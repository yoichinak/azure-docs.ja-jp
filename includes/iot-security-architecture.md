---
title: インクルード ファイル
description: インクルード ファイル
services: iot-suite
author: dominicbetts
ms.service: iot-suite
ms.topic: include
ms.date: 04/24/2018
ms.author: dobett
ms.custom: include file
ms.openlocfilehash: 1137f1dac9570b56dc202194e5f94dfd72c31c9f
ms.sourcegitcommit: e0a678acb0dc928e5c5edde3ca04e6854eb05ea6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/13/2018
ms.locfileid: "39029972"
---
# <a name="internet-of-things-security-architecture"></a>モノのインターネットのセキュリティ アーキテクチャ

システムを設計する際は、そのシステムに対する脅威のリスクを把握し、設計と構築時にそれに応じた適切な防御措置を講じることが重要となります。 重要なことは、最初からセキュリティを考慮に入れて製品を設計することです。攻撃者がどのような方法でシステムに侵入しうるかを把握しておけば、適切な軽減策を初期段階から講じることができるためです。

## <a name="security-starts-with-a-threat-model"></a>セキュリティの第一歩は脅威モデル

マイクロソフトは以前から自社製品に脅威モデルを採用すると共に、だれもが使用できるよう、その脅威モデル化プロセスを公開してきました。 Microsoft の経験上、モデル化には、懸念される脅威が把握しやすくなるというだけでなく、それ以上に思いがけない利点もあります。 たとえば開発チーム以外の人々との間で、率直な議論ができるようになり、新しいアイデアや改善策が製品にもたらされることがあります。

脅威をモデル化する目的は、攻撃者がどのような方法でシステムに侵入しうるかを把握したうえで、適切な軽減策を講じることです。 脅威がモデル化されていれば設計チームは否応なしに、システムのデプロイ後ではなく設計段階で軽減策を考慮するようになります。 この点は非常に重要です。なぜなら、現場で稼働している無数のデバイスに対してセキュリティ対策を行うことは現実的ではなく、間違いが起きやすいうえに、利用者を危険にさらすことになるからです。

システムのユーザーに利益をもたらす機能的要件を収集することは多くの開発チームが得意とすることです。 しかし漠然と、何者かによって行われるシステム悪用の手法を見極めようとすると、ぐっと難易度が上がります。 攻撃者がどのようなことを、どのような理由で行うのか。その点を開発チームは、脅威のモデル化によって把握することができます。 脅威のモデル化は、セキュリティの設計上や、セキュリティに影響を及ぼす設計変更上の意思決定についての論点を形成する体系化されたプロセスです。 脅威モデルは単なるドキュメントですが、このように文書化することが、知識の継続と獲得した教訓の蓄積、新しいチームの迅速な受け入れに寄与する最良の方法でもあります。 また、セキュリティに関して顧客に約束する必達目標など、セキュリティをさまざまな角度から考慮できることも、脅威のモデル化の成果の一つといえます。 脅威のモデル化と共に、こうした必達目標が貴社の IoT (モノのインターネット) ソリューションに関する情報提供となり、テストを促進する要因となります。

### <a name="when-to-threat-model"></a>いつ脅威のモデル化を行うか


  [脅威のモデル化](https://www.microsoft.com/en-us/sdl/adopt/threatmodeling.aspx)は、設計フェーズに組み込まれたときにその価値が最大となります。 脅威を排除するための変更には、設計段階が最も柔軟に対応できます。 設計によって脅威を排除することが成果として求められます。 その方が軽減策を後から追加してテストし、最新の状態に保つよりもはるかに容易です。そもそも、後から脅威を排除することが必ずしも可能であるとは限りません。 製品の完成度が増してくるにつれて、脅威を排除することは難しくなっていきます。結局は、脅威のモデル化を開発の初期段階で行った場合と比べて必要な作業が増え、より重要な部分でトレードオフに苦渋の決断を迫られることとなります。

### <a name="what-to-threat-model"></a>脅威のモデル化の対象は何か

脅威のモデルは、ソリューション全体を対象とし、次の点に着目する必要があります。

* セキュリティとプライバシーの機能
* 不具合がセキュリティに影響するような機能
* 信頼の境界と面する機能

### <a name="who-threat-models"></a>だれが脅威のモデル化を行うか

脅威のモデル化は、特別なプロセスではありません。 脅威モデルのドキュメントは、ソリューションを構成する他の要素と同様に取り扱い、検証することをお勧めします。 システムのユーザーに利益をもたらす機能的要件を収集することは多くの開発チームが得意とすることです。 しかし漠然と、何者かによって行われるシステム悪用の手法を見極めようとすると、ぐっと難易度が上がります。 攻撃者がどのようなことを、どのような理由で行うのか。その点を開発チームは、脅威のモデル化によって把握することができます。

### <a name="how-to-threat-model"></a>どのように脅威のモデル化を行うか

脅威のモデル化プロセスは、次の 4 つのステップから成ります。

* アプリケーションのモデル化
* 脅威の列挙
* 脅威の軽減
* 軽減策の検証

#### <a name="the-process-steps"></a>モデル化プロセスのステップ

実際に即した方法でいうと、脅威モデルは次の 3 つの手順で構築します。

1. リファレンス アーキテクチャを基に図を作成します。
1. 概要の把握に着手します。 深く踏み込んで調査する前に概要を見極め、システムの全体像を把握します。 この方法で、詳しく掘り下げるべきポイントを確実に特定することができます。
1. モデル化のプロセスを推進します。本来の目的を忘れないようにしてください。プロセスそのものに縛られてはいけません。 つまりモデル化のフェーズで問題が見つかり、詳しく調査したいと思ったら、そのようにしてください。 盲目的にその手順に従う必要はありません。

#### <a name="threats"></a>脅威

脅威モデルの核となる要素は次の 4 つです。

* プロセス (Web サービス、Win32 サービス、*nix デーモンなど)。 いくつかの複雑なエンティティ (フィールド ゲートウェイ、センサーなど) については、その領域を技術的に掘り下げることが困難である場合には、プロセスとして概念化できます。
* データ ストア (構成ファイルやデータベースなど、さまざまなデータの保存場所)。
* データ フロー (アプリケーション内の要素間におけるデータの移動)。
* 外部エンティティ。システムと接する要素のうちアプリケーションの管理下にないもの (ユーザー、衛星伝送など)。

アーキテクチャ図の要素はいずれも、さまざまな脅威の影響を受けます。この記事では、それらの頭文字を取って STRIDE と読んでいます。 STRIDE の各要素の詳細については、「[Threat Modeling Again, STRIDE (STRIDE に基づく脅威のモデル化)](https://blogs.msdn.microsoft.com/larryosterman/2007/09/04/threat-modeling-again-stride/)」を参照してください。

アプリケーション図を構成する各要素が、STRIDE で表されるそれぞれ異なった脅威にさらされます。

* プロセスは STRIDE の影響を受けます。
* データ フローは TID の影響を受けます。
* データ ストアは TID の影響を受けます。データ ストアがログ ファイルである場合、R の影響も受けます。
* 外部エンティティは SRD の影響を受けます。

## <a name="security-in-iot"></a>IoT のセキュリティ

特殊な用途をもって接続されるデバイスには、膨大な数の対話領域と対話パターンがあり、デバイスへのデジタル アクセスのセキュリティを確保するうえでは、そのすべてを、基本的な枠組みを形成するものとして捉える必要があります。 デバイスを直接操作することによって実行される操作 (アクセス セキュリティは物理的な立ち入り管理によって確保される) と区別するために、ここでは "デジタル アクセス" という言葉を使用しています。 たとえば施錠された部屋にデバイスを設置することは、物理的な立ち入り管理の領域です。 物理的アクセスをソフトウェアやハードウェアによって防止することはできませんが、物理的なアクセスがシステム障害に発展するのを防ぐための対策を講じることはできます。

対話パターンを調査するときに注目するのは、"デバイスの制御" と "デバイスのデータ" です。その両者に同程度の注意を払う必要があります。 "デバイスの制御" は、動作に何らかの変更または作用を与えてその状態やその環境の状態を変えるためにデバイスに与えられる情報と見なすことができます。 これに対し、"デバイスのデータ" は、デバイスがその状態やその環境に関して観察された状態について、他者に出力する情報と見なすことができます。

脅威のモデル化を実践する過程では、セキュリティのベスト プラクティスを最適な形で適用するために、標準的な IoT アーキテクチャをいくつかのコンポーネント/ゾーンに分割することをお勧めします。 このセクションを通じて、これらのゾーンについて詳しく見ていくことにしましょう。以下のようなゾーンがあります。

* デバイス
* フィールド ゲートウェイ
* クラウド ゲートウェイ
* 承認。

ゾーンは、大まかにソリューションを分割する手法です。それぞれのゾーンに、固有のデータや認証要件、承認要件が存在することも少なくありません。 被害を隔離したり、低い信頼ゾーンがそれより高い信頼ゾーンに及ぼす影響を限定したりする目的にもゾーンは使用されます。

各ゾーンは信頼の境界によって仕切られています。下の図に赤色の点線で示した箇所が信頼の境界です。 この図は、ソースからソースへのデータまたは情報の遷移を表しています。 この遷移の過程でデータや情報は STRIDE、つまり Spoofing (スプーフィング)、Tampering (改ざん)、Repudiation (否認)、Information Disclosure (情報漏えい)、Denial of Service (サービス拒否)、Elevation of Privilege (特権の昇格) の影響にさらされることとなります。

![IoT Security Zones](media/iot-security-architecture/iot-security-architecture-fig1.png) 

それぞれの境界の内側に描写されている構成要素もまた STRIDE の影響下にあり、こうしてソリューションの脅威をあらゆる角度からモデル化することができます。 以下の各セクションで、それぞれの構成要素について詳しく説明すると共に、セキュリティ上の具体的な懸念事項と導入すべき解決策について取り上げます。

では、これらのゾーンで一般的に見られる標準的な構成要素について見ていきましょう。

### <a name="the-device-zone"></a>デバイス ゾーン

デバイス環境とは、デバイスと物理的に近接し、物理的に近づいたり "ローカル ネットワーク" を介してデバイスにピア ツー ピアでデジタル アクセスしたりできる空間を指します。 "ローカル ネットワーク" は、パブリック インターネットと明確に区別され隔離された (ただしパブリック インターネットとの橋渡し的な役割を果たすこともある) ネットワークであり、デバイスどうしのピア ツー ピア通信を可能にする狭い範囲の無線技術を含みます。 そうしたローカル ネットワークを擬似的に作り出すネットワークの仮想化技術は "*対象外*" となります。また、2 台のデバイスがピア ツー ピア通信の関係を結ぶうえでパブリック ネットワーク空間を介した通信が必要となるような公共通信事業者のネットワークも、ローカル ネットワークには当てはまりません。

### <a name="the-field-gateway-zone"></a>フィールド ゲートウェイ ゾーン

フィールド ゲートウェイは、通信を可能にする要素として、また場合によってはデバイスの制御システムやデバイスのデータ処理の拠点としての役割を果たします。 フィールド ゲートウェイのゾーンには、フィールド ゲートウェイ自体とそこに接続されているすべてのデバイスが含まれます。 フィールド ゲートウェイは、その名前が示すように、専用のデータ処理機構の外で作動します。通常、特定の場所に固定され、物理的な侵入のリスクがあります。また、運用上の冗長性は限られています。 フィールド ゲートウェイとは一般に、何者かがその働きを理解したうえで近づき、妨害行為を行うことができる対象をいいます。

アクセスと情報の流れを管理することにおいて積極的役割を果たしてきたという点で、フィールド ゲートウェイは単なるトラフィック ルーターとは異なります。つまり、アプリケーションによってアドレス指定されるエンティティやネットワーク接続端末、セッション端末が、フィールド ゲートウェイということになります。 一方、NAT デバイスやファイアウォールは、フィールド ゲートウェイの資格を満たしません。明示的な接続やセッション端末というよりは、むしろ、それらによって確立される接続やセッションをルーティング (またはブロック) する働きが主体です。 フィールド ゲートウェイには、2 種類の攻撃対象領域があります。 1 つは、フィールド ゲートウェイに接続されているデバイスと接する領域です。フィールド ゲートウェイ ゾーンの内側を表します。もう 1 つは、外部からのあらゆる通信と接する領域で、フィールド ゲートウェイ ゾーンのエッジの部分となります。

### <a name="the-cloud-gateway-zone"></a>クラウド ゲートウェイ ゾーン

クラウド ゲートウェイは、デバイスまたはフィールド ゲートウェイと、さまざまなサイトとの間でパブリック ネットワーク空間を介してリモート通信を可能にするシステムです。その先には通常、クラウドベースの制御/データ分析システム、つまりそのようなシステムが連携する集合体が存在します。 場合によっては、タブレットやスマートフォンなどの端末から特殊用途のデバイスへのアクセスをクラウド ゲートウェイが直接つかさどるケースもあります。 ここでいう "クラウド" とは、接続されているデバイスやフィールド ゲートウェイと同じ場所に固定されない専用のデータ処理システムを指します。 またクラウド ゾーンでは、運用上の対策によって標的への物理的なアクセスができないようになっており、必ずしも "パブリック クラウド" インフラストラクチャには公開されていません。  

クラウド ゲートウェイとそこに接続されているすべてのデバイス (またはフィールド ゲートウェイ) を他のネットワーク トラフィックから隔離するために、クラウド ゲートウェイはネットワーク仮想化オーバーレイにマッピングすることも考えられます。 クラウド ゲートウェイそのものは、デバイス制御システムではなく、デバイス データの処理や保存を行う機構でもありません。そうした機構とのインターフェイスとなります。 クラウド ゲートウェイ ゾーンには、クラウド ゲートウェイ自体のほか、そこに直接または間接的に接続されているすべてのフィールド ゲートウェイとデバイスが含まれます。 このゾーンのエッジは、外部からのあらゆる通信が経由する明確な攻撃対象領域となっています。

### <a name="the-services-zone"></a>サービス ゾーン

ここでいう "サービス" とは、データの収集と分析、コマンド、制御などを目的に、フィールド ゲートウェイまたはクラウド ゲートウェイを介してデバイスと連動するソフトウェア コンポーネントまたはモジュールのことです。 サービスは橋渡し的な役割を持ちます。 サービスはその ID の下で、ゲートウェイをはじめとするサブシステムに働きかけ、データの保存や分析を行い、そこから得られた知見やスケジュールに基づいて、デバイスに自律的にコマンドを発行したり、承認されたエンド ユーザーに対して情報や制御機能を提供したりする役割を果たします。

### <a name="information-devices-versus-special-purpose-devices"></a>情報デバイスと特殊用途デバイス

PC、スマートフォン、タブレットは、代表的な双方向情報デバイスです。 スマートフォンとタブレットは、バッテリの駆動時間を最大化することを念頭に設計されています。 すぐにユーザーが操作するような状況にないときや、音楽の再生や目的地へのナビゲーションといったサービスを提供していないときには、一部の機能がオフになるのが理想です。 システムの観点から見ると、これらの IT デバイスは主にユーザーの分身として人に働きかけます。 つまり人に何かの行動を起こさせる働きや、入力データを収集して人を感知する働きがあるといえます。

一方、特殊用途のデバイスは、単純な温度センサーから、無数のコンポーネントから成る複雑な工場製造ラインまでさまざまです。 情報デバイスと比べて、はるかに目的が限定的であり、ユーザー インターフェイスが備わっていたとしても、物理的空間の中の技術と連動するか、そのような技術に組み込まれていることが大半です。 周囲温度の測定と報告、バルブの開閉、サーボの制御、警告音の発報、照明のオン/オフといったさまざまな作業を行います。 特殊用途のデバイスは、汎用性が優先される情報デバイスでは使用に耐えない、または情報デバイスではコストやサイズが大きすぎる、衝撃に弱すぎるといった状況で活躍します。 技術的な設計や、製造に認められる予算、稼働予定年数には、その具体的な目的がそのまま反映されます。 許容される消費電力コスト、物理的な据付面積、ひいては利用できる記憶域、計算能力、セキュリティ機能は、この 2 つの主要要因の制約を受けることとなります。

オートメーション化されたデバイスやリモート制御のデバイスに、物理的な不良や制御ロジックの欠陥など何らかの "問題" が生じた場合、意図的な侵害行為や不正な操作につながります。 製造ロットの破壊、建物の略奪や火事、人身事故、最悪、死亡事故が起こる可能性もあります。 その被害の大きさは、クレジット カードの盗難に遭って限度額いっぱいまで使われたというのとは、まったく次元が異なります。 モノを動かすデバイスや、モノを動かすコマンドに直結するセンサー データには、E コマースやバンキングよりも高いセキュリティ水準が求められます。

### <a name="device-control-and-device-data-interactions"></a>デバイス制御とデバイス データの対話

特殊な用途をもって接続されるデバイスには、膨大な数の対話領域と対話パターンがあり、デバイスへのデジタル アクセスのセキュリティを確保するうえでは、そのすべてを、基本的な枠組みを形成するものとして捉える必要があります。 デバイスを直接操作することによって実行される操作 (アクセス セキュリティは物理的な立ち入り管理によって確保される) と区別するために、ここでは "デジタル アクセス" という言葉を使用しています。 たとえば施錠された部屋にデバイスを設置することは、物理的な立ち入り管理の領域です。 物理的アクセスをソフトウェアやハードウェアによって防止することはできませんが、物理的なアクセスがシステム障害に発展するのを防ぐための対策を講じることはできます。

対話パターンを調査するときに注目するのは、"デバイスの制御" と "デバイスのデータ" です。脅威をモデル化する際は、その両者に同程度の注意を払う必要があります。 "デバイスの制御" は、動作に何らかの変更または作用を与えてその状態やその環境の状態を変えるためにデバイスに与えられる情報と見なすことができます。 これに対し、"デバイスのデータ" は、デバイスがその状態やその環境に関して観察された状態について、他者に出力する情報と見なすことができます。

## <a name="threat-modeling-the-azure-iot-reference-architecture"></a>Azure IoT リファレンス アーキテクチャの脅威のモデル化

Microsoft は、既に述べたフレームワークを使って Azure IoT の脅威をモデル化しています。 以下のセクションで、IoT に対する脅威のモデル化の考え方とそれによって特定された脅威の解決方法を、具体的な Azure IoT リファレンス アーキテクチャの例を用いて説明します。 この例では、主に 4 つの領域が注目されます。

* デバイスとデータ ソース
* データ転送
* デバイスとイベント処理
* プレゼンテーション

![Threat Modeling for Azure IoT](media/iot-security-architecture/iot-security-architecture-fig2.png)

次の図は、Microsoft Threat Modeling Tool で使用されているデータ フロー ダイアグラム モデルを使ってマイクロソフトの IoT アーキテクチャを単純化したものです。

![Threat Modeling for Azure IoT using MS Threat Modeling Tool](media/iot-security-architecture/iot-security-architecture-fig3.png)

このアーキテクチャは、デバイスの機能とゲートウェイの機能が切り離されていることに注目してください。 この方法によって、より安全性の高いゲートウェイ デバイスを利用できるようになっています。つまりユーザーは、安全なプロトコルを使ってクラウド ゲートウェイと通信できます。一般に、安全なプロトコルの使用には、デバイス (サーモスタットなど) に本来備わっている以上の処理オーバーヘッドが伴います。 Azure サービス ゾーンにおけるクラウド ゲートウェイは Azure IoT Hub サービスを想定しています。

### <a name="device-and-data-sourcesdata-transport"></a>デバイスとデータ ソース/データ転送

このセクションでは、前に示したアーキテクチャを脅威のモデル化の観点から詳しく見ていきます。また、このアーキテクチャ特有の問題点をマイクロソフトがどのように解決しているかについても簡単に説明します。 この例では、脅威モデルの核となる要素に焦点を絞って説明します。

* 処理 (管理下にあるものと外部項目の両方)
* 通信 (データ フロー)
* 記憶域 (データ ストア)

#### <a name="processes"></a>処理

Azure IoT アーキテクチャに示したカテゴリごとに、この例では、データ/情報が存在する各種のステージ (処理、通信、記憶域) にわたって、さまざまな脅威の軽減に努めます。 次に "処理" カテゴリに関して最も一般的な脅威について大まかに述べた後、それらの驚異の最善の軽減策について簡単に説明します。

**スプーフィング (S)**: 攻撃者が、ソフトウェア レベルまたはハードウェア レベルでデバイスから暗号化キー マテリアルを抽出し、その後、その抽出元となったデバイスの ID で、異なる物理デバイスまたは異なる仮想デバイスからシステムにアクセスする可能性があります。 たとえばテレビを操作するリモコンが、いたずらの道具に使われる可能性があります。

**サービス拒否 (D)**: 妨害電波やケーブルの切断によって、デバイスの機能が停止したり、通信できない状態になったりする可能性があります。 たとえば、電源やネットワーク接続が意図的に切断された防犯カメラは、データをまったく報告することができなくなります。

**改ざん (T)**: デバイス上で実行されているソフトウェアの一部または全部が、攻撃者によって差し替えられるおそれがあります。キー マテリアルまたはそのキー マテリアルを保持する暗号機構に違法なプログラムがアクセスできた場合、差し替わったソフトウェアによって、デバイスの本物の ID が悪用される可能性があります。 たとえば攻撃者が、抽出したキー マテリアルを利用して、デバイスからのデータを通信経路上で傍受、遮断し、偽のデータに置き換えて、盗んだキー マテリアルで認証をパスすることが考えられます。

**情報漏えい (I)**: デバイス上で実行されるソフトウェアが改変されていた場合、その改変されたソフトウェアから、許可していない相手にデータが漏えいするおそれがあります。 たとえば攻撃者が、抽出したキー マテリアルを悪用し、デバイスとコントローラー (フィールド ゲートウェイまたはクラウド ゲートウェイ) との間の通信経路にそのキー マテリアルを注入して情報を吸い上げるおそれがあります。

**特権の昇格 (E)**: 特定の働きをするデバイスが、他の目的に利用される可能性があります。 たとえば半開状態となるようにプログラムされているバルブが、意図的に全開にされる可能性があります。

| **コンポーネント** | **脅威** | **対応策** | **リスク** | **実装** |
| --- | --- | --- | --- | --- |
| Device |S |デバイスに ID を割り当てて本物であることを確認します。 |デバイスまたはその一部が他のデバイスに差し替えられます。 意図したデバイスと通信しているという確信はどうすれば得られるでしょうか。 |トランスポート層セキュリティ (TLS) または IPSec を使ってデバイスを認証します。 完全な非対称暗号を扱うことのできないデバイスでは、インフラストラクチャが事前共有キー (PSK) の使用をサポートしている必要があります。 Azure AD の [OAuth](https://www.rfc-editor.org/pdfrfc/rfc6755.txt.pdf) をご利用ください。 |
|| TRID |改ざん防止機構をデバイスに適用します。たとえば、デバイスからキーや他の暗号マテリアルを抽出することが困難または不可能となるようにします。 |何者かによってデバイスが改ざんされた場合にリスクが発生します (物理的干渉)。 デバイスが改ざんされていないという確信はどうすれば得られるでしょうか。 |最も効果的な軽減策は、トラステッド プラットフォーム モジュール (TPM) 機能です。基盤に直付けされた特殊な回路にキーを格納することができます。この回路からキーを読み出すことはできません。この回路は、格納されたキーを使う暗号処理にのみ利用でき、そこからキーが漏えいすることは決してありません。 デバイスのメモリの暗号化、 デバイスのキー管理、 コード署名を行います。 | |
|| E |デバイスのアクセス制御を行います。 承認スキームを設けます。 |外部ソース (または侵害されたセンサー) からのコマンドによってデバイスの操作を別途実行できた場合、本来であれば利用できない操作を攻撃者に許すことになります。 |デバイスの承認スキームを設けます。 | |
| フィールド ゲートウェイ |S |クラウド ゲートウェイに対してフィールド ゲートウェイが本物であることを証明します (証明書、PSK、要求など)。 |何者かがフィールド ゲートウェイになりすました場合、任意のデバイスに見せかけることができます。 |TLS RSA/PSK、IPSec、[RFC 4279](https://tools.ietf.org/html/rfc4279)。 キーの保存と認証に関してはデバイスの場合とまったく同じです。TPM を使用することが最善の方法となります。 IPSec の 6LowPAN 拡張によってワイヤレス センサー ネットワーク (WSN) をサポートします。 |
|| TRID |改ざんされないようにフィールド ゲートウェイを保護します (TPM を使用するなど)。 |なりすましによる攻撃。一見フィールド ゲートウェイと通信しているかのようにクラウド ゲートウェイに見せかけて情報を漏えいさせたり、データを改ざんしたりします。 |メモリの暗号化、TPM、認証。 | |
|| E |フィールド ゲートウェイにアクセス制御機構を導入します。 | | | |

このカテゴリの脅威の例をいくつか紹介します。

スプーフィング: 攻撃者が、ソフトウェア レベルまたはハードウェア レベルでデバイスから暗号化キー マテリアルを抽出し、その後、その抽出元となったデバイスの ID で、異なる物理デバイスまたは異なる仮想デバイスからシステムにアクセスする可能性があります。

**サービス拒否**: 妨害電波やケーブルの切断によって、デバイスの機能が停止したり、通信できない状態になったりする可能性があります。 たとえば、電源やネットワーク接続が意図的に切断された防犯カメラは、データをまったく報告することができなくなります。

**改ざん**: デバイス上で実行されているソフトウェアの一部または全部が、攻撃者によって差し替えられるおそれがあります。キー マテリアルまたはそのキー マテリアルを保持する暗号機構に違法なプログラムがアクセスできた場合、差し替わったソフトウェアによって、デバイスの本物の ID が悪用される可能性があります。

**改ざん**: たとえば、だれもいない廊下の写真を防犯カメラにかざすことによって、そのような廊下の可視スペクトル画像が表示されることが考えられます。 発煙センサーや火災感知器の下で何者かがライターを点火したことによって、警報が鳴ることも考えられます。 いずれの場合も、デバイスのシステムとしては、技術的に十分な信頼性が確保されているかもしれませんが、報告される情報は改変されています。

**改ざん**: 攻撃者が、抽出したキー マテリアルを利用して、デバイスからのデータを通信経路上で傍受、遮断し、偽のデータに置き換えて、盗んだキー マテリアルで認証をパスすることが考えられます。

**改ざん**: デバイス上で実行されているソフトウェアの一部または全部が、攻撃者によって差し替えられるおそれがあります。キー マテリアルまたはそのキー マテリアルを保持する暗号機構に違法なプログラムがアクセスできた場合、差し替わったソフトウェアによって、デバイスの本物の ID が悪用される可能性があります。

**情報漏えい**: デバイス上で実行されるソフトウェアが改変されていた場合、その改変されたソフトウェアから、許可していない相手にデータが漏えいするおそれがあります。

**情報漏えい**: 攻撃者が、抽出したキー マテリアルを悪用し、デバイスとコントローラー (フィールド ゲートウェイまたはクラウド ゲートウェイ) との間の通信経路にそのキー マテリアルを注入して情報を吸い上げるおそれがあります。

**サービス拒否**: さまざまな産業用機械で意図的にデバイスの電源が切られたり、通信ができないモードに設定されたりするおそれがあります。

**改ざん**: 制御システムにとって未知の状態 (既知のキャリブレーション パラメーターの範囲外) で動作するようにデバイスの構成が変更され、間違った解釈につながりうるデータがデバイスから出力される可能性があります。

**特権の昇格**: 特定の機能を実行するデバイスが、他の目的に利用される可能性があります。 たとえば半開状態となるようにプログラムされているバルブが、意図的に全開にされる可能性があります。

**サービス拒否**: デバイスが通信不可能な状態になる可能性があります。

**改ざん**: 制御システムにとって未知の状態 (既知のキャリブレーション パラメーターの範囲外) で動作するようにデバイスの構成が変更され、間違った解釈につながりうるデータがデバイスから出力される可能性があります。

**スプーフィング/改ざん/否認**: 民生用のリモコンでまれにあることですが、セキュリティが確保されていない場合、攻撃者がデバイスの状態を匿名で操作することができます。 たとえばテレビを操作するリモコンが、いたずらの道具に使われる可能性があります。

#### <a name="communication"></a>Communication

デバイス間、デバイスとフィールド ゲートウェイ間、デバイスとクラウド ゲートウェイ間の通信経路に関する脅威について取り上げます。 次の表は、デバイス/VPN 上のオープン ソケットに関するいくつかの指針をまとめたものです。

| **コンポーネント** | **脅威** | **対応策** | **リスク** | **実装** |
| --- | --- | --- | --- | --- |
| デバイス対 IoT Hub |TID |(D)TLS (PSK/RSA) によってトラフィックを暗号化します。 |デバイスとゲートウェイとの間の通信を傍受または妨害します。 |プロトコル レベルでセキュリティを確保します。 カスタム プロトコルの場合は、その保護方法を把握する必要があります。 ほとんどの場合、通信は、デバイスと IoT Hub との間で行われます (デバイス側から接続が開始されます)。 |
| デバイス対デバイス |TID |(D)TLS (PSK/RSA) によってトラフィックを暗号化します。 |デバイス間で転送されているデータが読み取られます。 データが改ざんされます。 デバイスに対する新規接続が過剰に繰り返されます。 |プロトコル レベルでセキュリティを確保します (MQTT/AMQP/HTTP/CoAP)。 カスタム プロトコルの場合は、その保護方法を把握する必要があります。 DoS の脅威を軽減するには、クラウド ゲートウェイまたはフィールド ゲートウェイを介してデバイスをピアリングし、それらのデバイスがネットワークに対するクライアントとしてのみ動作するように徹底します。 ピアリングされた 2 台のデバイスは、ゲートウェイによって仲介された後に直接接続となる場合があります。 |
| 外部エンティティ対デバイス |TID |外部エンティティをデバイスに対して強力にペアリングします。 |デバイスへの接続が傍受されます。 デバイスとの通信が妨害されます。 |外部エンティティをデバイスの NFC/Bluetooth LE に対して確実にペアリングします。 デバイスの操作パネルを制御します (物理)。 |
| フィールド ゲートウェイ対クラウド ゲートウェイ |TID |TLS (PSK/RSA) によってトラフィックを暗号化します。 |デバイスとゲートウェイとの間の通信を傍受または妨害します。 |プロトコル レベルでセキュリティを確保します (MQTT/AMQP/HTTP/CoAP)。 カスタム プロトコルの場合は、その保護方法を把握する必要があります。 |
| デバイス対クラウド ゲートウェイ |TID |TLS (PSK/RSA) によってトラフィックを暗号化します。 |デバイスとゲートウェイとの間の通信を傍受または妨害します。 |プロトコル レベルでセキュリティを確保します (MQTT/AMQP/HTTP/CoAP)。 カスタム プロトコルの場合は、その保護方法を把握する必要があります。 |

このカテゴリの脅威の例をいくつか紹介します。

**サービス拒否**: 一般に、制約の厳しいデバイスは、受信接続や一方的に送りつけられるデータグラムをネットワーク上で常時待機する形で DoS の脅威にさらされます。攻撃者は、多数の接続を同時に開き、何も処理を行わないか、処理に時間をかけることがあります。また、一方的なトラフィックでデバイスの処理能力をパンクさせる場合もあります。 どちらの場合もデバイスは事実上、ネットワークで機能不全の状態となります。

**スプーフィング、情報漏えい**: 制約の厳しいデバイスや特殊用途のデバイスには、パスワードや PIN による保護など、万能型のセキュリティ機構が採用されていたり、ネットワークが信頼できるという前提で動作していたりするケースが少なくありません。デバイスが同じネットワーク上にあれば情報へのアクセスは許可されますが、肝心のネットワークの保護に共有キーしか使われていないケースが多く見られます。 デバイスやネットワークに対する共有シークレットが漏えいした場合、デバイスが制御されたり、デバイスから出力されたデータが傍受されたりする可能性があります。  

**スプーフィング**: 攻撃者は放送を傍受するか、部分的にオーバーライドして、発信元になりすます場合があります (中間者攻撃)。

**改ざん**: 攻撃者は放送を傍受するか、部分的にオーバーライドして、偽の情報を送信する場合があります。 

**情報漏えい**: 攻撃者は放送を傍受して、承認なく情報を入手する場合があります。**サービス拒否**: 攻撃者は、放送信号を妨害して情報を配信できないようにする場合があります。

#### <a name="storage"></a>Storage

すべてのデバイスとフィールド ゲートウェイは、何らかの形態の記憶域を持ちます (データをキューに格納するための一時的な記憶域、オペレーティング システム (OS) イメージを保存するための記憶域など)。

| **コンポーネント** | **脅威** | **対応策** | **リスク** | **実装** |
| --- | --- | --- | --- | --- |
| デバイスの記憶域 |TRID |記憶域を暗号化し、ログに署名します。 |記憶域からデータ (個人を特定できる情報) が読み取られたり、テレメトリ データが改ざんされたりします。 キューやキャッシュに格納されたコマンド制御データが改ざんされます。 構成の更新パッケージやファームウェアの更新パッケージが、ローカルにキャッシュされるかローカルのキューに格納されている間に改ざんされた場合、OS やシステム コンポーネントのセキュリティ侵害につながる可能性があります |暗号化、メッセージ認証コード (MAC)、またはデジタル署名を導入します。 可能であれば、アクセス許可またはリソース アクセス制御リスト (ACL) を使った強力なアクセス制御を導入します。 |
| デバイスの OS イメージ |TRID | |OS が改ざんされたり、OS コンポーネントが差し替えられたりします。 |OS パーティションの読み取り専用化、OS イメージの署名、暗号化を行います。 |
| フィールド ゲートウェイの記憶域 (データのキューイング) |TRID |記憶域を暗号化し、ログに署名します。 |記憶域からデータ (個人を特定できる情報) が読み取られたり、テレメトリ データが改ざんされたりします。キューやキャッシュに格納されたコマンド制御データが改ざんされることもあります。 (デバイスまたはフィールド ゲートウェイに対する) 構成の更新パッケージやファームウェアの更新パッケージが、ローカルにキャッシュされるかローカルのキューに格納されている間に改ざんされた場合、OS やシステム コンポーネントのセキュリティ侵害につながる可能性があります |BitLocker |
| フィールド ゲートウェイの OS イメージ |TRID | |OS が改ざんされたり、OS コンポーネントが差し替えられたりします。 |OS パーティションの読み取り専用化、OS イメージの署名、暗号化を行います。 |

### <a name="device-and-event-processingcloud-gateway-zone"></a>デバイスとイベント処理/クラウド ゲートウェイ ゾーン

クラウド ゲートウェイは、デバイスまたはフィールド ゲートウェイと、さまざまなサイトとの間でパブリック ネットワーク空間を介してリモート通信を可能にするシステムです。その先には通常、クラウドベースの制御/データ分析システム、つまりそのようなシステムが連携する集合体が存在します。 場合によっては、タブレットやスマートフォンなどの端末から特殊用途のデバイスへのアクセスをクラウド ゲートウェイが直接つかさどるケースもあります。 ここでいう "クラウド" とは、接続されているデバイスやフィールド ゲートウェイと同じ場所に固定されない専用のデータ処理システムを指します。運用上の対策によって標的への物理的なアクセスができないようになっていますが、必ずしも "パブリック クラウド" インフラストラクチャには公開されていません。 クラウド ゲートウェイとそこに接続されているすべてのデバイス (またはフィールド ゲートウェイ) を他のネットワーク トラフィックから隔離するために、クラウド ゲートウェイはネットワーク仮想化オーバーレイにマッピングすることも考えられます。 クラウド ゲートウェイそのものは、デバイス制御システムではなく、デバイス データの処理や保存を行う機構でもありません。そうした機構とのインターフェイスとなります。 クラウド ゲートウェイ ゾーンには、クラウド ゲートウェイ自体のほか、そこに直接または間接的に接続されているすべてのフィールド ゲートウェイとデバイスが含まれます。

クラウド ゲートウェイは、独自に構築されたソフトウェアであることが一般的です。サービスとして実行され、フィールド ゲートウェイやデバイスの接続先となるエンドポイントを公開します。 そのため、セキュリティを念頭に置いて設計されている必要があります。 このサービスの設計と構築については、[SDL](http://www.microsoft.com/sdl) プロセスに従います。

#### <a name="services-zone"></a>サービス ゾーン

制御システム (コントローラー) は、デバイスの制御を目的として、あるいは、デバイス データを収集、保存、分析して提示したり、その後の制御を行ったりするために、デバイスやフィールド ゲートウェイ、クラウド ゲートウェイと連動するソフトウェア ソリューションです。 制御システムは、ここで扱う範囲で唯一、人との対話を直接つかさどる可能性のある存在です。 ただし中間の物理的制御領域は例外です。つまり人がデバイスの電源をオフにしたり、さまざまな特性を変化させたりすることができるものの、デジタルでアクセスできる同等の機能が存在しないようなスイッチは制御システムではありません。

中間の物理的制御領域とは、同等の機能をリモートから開始したり、リモートの入力と競合するような入力を防止したりできるように、統制ロジックによって、物理的な制御領域の機能が制限されているような領域をいいます。そのような中間の制御領域は概念上、そのデバイスが並行して接続されている他のリモート制御システムと同じ基本機能を利用するローカルの制御システムに接続されます。 クラウド コンピューティングに対する主な脅威については、[Cloud Security Alliance (CSA)](https://cloudsecurityalliance.org/research/top-threats/) のページを参照してください。

## <a name="additional-resources"></a>その他のリソース

詳細については、次の記事を参照してください。

* [SDL Threat Modeling Tool](https://www.microsoft.com/sdl/adopt/threatmodeling.aspx)
* [Microsoft Azure IoT リファレンス アーキテクチャ](https://azure.microsoft.com/updates/microsoft-azure-iot-reference-architecture-available/)
