---
title: インクルード ファイル
description: インクルード ファイル
services: virtual-machines-windows, azure-resource-manager
author: genlin
ms.service: virtual-machines-windows
ms.topic: include
ms.date: 04/14/2018
ms.author: genli
ms.custom: include file
ms.openlocfilehash: f403e060859df6d1de96a3c0d478d57df2677eee
ms.sourcegitcommit: a1e1b5c15cfd7a38192d63ab8ee3c2c55a42f59c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/10/2018
ms.locfileid: "31531057"
---
以下に、割り当て要求が固定されることになる一般的な割り当てシナリオを示します。 この記事の後の方で、各シナリオについて説明します。

- VM のサイズの変更、あるいは既存のクラウド サービスへの VM またはロール インスタンスの追加
- 部分的に停止 (割り当て解除) されていた VM の再起動
- 完全に停止 (割り当て解除) されていた VM の再起動
- ステージング環境デプロイと運用環境デプロイ (サービスとしてのプラットフォームのみ)
- アフィニティ グループ (VM またはサービス近接性)
- アフィニティ グループ ベースの仮想ネットワーク

割り当てエラーが発生した場合は、示されているシナリオのいずれかがエラーに該当するかどうかをご確認ください。 Azure プラットフォームから返される割り当てエラーを使用すると、対応するシナリオを特定できます。 要求が固定されている場合は、固定している制約の一部を削除して、要求の対象となるクラスターを増やしてください。その結果、割り当てが成功する確率が高くなります。
一般に、「要求された VM サイズがサポートされていない」ことがエラーで示されていない場合は、後でいつでも再試行できます。 これは、要求を処理するクラスターで十分なリソースが解放される可能性があるためです。 要求された VM サイズがサポートされていないことが問題である場合は、別の VM サイズを試してください。 そうでない場合、唯一のオプションは、固定している制約を削除することです。

2 つの一般的なエラー シナリオはアフィニティ グループと関連しています。 以前は、アフィニティ グループは、VM およびサービス インスタンスの近接性を提供したり、仮想ネットワークを作成できるようにするために使用されていました。 リージョン仮想ネットワークの導入により、アフィニティ グループは仮想ネットワークの作成に必要ではなくなりました。 Azure インフラストラクチャでのネットワーク待機時間の短縮により、VM またはサービス近接性のためにアフィニティ グループを使用する必要性も変わりました。

次の図は、(固定された) 割り当てシナリオの分類を示しています。 

![Pinned Allocation Taxonomy](./media/virtual-machines-common-allocation-failure/Allocation3.png)

## <a name="resize-a-vm-or-add-vms-or-role-instances-to-an-existing-cloud-service"></a>VM のサイズの変更、あるいは既存のクラウド サービスへの VM またはロール インスタンスの追加
**エラー**

Upgrade_VMSizeNotSupported または GeneralError

**クラスターの固定の原因**

VM のサイズの変更、あるいは既存のクラウド サービスへの VM またはロール インスタンスの追加の要求は、既存のクラウド サービスをホストしている元のクラスターで試行する必要があります。 新しいクラウド サービスを作成すると、Azure プラットフォームは、空きリソースを持つクラスターや要求された VM サイズをサポートしているクラスターを別途検索できます。

**対処法**

エラーが Upgrade_VMSizeNotSupported* である場合は、別の VM サイズを試してみてください。 別の VM サイズを使用できないものの、別の仮想 IP アドレス (VIP) を使用できる場合は、新しい VM をホストする新しいクラウド サービスを作成し、既存の VM が実行されているリージョン仮想ネットワークにその新しいクラウド サービスを追加します。 既存のクラウド サービスがリージョン仮想ネットワークを使用しない場合も、新しいクラウド サービス用の新しい仮想ネットワークを作成し、 [既存の仮想ネットワークを新しい仮想ネットワーク](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)に接続できます。 詳細については、「 [リージョン仮想ネットワーク](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)」を参照してください。

エラーが GeneralError* である場合は、リソースの種類 (特定の VM サイズなど) がクラスターでサポートされているものの、現時点ではクラスターに空きリソースがないと考えられます。 上のシナリオと同じように、新しいクラウド サービスを作成することによって、必要なコンピューティング リソースを追加します (新しいクラウド サービスは別の VIP を使用する必要がある点に注意してください)。その後、リージョン仮想ネットワークを使用して、クラウド サービスに接続します。

## <a name="restart-partially-stopped-deallocated-vms"></a>部分的に停止 (割り当て解除) されていた VM の再起動
**エラー**

GeneralError*

**クラスターの固定の原因**

部分的割り当て解除とは、クラウド サービス内のすべての VM ではなく、1 つ以上の VM を停止 (割り当て解除) したことを意味します。 VM を停止 (割り当て解除) すると、関連付けられているリソースが解放されます。 そのため、停止された (割り当て解除された) VM を再起動すると、新しい割り当てが要求されます。 部分的に割り当て解除されたクラウド サービスで VM を再起動することは、既存のクラウド サービスに VM を追加することと同じです。 割り当て要求は、既存のクラウド サービスをホストしている元のクラスターで試行する必要があります。 別のクラウド サービスを作成すると、Azure プラットフォームは、空きリソースを持つクラスターや要求された VM サイズをサポートしているクラスターを別途検索できます。

**対処法**

別の VIP を使用できる場合は、停止 (割り当て解除) された VM を削除し (ただし、関連付けられているディスクは保持し)、別のクラウド サービスを通じて VM を追加し直します。 クラウド サービスに接続するには、リージョン仮想ネットワークを使用します。

* 既存のクラウド サービスがリージョン仮想ネットワークを使用している場合は、単に新しいクラウド サービスを同じ仮想ネットワークに追加します。
* 既存のクラウド サービスがリージョン仮想ネットワークを使用しない場合、新しいクラウド サービス用の新しい仮想ネットワークを作成し、 [既存の仮想ネットワークを新しい仮想ネットワーク](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)に接続します。 詳細については、「 [リージョン仮想ネットワーク](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)」を参照してください。

## <a name="restart-fully-stopped-deallocated-vms"></a>完全に停止 (割り当て解除) されていた VM の再起動
**エラー**

GeneralError*

**クラスターの固定の原因**

完全割り当て解除とは、クラウド サービス内のすべての VM を停止 (割り当て解除) したことを意味します。 これらの VM を再起動するための割り当て要求は、クラウド サービスをホストしている元のクラスターで試行する必要があります。 新しいクラウド サービスを作成すると、Azure プラットフォームは、空きリソースを持つクラスターや要求された VM サイズをサポートしているクラスターを別途検索できます。

**対処法**

別の VIP を使用できる場合は、停止 (割り当て解除) された元の VM を削除し (ただし、関連付けられているディスクは保持し)、対応するクラウド サービスを削除します (関連付けられているコンピューティング リソースは、VM を停止 (割り当て解除) したときに既に解放されています)。 新しいクラウド サービスを作成し、VM を追加し直します。

## <a name="stagingproduction-deployments-platform-as-a-service-only"></a>ステージング環境/運用環境のデプロイメント (サービスとしてのプラットフォームのみ)
**エラー**

New_General* または New_VMSizeNotSupported\*

**クラスターの固定の原因**

クラウド サービスのステージング環境のデプロイと運用環境のデプロイは、同じクラスターでホストされます。 2 つ目のデプロイを追加する場合、対応する割り当て要求は、最初のデプロイをホストする同じクラスター内で試行されます。

**対処法**

最初のデプロイと元のクラウド サービスを削除し、クラウド サービスを再デプロイします。 この操作によって、最初のデプロイが、両方のデプロイのための十分な空きリソースを持つクラスターや、要求された VM サイズをサポートしているクラスターに配置される場合があります。

## <a name="affinity-group-vmservice-proximity"></a>アフィニティ グループ (VM/サービス近接性)
**エラー**

New_General* または New_VMSizeNotSupported\*

**クラスターの固定の原因**

アフィニティ グループに割り当てられているすべてのコンピューティング リソースは、1 つのクラスターに結び付けられています。 そのアフィニティ グループでの新しいコンピューティング リソース要求は、既存のリソースがホストされているのと同じクラスターで試行されます。 新しいリソースが新しいクラウド サービスを通じて作成された場合でも、既存のクラウド サービスを通じて作成された場合でも、そのようになります。

**対処法**

アフィニティ グループが必要なければ、アフィニティ グループを使用しないでください。そうでなければ、コンピューティング リソースを複数のアフィニティ グループにグループ化してください。

## <a name="affinity-group-based-virtual-network"></a>アフィニティ グループ ベースの仮想ネットワーク
**エラー**

New_General* または New_VMSizeNotSupported\*

**クラスターの固定の原因**

リージョン仮想ネットワークが導入される前は、仮想ネットワークをアフィニティ グループに関連付ける必要がありました。 その結果、アフィニティ グループに配置されたコンピューティング リソースは、上の「割り当てシナリオ: アフィニティ グループ (VM/サービス近接性)」セクションで説明したのと同じ制約を受けます。 つまり、コンピューティング リソースは 1 つのクラスターに結び付けられます。

**対処法**

アフィニティ グループが不要の場合は、追加する新しいリソース用に新しいリージョン仮想ネットワークを作成し、 [既存の仮想ネットワークを新しい仮想ネットワークに接続](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)します。 詳細については、「 [リージョン仮想ネットワーク](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)」を参照してください。

または、 [アフィニティ グループ ベースの仮想ネットワークをリージョン仮想ネットワークに移行](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/)し、必要なリソースをもう一度追加することもできます。
