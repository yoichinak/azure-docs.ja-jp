---
title: Azure IoT Central アプリケーションでデバイス テンプレートを設定する | Microsoft Docs
description: 測定値、設定、プロパティ、ルール、およびダッシュボードを含むデバイス テンプレートを設定する方法を説明します。
author: viv-liu
ms.author: viviali
ms.date: 04/16/2018
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: f71d4c7dc94fedfd598ab87c51366ba9fb1f184a
ms.sourcegitcommit: f06925d15cfe1b3872c22497577ea745ca9a4881
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37063037"
---
# <a name="set-up-a-device-template"></a>デバイス テンプレートを設定する

デバイス テンプレートは、Microsoft Azure IoT Central アプリケーションに接続するデバイスの種類の、特性と動作を定義するブループリントです。

たとえばビルダーは、以下の機能を持つ、IoT 接続されているファンのデバイス テンプレートを作成できます。

- 温度テレメトリの測定

- ファン モーター エラー イベントの測定

- ファン動作状態の測定

- ファン速度の設定

- 場所プロパティ

- アラートを送信するルール

- デバイスの全体像を把握できるダッシュボード

オペレーターはこのデバイス テンプレートから、**fan-1** や **fan-2** などの名前で、実際のファン デバイスを作成して接続できます。 これらのファンはすべて、測定、設定、プロパティ、ルール、およびアプリケーションのユーザーが監視と管理を行えるダッシュボードを備えています。

> [!NOTE]
> デバイス テンプレートの作成、編集、および削除が可能なのは、ビルダーと管理者のみです。 **[Device Explorer]** ページの既存のデバイス テンプレートからは、すべてのユーザーがデバイスを作成できます。

## <a name="create-a-device-template"></a>デバイス テンプレートを作成する

1. **[Application Builder]\(アプリケーション ビルダー\)** ページに移動します。

2. 空のテンプレートを作成するには、**[Create Device Template]\(デバイス テンプレートの作成\)** を選択し、**[Custom]\(カスタム\)** を選択します。

3. 新しいデバイス テンプレートの名前を入力し、**[Create]\(作成\)** を選択します。

   ![テンプレート名が "Refrigerator" (冷蔵庫) のデバイスの詳細ページ](./media/howto-set-up-template/devicedetailspage.png)

4. これで、新しいシミュレートされたデバイスの **[デバイスの詳細]** ページが表示されました。 デバイス テンプレートを作成すると、シミュレートされたデバイスが自動的に作成されます。 これがデータを報告して、実際のデバイスと同様に制御できます。

ここで、**[デバイスの詳細]** ページの各タブを調べます。

## <a name="measurements"></a>測定

測定値は、デバイスから到着するデータです。 デバイスの機能と一致するように、複数の測定値をデバイス テンプレートに追加できます。

- **[Telemetry]\(テレメトリ\)** の測定値は、デバイスが時間の経過と共に収集した数値データ ポイントです。 連続するストリームとして表されます。 たとえば、温度です。
- **[Event]\(イベント\)** の測定値は、デバイス上の何らかの重要性を表す特定の時点のデータです。 重大度は、イベントの重要度を表します。 たとえば、ファン モーターのエラーです。
- **[状態]** の測定値は、一定期間にわたるデバイスまたはそのコンポーネントの状態を表します。 たとえば、**Operating** (動作中) と **Stopped** (停止) という 2 つの状態があるファン モードを定義できます。

### <a name="create-a-telemetry-measurement"></a>テレメトリの測定を作成する
新しいテレメトリの測定を追加するには、**[+ New Measurement]\(+ 新規の測定\)** ボタンを選択します。 測定の種類として **[Telemetry]\(テレメトリ\)** を選択し、**[Create Telemetry]\(テレメトリの作成\)** フォームで詳細を入力します。

> [!NOTE]
> 実際のデバイスが接続されたときは、デバイスが報告する測定の名前に注意してください。 名前は測定の **[Field Name]\(フィールド名\)** と正確に一致している必要があります。

たとえば、新しい温度テレメトリ測定を追加できます。

![温度測定の詳細が表示された [Create Telemetry]\(テレメトリの作成\) フォーム](./media/howto-set-up-template/measurementsform.png)

**[Save]\(保存\)** を選択すると、測定の一覧に **[Temperature]\(温度\)** の測定が表示されます。 オペレーターは、デバイスが収集している温度データの視覚化を確認できます。

![測定グラフ](./media/howto-set-up-template/measurementsgraph.png)

### <a name="create-an-event-measurement"></a>イベントの測定を作成する
新しいイベントの測定を追加するには、**[+ New Measurement]\(+ 新規の測定\)** ボタンを選択します。 測定の種類として **[Event]\(イベント\)** を選択し、**[Create Event]\(イベントの作成\)** フォームで詳細を入力します。

イベントの **[Display Name]\(表示名\)**、**[Field Name]\(フィールド名\)**、**[Severity]\(重大度\)** の詳細を入力します。 **[Error]\(エラー\)**、**[Warning]\(警告\)**、**[Information]\(情報\)** という 3 つの重大度から選択できます。  

たとえば、新しい "**Fan Motor Error**" (ファン モーター エラー) イベントを追加できます。

![ファン モーター イベントの詳細が表示された [Create Event]\(イベントの作成\) フォーム](./media/howto-set-up-template/eventmeasurementsform.png)

**[Save]\(保存\)** を選択すると、測定の一覧に **[Fan Motor Error]\(ファン モーター エラー\)** の測定が表示されます。 オペレーターは、デバイスが送信しているイベント データの視覚化を確認できます。

![イベント測定グラフ](./media/howto-set-up-template/eventmeasurementschart.png)

イベントに関する詳細を表示するには、グラフ上のイベント アイコンを選択します。

!["Fan Motor Error" (ファン モーター エラー) イベントの詳細](./media/howto-set-up-template/eventmeasurementsdetail.png)


### <a name="create-a-state-measurement"></a>状態の測定を作成する
新しい状態の測定を追加するには、**[+ New Measurement]\(+ 新規の測定\)** ボタンを選択します。 測定の種類として **[State]\(状態\)** を選択し、**[Create State]\(状態の作成\)** フォームで詳細を入力します。

状態の **[Display Name]\(表示名\)**、**[Field Name]\(フィールド名\)**、および **[Values]\(値\)** の詳細を入力します。 それぞれの値には、グラフやテーブルに値を表示するときに使用される表示名を付けることもできます。

たとえば、デバイスが送信できる **Operating** (動作中) と **Stopped** (停止) という 2 つの値がある新しい "**Fan Mode**" (ファン モード) 状態を追加できます。

![ファン モードの詳細が表示された [Edit State]\(状態の編集\)](./media/howto-set-up-template/statemeasurementsform.png)

**[Save]\(保存\)** を選択すると、測定の一覧に **[Fan Mode]\(ファン モード\)** の状態の測定が表示されます。 オペレーターは、デバイスが送信している状態データの視覚化を確認できます。

![状態の測定グラフ](./media/howto-set-up-template/statemeasurementschart.png)

短期間にデバイスから送信されたデータ ポイントが多すぎる場合、状態の測定は、次のスクリーンショットのように異なるビジュアルで表示されます。 グラフをクリックすると、その期間内のすべてのデータ ポイントが、時系列に表示されます。 時間の範囲を狭くしても、グラフにプロットされる測定を表示できます。

!["Static Fan Mode" (静的ファン モード) 状態の測定の詳細](./media/howto-set-up-template/statemeasurementsdetail.png)


## <a name="settings"></a>設定

設定はデバイスを制御します。 これらにより、アプリケーションのオペレーターは、デバイスに入力を提供できるようになります。 オペレーターが使用する **[設定]** タブにタイルとして表示されるデバイス テンプレートには、複数の設定を追加できます。 数値、テキスト、日付、トグル、選択リスト、およびセクション ラベルの 6 種類の設定を追加できます。

> [!NOTE]
> 実際のデバイスが接続されたときは、デバイスが報告する設定の名前に注意してください。 名前は設定の **[Field Name]\(フィールド名\)** と正確に一致している必要があります。

設定は、3 つの状態のいずれかにできます。 デバイスからは次の状態が報告されます。

- **同期済み**: デバイスは設定値を反映するように変わりました。

- **保留中**: デバイスは現在、設定値に変わろうとしています。

- **エラー**: デバイスはエラーを返しました。

たとえば、新しいファン速度の設定を追加できます。

![速度設定の詳細が表示された [Configure Number]\(数値の構成\) フォーム](./media/howto-set-up-template/settingsform.png)

**[Save]\(保存\)** を選択した後、**[Fan Speed]\(ファン速度\)** 設定はタイルとして表示され、デバイスのファン速度を変更するために使用する準備が整います。

タイルの作成後、新しい設定を試すことができます。 まず画面の右上で [Design Mode]\(デザイン モード\) を [Off]\(オフ\) にします。

![タイルの [Design Mode]\(デザイン モード\) スイッチが表示された [Settings]\(設定\) タブ](./media/howto-set-up-template/settingstile.png)

## <a name="properties"></a>Properties

プロパティは、デバイスの場所やシリアル番号など、デバイスに関連付けられているデバイスのメタデータです。 デバイス テンプレートには複数のプロパティを追加できます。それらは **[Properties]\(プロパティ\)** タブのタイルとして表示されます。オペレーターは、デバイスを作成するときにプロパティの値を指定でき、これらの値をいつでも編集できます。 追加できるプロパティは、数値、テキスト、日付、トグル、デバイス プロパティ、およびラベルの 6 種類です。

プロパティには 2 つのカテゴリがあります。

- デバイスから報告される**デバイス** プロパティ。
- アプリケーションにのみ保存される**アプリケーション** プロパティ。 デバイスはアプリケーション プロパティを認識しません。

> [!NOTE]
> デバイス プロパティについては、実際のデバイスが接続されたときは、デバイスが報告するプロパティの名前に注意してください。 名前はプロパティの **[Field Name]\(フィールド名\)** と正確に一致している必要があります。 アプリケーションのプロパティについては、名前がデバイス テンプレート内で一意である限り、任意のフィールド名を指定できます。

たとえば、新しいプロパティとして、デバイスの場所を追加できます。

![[Properties]\(プロパティ\) タブの [Configure Text]\(テキストの構成\) フォーム](./media/howto-set-up-template/propertiesform.png)

**[Save]\(保存\)** を選択した後、デバイスの場所はタイルとして表示されます。

![[Location]\(場所\) タイル](./media/howto-set-up-template/propertiestile.png)

タイルの作成後、プロパティの値を変更できます。 まず画面の右上で [Design Mode]\(デザイン モード\) を [Off]\(オフ\) にします。

### <a name="create-a-location-property-through-azure-maps"></a>Azure Maps で場所プロパティを作成する
Azure IoT Central 内で場所データに地理的コンテキストを追加し、番地の緯度と経度の座標をマッピングすることができます。 または、単に緯度と経度の座標を渡すことができます。 IoT Central の Azure Maps でこの機能を使用できます。

追加できる場所プロパティは 2 種類あります。
- **アプリケーション プロパティとしての場所**は、アプリケーション内にのみ保存されます。 デバイスはアプリケーション プロパティを認識しません。
- **デバイス プロパティとしての場所**は、デバイスから報告されます。

#### <a name="add-location-as-an-application-property"></a>場所をアプリケーション プロパティとして追加する 
Azure IoT Central アプリケーション内で Azure Maps を使用することで、場所プロパティをアプリケーション プロパティとして作成することができます。 たとえば、デバイスの設置先アドレスを追加できます。 

1. **[Properties]\(プロパティ\)** タブで **[Design Mode]\(デザイン モード\)** が **[On]\(オン\)** であることを確認します。

   ![[Design Mode]\(デザイン モード\) が [On]\(オン\) の [Properties]\(プロパティ\)](./media/howto-set-up-template/locationcloudproperty1.png)

2. ライブラリで **[場所]** を選択します。
3. 場所の**表示名**、**フィールド名**、および (省略可能) **初期値**を構成します。 

   ![場所の詳細が表示された [Configure Location]\(場所の構成\)](./media/howto-set-up-template/locationcloudproperty2.png)

   場所を追加する形式は 2 つあります。
   - **住所としての場所**
   - **座標としての場所** 

4. **[保存]** を選択します。 

   ![インストール アドレスが追加された場所プロパティ](./media/howto-set-up-template/locationcloudproperty3.png)

場所フィールドのフォームで場所の値を更新できるようになります。 

#### <a name="add-location-as-a-device-property"></a>デバイス プロパティとして場所を追加する 

場所プロパティは、デバイスから報告されるデバイス プロパティとして作成できます。 たとえば､デバイスの場所を追跡する場合です。

1. **[Properties]\(プロパティ\)** タブで **[Design Mode]\(デザイン モード\)** が **[On]\(オン\)** であることを確認します。

   ![[Design Mode]\(デザイン モード\) が [On]\(オン\) の [Properties]\(プロパティ\)](./media/howto-set-up-template/locationdeviceproperty1.png)

2. ライブラリから **[Device Property]\(デバイス プロパティ\)** を選択します。
3. 表示名とフィールド名を構成し、データの種類として **[Location]\(場所\)** を選択します。 

   > [!NOTE]
   > フィールド名は、デバイスから報告されるプロパティの名前と完全に一致する必要があります。 

   ![場所の詳細が表示された [Configure Device Properties]\(デバイス プロパティの構成\) フォーム](./media/howto-set-up-template/locationdeviceproperty2.png)

場所プロパティを構成したので、[デバイス ダッシュボードでマップを追加して場所を視覚化](#add-an-azure-maps-location-in-the-dashboard)できます。

## <a name="commands"></a>コマンド

コマンドは、デバイスのリモート管理に使用されます。 そのため、アプリケーションのオペレーターはデバイス上ですぐにコマンドを実行できます。 オペレーターが使用する **[Commands]\(コマンド\)** タブにタイルとして表示されるデバイス テンプレートには、複数のコマンドを追加できます。 デバイスのビルダーは、要件に応じて柔軟にコマンドを定義できます。

コマンドと設定の違いは次のとおりです。 

* **設定**: 設定はデバイスに適用する構成であり、変更するまでデバイスにその構成を維持させたい場合に使用します。 たとえば、フリーザーの温度を設定して、フリーザーを再起動してもその設定を維持する場合があります。 

* **コマンド**: コマンドは、IoT Central からリモートでデバイスに対してすぐにコマンドを実行する場合に使用します。 デバイスが接続されていない場合、コマンドはタイムアウトして失敗します。 たとえば、デバイスを再起動するとします。  

コマンドを実行すると、デバイスがコマンドを受け取ったかどうかによって、3 つの状態のいずれかになります。 

たとえば、新しい **Echo** コマンドを作成できます。

![Echo の詳細が表示された [Configure Command]\(コマンドの構成\) フォーム](./media/howto-set-up-template/commandsecho.png)

**[Save]\(保存\)** を選択すると、**Echo** コマンドがタイルとして表示され、デバイスの echo に使用できる状態になります。

タイルの作成後、新しいコマンドを試すことができます。

## <a name="rules"></a>ルール

オペレーターはルールによって、ほぼリアルタイムにデバイスを監視できます。 ルールは、ルールがトリガーされたときに電子メールを送信するなどのアクションを自動的に呼び出します。 現在使用できるルールの種類は 1 つです。

- **テレメトリ ルール**は、選択したデバイスのテレメトリが、指定したしきい値を超えたときにトリガーされます。 テレメトリ ルールの詳細については、[こちら](howto-create-telemetry-rules.md)を参照してください。

## <a name="dashboard"></a>ダッシュボード

ダッシュボードは、オペレーターがアクセスして、デバイスに関する情報を参照できる場所です。 ビルダーは、デバイスがどのように動作しているかをオペレーターが理解する助けになるタイルをこのページに追加できます。 デバイス テンプレートには複数のダッシュボード タイルを追加できます。 追加できるダッシュボード タイルの種類は、画像、折れ線グラフ、棒グラフ、KPI、設定、プロパティ、およびラベルの 6 つです。

たとえば、**[Settings and Properties]** タイルを追加して、設定とプロパティの現在の値から、選択したものを表示できます。

![設定とプロパティの詳細が表示された [Configure Device Details]\(デバイスの詳細の構成\) フォーム](./media/howto-set-up-template/dashboardsettingsandpropertiesform.png)

これでオペレーターがダッシュボードを表示すると、デバイスの設定とプロパティを表示するこのタイルを確認できます。

![タイルの設定とプロパティが表示された [Dashboard]\(ダッシュボード\) タブ](./media/howto-set-up-template/dashboardtile.png)

### <a name="add-an-azure-maps-location-in-the-dashboard"></a>ダッシュボードに Azure Maps の場所を追加する

前述の「[Azure Maps を使用して場所プロパティを作成する](#create-a-location-property-through-azure-maps)」で場所プロパティを構成した場合、デバイス ダッシュボードのマップを使用して場所を視覚化することができます。

1. **[Dashboard]\(ダッシュボード\)** タブで **[Design Mode]\(デザイン モード\)** が **[On]\(オン\)** であることを確認します。

   ![[Design Mode]\(デザイン モード\) が [On]\(オン\) の [Dashboard]\(ダッシュボード\) タブ](./media/howto-set-up-template/locationcloudproperty4map.png)

2. デバイス ダッシュボードでライブラリから **[Map]\(マップ\)** を選択します。 
3. タイトルを付けて、以前にデバイス プロパティの一部として構成した場所プロパティを選択します。

   ![タイトルとプロパティの詳細が表示された [Configure Map]\(マップの構成\) フォーム](./media/howto-set-up-template/locationcloudproperty5map.png)

4. **[保存]** を選択します。 [Map]\(マップ\) タイルに選択した場所が表示されるようになりました。 

   ![選択した場所が表示された [Map]\(マップ\) タイル](./media/howto-set-up-template/locationcloudproperty6map.png) 

マップは任意のサイズに変更することができます。

オペレーターがダッシュボードを表示すると、場所マップを含め、構成したすべてのダッシュボード タイルを見ることができるようになりました。

![ダッシュボード上のタイル](./media/howto-set-up-template/locationcloudproperty7map.png) 

## <a name="next-steps"></a>次の手順

ここでは、Azure IoT Central アプリケーションでデバイス テンプレートを設定する方法について説明しました。次の手順に進むことができます。

> [!div class="nextstepaction"]
> [デバイス テンプレートの新しいバージョンを作成する](howto-version-devicetemplate.md)
