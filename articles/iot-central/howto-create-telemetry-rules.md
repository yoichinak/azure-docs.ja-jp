---
title: Azure IoT Central アプリケーションでテレメトリ ルールを作成して管理する | Microsoft Docs
description: Azure IoT Central のテレメトリ ルールを使用すると、ほぼリアルタイムでデバイスを監視し、ルールがトリガーされたときに、電子メールの送信などのアクションを自動的に呼び出すことができます。
services: iot-central
author: tanmaybhagwat
ms.author: tanmayb
ms.date: 04/16/2018
ms.topic: article
ms.prod: microsoft-iot-central
manager: timlt
ms.openlocfilehash: 42516e4dd6a85e0d07d4a8e70e958b2ec6e84aad
ms.sourcegitcommit: 44fa77f66fb68e084d7175a3f07d269dcc04016f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/24/2018
ms.locfileid: "39225202"
---
# <a name="create-a-telemetry-rule-and-set-up-an-action-in-your-azure-iot-central-application"></a>Azure IoT Central アプリケーションでテレメトリ ルールを作成してアクションを設定する

Microsoft Azure IoT Central を使用して、接続されたデバイスをリモートで監視できます。 Azure IoT Central ルールを使用すると、ほぼリアルタイムでデバイスを監視し、ルール条件が満たされたときに、電子メールの送信や Microsoft Flow によるワークフローのトリガーなどのアクションを自動的に呼び出すことができます。 数回のクリックで、デバイスのデータを監視する条件を定義したり、呼び出すアクションを構成したりできます。 この記事では、テレメトリ ルールについて詳しく説明します。

Azure IoT Central では、[テレメトリ測定](howto-set-up-template.md)を使用してデバイスのデータをキャプチャします。 測定の種類ごとに、測定を定義する主な属性が含まれます。 ルールを作成して、各種のデバイスの測定を監視し、ルールがトリガーされたときにアラートを生成できます。 テレメトリ ルールは、選択したデバイスのテレメトリが、指定したしきい値を超えたときにトリガーされます。

## <a name="create-a-telemetry-rule"></a>テレメトリ ルールを作成する

このセクションでは、テレメトリ ルールを作成する方法について説明します。 この例では、温度と湿度のテレメトリを送信する、接続された空調デバイスを使用します。 ルールは、デバイスによってレポートされる温度を監視し、80 度以上になったときに電子メールを送信します。

1. ルールを追加するデバイスの [デバイスの詳細] ページに移動します。

1. まだルールを作成していない場合は、次の画面が表示されます。

    ![ルールがまだありません](media/howto-create-telemetry-rules/image1.png)

1. **[ルール]** タブで、**[+ 新しいルール]** を選択して、作成できるルールの種類を確認します。

    ![ルールの種類](media/howto-create-telemetry-rules/image2.png)

1. **[テレメトリ]** タイルを選択して、ルールを作成するフォームを開きます。

    ![テレメトリ ルール](media/howto-create-telemetry-rules/image3.png)

1. このデバイス テンプレートでルールを識別するのに役立つ名前を選択します。

1. このテンプレートから作成されたすべてのデバイスに対してすぐにルールを有効にするには、**[ルールの有効化]** を切り替えます。

### <a name="configure-the-rule-condition"></a>ルールの条件を構成する

このセクションでは、温度のテレメトリを監視するための条件を追加する方法について説明します。

1. **[条件]** の横にある **+** を選択します。

1. ドロップダウンからテレメトリの種類 **[温度]** を選択します。 次に演算子を選択し、しきい値を指定します。 テレメトリの条件は、複数追加できます。 複数の条件を指定する場合、ルールをトリガーするためにはすべての条件が満たされる必要があります。

    ![テレメトリの条件を追加する](media/howto-create-telemetry-rules/image4.png)

    > [!NOTE]
    > テレメトリ ルールの条件を定義するときに、テレメトリの測定を少なくとも 1 つ選択します。

1. **[保存]** をクリックしてルールを保存します。 ルールは数分以内に有効になり、アプリケーションに送信されるテレメトリの監視が開始されます。

### <a name="add-an-action"></a>アクションを追加する

この例では、ルールにアクションを追加する方法を示します。 これはメール アクションを追加する方法を示しますが、以下の他のアクションを追加することもできます。
-  [Microsoft Flow アクション](howto-add-microsoft-flow.md): ルールがトリガーされたときに Microsoft Flow でワークフローを開始します
- [Webhook アクション](howto-create-webhooks.md): ルールがトリガーされたときに他のサービスに通知します

> [!NOTE]
> 現時点では、1 つのルールに関連付けられるアクションは 1 つだけです。

1. **[アクション]** の横にある **+** を選択します。 使用可能なアクションの一覧が表示されます。

    ![アクションを追加する](media/howto-create-telemetry-rules/image5.png)

1. **[電子メール]** アクションを選択し、**[宛先]** フィールドに有効な電子メール アドレスを入力して、ルールがトリガーされた際に電子メールの本文に表示されるメモを指定します。

    > [!NOTE]
    > 電子メールは、アプリケーションに追加されており、少なくとも 1 回はログインしているユーザーにのみ送信されます。 Azure IoT Central での[ユーザー管理](howto-administer.md)について詳しくは、こちらをご覧ください。

   ![アクションを構成する](media/howto-create-telemetry-rules/image6.png)

1. **[Save]** をクリックします。 ルールは数分以内に有効になり、アプリケーションに送信されるテレメトリの監視が開始されます。 ルールで指定した条件に一致すると、構成した電子メールのアクションがトリガーされます。

## <a name="parameterize-the-rule"></a>ルールをパラメーター化する

ルールでは、**[デバイスのプロパティ]** から、特定の値をパラメーターとして取得できます。 パラメーターの使用は、テレメトリのしきい値がさまざまなデバイスによって異なるシナリオにおいて役立ちます。 ルールを作成する場合は、絶対値 (80 度など) を指定する代わりに、しきい値を指定するデバイスのプロパティを選択します (**[Maximum Ideal Threshold]\(最大理想しきい値\)** など)。 ルールが実行されると、デバイスのテレメトリと、デバイスのプロパティで指定された値がマッチされます。

パラメーターの使用は、デバイス テンプレートごとの管理するルールの数を減らすための、効果的な方法です。

**[デバイス プロパティ]** をパラメーターとして使用して、アクションを構成することもできます。 電子メール アドレスがデバイスのプロパティとして格納されている場合、**[宛先]** アドレスを定義するときにこれを使用できます。

## <a name="delete-a-rule"></a>規則を削除する

ルールが不要になった場合は、ルールを開き、**[削除]** を選択して削除します。 ルールを削除すると、そのルールはデバイス テンプレートと関連付けられているすべてのデバイスから削除されます。

## <a name="enable-or-disable-a-rule-for-a-device-template"></a>デバイス テンプレートのルールを有効または無効にする

デバイスに移動し、有効または無効にするルールを選択します。 ルールの **[Enable rule for all devices of this template]\(このテンプレートのすべてのデバイスに対してルールを有効にする\)** ボタンを切り替えることで、デバイス テンプレートに関連付けられているすべてのデバイスに対してルールを有効または無効にできます。

## <a name="enable-or-disable-a-rule-for-a-device"></a>デバイスのルールを有効または無効にする

デバイスに移動し、有効または無効にするルールを選択します。 **[Enable rule for this device]\(このデバイスに対してルールを有効にする\)** ボタンを切り替えて、このデバイスに対してルールを有効または無効にします。

## <a name="next-steps"></a>次の手順

ここでは、Azure IoT Central アプリケーションでルールを編集する方法について説明しました。推奨される次の手順は以下のとおりです。

> [!div class="nextstepaction"]
> [Microsoft Flow アクションをルールに追加する方法](howto-add-microsoft-flow.md)
> [デバイスを管理する方法](howto-manage-devices.md)
