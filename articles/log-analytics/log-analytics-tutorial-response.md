---
title: Log Analytics のアラートを使用してイベントに応答する | Microsoft Docs
description: このチュートリアルでは、ワークスペース内の重要な情報の識別、問題に関する事前の通知、または問題を修正するためのアクションの呼び出しを行うために使用できる Log Analytics のアラートについて理解します。
services: log-analytics
documentationcenter: log-analytics
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: abb07f6c-b356-4f15-85f5-60e4415d0ba2
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 07/30/2018
ms.author: magoedte
ms.custom: mvc
ms.component: na
ms.openlocfilehash: c6c7b3f897e38fbd67098c9f881380bc073f13da
ms.sourcegitcommit: 1d850f6cae47261eacdb7604a9f17edc6626ae4b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/02/2018
ms.locfileid: "39432652"
---
# <a name="respond-to-events-with-azure-monitor-alerts"></a>Azure Monitor のアラートを使用してイベントに応答する
ログ検索ルールは、指定されたログ クエリを一定の間隔で自動的に実行するために、Azure アラートによって作成されます。  ログ クエリの結果が特定の条件に一致すると、アラート レコードが作成されます。 ルールではその後、[アクション グループ](../monitoring-and-diagnostics/monitoring-action-groups.md)を使用して、1 つ以上のアクションを自動的に実行できます。  このチュートリアルは、「[Log Analytics データのダッシュボードを作成して共有する](log-analytics-tutorial-dashboards.md)」チュートリアルの続きです。   

このチュートリアルで学習する内容は次のとおりです。

> [!div class="checklist"]
> * アラート ルールを作成する
> * 電子メール通知を送信するアクション グループを構成する

このチュートリアルの例を完了するには、[Log Analytics ワークスペースに接続された](log-analytics-quick-collect-azurevm.md)既存の仮想マシンが必要です。

## <a name="sign-in-to-azure-portal"></a>Azure Portal にサインインする
Azure Portal ([https://portal.azure.com](https://portal.azure.com)) にログインします。

## <a name="create-alerts"></a>アラートを作成する
アラートは Azure Monitor のアラート ルールによって作成され、保存済みのクエリまたはカスタム ログ検索を一定の間隔で自動的に実行できます。  特定のパフォーマンス メトリック、特定のイベントが作成されたとき、イベントが欠如しているとき、または特定の時間枠内に作成されたイベントの数に基づくアラートを作成できます。  たとえば、アラートを使用して、平均 CPU 使用率が特定のしきい値を超えた場合、不足している更新が検出された場合、または特定の Windows サービスまたは Linux デーモンが実行されていないときにイベントが生成された場合に通知を受信することができます。  ログ検索の結果が特定の条件に一致すると、アラートが作成されます。 さらに、アラートの通知や別のプロセスの呼び出しなど、1 つ以上のアクションを自動的に実行できます。

次の例では、[データの視覚化のチュートリアル](log-analytics-tutorial-dashboards.md)で保存した "*Azure VM - プロセッサ使用率*" のクエリに基づいてメトリック測定アラート ルールを作成します。 90% のしきい値を超える仮想マシンごとにアラートが作成されます。

1. Azure Portal で、**[すべてのサービス]** をクリックします。 リソースの一覧で「**Monitor**」と入力します。 入力を始めると、入力内容に基づいて、一覧がフィルター処理されます。 **[モニター]** を選択します。
1. 左側のウィンドウで、**[アラート]** を選択し、ページの上部の **[新しいアラート ルール]** をクリックして新しいアラートを作成します。

    ![新しいアラート ルールの作成](./media/log-analytics-tutorial-response/alert-rule-02.png)

1. 最初の手順では、**[アラートの作成]** セクションで、リソースとして Log Analytics ワークスペースを選択します。これがログ ベースのアラート シグナルであるためです。  複数のサブスクリプションがある場合は、ドロップダウン リストから、先ほど作成した VM および Log Analytics ワークスペースが含まれている特定の**サブスクリプション**を選択して結果をフィルターします。  ドロップダウン リストから **[Log Analytics]** を選択して **[リソースの種類]** をフィルターします。  最後に、**[リソース]** **[DefaultLAWorkspace]** を選択し、**[完了]** をクリックします。

    ![アラートの作成手順 1 のタスク](./media/log-analytics-tutorial-response/alert-rule-03.png)

1. **[アラートの条件]** セクションで、**[条件の追加]** をクリックしてクエリを定義し、アラート ルールが従うロジックを指定します。 **[シグナル ロジックの構成]** ウィンドウで、**[Custom log search]\(カスタム ログ検索\)** をシグナル名として選択し、**[検索クエリ]** にクエリを入力します。

    例: 
    ```
    Perf
    | where CounterName == "% Processor Time" and ObjectName == "Processor" and InstanceName == "_Total"
    | summarize AggregatedValue=avg(CounterValue) by bin(TimeGenerated, 1m)
    ```

    ウィンドウが更新されてアラートの構成設定が表示されます。  一番上に、選択したシグナルの過去 30 分の結果が表示されます。

1. 次の情報を指定して、アラートを構成します。  
   a. **[基準]* ドロップダウン リストで **[メトリック測定]** を選択します。  メトリック測定では、クエリの対象となったオブジェクトのうち、値が指定されたしきい値を上回っているオブジェクトについて、それぞれ別個にアラートが生成されます。  
   b. **[条件]** では、**[より大きい]** を選択し、**[しきい値]** には「**90**」を入力します。  
   c. [アラートをトリガーする基準] セクションで、**[連続する違反]** を選択し、ドロップダウン リストから **[より大きい]** を選択して値 3 を入力します。  
   d. [Evaluation based on]\(評価基準\) セクションで、既定値を受け入れます。 ルールは 5 分ごとに実行され、現在の時刻からこの範囲内に作成されたレコードを返します。  
1. **[完了]** をクリックして、アラート ルールを完成させます。

    ![アラート シグナルの構成](./media/log-analytics-tutorial-response/alert-signal-logic-02.png)

1. 2 番目の手順に進み、**[アラート ルール名]** フィールドに「**90% を超える CPU の割合**」のようなアラートの名前を入力します。  アラートの詳細を説明する **[説明]** を指定し、表示されたオプションから **[重大度]** 値として **[重大 (重大度 0)]** を選択します。

    ![アラート詳細の構成](./media/log-analytics-tutorial-response/alert-signal-logic-04.png)

1. 作成時にアラート ルールをすぐにアクティブ化するには、**[ルールの作成時に有効にする]** の既定値を受け入れます。  
1. 3 番目および最後の手順では、**[アクション グループ]** を指定します。これにより、アラートがトリガーされるたびに同じアクションが実行され、定義する各ルールに同じアクションを使用できます。  次の情報を指定して、新しいアクション グループを構成します。  
   a. **[新しいアクション グループ]** を選択すると、**[アクション グループの追加]** ウィンドウが表示されます。  
   b. **[アクション グループ名]** で、「**IT 操作 - 通知**」のような名前と **itops-n** などの **[短い名前]** を指定します。  
   c. **[サブスクリプション]** と **[リソース グループ]** の既定値が正しいことを確認します。 正しくない場合は、ドロップダウン リストから正しいものを 1 つ選択します。  
   d. [アクション] セクションで、「**電子メールの送信**」などのアクション名を指定し、**[アクションの種類]** でドロップダウン リストから **[電子メール/SMS/プッシュ/音声]** を選択します。 追加情報を指定するために **[電子メール/SMS/プッシュ/音声]** プロパティ ウィンドウが右側に開きます。  
   e. **[電子メール/SMS/プッシュ/音声]** ウィンドウで、**[電子メール]** を有効にし、メッセージを配信するための有効な電子メール SMTP アドレスを指定します。  
   f. **[OK]** をクリックして変更を保存します。  
       ![新しいアクション グループの作成](./media/log-analytics-tutorial-response/action-group-properties-01.png)

1. **[OK]** をクリックしてアクション グループを完成させます。
1. **[アラート ルールの作成]** をクリックしてアラート ルールを完成させます。 すぐに実行が開始されます。

    ![新しいアラート ルールの作成の完了](./media/log-analytics-tutorial-response/alert-rule-01.png)

## <a name="view-your-alerts-in-azure-portal"></a>ご利用のアラートを Azure Portal で表示する
アラートを作成したので、1 つのウィンドウで Azure のアラートを表示でき、Azure サブスクリプション全体のすべてのアラート ルールを管理できます。 このページには、(有効または無効になっている) すべてのアラート ルールが一覧表示され、ターゲット リソース、リソース グループ、ルール名、または状態に基づいて並べ替えることができます。 発生したすべてのアラートの集計サマリーと、構成済みおよび有効なアラート ルールの合計が含まれます。

![Azure アラートの状態ページ](./media/log-analytics-tutorial-response/azure-alerts-02.png)

アラートがトリガーされると、条件、および選択した時間範囲 (既定値は最後の 6 時間) 内に発生した回数がテーブルに反映されます。  受信トレイに、次の例のような対応する電子メールが表示されます。この場合は、問題が発生している仮想マシンと、検索クエリに一致した最上位の結果が表示されています。

![アラート電子メール アクションの例](./media/log-analytics-tutorial-response/azure-alert-email-notification-01.png)

## <a name="next-steps"></a>次の手順
このチュートリアルでは、ログ検索をスケジュールした間隔で実行しているときに、特定の条件に一致した場合は、アラート ルールを使用して、問題を事前に識別して対応する方法を学習しました。

あらかじめ用意されている Log Analytics のサンプル スクリプトを確認するには、次のリンクをクリックしてください。

> [!div class="nextstepaction"]
> [Log Analytics のサンプル スクリプト](powershell-samples.md)
