---
title: Azure Tools を使用したクラウド サービスの発行 | Microsoft Docs
description: Visual Studio を使用して Azure クラウド サービス プロジェクトを発行する方法について説明します。
services: visual-studio-online
author: ghogen
manager: douge
assetId: 1a07b6e4-3678-4cbf-b37e-4520b402a3d9
ms.prod: visual-studio-dev15
ms.technology: vs-azure
ms.custom: vs-azure
ms.workload: azure-vs
ms.topic: conceptual
ms.date: 11/11/2017
ms.author: ghogen
ms.openlocfilehash: 78a313e824ee7926ab9f1875407d650d614afce2
ms.sourcegitcommit: 30c7f9994cf6fcdfb580616ea8d6d251364c0cd1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/18/2018
ms.locfileid: "42145238"
---
# <a name="publishing-a-cloud-service-using-visual-studio"></a>Visual Studio を使用したクラウド サービスの発行

Visual Studio では、クラウド サービスのステージング環境と運用環境の両方がサポートされるため、アプリケーションを Azure に直接発行できます。 発行するときは、デプロイ パッケージで一時的に使用するデプロイ環境とストレージ アカウントを選択します。

Azure アプリケーションを開発およびテストするときは、Web 配置を使用して、Web ロールの変更を段階的に発行することができます。 アプリケーションをデプロイ環境に発行したら、Web Deploy を使用して、Web ロールを実行している仮想マシンに変更を直接デプロイできます。 変更をテストするために Web ロールを更新するたびに、Azure アプリケーション全体をパッケージ化して発行する必要はありません。 この方法では、アプリケーションがデプロイ環境に発行されるのを待たなくても、クラウドで Web ロールの変更をテストできます。

Azure アプリケーションを発行し、Web Deploy を使用して Web ロールを更新するには、次の手順に従います。

- Visual Studio からの Azure アプリケーションの発行またはパッケージ化
- 開発およびテスト サイクルの一環としての Web ロールの更新

## <a name="publish-or-package-an-azure-application-from-visual-studio"></a>Visual Studio からの Azure アプリケーションの発行またはパッケージ化

Azure アプリケーションを発行するときは、次のいずれかの作業を行います。

- サービス パッケージを作成する: このパッケージとサービス構成ファイルを使用して、[Azure Portal](https://portal.azure.com) からデプロイ環境にアプリケーションを発行できます。

- Visual Studio から Azure プロジェクトを発行する: アプリケーションを Azure に直接発行するには、発行ウィザードを使用します。 詳細については、「 [Azure アプリケーションの発行ウィザード](vs-azure-tools-publish-azure-application-wizard.md)」をご覧ください。

### <a name="to-create-a-service-package-from-visual-studio"></a>Visual Studio からサービス パッケージを作成するには

1. アプリケーションを発行する準備ができたら、ソリューション エクスプローラーを開き、ロールを含む Azure プロジェクトのショートカット メニューを開いて、[発行] をクリックします。

1. サービス パッケージだけを作成するには、次の手順に従います。

   a. Azure プロジェクトのショートカット メニューで、 **[パッケージ]** をクリックします。

   b. **[Azure アプリケーションのパッケージ化]** ダイアログ ボックスで、パッケージを作成するサービス構成を選択し、ビルド構成を選択します。

   c. (省略可能) 発行後にクラウド サービスのリモート デスクトップを有効にするには、**[すべてのロールのリモート デスクトップを有効にする]** をオンにし、**[設定]** を選択してリモート デスクトップ資格情報を構成します。 詳しくは、「[Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio (Visual Studio を使用して Azure Cloud Services のロールでリモート デスクトップ接続を有効にする)](cloud-services/cloud-services-role-enable-remote-desktop-visual-studio.md)」をご覧ください。

      クラウド サービスを発行後にデバッグする場合は、 **[すべてのロールのリモート デバッガーを有効にする]** を選択してリモート デバッグを有効にします。

   d. パッケージを作成するには、 **[パッケージ]** リンクをクリックします。

      ファイル エクスプ ローラーに、新しく作成されたパッケージのファイルの場所が表示されます。 Azure Portal から使用できるように、この場所をコピーできます。

   e. このパッケージをデプロイ環境に発行するには、クラウド サービスを作成し、Azure Portal でこのパッケージを環境にデプロイするときに、この場所をパッケージの場所として使用する必要があります。

1. (省略可能) デプロイ プロセスをキャンセルするには、アクティビティ ログの行項目のショートカット メニューで、 **[取り消して削除]** を選択します。 このコマンドによりデプロイ プロセスが停止し、Azure からデプロイ環境が削除されます。 デプロイ後に環境を削除するには、Azure Portal を使用します。

1. (省略可能) ロール インスタンスが起動すると、Visual Studio のサーバー エクスプローラーの **[クラウド サービス]** ノードにデプロイ環境が自動的に表示されます。 ここから、個々のロール インスタンスの状態を確認できます。 「[クラウド エクスプローラーを使用した Azure リソースの管理](vs-azure-tools-resources-managing-with-cloud-explorer.md)」をご覧ください。次の図は、まだ "初期化中" 状態であるロール インスタンスを示しています。

    ![VST_DeployComputeNode](./media/vs-azure-tools-publishing-a-cloud-service/IC744134.png)

## <a name="update-a-web-role-as-part-of-the-development-and-testing-cycle"></a>開発およびテスト サイクルの一環としての Web ロールの更新

アプリケーションのバックエンド インフラストラクチャは安定していても、Web ロールを頻繁に更新する必要がある場合は、Web 配置を使用してプロジェクトの Web ロールだけを更新できます。 Web 配置は、バックエンド worker ロールの再構築と再デプロイを避ける場合や、複数の Web ロールの中の 1 つだけを更新する場合に便利です。

### <a name="requirements-for-using-web-deploy"></a>Web 配置を使用する要件

- **開発とテストのみを目的とする**: Web ロールが実行されている仮想マシンに直接変更が加えられます。 この仮想マシンをリサイクルする必要がある場合、発行済みの元のパッケージを使用してロールの仮想マシンが再作成されるため、変更は失われます。 Web ロールの最新の変更を取得するには、アプリケーションを再発行します。

- **Web ロールだけを更新できる**: ワーカー ロールは更新できません。 また、`web role.cs`の `RoleEntryPoint` は更新できません。

- **サポートできる Web ロールのインスタンスは 1 つに限られる**: デプロイ環境で Web ロールの複数のインスタンスを使用することはできません。 ただし、それぞれにインスタンスを 1 つだけ持つ複数の Web ロールがサポートされます。

- **リモート デスクトップ接続を有効にする**: この要件により、Web 配置でユーザーとパスワードを使用して仮想マシンに接続し、インターネット インフォメーション サービス (IIS) を実行しているサーバーに変更をデプロイできます。 また、仮想マシンに接続して、その仮想マシン上の IIS に信頼された証明書を追加することが必要な場合もあります  (この証明書により、Web 配置によって使用される IIS のリモート接続のセキュリティが確保されます)。

次の手順は、 **Azure アプリケーションの公開** ウィザードを使用していることを前提としています。

### <a name="enable-web-deploy-when-you-publish-your-application"></a>アプリケーションの発行時に Web 配置を有効にする

1. **[すべての Web ロールの Web 配置を有効にする]** オプションを有効にするには、リモート デスクトップ接続を構成しておく必要があります。 **[すべてのロールのリモート デスクトップを有効にする]** を選択し、表示される **[リモート デスクトップ構成]** ボックスに、リモート接続に使用する資格情報を入力します。 「[Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio (Visual Studio を使用して Azure Cloud Services のロールでリモート デスクトップ接続を有効にする)](cloud-services/cloud-services-role-enable-remote-desktop-visual-studio.md)」をご覧ください。

1. アプリケーションのすべての Web ロールの Web Deploy を有効にするには、 **[すべての Web ロールの Web 配置を有効にする]** を選択します。

    警告を表す黄色の三角形が表示されます。 Web Deploy では、信頼されていない自己署名証明書が既定で使用されます。これは、機密データをアップロードする場合には推奨されません。 機密データのためにこのプロセスを保護する必要がある場合は、Web 配置の接続に使用する SSL 証明書を追加できます。 この証明書は、信頼された証明書であることが必要です。 詳細については、「[Web 配置のセキュリティを確保する](#make-web-deploy-secure)」をご覧ください。

1. **[次へ]** をクリックして **[概要]** 画面を表示し、**[発行]** をクリックしてクラウド サービスをデプロイします。

    クラウド サービスが発行されます。 作成される仮想マシンでは IIS のリモート接続が有効になっているため、Web ロールを再発行しなくても、Web Deploy を使用してそれらのロールを更新できます。

   > [!NOTE]
   > Web ロールの複数のインスタンスを構成している場合、アプリケーションを発行するために作成されるパッケージでは、Web ロールごとに 1 つのインスタンスに制限されることを示す警告メッセージが表示されます。 **[OK]** を選択して続行します。 「必要条件」で説明したように、複数の Web ロールを使用できますが、インスタンスはロールごとに 1 つに限られます。

### <a name="update-your-web-role-by-using-web-deploy"></a>Web 配置を使用して Web ロールを更新する

1. Web Deploy を使用するには、発行する Web ロールのプロジェクトに Visual Studio でコードの変更を加え、ソリューションでこのプロジェクト ノードを右クリックして、 **[発行]** をポイントします。 **[Web の発行]** ダイアログ ボックスが表示されます。

1. (省略可能) IIS のリモート接続に使用する信頼された SSL 証明書を追加した場合は、 **[信頼されていない証明書を許可する]** チェック ボックスをオフにすることができます。 証明書を追加して Web 配置のセキュリティを確保する方法については、この記事で後述する「**Web 配置のセキュリティを確保する**」をご覧ください。

1. Web 配置を使用するには、パッケージを最初に発行したときにリモート デスクトップ接続用に設定したユーザー名とパスワードが必要です。

   a. **[ユーザー名]** に、ユーザー名を入力します。

   b. **[パスワード]** に、パスワードを入力します。

   c. (省略可能) このパスワードをこのプロファイルに保存する場合は、 **[パスワードの保存]** を選択します。

1. Web ロールへの変更を発行するには、 **[発行]** をクリックします。

    状態行に **[発行を開始しました]** と表示されます。 発行が完了すると、 **[発行は成功しました]** と表示されます。 これで、仮想マシンの Web ロールに変更がデプロイされました。 Azure 環境で Azure アプリケーションを起動して変更をテストできます。

### <a name="make-web-deploy-secure"></a>Web 配置のセキュリティを確保する

1. Web Deploy では、信頼されていない自己署名証明書が既定で使用されます。これは、機密データをアップロードする場合には推奨されません。 機密データのためにこのプロセスを保護する必要がある場合は、Web 配置の接続に使用する SSL 証明書を追加できます。 この証明書は、証明機関 (CA) から取得した信頼された証明書であることが必要です。

    各 Web ロールの各仮想マシンで Web 配置のセキュリティを確保するには、Web 配置に使用する信頼された証明書を Azure Portal にアップロードする必要があります。 この証明書により、アプリケーションの発行時に作成される Web ロールの仮想マシンに証明書が確実に追加されます。

1. リモート接続に使用する信頼された SSL 証明書を IIS に追加するには、次の手順を実行します。

   a. Web ロールを実行している仮想マシンに接続するには、**Cloud Explorer** または**サーバー エクスプローラー**で Web ロールのインスタンスを選択し、**[リモート デスクトップを使用して接続]** をクリックします。 仮想マシンに接続する手順について詳しくは、「[Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio (Visual Studio を使用して Azure Cloud Services のロールでリモート デスクトップ接続を有効にする)](cloud-services/cloud-services-role-enable-remote-desktop-visual-studio.md)」をご覧ください。 お使いのブラウザーに、`.rdp` ファイルのダウンロードを求めるメッセージが表示されます。

   b. SSL 証明書を追加するには、IIS マネージャーで管理サービスを開きます。 IIS マネージャーで、**[操作]** ウィンドウの **[バインド]** リンクを開いて SSL を有効にします。 **[サイト バインドの追加]** ダイアログ ボックスが表示されます。 **[追加]** を選択し、**[種類]** ドロップダウン リストから HTTPS を選択します。 **[SSL 証明書]** 一覧で、Azure Portal にアップロードした、CA による署名済みの SSL 証明書を選択します。 詳細については、「 [管理サービスの接続設定を構成する (IIS 7)](http://go.microsoft.com/fwlink/?LinkId=215824)」をご覧ください。

      > [!NOTE]
      > 信頼された SSL 証明書を追加すると、 **発行ウィザード**で警告を表す黄色の三角形が表示されなくなります。

## <a name="include-files-in-the-service-package"></a>サービス パッケージにファイルを含める

作成されるロールの仮想マシンで特定のファイルを使用できるように、サービス パッケージにそれらのファイルを含めることが必要な場合があります。 たとえば、スタートアップ スクリプトで使用する `.exe` ファイルまたは `.msi` ファイルをサービス パッケージに追加する場合があります。 また、Web ロール プロジェクトまたは worker ロール プロジェクトに必要なアセンブリを追加することが必要な場合もあります。 ファイルを含めるには、そのファイルを Azure アプリケーションのソリューションに追加する必要があります。

1. サービス パッケージにアセンブリを追加するには、次の手順に従います。

   a. **ソリューション エクスプローラー** で、参照アセンブリが欠けているプロジェクトのプロジェクト ノードを開きます。
   b. アセンブリをプロジェクトに追加するには、**[参照]** フォルダーのショートカット メニューを開き、**[参照の追加]** をクリックします。 [参照の追加] ダイアログが表示されます。
   c. 追加する参照を選択し、**[OK]** をクリックします。 **[参照]** フォルダーの下の一覧に参照が追加されます。
   d. 追加したアセンブリのショートカット メニューを開き、 **[プロパティ]** をクリックします。 **[プロパティ]** ウィンドウが表示されます。

      このアセンブリをサービス パッケージに含めるには、**[ローカルにコピー]** 一覧で **[True]** を選択します。
1. **ソリューション エクスプローラー** で、参照アセンブリが欠けているプロジェクトのプロジェクト ノードを開きます。

1. アセンブリをプロジェクトに追加するには、**[参照]** フォルダーのショートカット メニューを開き、**[参照の追加]** をクリックします。 **[参照の追加]** ダイアログが表示されます。

1. 追加する参照を選択し、 **[OK]** をクリックします。

    **[参照]** フォルダーの下の一覧に参照が追加されます。

1. 追加したアセンブリのショートカット メニューを開き、 **[プロパティ]** をクリックします。 [プロパティ] ウィンドウが表示されます。

1. このアセンブリをサービス パッケージに含めるには、**[ローカルにコピー]** 一覧で **[True]** を選択します。

1. Web ロール プロジェクトに追加したサービス パッケージにファイルを含めるには、ファイルのショートカット メニューを開き、 **[プロパティ]** をクリックします。 **[プロパティ]** ウィンドウで、**[ビルド アクション]** ボックスの一覧の **[コンテンツ]** をクリックします。

1. worker ロール プロジェクトに追加したサービス パッケージにファイルを含めるには、ファイルのショートカット メニューを開き、 **[プロパティ]** をクリックします。 **[プロパティ]** ウィンドウで、**[出力ディレクトリにコピー]** ボックスの一覧の **[新しい場合はコピーする]** をクリックします。

## <a name="next-steps"></a>次の手順

Visual Studio から Azure への発行の詳細については、「 [Azure アプリケーションの発行ウィザード](vs-azure-tools-publish-azure-application-wizard.md)」をご覧ください。
