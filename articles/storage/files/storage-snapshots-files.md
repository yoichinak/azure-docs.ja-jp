---
title: Azure Files の共有スナップショットの概要 | Microsoft Docs
description: 共有スナップショットは、Azure Files 共有の読み取り専用バージョンであり、共有をバックアップする手段として特定の時点で取得されます。
services: storage
author: RenaShahMSFT
ms.service: storage
ms.topic: article
ms.date: 01/17/2018
ms.author: renash
ms.component: files
ms.openlocfilehash: b261ec5fb0ad437202df1a8fd8683a095cb1bb96
ms.sourcegitcommit: 17fe5fe119bdd82e011f8235283e599931fa671a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/11/2018
ms.locfileid: "42146424"
---
# <a name="overview-of-share-snapshots-for-azure-files"></a>Azure Files の共有スナップショットの概要 
Azure Files には、ファイル共有の共有スナップショットを作成する機能があります。 共有スナップショットは、その時点の共有状態をキャプチャします。 この記事では、共有スナップショットで提供される機能と、それらをカスタムのユース ケースに活用する方法を説明します。

## <a name="when-to-use-share-snapshots"></a>共有スナップショットを使用する目的

### <a name="protection-against-application-error-and-data-corruption"></a>アプリケーション エラーとデータの破損からの保護
ファイル共有を使用するアプリケーションでは、書き込み、読み取り、格納、送信、処理などの操作を実行します。 アプリケーションが正しく構成されていない場合や、意図的ではないバグが組み込まれる場合は、いくつかのブロックが誤って上書きされたり破損したりすることがあります。 このようなシナリオから保護するために、新しいアプリケーション コードをデプロイする前に共有スナップショットを作成できます。 新しいデプロイにバグまたはアプリケーション エラーが組み込まれている場合に、そのファイル共有の以前のバージョンのデータに戻ることができます。 

### <a name="protection-against-accidental-deletions-or-unintended-changes"></a>誤った削除や意図しない変更からの保護
ファイル共有内のテキスト ファイルを操作しているとしましょう。 テキスト ファイルが閉じられると、変更を元に戻すことができなくなります。 このような場合は、以前のバージョンのファイルを復旧する必要があります。 共有スナップショットを使用すると、ファイルを誤って名前変更したり削除したりした場合に以前のバージョンを復旧することができます。

### <a name="general-backup-purposes"></a>一般的なバックアップ目的
ファイル共有を作成した後で、ファイル共有の共有スナップショットを定期的に作成してデータ バックアップに使用することができます。 共有スナップショットを定期的に作成すると、将来の監査要件やディザスター リカバリーに使用できる以前のバージョンのデータを維持できます。

## <a name="capabilities"></a>機能
共有スナップショットは、特定の時点のデータの読み取り専用コピーです。 REST API を使用してスナップショットを作成、削除、管理することができます。 同じ機能をクライアント ライブラリ、Azure CLI、Azure Portal でも使用できます。 

REST API と SMB の両方を使用して、共有のスナップショットを表示することができます。 ディレクトリまたはファイルのバージョンの一覧を取得することができ、特定のバージョンをドライブとして直接マウントすることができます。 

作成された共有スナップショットは、読み取り、コピー、削除はできますが、変更はできません。 別のストレージ アカウントに共有スナップショット全体をコピーすることはできません。 AzCopy またはその他のコピー メカニズムを使用して、ファイルごとにコピーする必要があります。

共有スナップショット機能は、ファイル共有レベルで提供されます。 取得は、個々のファイルを復元できるように個々のファイル レベルで提供されます。 SMB、REST API、ポータル、クライアント ライブラリ、または PowerShell/CLI ツールを使用して完全なファイル共有を復元できます。

ファイル共有の共有スナップショットは、そのベース ファイル共有と同じです。 唯一の違いは、共有スナップショットの作成時刻を示すために **DateTime** 値が共有 URI に追加されることです。 たとえば、ファイル共有の URI が http://storagesample.core.file.windows.net/myshare の場合、共有スナップショットの URI は次のようになります。
```
http://storagesample.file.core.windows.net/myshare?snapshot=2011-03-09T01:42:34.9360000Z
```

共有スナップショットは、明示的に削除されるまで保持されます。 共有スナップショットは、ベース ファイル共有よりも長く保持することはできません。 ベース ファイル共有に関連付けられたスナップショットを列挙して、現在のスナップショットを追跡できます。 

ファイル共有の共有スナップショットを作成するときに、共有のシステム プロパティ内のファイルが共有スナップショットに同じ値でコピーされます。 また、共有スナップショットの作成時に別のメタデータを指定しない限り、ベース ファイルとファイル共有のメタデータも共有スナップショットにコピーされます。

共有スナップショットを持つ共有は、最初にすべての共有スナップショットを削除してからでないと削除できません。

## <a name="space-usage"></a>領域の使用量 
共有スナップショットは、本質的に増分です。 最新の共有のスナップショットの後に変更されたデータだけが保存されます。 これにより、共有スナップショットの作成に必要な時間が最小限に抑えられ、ストレージ コストが削減されます。 オブジェクトへの書き込み操作またはプロパティやメタデータの更新操作は「変更されたコンテンツ」としてカウントされ、共有スナップショットに格納されます。 

領域を節約するために、チャーンが最も高かった期間の共有スナップショットを削除できます。

共有スナップショットは増分的に保存されますが、共有を復元するために保持する必要があるのは最新の共有スナップショットだけです。 共有スナップショットを削除すると、その共有スナップショットに固有のデータのみが削除されます。 アクティブなスナップショットには、(共有スナップショットが作成された時点の) データを参照して元の場所または別の場所に復元するために必要な情報がすべて含まれます。 項目レベルで復元することができます。

スナップショットは、5 TB の共有制限にカウントされません。 合計領域のうち共有スナップショットが占有する領域に制限はありません。 ストレージ アカウントの制限は、引き続き適用されます。

## <a name="limits"></a>制限
Azure Files で現在許可されている共有スナップショットの最大数は 200 です。 共有スナップショットの数が 200 を超えると、新しい共有スナップショットを作成するために、古い共有スナップショットを削除する必要があります。 

共有スナップショットを作成するための同時呼び出しに制限はありません。 特定のファイル共有の共有スナップショットが利用できる領域の量に制限はありません。 

## <a name="copying-data-back-to-a-share-from-share-snapshot"></a>共有スナップショットから共有へのデータのコピー
ファイルや共有スナップショットに関連するコピー操作は次のルールに従います。

ファイル共有スナップショットの個々のファイルは、ベース共有またはその他の任意の場所にコピーできます。 ファイルの以前のバージョンを復元したり、共有スナップショットからファイルごとにコピーして完全なファイル共有を復元したりすることができます。 共有スナップショットはベース共有にレベル上げされません。 

共有スナップショットはコピー後もそのまま残りますが、ベース ファイル共有は、共有スナップショットで使用可能だったデータのコピーで上書きされます。 復元されたファイルはすべて「変更されたコンテンツ」としてカウントされます。

共有スナップショット内のファイルを別の名前でコピー先にコピーできます。 結果として得られるコピー先ファイルは書き込み可能なファイルであり、共有スナップショットではありません。

コピー先ファイルをコピーで上書きしても、元のコピー先ファイルに関連付けられた共有スナップショットは元の状態のままになります。

## <a name="general-best-practices"></a>一般的なベスト プラクティス 
Azure でインフラストラクチャを実行するときには、可能な限りデータ復旧用のバックアップを自動化します。 自動化されたアクションは手動のプロセスより信頼性が高く、データ保護と回復性の向上に役立ちます。 自動化には REST API、クライアント SDK またはスクリプトを使用することができます。

共有スナップショット スケジューラをデプロイする前に、共有スナップショットの頻度とリテンション期間の設定を慎重に検討して、不要な課金を避けてください。

共有スナップショットは、ファイル レベルの保護のみを提供します。 共有スナップショットでは、タイプミスによるファイル共有またはストレージ アカウントの削除を防ぐことはできません。 ストレージ アカウントを誤って削除しないようにするために、ストレージ アカウントまたはリソース グループをロックできます。

## <a name="next-steps"></a>次の手順
- 次のツールで共有スナップショットを操作する方法:
    - [ポータル](storage-how-to-use-files-portal.md#create-and-modify-share-snapshots)
    - [PowerShell](storage-how-to-use-files-powershell.md#create-and-modify-share-snapshots)
    - [CLI](storage-how-to-use-files-cli.md#create-and-modify-share-snapshots)
    - [Windows](storage-how-to-use-files-windows.md#accessing-share-snapshots-from-windows)
- [共有スナップショットに関してよく寄せられる質問](storage-files-faq.md#share-snapshots)
