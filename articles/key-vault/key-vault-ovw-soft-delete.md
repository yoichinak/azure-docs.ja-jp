---
ms.assetid: ''
title: Azure Key Vault の論理的な削除 | Microsoft Docs
ms.service: key-vault
author: bryanla
ms.author: bryanla
manager: mbaldwin
ms.date: 09/25/2017
ms.openlocfilehash: ccdefc83642285194635ffe7b561e9e322360533
ms.sourcegitcommit: 0fcd6e1d03e1df505cf6cb9e6069dc674e1de0be
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/14/2018
ms.locfileid: "42141762"
---
# <a name="azure-key-vault-soft-delete-overview"></a>Azure Key Vault の論理的な削除の概要

Key Vault の論理的な削除機能を使用すると、削除されたコンテナーとコンテナー オブジェクトを復旧できます (論理的な削除として知られています)。 具体的には、以下のシナリオを扱います。

- キー コンテナーの回復可能な削除のサポート
- キー コンテナー オブジェクトの回復可能な削除のサポート (例:  キー、シークレット、証明書)

## <a name="supporting-interfaces"></a>インターフェイスのサポート

論理的な削除機能は、最初は REST、.NET/C#、PowerShell、および CLI の各インターフェイスで使用できます。

各インターフェイスの詳細なリファレンスについては、[Key Vault のリファレンス](https://docs.microsoft.com/azure/key-vault/)に関するページを参照してください。

## <a name="scenarios"></a>シナリオ

Azure Key Vault は追跡対象のリソースであり、Azure Resource Manager によって管理されます。 Azure Resource Manager では、明確に定義された削除動作も指定されます。この動作では、正常な DELETE 操作によって、以降そのリソースにアクセスできないようにする必要があります。 論理的な削除機能は、削除が偶発的なものか意図的なものかにかかわらず、削除されたオブジェクトの回復に対処します。

1. 一般的なシナリオでは、ユーザーが誤ってキー コンテナーまたはキー コンテナー オブジェクトを削除します。事前に定義された期間だけ、そのキー コンテナーまたはキー コンテナー オブジェクトを回復できるようにすると、ユーザーは削除を取り消して、データを回復することができます。

2. もう 1 つのシナリオでは、悪意のあるユーザーが、キー コンテナーまたはキー コンテナー オブジェクト (コンテナー内のキーなど) を削除して、業務を中断させようとします。 安全対策として、キー コンテナーまたはキー コンテナー オブジェクトの削除と、基盤となるデータの実際の削除を分離するには、たとえば、データ削除のアクセス許可を、別の信頼できるロールに制限します。 このアプローチでは、すぐにデータが失われる結果を招く可能性がある操作に対しては、事実上クォーラムが必要になります。

### <a name="soft-delete-behavior"></a>論理的な削除の動作

この機能を使用すると、キー コンテナーまたはキー コンテナー オブジェクトの DELETE 操作は論理的な削除となり、見かけ上はオブジェクトが削除されていても、実際には指定したリテンション期間だけリソースが保持されます。 さらに、削除されたオブジェクトを回復する、実質的には削除を元に戻すメカニズムも用意されています。 

論理的な削除は Key Vault のオプションの動作であり、このリリースでは**既定では有効になっていません**。 

### <a name="key-vault-recovery"></a>キー コンテナーの回復

キー コンテナーを削除すると、サービスによってサブスクリプションにプロキシ リソースが作成され、回復に必要なメタデータが追加されます。 プロキシ リソースは保存済みオブジェクトで、削除済みキー コンテナーと同じ場所から使用できます。 

### <a name="key-vault-object-recovery"></a>キー コンテナー オブジェクトの回復

キーなどのキー コンテナー オブジェクトを削除すると、オブジェクトは削除済み状態になり、取得操作ではアクセスできなくなります。 この状態のキー コンテナー オブジェクトは、表示、回復、強制/完全削除だけができます。 

また、Key Vault では、削除したキー コンテナーまたはキー コンテナー オブジェクトに対応する基盤となるデータが、事前に定義されたリテンション期間の後に削除されるようにスケジュールされます。 また、コンテナーに対応する DNS レコードも、リテンション期間の間だけ保持されます。

### <a name="soft-delete-retention-period"></a>論理的な削除のリテンション期間

論理的に削除されたリソースは、一定の時間、つまり 90 日間保持されます。 論理的な削除のリテンション期間の間は、以下が適用されます。

- サブスクリプションで論理的な削除状態のすべてのキー コンテナーとキー コンテナー オブジェクトを表示したり、その削除情報と回復情報にアクセスしたりできます。
    - 特別なアクセス許可を持つユーザーだけが、削除されたコンテナーを表示できます。 削除されたコンテナーを扱うための特別なアクセス許可が指定されたカスタム ロールを作成することをお勧めします。
- 同じ場所には同じ名前のキー コンテナーを作成できません。同様に、キー コンテナー オブジェクトを、そのオブジェクトと同じ名前の削除済み状態オブジェクトが含まれるキー コンテナーに作成することはできません。 
- 特別な権限を持つユーザーのみが、対応するプロキシ リソースで回復コマンドを発行して、キー コンテナーまたはキー コンテナー オブジェクトを復元できます。
    - リソース グループにキー コンテナーを作成する権限を持つユーザー (カスタム ロールのメンバー) がコンテナーを復元できます。
- 特別な権限を持つユーザーのみが、対応するプロキシ リソースで削除コマンドを発行して、キー コンテナーまたはキー コンテナー オブジェクトを強制的に削除できます。

論理的に削除されたキー コンテナーまたはキー コンテナー オブジェクトとそのコンテンツは、そのキー コンテナーまたはキー コンテナー オブジェクトを回復しない限り、リテンション期間の終わりに消去されます。 リソースの削除は、再スケジュールできません。

### <a name="permitted-purge"></a>許可された消去

プロキシ リソースで POST 操作によってキー コンテナーを完全削除、つまり消去することが可能ですが、それには特別な権限が必要です。 一般的に、サブスクリプションの所有者だけが、キー コンテナーを消去できます。 POST 操作では、コンテナーが直ちに削除されます。この削除は元に戻すことができません。 

ただし、Azure サブスクリプションが "*削除不可*" とマークされている場合は例外です。 この場合は、サービスのみが実際の削除を実行できます。これは、スケジュールされたプロセスとして行われます。 

### <a name="billing-implications"></a>課金への影響

一般に、オブジェクト (キー コンテナー、キー、またはシークレット) が削除済み状態にある場合は、'purge' と 'recover' の 2 つの操作のみが可能です。 その他の操作はすべて失敗します。 したがって、オブジェクトが存在するにもかかわらず操作を実行できないため、使用状況は発生せず、課金も発生しません。 ただし、次の例外があります。

- 'purge' および 'recover' アクションは通常のキー コンテナー操作と見なされ、課金されます。
- オブジェクトが HSM キーである場合は、過去 30 日間にキー バージョンが使用されていると、'HSM で保護されたキー' の 1 か月あたり、キー バージョンあたりの課金が適用されます。 その後は、オブジェクトが削除済み状態になり、それに対して操作を実行できないため、課金は適用されません。

## <a name="next-steps"></a>次の手順

次の 2 つのガイドでは、論理的な削除を使用する場合の主な使用シナリオを紹介しています。

- [PowerShell で Key Vault の論理的な削除を使用する方法](key-vault-soft-delete-powershell.md) 
- [CLI で Key Vault の論理的な削除を使用する方法](key-vault-soft-delete-cli.md)

