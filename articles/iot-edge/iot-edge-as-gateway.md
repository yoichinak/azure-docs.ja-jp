---
title: Azure IoT Edge デバイスをゲートウェイとして使用する | Microsoft Docs
description: Azure IoT Edge を使って、複数のダウンストリーム デバイスからクラウドにデータを送信する、またはデータをローカルに処理する、透過的デバイス、非透過的デバイス、またはプロキシ ゲートウェイ デバイスを作成します。
author: kgremban
manager: timlt
ms.author: kgremban
ms.date: 11/27/2017
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 0e085d6c2962ec2a2324bfc134b0e201df04a336
ms.sourcegitcommit: 150a40d8ba2beaf9e22b6feff414f8298a8ef868
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37028967"
---
# <a name="how-an-iot-edge-device-can-be-used-as-a-gateway"></a>IoT Edge デバイスをゲートウェイとして使用する方法

IoT ソリューションでのゲートウェイの目的は、ソリューションに固有であり、デバイスの接続とエッジ分析を結合します。 Azure IoT Edge を使うと、目的が接続、ID、エッジ分析のいずれに関係していても、IoT ゲートウェイのすべてのニーズを満たすことができます。 この記事のゲートウェイ パターンでは、ダウンストリーム デバイスの接続の特性とデバイスの ID のみが示されており、ゲートウェイでのデバイス データの処理方法は示されていません。

## <a name="patterns"></a>パターン
ゲートウェイとしての IoT Edge デバイスの使用には、透過、プロトコル変換、ID 変換の 3 つのパターンがあります。
* **透過** – IoT Hub に理論的に接続できるデバイスは、代わりにゲートウェイ デバイスに接続できます。 これは、ダウンストリーム デバイスが独自の IoT Hub ID を持ち、MQTT、AMQP、HTTP のいずれかのプロトコルを使っていることを意味します。 ゲートウェイは、デバイスと IoT Hub の間の通信を単純に受け渡します。 デバイスはゲートウェイ経由でクラウドと通信していることを認識せず、IoT Hub のデバイスを操作しているユーザーは中間のゲートウェイ デバイスに気付きません。 したがって、ゲートウェイは透過的です。 透過的なゲートウェイとして IoT Edge デバイスを使う方法については、「[透過的なゲートウェイの作成][lnk-iot-edge-as-transparent-gateway]」をご覧ください。
* **プロトコル変換** – MQTT、AMQP、または HTTP をサポートしていないデバイスは、ゲートウェイ デバイスを使って IoT Hub にデータを送信します。 ゲートウェイは、ダウンストリーム デバイスでそのプロトコルが使われていることを認識できるほど十分にスマートです。ただし、ゲートウェイは IoT Hub 内で ID を持つ唯一のデバイスです。 すべての情報は、1 つのデバイスつまりゲートウェイから送信されているように見えます。 これは、クラウド アプリケーションでデバイスごとにデータに関する理由が必要な場合、ダウンストリーム デバイスは追加の識別情報をメッセージに埋め込む必要があることを意味します。 さらに、ツインやメソッドのような IoT Hub プリミティブを使うことができるのはゲートウェイ デバイスのみであり、ダウンストリーム デバイスは使えません。
* **ID 変換** - IoT Hub に接続できないデバイスはゲートウェイ デバイスに接続し、ゲートウェイ デバイスがダウンストリーム デバイスに代わって IoT Hub に ID およびプロトコルの変換を提供します。 ゲートウェイは、ダウンストリーム デバイスによって使われているプロトコルを認識し、ダウンストリーム デバイスに ID を提供し、IoT Hub のプリミティブを変換できるほど十分にスマートです。 ダウンストリーム デバイスは、ツインとメソッドを備えたファースト クラスのデバイスとして IoT Hub に認識されます。 ユーザーは、中間のゲートウェイ デバイスを意識せずに IoT Hub 内のデバイスを操作できます。

![ゲートウェイのパターンの図][1]

## <a name="use-cases"></a>ユース ケース
すべてのゲートウェイ パターンには次の利点があります。
* **エッジ分析** – AI サービスをローカルに使って、クラウドに完全に忠実なテレメトリを送信することなく、ダウンストリーム デバイスからのデータを処理します。 ローカルに洞察を検索して対応し、データのサブセットのみを IoT Hub に送信します。 
* **ダウンストリーム デバイスの分離** – ゲートウェイ デバイスは、すべてのダウンストリーム デバイスをインターネットへの露出から保護できます。 接続されていない OT ネットワークと、Web へのアクセスを提供する IT ネットワークの間に配置できます。 
* **接続の多重化** - IoT Edge デバイスを介して IoT Hub に接続するすべてのデバイスは、同じ基になる接続を使用します。
* **トラフィックのスムージング** - IoT Edge デバイスは、メッセージをローカルに保持しながら、IoT Hub を調整する場合に指数のバックオフを自動的に実装します。 これにより、急増するトラフィックに対するソリューションの回復力が高まります。
* **制限されるオフライン サポート** - ゲートウェイ デバイスは、IoT Hub に配信できなかったメッセージとツインの更新をローカルに保存します。

プロトコル変換を行うゲートウェイは、リソースが制約される既存デバイスと新規デバイスに対し、エッジ分析、デバイス分離、トラフィック スムージング、およびオフライン サポートも実行できます。 既存の多くのデバイスは、ビジネスの洞察に役立つデータを生成します。しかし、クラウドへの接続を考慮して設計されてはいません。 非透過的なゲートウェイを使うと、このデータの制約がなくなり、エンド ツー エンドの IoT ソリューションで利用できるようになります。

ID 変換を行うゲートウェイを使うと、プロトコル変換の利点が提供され、さらにクラウドからダウンストリーム デバイスを完全に管理できます。 IoT ソリューションのすべてのデバイスは、使われているプロトコルに関係なく、IoT Hub に認識されます。

## <a name="cheat-sheet"></a>チート シート
透過的ゲートウェイ、非透過的ゲートウェイ、およびプロキシ ゲートウェイを使ったときの IoT Hub プリミティブを比較した簡単なチート シートを次に示します。

| &nbsp; | 透過的なゲートウェイ | プロトコル変換 | ID 変換 |
|--------|-------------|--------|--------|
| IoT Hub ID レジストリに格納されている ID | 接続されているすべてのデバイスの ID | ゲートウェイ デバイスの ID のみ | 接続されているすべてのデバイスの ID |
| デバイス ツイン | 各接続のデバイスには、独自のデバイス ツインが含まれている | デバイスとモジュール ツインはゲートウェイにのみ含まれている | 各接続のデバイスには、独自のデバイス ツインが含まれている |
| ダイレクト メソッドおよびクラウドからデバイスへのメッセージ | クラウドは接続された各デバイスを個別にアドレスできる | クラウドはゲートウェイ デバイスのみをアドレスできる | クラウドは接続された各デバイスを個別にアドレスできる |
| [IoT Hub のスロットルおよびクォータ][lnk-iothub-throttles-quotas] | 各デバイスに適用する | ゲートウェイ デバイスに適用する | 各デバイスに適用する |

非透過的なゲートウェイ (プロトコル変換) パターンを使用する場合、そのゲートウェイを介して接続するすべてのデバイスは、同一のクラウドからデバイスのキューを共有します。これには最大で 50 のメッセージを含めることができます。 したがって、各フィールド ゲートウェイを介して接続するデバイスが非常に少なく、クラウドからデバイスへのトラフィックが少ない場合にのみ、非透過的なゲートウェイ パターンを使用する必要があります。

## <a name="next-steps"></a>次の手順
IoT Edge デバイスを[透過的ゲートウェイ][lnk-iot-edge-as-transparent-gateway]として使います 

[lnk-iot-edge-as-transparent-gateway]: ./how-to-create-transparent-gateway-linux.md
[lnk-iothub-throttles-quotas]: ../iot-hub/iot-hub-devguide-quotas-throttling.md

[1]: ./media/iot-edge-as-gateway/edge-as-gateway.png
