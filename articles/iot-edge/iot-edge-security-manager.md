---
title: Azure IoT Edge セキュリティ マネージャー | Microsoft Docs
description: IoT Edge デバイスのセキュリティ方針とセキュリティ サービスの整合性を管理します。
services: iot-edge
keywords: セキュリティ, 要素, エンクレーブ, IoT Edge
author: eustacea
manager: timlt
ms.author: eustacea
ms.date: 07/30/2018
ms.topic: article
ms.service: iot-edge
ms.openlocfilehash: 9b4801048c391aae6e95f4181464255ecf6151fc
ms.sourcegitcommit: 99a6a439886568c7ff65b9f73245d96a80a26d68
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2018
ms.locfileid: "39359541"
---
# <a name="azure-iot-edge-security-manager"></a>Azure IoT Edge セキュリティ マネージャー

Azure IoT Edge セキュリティ マネージャーは、セキュア シリコン ハードウェアを抽象化することによって IoT Edge デバイスとそのすべてのコンポーネントを保護するための、適切に境界付けられたセキュリティ コアです。 これはセキュリティ強化の中心点であり、本来のデバイス製造元 (OEM) にテクノロジの統合ポイントを提供します。

![Azure IoT Edge セキュリティ マネージャー](media/edge-security-manager/iot-edge-security-manager.png)

IoT Edge セキュリティ マネージャーの目的は、IoT Edge デバイスとすべての本質的なソフトウェア動作の整合性を保護することです。  そのために、基になる信頼のハードウェア ルート ハードウェア (ある場合) から信頼を移行することにより、安全に IoT Edge ランタイムをブートストラップして、その動作の整合性を継続的に監視します。  IoT Edge セキュリティ マネージャーは基本的に、セキュア シリコン ハードウェアと連携し (可能な場合)、可能な最高のセキュリティ保証を提供できるようになっている、ソフトウェアで構成されます。  

IoT Edge セキュリティ マネージャーには次のような役割があります (ただし、これだけではありません)。

* Azure IoT Edge デバイスのセキュリティで保護されて測定されたブートストラップ。
* デバイス ID のプロビジョニングと信頼の切り替え (該当する場合)。
* Device Provisioning Service などのクラウド サービスのデバイス コンポーネントのホストと保護。
* モジュールの一意 ID による IoT Edge モジュールのセキュリティ保護されたプロビジョニング。
* 公証人サービスによる信頼のデバイス ハードウェア ルートに対するゲートキーパー。
* 実行時の IoT Edge の動作の整合性の監視。

IoT Edge セキュリティ マネージャーは、次の 3 つの主要なコンポーネントで構成されています。

* IoT Edge セキュリティ デーモン。
* ハードウェア セキュリティ モジュール プラットフォーム抽象化レイヤー (HSM PAL)。
* 必須ではないが強く推奨される信頼のハードウェア シリコン ルート (HSM)。

## <a name="the-iot-edge-security-daemon"></a>IoT Edge セキュリティ デーモン

IoT Edge セキュリティ デーモンは、IoT Edge セキュリティ マネージャーの論理動作を担当するソフトウェアです。  IoT Edge デバイスの信頼できるコンピューティング ベースの重要な部分を構成します。 

### <a name="design-principles"></a>設計原則

適切かつ実際的にその責任を果たすため、IoT Edge セキュリティ デーモンでは次の中核的原則に準拠することが目指されています。

#### <a name="maximize-operational-integrity"></a>動作の整合性を最大にする

IoT Edge セキュリティ デーモンは、特定の信頼のルート ハードウェアの防御機能内で可能な限り高い整合性で動作するように設計されています。 適切な統合により、信頼のルート ハードウェアは、静的および実行時にセキュリティ デーモンを測定および監視して改ざんを防ぎます。

一般に、物理的なアクセスは常に IoT デバイスに対する脅威です。  そのため、信頼のハードウェア ルートは、IoT Edge セキュリティ デーモンの整合性の保護において重要な役割を果たします。  信頼のハードウェア ルートには 2 種類あります。

* シークレットや暗号化キーなどの機密情報を保護するためのセキュリティで保護された要素。
* キーのようなシークレットおよび測定や課金のような機密性の高いワークロードなどを保護するためのセキュリティで保護されたエンクレーブ。

信頼のハードウェア ルートを使用するためのモデルが 2 つあるため、2 種類の実行環境が生じます。

* 機密情報の保護をセキュリティで保護された要素の使用に依存する標準のリッチ実行環境 (REE)。
* 機密情報の保護およびソフトウェア実行に対する保護の提供をセキュリティで保護されたエンクレーブ テクノロジの使用に依存する信頼できる実行環境 (TEE)。

信頼のハードウェア ルートとしてセキュリティで保護されたエンクレーブを使用するデバイスの場合、IoT Edge セキュリティ デーモン内の機密性の高いロジックはエンクレーブ内に存在するものと想定されます。  セキュリティ デーモンの重要ではない部分は、TEE の外部に存在できます。  いずれの場合も、元の設計の製造元 (ODM) および OEM (Original Equipment Manufacturer) には、それらの HSM から信頼を拡張し、起動時と実行時に Edge セキュリティ デーモンの整合性を測定して保護することが期待されます。

#### <a name="minimize-bloat-and-churn"></a>肥大化とチャーンを最小にする

Edge セキュリティ デーモンのもう 1 つの核心的原則は、チャーンを最小限に抑えることです。  最高レベルの信頼では、IoT Edge セキュリティ デーモンは信頼のデバイス ハードウェア ルートと緊密に結合し、ネイティブ コードとして動作できます。  この種の実現方法では、(OS で提供される更新メカニズムではなく) 信頼のハードウェア ルートのセキュリティで保護された更新パスによってデーモンのソフトウェアを更新するのが一般的であり、特定のハードウェアやデプロイ シナリオでは困難になる可能性があります。  IoT デバイスに対してはセキュリティの更新が強く推奨されますが、過剰な更新要件や大規模な更新ペイロードはさまざまな方法で脅威にさらされる面を広げることも事実です。  たとえば、動作の可用性を最大化する更新のスキップ、または大きな更新ペイロードを処理するために過度に制約される信頼のルート ハードウェアなどです。  そのため、IoT Edge セキュリティ デーモンの設計は、フットプリントしたがって信頼できるコンピューティング ベースを小さく保ち、更新要件を最小限に抑えるために、簡潔なものになっています。

### <a name="architecture-of-iot-edge-security-daemon"></a>IoT Edge セキュリティ デーモンのアーキテクチャ

![Azure IoT Edge セキュリティ デーモン](media/edge-security-manager/iot-edge-security-daemon.png)

IoT Edge セキュリティ デーモンは、セキュリティ強化のために利用可能な信頼のハードウェア ルート テクノロジを活用するように設計されています。  また、信頼できる実行環境 (TEE) を提供するハードウェア テクノロジを活用するために、標準/リッチ実行環境 (REE) と信頼できる実行環境 (TEE) の間の分割動作を可能にするように設計されています。  IoT Edge セキュリティ デーモンのアーキテクチャの中核は、IoT Edge デバイスとその動作の整合性を確保するための、Edge の主要コンポーネントの相互作用を可能にするロール固有のインターフェイスです。

#### <a name="cloud-interface"></a>クラウド インターフェイス

クラウド インターフェイスにより、IoT Edge セキュリティ デーモンはセキュリティ更新のようなデバイス セキュリティに対するクラウド補完などのクラウド サービスにアクセスできます。  たとえば、IoT Edge セキュリティ デーモンは、現在、このインターフェイスを使用してデバイス ID ライフサイクル管理のために Azure IoT Hub の [Device Provisioning Service (DPS)](https://docs.microsoft.com/azure/iot-dps/) にアクセスします。  

#### <a name="management-api"></a>管理 API

IoT Edge セキュリティ デーモンでは管理 API が提供されており、Edge モジュールの作成/開始/停止/削除のときに Edge エージェントによって呼び出されます。 IoT Edge セキュリティ デーモンは、すべてのアクティブなモジュールの "登録" を保持しています。 これらの登録は、モジュールの ID をモジュールの一部のプロパティにマップします。 このようなプロパティの例としては、コンテナーで実行しているプロセスのプロセス ID (pid) や、Docker コンテナーの内容のハッシュなどがあります。

これらのプロパティは、呼び出し元がアクションの実行を許可されていることを証明するために、ワークロード API (後述) によって使用されます。

管理 API は特権を持つ API であり、IoT Edge エージェントからのみ呼び出されます。  IoT Edge セキュリティ デーモンは、IoT Edge エージェントをブートストラップして開始するので、IoT Edge エージェントが改ざんされていないことを証明した後で、IoT Edge エージェントの暗黙の登録を作成できます。 ワークロード API が使用するものと同じ構成証明プロセスが、管理 API へのアクセスを IoT Edge エージェントに制限するために使用されします。

#### <a name="container-api"></a>コンテナー API

IoT Edge セキュリティ デーモンでは、Moby や Docker など、モジュールのインスタンス化のために使用中のコンテナー システムと対話するためのコンテナー インターフェイスが提供されています。

#### <a name="workload-api"></a>ワークロード API

ワークロード API は、IoT Edge エージェントを含むすべてのモジュールにアクセスできる IoT Edge セキュリティ デーモン API です。 この API は、HSM ルート化署名付きトークンまたは X509 証明書の形式での ID の証拠と、対応する信頼バンドルを、モジュールに提供します。 信頼バンドルには、モジュールが信頼する必要のある他のすべてのサーバーの CA 証明書が含まれています。

IoT Edge セキュリティ デーモンは、構成証明プロセスを使用してこの API を保護します。 モジュールがこの API を呼び出すと、IoT Edge セキュリティ デーモンは ID の登録の発見を試みます。 見つかった場合は、登録のプロパティを使ってモジュールを測定します。 測定プロセスの結果が登録と一致する場合は、新しい HSM ルート化署名付きトークンまたは X509 証明書が生成されて、対応する CA 証明書 (信頼バンドル) がモジュールに返されます。  モジュールは、この証明書を使って、IoT Hub や他のモジュールに接続したり、サーバーを起動したりします。 署名付きトークンまたは証明書の有効期限が近づいたときは、モジュールが新しい証明書を要求する必要があります。  ID 更新プロセスを可能な限りシームレスにするため、追加の考慮事項が設計に組み込まれています。

### <a name="integration-and-maintenance"></a>統合とメンテナンス

Microsoft は、[GitHub 上の IoT Edge セキュリティ デーモン](https://github.com/Azure/iotedge/tree/master/edgelet)に対するメイン コード ベースを保持しています。

#### <a name="installation-and-updates"></a>インストールと更新

ネイティブ プロセスのため、IoT Edge セキュリティ デーモンのインストールと更新は、オペレーティング システムのパッケージ管理システムによって管理されます。  ただし、信頼のハードウェア ルートを含む IoT Edge デバイスは、デバイスのセキュリティで保護された起動および更新管理システムによってライフサイクルを管理することで、デーモンの整合性をさらに強化することが期待されます。  それぞれのデバイス機能に従ってこれらの手段を調べることは、デバイスの製造元に委ねられます。

#### <a name="versioning"></a>バージョン管理

IoT Edge ランタイムは、IoT Edge セキュリティ デーモンのバージョンを追跡して報告します。 バージョンは、Edge エージェント モジュールが報告するプロパティの *runtime.platform.version* 属性として報告されます。

### <a name="hardware-security-module-platform-abstraction-layer-hsm-pal"></a>ハードウェア セキュリティ モジュール プラットフォーム抽象化レイヤー (HSM PAL)

HSM PAL は、すべての信頼のルート ハードウェアを抽象化して、IoT Edge の開発者やユーザーをそれらの複雑さから切り離します。  HSM PAL は、アプリケーション プログラマー インターフェイス (API) と、ドメイン内通信手順 (標準実行環境とセキュリティで保護されたエンクレーブとの間の通信など) の組み合わせで構成されます。  HSM PAL の実際の実装は、使用されている特定のセキュリティ保護されたハードウェアに依存します。  HSM PAL が存在することにより、IoT エコシステムではほとんどすべてのセキュア シリコン ハードウェアを使用できます。

## <a name="secure-silicon-root-of-trust-hardware"></a>信頼のセキュア シリコン ルート ハードウェア

セキュア シリコンは、IoT Edge デバイス ハードウェア内に信頼を固定するために必要です。  セキュア シリコンは、トラステッド プラットフォーム モジュール (TPM)、埋め込みセキュア エレメント (eSM)、ARM Trustzone、Intel SGX、カスタム セキュア シリコン テクノロジなど、さまざまな形式で提供されます。  IoT デバイスの物理的なアクセシビリティに関連する脅威のため、デバイスでは信頼のセキュア シリコン ルートを使うことを強くお勧めします。

## <a name="iot-edge-security-manager-integration-and-maintenance"></a>IoT Edge セキュリティ マネージャーの統合とメンテナンス

IoT Edge セキュリティ マネージャーの主要な目標の 1 つは、独自のセキュリティ強化のために Azure IoT Edge プラットフォームのセキュリティと整合性の保護を行っているコンポーネントを識別して分離することです。  そのため、デバイス製造元などのサード パーティには、それぞれのデバイス ハードウェアで使用できるカスタム セキュリティ機能を利用することが期待されます。  Linux および Windows プラットフォームでトラステッド プラットフォーム モジュール (TPM) を使用して Azure IoT セキュリティ マネージャーのセキュリティを強化する方法の例へのリンクについては、後の「次の手順」セクションをご覧ください。  これらの例ではソフトウェアまたは仮想 TPM を使用していますが、個別の TPM デバイスの使用に対して直接適用されます。  

## <a name="next-steps"></a>次の手順

ブログ「[Securing the intelligent edge](https://azure.microsoft.com/blog/securing-the-intelligent-edge/)」(インテリジェント エッジをセキュリティで保護する) を読む。

[Linux 仮想マシン上で仮想 TPM](how-to-auto-provision-simulated-device-linux.md) を使用して Edge デバイスを作成およびプロビジョニングする。

[Windows 上でシミュレートされた TPM Edge デバイス](how-to-auto-provision-simulated-device-windows.md)を作成およびプロビジョニングする。

<!-- Links -->
[lnk-edge-blog]: https://azure.microsoft.com/blog/securing-the-intelligent-edge/
