---
title: Graph API のパーティション分割 | Microsoft Docs
description: Azure Cosmos DB でパーティション分割されたグラフを使用する方法について説明します。
services: cosmos-db
author: luisbosquez
manager: kfile
ms.service: cosmos-db
ms.component: cosmosdb-graph
ms.devlang: na
ms.topic: conceptual
ms.date: 02/28/2018
ms.author: lbosq
ms.openlocfilehash: 202c575a917cfb24436d86881e5368b61f216d42
ms.sourcegitcommit: 0b4da003fc0063c6232f795d6b67fa8101695b61
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/05/2018
ms.locfileid: "37861210"
---
# <a name="using-a-partitioned-graph-in-azure-cosmos-db"></a>Azure Cosmos DB でのパーティション分割されたグラフの使用

Azure Cosmos DB の Graph API の主な特長の 1 つとして、水平スケーラビリティによって大規模なグラフを処理する機能があります。 このプロセスは [Azure Cosmos DB でのパーティション分割](partition-data.md#how-does-partitioning-work)を通して実現されます。このパーティション分割では、ストレージとスループットに基づいて個別にスケーリング可能なコンテナーが利用されます。 Azure Cosmos DB では、すべての API に対して次の種類のコンテナーをサポートしています。

- **固定のコンテナー**: これらのコンテナーには、最大で 10 GB のグラフ データベースを格納でき、1 秒あたり最大で 10,000 の要求単位が割り当てられます。 固定のコンテナーを作成する場合、データ内にパーティション キー プロパティを指定する必要はありません。

- **無制限のコンテナー**: これらのコンテナーでは、行方向のパーティション分割によって 10 GB の制限を超えるグラフを格納できるように自動的にスケーリングが行われます。 各パーティションには 10 GB のデータが格納され、このデータは**指定したパーティション キー** (無制限のコンテナーを使用する場合に必須のパラメーター) に基づいて自動的にバランスが取られます。 この種類のコンテナーでは実質的に無制限のサイズのデータを格納できると共に、1 秒あたり最大で 100,000 の要求単位 ([サポートに連絡](https://aka.ms/cosmosdbfeedback?subject=Cosmos%20DB%20More%20Throughput%20Request)すれば、それ以上) を許可することができます。

このドキュメントでは、グラフ データベースをパーティション分割する方法の詳細に加えて、頂点 (ノード) とエッジの両方に及ぼす影響についても説明します。

## <a name="requirements-for-partitioned-graph"></a>パーティション分割グラフの要件

パーティション分割されたグラフのコンテナーを作成する場合に理解しておく必要がある詳細事項を次に示します。
- コンテナーのサイズが 10 GB を超えると予想される場合、および 1 秒間に 10,000 を超える要求単位 (RU/秒) が必要な場合は、**パーティション分割の設定が必要になります**。
- Azure Cosmos DB Graph API コンテナーのバックエンドに、**頂点とエッジの両方が JSON ドキュメントとして格納されます**。
- **頂点にはパーティション キーが必須です**。 このキーによって、ハッシュ アルゴリズムを通して頂点が格納されるパーティションが決定されます。 このパーティション キーの名前はスペースまたは特殊文字を含まない 1 単語の文字列であり、ポータル上でフォーマット `/partitioning-key-name` を使用して新しいコンテナーを作成する場合に定義されます。
- **エッジはソースの頂点と共に格納されます**。 つまり、頂点ごとに、そのパーティション キーによって、頂点がその送信エッジと共に格納される場所が定義されます。 これは、グラフ クエリで `out()` カーディナリティを使用する際にクロス パーティション クエリを回避するために行われます。
- **グラフ クエリではパーティション キーを指定する必要があります**。 Azure Cosmos DB で行方向のパーティション分割を最大限に活用するには、単一の頂点を選択するときに、可能な限り、パーティション キーを指定します。 パーティション分割されたグラフにおいて 1 つまたは複数の頂点を選択するためのクエリを次に示します。

    - ID によって頂点を選択してから、**`.has()` ステップを使用してパーティション キー プロパティを指定する**: 
    
        ```
        g.V('vertex_id').has('partitionKey', 'partitionKey_value')
        ```
    
    - **パーティション キー値と ID が含まれている組を指定**して頂点を選択する: 
    
        ```
        g.V(['partitionKey_value', 'vertex_id'])
        ```
        
    - **パーティション キー値と ID の組の配列**を指定する:
    
        ```
        g.V(['partitionKey_value0', 'verted_id0'], ['partitionKey_value1', 'vertex_id1'], ...)
        ```
        
    - 頂点セットを選択し、**パーティション キー値の一覧を指定する**: 
    
        ```
        g.V('vertex_id0', 'vertex_id1', 'vertex_id2', …).has('partitionKey', within('partitionKey_value0', 'partitionKey_value01', 'partitionKey_value02', …)
        ```

## <a name="best-practices-when-using-a-partitioned-graph"></a>パーティション分割されたグラフを使用する場合のベスト プラクティス

無制限のコンテナーでパーティション分割されたグラフを使用する場合、最も効率的なパフォーマンスとスケーラビリティが確実に得られるようにするには次のガイドラインに従う必要があります。
- **頂点に対してクエリを実行するときは常にパーティション キー値を指定します**。 既知のパーティションからの頂点の取得は、パフォーマンスの観点から最も効率的な方法です。
- **エッジに対してクエリを実行する場合は、可能な限り、送信方向を使用します**。 前述のように、エッジは、送信方向のそのソース頂点と一緒に格納されます。 つまり、このパターンを念頭においてデータとクエリを設計すると、クロス パーティション クエリを使用する可能性が最小限に抑えられます。
- **パーティション間でデータを均等に分散するパーティション キーを選択します**。 この決定は、ソリューションのデータ モデルに大きく依存します。 適切なパーティション キーの作成の詳細については、「[Azure Cosmos DB でのパーティション分割とスケーリング](partition-data.md)」を参照してください。
- **可能な場合、パーティションの境界内でデータを取得するようにクエリを最適化します**。 最適なパーティション分割方法を決める場合は、クエリ パターンに合わせます。 1 つのパーティションからデータを取得するクエリでは、最大限のパフォーマンスを実現できます。

## <a name="next-steps"></a>次の手順
この記事では、Azure Cosmos DB Graph API を使ったパーティション分割の概念とベスト プラクティスについて概説しました。 

* [Azure Cosmos DB でのパーティション分割とスケーリング](partition-data.md)について説明します。
* [Graph API での Gremlin のサポート](gremlin-support.md)について説明します。
* [Graph API の概要](graph-introduction.md)について説明します。
