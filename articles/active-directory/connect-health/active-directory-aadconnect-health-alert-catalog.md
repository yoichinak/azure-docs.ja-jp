---
title: Azure AD Connect Health - アラート カタログ | Microsoft Docs
description: このドキュメントでは、Azure AD Connect Health のすべてのアラートのカタログを示します。
services: active-directory
documentationcenter: ''
author: zhiweiwangmsft
manager: maheshu
editor: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/15/2018
ms.author: zhiweiw
ms.openlocfilehash: 8699fd77943ba89d60a8ad820f8116b49ece6089
ms.sourcegitcommit: 99a6a439886568c7ff65b9f73245d96a80a26d68
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2018
ms.locfileid: "39359094"
---
# <a name="azure-active-directory-connect-health-alert-catalog"></a>Azure Active Directory Connect Health のアラート カタログ 

Azure AD Connect Health サービスは、ID インフラストラクチャに問題があることを示すアラートを送信します。 この記事には、各アラートのタイトル、説明、および修復手順が含まれています。 <br />
Connect Health サービスから生成されるアラートには、エラー、警告、および事前警告という 3 つの段階があります。 トリガーされたアラートには、すぐに対応することを強くお勧めします。 <br />
Azure AD Connect Health アラートは、成功条件を満たすと解決されます。 Azure AD Connect Health エージェントは、定期的に成功条件を検出してサービスにレポートします。 一部のアラートは、時間に基づいて抑制されます。 つまり、アラートの生成から 72 時間以内に同じエラー条件が観察されない場合、アラートは自動的に解決されます。

## <a name="general-alerts"></a>一般的なアラート

| アラート名 | 説明 | 修復 |
| --- | --- | ----- |
| Health サービス データが最新ではありません | 1 台以上のサーバー上で実行されている正常性エージェントがヘルス サービスに接続されておらず、ヘルス サービスはこのサーバーから最新データを受信していません。 ヘルス サービスによって最後に処理されたデータは 2 時間より前のものです。 | 正常性エージェントに必要なサービス エンドポイントへの送信接続があることを確認します。 [詳細](active-directory-aadconnect-health-data-freshness.md) |

## <a name="alerts-for-azure-ad-connect-sync"></a>Azure AD Connect のアラート (同期)

| アラート名 | 説明 | 修復 |
| --- | --- | ----- |
| Azure AD Connect Sync Service が実行されていません | Microsoft Azure AD Sync Windows サービスが実行されていないか開始できませんでした。 その結果、オブジェクトは Azure Active Directory と同期しなくなります。 | Microsoft Azure Active Directory 同期サービスを開始します。</b> <ol> <li><b>[スタート]</b> ボタンをクリックし、<b>[ファイル名指定して実行]</b> をクリックします。「<b>Services.msc</b>」と入力し、<b>[OK]</b> をクリックします。</li> <li><b>Microsoft Azure AD Sync サービス</b>を探し、サービスが開始されているかどうかを確認します。 サービスが開始されていない場合は、サービスを右クリックし、<b>[開始]</b> をクリックします。 | 
| Azure Active Directory からのインポートが失敗しました | Azure Active Directory コネクタからのインポート操作が失敗しています。 |  インポート操作のイベント ログ エラーで詳細を調べます。  |
| 認証エラーのため、Azure Active Directory との接続が失敗しました | 認証エラーのため、Azure Active Directory との接続が失敗しました。 その結果、オブジェクトは Azure Active Directory と同期しなくなります。  | イベント ログ エラーで詳細を調べます。 |
| Active Directory へのエクスポートが失敗しました | Active Directory コネクタへのエクスポート操作が失敗しています。 | エクスポート操作のイベント ログ エラーで詳細を調べます。 | 
| Active Directory からのインポートが失敗しました | Active Directory からのインポートが失敗しました。 その結果、このフォレストの一部のドメインのオブジェクトはインポートされていない可能性があります。 | <li>DC 接続を確認します。</li> <li>インポートを手動で再実行します。</li> <li> インポート操作のイベント ログ エラーで詳細を調べます。 | 
| Azure Active Directory へのエクスポートが失敗しました | Azure Active Directory コネクタへのエクスポート操作が失敗しています。 その結果、一部のオブジェクトが Azure Active Directory に正常にエクスポートされていない可能性があります。 | エクスポート操作のイベント ログ エラーで詳細を調べます。 |
| パスワード ハッシュ同期のハートビートが 120 分間スキップされました | パスワード ハッシュ同期が Azure Active Directory に 120 分間接続されていません。 その結果、パスワードは Azure Active Directory と同期しなくなります。 | Microsoft Azure Active Directory 同期サービスをもう一度開始します。</b><br> 現在実行中のすべての同期操作は中断されます。 進行中の同期操作がない場合は、次の手順を実行できます。<br> 1.<b>[スタート]</b> ボタンをクリックし、<b>[ファイル名指定して実行]</b> をクリックします。「<b>Services.msc</b>」と入力し、<b>[OK]</b> をクリックします。<br> 2.<b>Microsoft Azure AD Sync</b> を探して右クリックし、<b>[再起動]</b> をクリックします。 | 
| CPU 使用率が高くなっていることが検出されました | CPU 消費率が、このサーバーの推奨しきい値を超えました。 | <li>これは、CPU 消費率の一時的なスパイクである可能性があります。 [監視] セクションで CPU 使用量の傾向を確認します。</li><li>サーバー上の CPU 使用量が高いプロセスを調べます。<ol type="a"><li>タスク マネージャーを使用するか、次の PowerShell コマンドを実行できます。 <br> <i>get-process \| Sort-Object -Descending CPU \| Select-Object -First 10</i></li><li>CPU 使用率が高い予期しないプロセスがある場合は、次の PowerShell コマンドを使用してそのプロセスを停止します。 <br> <i>stop-process -ProcessName [プロセスの名前]</i></li></li></ol><li>上記の一覧に表示されるプロセスが、サーバーで実行されることを意図しているプロセスであり、その CPU 消費率が継続的にしきい値に近い場合は、サーバーのデプロイ要件を再評価することを検討してください。</li><li>フェールセーフ オプションとして、サーバーの再起動を検討できます。 |
| メモリ使用量が多くなっていることを検出しました | サーバーのメモリ使用量が、このサーバーの推奨しきい値を超えています。 | サーバー上の メモリ使用量が多いプロセスを調べます。 タスク マネージャーを使用するか、次の PowerShell コマンドを実行できます。<br> <i>get-process \| Sort-Object -Descending WS \| Select-Object -First 10</i> </br> メモリ使用量が多い予期しないプロセスがある場合は、次の PowerShell コマンドを使用してそのプロセスを停止します。<br><i>stop-process -ProcessName [プロセスの名前] </i></li><li> 上記の一覧に表示されるプロセスが、サーバーで実行されることを意図しているプロセスである場合は、サーバーのデプロイ要件を再評価することを検討してください。</li><li>フェールセーフ オプションとして、サーバーの再起動を検討できます。 | 
| パスワード ハッシュ同期の動作が停止しました | パスワード ハッシュ同期が停止しています。 その結果、パスワードは Azure Active Directory と同期しなくなります。 | Microsoft Azure Active Directory 同期サービスをもう一度開始します。 <br /> 現在実行中のすべての同期操作は中断されます。 進行中の同期操作がない場合は、次の手順を実行できます。 <br /> <ol> <li><b>[スタート]</b> ボタンをクリックし、<b>[ファイル名指定して実行]</b> をクリックします。「<b>Services.msc</b>」と入力し、<b>[OK]</b> をクリックします。</li> <li><b>Microsoft Azure AD Sync</b> を探して右クリックし、<b>[再起動]</b> をクリックします。</li> </ol> </p>  | 
| Azure Active Directory へのエクスポートが停止されました。 予想外の削除のしきい値に達しました | Azure Active Directory へのエクスポート操作が失敗しています。 構成されたしきい値を超える数の削除されるオブジェクトがありました。 その結果、オブジェクトはエクスポートされませんでした。 | <li> 削除するようにマークされたオブジェクトの数が、設定されたしきい値を超えています。 この操作が意図されたものであることを確認します。</li> <li> エクスポートを続行するには次の手順を実行します。 <ol type="a"> <li>Disable-ADSyncExportDeletionThreshold を実行して、しきい値を無効にします。</li> <li>Synchronization Service Manager を起動する</li> <li>種類を Azure Active Directory に設定して、コネクタでエクスポートを実行します。</li> <li>オブジェクトが正常にエクスポートされたら、ADSyncExportDeletionThreshold を実行して、しきい値を有効にします。</li> </ol> </li> |

## <a name="alerts-for-active-directory-federation-services"></a>Active Directory フェデレーション サービスのアラート
| アラート名 | 説明 | 修復 |
| --- | --- | ----- |
|テスト認証要求 (代理トランザクション) は、トークンの取得に失敗しました | このサーバーから開始されたテスト認証要求 (代理トランザクション) は、5 回試行しましたが、トークンを取得できませんでした。 これは、一時的なネットワークの問題、AD DS ドメイン コントローラーの可用性、または AD FS サーバーの不適切な構成が原因である可能性があります。  その結果、フェデレーション サービスによって処理される認証要求は失敗することがあります。 エージェントは、ローカル コンピューター アカウントのコンテキストを使用して、フェデレーション サービスからトークンを取得します。 | 次の手順を実行して、サーバーの正常性を確認します。<ol><li>ファーム内のこの AD FS サーバーまたはその他の AD FS サーバーに未解決のアラートがないことを確認します。</li><li>AD FS ログイン ページ (https://{your_adfs_server_name}/adfs/ls/idpinitiatedsignon.aspx) からテスト ユーザーでログインして、この状態が一時的なエラーではないことを確認します。</li><li><a href="https://testconnectivity.microsoft.com">https://testconnectivity.microsoft.com</a> に移動し、[Office 365] タブを選択します。Office 365 シングル サインオン テストを実行します。</li><li>このサーバーでコマンド プロンプトから次のコマンドを実行して、AD FS サービス名がこのサーバーから解決できるかどうかを検証します。 nslookup your_adfs_server_name</li></ol><p>サービス名を解決できない場合は、FAQ セクションの手順を参照して、AD FS サービスの HOST ファイル エントリにこのサーバーの IP アドレスを追加します。 これにより、このサーバーで代理トランザクション モジュールを実行してトークンを要求できるようになります。</p> | 
| プロキシ サーバーがフェデレーション サーバーに到達できません | この AD FS プロキシ サーバーが AD FS サービスに接続できません。 その結果、このサーバーによって処理される認証要求は失敗します。 | 次の手順を実行して、このサーバーと AD FS サービス間の接続を検証します。 <ol><li> このサーバーと AD FS サービス間のファイアウォールが適切に構成されていることを確認します。 </li><li> AD FS サービス名の DNS 解決が、企業ネットワークに存在する AD FS サービスを適切に指定していることを確認します。 これは、境界ネットワークでこのサーバーに対して機能している DNS サーバーによって、またはAD FS サービス名の HOSTS ファイル内のエントリによって実現できます。 </li><li> このサーバーでブラウザーを開き、フェデレーション メタデータ エンドポイント (https://<ADFS サービス名>/federationmetadata/2007-06/federationmetadata.xml) にアクセスすることで、ネットワーク接続を確認します。 </li> | 
| SSL 証明書の有効期限がまもなく切れます | フェデレーション サーバーによって使用される SSL 証明書の有効期限が 90 日以内に切れます。 有効期限が切れると、有効な SSL 接続を必要とするすべての要求は失敗します。 たとえば、Office 365 ユーザーは、メール クライアントを認証できなくなります。 | 各 AD FS サーバーの SSL 証明書を更新します。<ol><li>次の要件の SSL 証明書を取得します。<ol type="a"><li>拡張キー使用法が少なくともサーバーの認証である。 </li><li>証明書のサブジェクトまたはサブジェクトの別名 (SAN) に、フェデレーション サービスの DNS 名または適切なワイルドカードが含まれている。 例: sso.contoso.com や *.contoso.com</li></ol></li><li>各サーバーのローカル コンピューターの証明書ストアに新しい SSL 証明書をインストールします。</li><li>AD FS サービス アカウントが、証明書の秘密キーに読み取りアクセスできることを確認します。</li></ol></p><p><b>Windows Server 2008R2 の AD FS 2.0 の場合:</b><ul><li>新しい SSL 証明書を、フェデレーション サービスをホストする IIS の Web サイトにバインドします。 この手順を、各フェデレーション サーバーとフェデレーション サーバー プロキシで実行する必要があります。</li></ul></p><p><b>Windows Server 2012 R2 以降のバージョンの AD FS の場合:</b> <li>  <a href="https://docs.microsoft.com/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap">AD FS と WAP での SSL 証明書の管理</a>に関するページを参照してください。 </li> | 
| AD FS サービスがサーバーで実行されていません | Active Directory フェデレーション サービス (Windows サービス) がこのサーバーで実行されていません。 このサーバーを対象とするすべての要求は失敗します。 | Active Directory フェデレーション サービス (Windows サービス) を開始するには:<ol><li>サーバーに管理者としてログオンします。</li><li> services.msc を開きます</li><li>Active Directory フェデレーション サービスを探します。 </li><li>右クリックし、[開始] を選択します。 | 
| フェデレーション サービスの DNS の構成が正しくない可能性があります | AD FS ファーム名の CNAME レコードを使用するように DNS サーバーを構成できませんでした。 企業ネットワーク内で Windows 統合認証をシームレスに動作させるには、AD FS に対して A または AAAA レコードを使用することをお勧めします。 | AD FS ファーム <Farm Name> の DNS レコードの種類が CNAME ではないことを確認します。 A または AAAA レコードになるように構成します。 | 
| AD FS の監査が無効です | サーバーに対する AD FS の監査が無効です。 このサーバーからのデータがポータルの AD FS 利用状況セクションに含まれなくなります。 | AD FS の監査が有効になっていない場合は、次の手順に従います。<ol><li>AD FS サービス アカウントに、AD FS サーバーの "セキュリティ監査の生成" 権限を付与します。<li>サーバーの gpedit.msc でローカル セキュリティ ポリシーを開きます。</li><li>"Computer Configuration\Windows Settings\Local Policies\User Rights Assignment" に移動します。 </li><li>AD FS サービス アカウントに、"セキュリティ監査の生成" 権限を追加します。</li></li><li>コマンド プロンプトで、次のコマンドを実行します。<br><i>auditpol.exe /set /subcategory:"Application Generated" /failure:enable /success:enable </i></li><li>成功の監査と失敗の監査を含むようにフェデレーション サービスを更新します。<li>AD FS コンソールで、[フェデレーション サービス プロパティの編集] を選択します。</li><li>[フェデレーション サービスのプロパティ] ダイアログ ボックスで [イベント] タブを選択し、[成功の監査] と [失敗の監査] を選択します。</li></li></ol></p><p>これらの手順を実行すると、AD FS の監査イベントがイベント ビューアーに表示されます。 検証するには:<ol><li>イベント ビューアーで、[Windows ログ]、[セキュリティ] の順に移動します。</li><li>[現在のログをフィルター] を選択し、[イベント ソース] ドロップダウン リストから [AD FS の監査] を選択します。 AD FS 監査が有効になっているアクティブな AD FS サーバーでは、上記のフィルター処理でイベントが表示されます。</li></ol></p><p>これらの手順に従った場合でも、このアラートが引き続き表示される場合は、グループ ポリシー オブジェクトによって AD FS の監査が無効になっている可能性があります。 根本原因は、次のいずれかです。<ol><li>AD FS サービス アカウントから "セキュリティ監査の生成" 権限が削除されている。</li><li>グループ ポリシー オブジェクトのカスタム スクリプトが、"生成されたアプリケーション" に基づく成功の監査と失敗の監査を無効にしている。</li><li>AD FS が、成功/失敗の監査を生成できるように構成されていない。 | 
| AD FS の SSL 証明書が自己署名証明書です | 現在、AD FS ファームの SSL 証明書として自己署名証明書が使用されています。 その結果、Office 365 のメール クライアント認証が失敗します。 | <p> 各 AD FS サーバーの SSL 証明書を更新します。 </p> <ol><li>次の要件の公的に信頼されている SSL 証明書を取得します。 </li><li>証明書のインストール ファイルに、その秘密キーが含まれている。 </li> <li>拡張キー使用法が少なくともサーバーの認証である。 </li> <li>証明書のサブジェクトまたはサブジェクトの別名 (SAN) に、フェデレーション サービスの DNS 名または適切なワイルドカードが含まれている。 例: sso.contoso.com や *.contoso.com </li></ol> <p>各サーバーのローカル コンピューターの証明書ストアに新しい SSL 証明書をインストールします。 </p> <ol>AD FS サービス アカウントが、証明書の秘密キーに読み取りアクセスできることを確認します。 <br /> <b>Windows Server 2008R2 の AD FS 2.0 の場合:</b> <li>新しい SSL 証明書を、フェデレーション サービスをホストする IIS の Web サイトにバインドします。 この手順を、各フェデレーション サーバーとフェデレーション サーバー プロキシで実行する必要があります。 </li> <br /><b>Windows Server 2012 R2 以降のバージョンの AD FS の場合:</b> <li>  <a href="https://docs.microsoft.com/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap">AD FS と WAP での SSL 証明書の管理</a>に関するページを参照してください。 </li> </ol> | 
| プロキシ サーバーとフェデレーション サーバーの間の信頼が無効です | フェデレーション サーバー プロキシとフェデレーション サービスの間の信頼を確立または更新できませんでした。 | プロキシ サーバー上のプロキシ信頼証明書を更新します。 プロキシ構成ウィザードを再度実行します。 |
| AD FS のエクストラネット ロックアウト保護が無効です | AD FS ファームでエクストラネット ロックアウト保護機能が無効になっています。 この機能は、インターネットからのブルート フォース パスワード攻撃からユーザーを保護し、AD DS アカウントのロックアウト ポリシーが有効な場合にユーザーに対するサービス拒否攻撃を防ぎます。 この機能を有効にすると、ユーザーが失敗したエクストラネット ログイン (WAP サーバーと AD FS 経由で行われるログイン) の回数が 'ExtranetLockoutThreshold' を超えた場合、AD FS サーバーは ‘ExtranetObservationWindow' に対する以降のログイン処理を停止します。AD FS サーバーでこの機能を有効にすることを強くお勧めします。 | AD FS エクストラネット ロックアウト保護を既定値で有効にするには、次のコマンドを実行します。<br><i>Set-AdfsProperties -EnableExtranetLockout $true</i><br><br>ユーザー用に構成された AD ロックアウト ポリシーがある場合は、<i>'ExtranetLockoutThreshold'</i> プロパティが、AD DS のロックアウトしきい値未満の値に設定されていることを確認します。 これにより、AD FS のしきい値を超えている要求は削除され、AD DS サーバーに対する検証は行われません。 | 
| AD FS サービス アカウントのサービス プリンシパル名 (SPN) が無効です | フェデレーション サービス アカウントのサービス プリンシパル名が登録されていないか、一意ではありません。 その結果、ドメインに参加しているクライアントからの Windows 統合認証がシームレスにならない可能性があります。 | サービス プリンシパルを一覧表示するには、[<b>SETSPN -L ServiceAccountName</b>] を使用します。<br>重複しているサービス プリンシパル名をチェックするには、[<b>SETSPN -X</b>] を使用します。</p><p>AD FS サービス アカウントの SPN が重複している場合は、[<b>SETSPN -d service/namehostname</b>] を使用して、重複しているアカウントを SPN から削除します。</p><p>SPN が設定されていない場合は、[<b>SETSPN -s {目的の SPN} {ドメイン名}\{サービス アカウント}</b>] を使用して、フェデレーション サービス アカウントに目的の SPN を設定します。 | 
| プライマリ AD FS のトークン暗号化解除証明書の有効期限がまもなく切れます | プライマリ AD FS のトークン暗号化解除証明書の有効期限が 90 日以内に切れます。 AD FS は、信頼された要求プロバイダーからのトークンの暗号化を解除できません。 AD FS は、暗号化された SSO クッキーの暗号化を解除できません。 エンドユーザーがリソースにアクセスするための認証は行われません。 | 証明書の自動ロールオーバーが有効になっている場合は、AD FS がトークン暗号化解除証明書を管理します。</p><p>証明書を手動で管理する場合は、次の手順を実行します。 <b>新しいトークン暗号化解除証明書を取得します。</b><ol type="a"><li>拡張キー使用法 (EKU) に "キーの暗号化" が含まれていることを確認します。</li><li>サブジェクトまたはサブジェクトの別名 (SAN) には、何の制限はありません。</li><li>フェデレーション サーバーと要求プロバイダー パートナーは、トークン暗号化解除証明書を検証するときに、信頼されたルート証明機関にチェーンできる必要があります。</li></ol><b>要求プロバイダー パートナーが新しいトークン暗号化解除証明書を信頼する方法を決定します。</b><ol type="a"><li>証明書を更新した後、フェデレーション メタデータをプルするようにパートナーに依頼します。</li><li>新しい証明書の公開キー  (.cer ファイル) をパートナーと共有します。 要求プロバイダー パートナーの AD FS サーバーで、[管理ツール] メニューから AD FS 管理を起動します。 [信頼関係/証明書利用者信頼] で、作成された信頼を選択します。 [プロパティ/暗号化] で、[参照] をクリックします。新しいトークン暗号化解除証明書を選択し、[OK] をクリックします。</li></ol><b>各フェデレーション サーバーのローカル証明書ストアに証明書をインストールします。</b><ul><li>証明書インストール ファイルに、各サーバーの証明書の秘密キーがあることを確認します。</li></ul><b>フェデレーション サービス アカウントが、新しい証明書の秘密キーにアクセスできることを確認します。</b> <b>AD FS に新しい証明書を追加します。</b><ol type="a"><li>[管理ツール] メニューから AD FS 管理を起動します。</li><li>[サービス] を展開し、[証明書] を選択します。</li><li>[操作] ウィンドウで、[トークン暗号化解除証明書の追加] をクリックします。</li><li>トークン暗号化解除で有効な証明書の一覧が表示されます。 新しい証明書が一覧に存在しない場合は、前に戻って、秘密キーが関連付けられているローカル コンピューターの個人用ストアに証明書が格納されていること、および拡張キー使用法としてキーの暗号化が証明書に含まれていることを確認します。</li><li>新しいトークン暗号化解除証明書を選択し、[OK] をクリックします。</li></ol><b>新しいトークン暗号化解除証明書をプライマリとして設定します。</b><ol type="a"><li>AD FS 管理で [証明書] ノードを選択すると、[トークン暗号化解除] の下に 2 つの証明書 (既存の証明書と新しい証明書) が表示されます。</li><li>新しいトークン暗号化解除証明書を右クリックし、[プライマリとして設定] を選択します。</li><li>古い証明書はロールオーバー用にセカンダリのままにします。 古い証明書は、ロールオーバーで不要になったことを確信したとき、または証明書の有効期限が切れたときに削除します。 </li></ol>  | 
| プライマリ AD FS のトークン署名証明書の有効期限がまもなく切れます | AD FS のトークン署名証明書の有効期限が 90 日以内に切れます。 この証明書が有効でない場合、AD FS は署名されたトークンを発行できません。 | <b>新しいトークン署名証明書を取得します。</b><ol type="a"><li>拡張キー使用法 (EKU) に "デジタル署名" が含まれていることを確認します。 </li><li>サブジェクトまたはサブジェクトの別名 (SAN) には、何の制限はありません。 </li><li>トークン署名証明書を検証する際は、フェデレーション サーバー、リソース パートナーのフェデレーション サーバー、および証明書利用者のアプリケーション サーバーが、信頼されたルート証明機関にチェーンできる必要があります。</li></ol><b>各フェデレーション サーバーのローカル証明書ストアに証明書をインストールします。</b> <ul><li>証明書インストール ファイルに、各サーバーの証明書の秘密キーがあることを確認します。</li></ul></li><b>フェデレーション サービス アカウントが、新しい証明書の秘密キーにアクセスできることを確認します。</b> <b>AD FS に新しい証明書を追加します。</b><ol type="a"><li>[管理ツール] メニューから AD FS 管理を起動します。</li><li>[サービス] を展開し、[証明書] を選択します。</li><li>[操作] ウィンドウで、[トークン署名証明書の追加] をクリックします。</li><li>トークン署名で有効な証明書の一覧が表示されます。 新しい証明書が一覧に存在しない場合は、前に戻って、秘密キーが関連付けられているローカル コンピューターの個人用ストアに証明書が格納されていること、および証明書にデジタル署名 KU が含まれていることを確認します。</li><li>新しいトークン署名証明書を選択し、[OK] をクリックします。</li></ol><b>すべての証明書利用者にトークン署名証明書の変更について通知します。</b><ol type="a"><li>AD FS のフェデレーション メタデータを使用する証明書利用者が新しい証明書の使用を開始するには、新しいフェデレーション メタデータをプルする必要があります。</li><li>AD FS のフェデレーション メタデータを使用しない証明書利用者は、新しいトークン署名証明書の公開キーを手動で更新する必要があります。 .cer ファイルを証明書利用者と共有します。</li></a><b>新しいトークン署名証明書をプライマリとして設定します。</b><ol type="a"><li>AD FS 管理で [証明書] ノードを選択すると、[トークン署名] の下に 2 つの証明書 (既存の証明書と新しい証明書)が表示されます。</li><li>新しいトークン署名証明書を右クリックし、<b>[プライマリとして設定]</b> を選択します。</li><li>古い証明書はロールオーバー用にセカンダリのままにします。 古い証明書は、ロールオーバーで不要になったことを確信したとき、または証明書の有効期限が切れたときに削除します。 署名されるのは、現在のユーザーの SSO セッションであることに注意してください。 現在の AD FS プロキシの信頼関係は、古い証明書を使用して署名され、暗号化されているトークンを使用します。 </li></ol>  | 
| AD FS SSL 証明書がローカル証明書ストアで見つかりません | AD FS データベースに SSL 証明書として構成されている拇印付きの証明書が、ローカル証明書ストアで見つかりませんでした。 その結果、SSL 上のすべての認証要求は失敗します。 たとえば、Office 365 のメール クライアント認証は失敗します。 | 構成された拇印がある証明書を、ローカル証明書ストアにインストールします。 | 
| SSL 証明書の有効期限が切れました | AD FS サービスの SSL 証明書の有効期限が切れています。 この結果、有効な SSL 接続を必要とするすべての要求は失敗します。 例: メール クライアント認証で、Office 365 ユーザーを認証できなくなります。 | 各 AD FS サーバーの SSL 証明書を更新します。<ol><li>次の要件の SSL 証明書を取得します。<li>拡張キー使用法が少なくともサーバーの認証である。 </li><li>証明書のサブジェクトまたはサブジェクトの別名 (SAN) に、フェデレーション サービスの DNS 名または適切なワイルドカードが含まれている。 例: sso.contoso.com や *.contoso.com</li></li><li>各サーバーのローカル コンピューターの証明書ストアに新しい SSL 証明書をインストールします。</li><li>AD FS サービス アカウントが、証明書の秘密キーに読み取りアクセスできることを確認します。</li></ol></p><p><b>Windows Server 2008R2 の AD FS 2.0 の場合:</b><ul><li>新しい SSL 証明書を、フェデレーション サービスをホストする IIS の Web サイトにバインドします。 この手順を、各フェデレーション サーバーとフェデレーション サーバー プロキシで実行する必要があります。</li></ul></p><p><b>Windows Server 2012 R2 以降のバージョンの AD FS の場合:</b> <a href="https://docs.microsoft.com/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap">AD FS と WAP での SSL 証明書の管理</a>に関するページを参照してください。 </li> | 
| Azure Active Directory (Office 365 用) の必須エンドポイントが無効です | Exchange Online Services、Azure AD、および Office 365 が必要とする次のエンドポイント セットが、フェデレーション サービスに対して有効になっていません。 <li>/adfs/services/trust/2005/usernamemixed</li><li>/adfs/services/trust/2005/windowstransport</li><li>/adfs/ls/</li> |  Microsoft Cloud Services のフェデレーション サービスで必要なエンドポイントを有効にします。<br>Windows Server 2012 R2 以降のバージョンの AD FS の場合 <li> <a href=\"https://docs.microsoft.com/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap\">AD FS と WAP での SSL 証明書の管理</a>に関するページを参照してください。 </li></p> | 
| フェデレーション サーバーは、AD FS 構成データベースに接続できませんでした | AD FS サービス アカウントが AD FS 構成データベースに接続しているときに問題が発生しました。 その結果、このコンピューターの AD FS サービスは期待どおりに機能しない可能性があります。 | <li> AD FS サービス アカウントが構成データベースにアクセスできることを確認します。 </li><li>AD FS 構成データベース サービスが使用可能であり、アクセス可能であることを確認します。 </li> | 
| 必要な SSL バインディングが欠落しているか、構成されていません | 認証を正常に実行するために必要なこのフェデレーション サーバーの SSL バインドが正しく構成されていません。 その結果、AD FS は、すべての着信要求を処理できません。 | Windows Server 2012 R2</b>:<br>管理者特権のコマンド プロンプトを開き、次のコマンドを実行します。 <ol> <li> 現在の SSL バインドを表示するには: <i> Get-AdfsSslCertificate </i> <li> 新しいバインドを追加するには: <i> netsh http add sslcert hostnameport=<federation service name>:443 certhash=0102030405060708090A0B0C0D0E0F1011121314 appid={00112233-4455-6677-8899-AABBCCDDEEFF} certstorename=MY </i> |
| プライマリ AD FS トークン署名証明書の有効期限が切れています | プライマリ AD FS トークン署名証明書の有効期限が切れています。 この証明書が有効でない場合、AD FS は署名されたトークンを発行できません。 | 証明書の自動ロールオーバーが有効になっている場合は、AD FS がトークン署名証明書を管理します。</p><p>証明書を手動で管理する場合は、次の手順に従います。 <ol><li><b>新しいトークン署名証明書を取得します。</b><ol type="a"><li>拡張キー使用法 (EKU) に "デジタル署名" が含まれていることを確認します。 </li><li>サブジェクトまたはサブジェクトの別名 (SAN) には、何の制限はありません。 </li><li>トークン署名証明書を検証する際は、フェデレーション サーバー、リソース パートナーのフェデレーション サーバー、および証明書利用者のアプリケーション サーバーが、信頼されたルート証明機関にチェーンできる必要があります。</li></ol></li><li><b>各フェデレーション サーバーのローカル証明書ストアに証明書をインストールします。</b> <ul><li>証明書インストール ファイルに、各サーバーの証明書の秘密キーがあることを確認します。</li></ul></li><li><b>フェデレーション サービス アカウントが、新しい証明書の秘密キーにアクセスできることを確認します。</b></li><li> <b>AD FS に新しい証明書を追加します。</b><ol type="a"><li>[管理ツール] メニューから AD FS 管理を起動します。</li><li>[サービス] を展開し、[証明書] を選択します。</li><li>[操作] ウィンドウで、[トークン署名証明書の追加] をクリックします。</li><li>トークン署名で有効な証明書の一覧が表示されます。 新しい証明書が一覧に存在しない場合は、前に戻って、秘密キーが関連付けられているローカル コンピューターの個人用ストアに証明書が格納されていること、および証明書にデジタル署名 KU が含まれていることを確認します。</li><li>新しいトークン署名証明書を選択し、[OK] をクリックします。</li></ol></li><li><b>すべての証明書利用者にトークン署名証明書の変更について通知します。</b><ol type="a"><li>AD FS のフェデレーション メタデータを使用する証明書利用者が新しい証明書の使用を開始するには、新しいフェデレーション メタデータをプルする必要があります。</li><li>AD FS のフェデレーション メタデータを使用しない証明書利用者は、新しいトークン署名証明書の公開キーを手動で更新する必要があります。 .cer ファイルを証明書利用者と共有します。</li></ol></li><li><b>新しいトークン署名証明書をプライマリとして設定します。</b><ol type="a"><li>AD FS 管理で [証明書] ノードを選択すると、[トークン署名] の下に 2 つの証明書 (既存の証明書と新しい証明書)が表示されます。</li><li>新しいトークン署名証明書を右クリックし、<b>[プライマリとして設定]</b> を選択します。</li><li>古い証明書はロールオーバー用にセカンダリのままにします。 古い証明書は、ロールオーバーで不要になったことを確信したとき、または証明書の有効期限が切れたときに削除します。 署名されるのは現在のユーザーの SSO セッションであることを忘れないでください。 現在の AD FS プロキシの信頼関係は、古い証明書を使用して署名され、暗号化されているトークンを使用します。 </li></ol></li>|
| プロキシ サーバーが輻輳制御のため要求をドロップしています | このプロキシ サーバーは、このプロキシ サーバーとフェデレーション サーバー間の待機時間が通常よりも長くなっているため、現在、エクストラネットからの要求をドロップしています。 その結果、AD FS プロキシ サーバーによって処理される認証要求の特定部分が失敗する可能性があります。 | <li>フェデレーション プロキシ サーバーとフェデレーション サーバー間のネットワークの待機時間が、許容範囲内であるかどうかを確認します。 監視セクションで "トークン要求待機時間" の傾向値を参照します。 待機時間が [1500 ミリ秒] を超える場合は、待機時間が長いとみなす必要があります。 待機時間が長い場合は、AD FS と AD FS プロキシ サーバー間のネットワークに接続の問題が発生していないことを確認します。</li><li>フェデレーション サーバーが認証要求で過負荷になっていないことを確認します。 監視セクションに、秒あたりのトークン要求、CPU 使用率、およびメモリ消費量の傾向が表示されます。</li><li>上記の項目を検証してもこの問題が解消されない場合は、関連リンクのガイダンスに従って、各フェデレーション プロキシ サーバー上の輻輳回避設定を調整します。 | 
| AD FS サービス アカウントが、いずれかの証明書の秘密キーへのアクセスを拒否されています | AD FS サービス アカウントに、このコンピューターのいずれかの AD FS 証明書の秘密キーにアクセスする権限がありません。 | AD FS サービス アカウントが、ローカル コンピューターの証明書ストアに格納されている SSL 証明書、トークン署名証明書、およびトークン暗号化解除証明書にアクセスできることを確認します。<ol> <li> コマンドラインから「MMC」と入力します。</li><li>[ファイル]、[スナップインの追加/削除] の順に移動します。</li><li> 証明書を選択し、[追加] をクリックします。 コンピューター アカウントを選択し、[次へ] をクリックします。 ローカル コンピューターを選択し、[終了] をクリックします。 [OK] をクリックします。 </li></ol> <br>証明書 (ローカル コンピューター/個人/証明書) を開きます。AD FS によって使用されるすべての証明書に対して、次の操作を実行します。<ol><li>証明書を右クリックします。</li><li>[すべてのタスク]、[選択] [秘密キーの管理] の順に選択します。</li><li>グループまたはユーザー名の [セキュリティ] タブで、AD FS サービス アカウントが存在していることを確認します。 ない場合は、[追加] を選択し、AD FS サービス アカウントを追加します。</li><li>AD FS サービス アカウントを選択し、[<AD FS Service Account Name> のアクセス許可] で、読み取り権限が許可されている (オンになっている) ことを確認します。 | 
| AD FS SSL 証明書に秘密キーがありません | AD FS の SSL 証明書が秘密キーなしでインストールされました。 その結果、SSL 上のすべての認証要求が失敗します。 たとえば、Office 365 のメール クライアント認証は失敗します。 | 各 AD FS サーバーの SSL 証明書を更新します。<ol><li>次の要件の公的に信頼されている SSL 証明書を取得します。<ol type="a"><li>証明書のインストール ファイルに、その秘密キーが含まれている。</li><li>拡張キー使用法が少なくともサーバーの認証である。 </li><li>証明書のサブジェクトまたはサブジェクトの別名 (SAN) に、フェデレーション サービスの DNS 名または適切なワイルドカードが含まれている。 例: sso.contoso.com や *.contoso.com</li></ol></li><li>各サーバーのローカル コンピューターの証明書ストアに新しい SSL 証明書をインストールします。</li><li>AD FS サービス アカウントが、証明書の秘密キーに読み取りアクセスできることを確認します。</li></ol></p><p><b>Windows Server 2008R2 の AD FS 2.0 の場合:</b><ul><li>新しい SSL 証明書を、フェデレーション サービスをホストする IIS の Web サイトにバインドします。 この手順を、各フェデレーション サーバーとフェデレーション サーバー プロキシで実行する必要があります。</li></ul></p><p><b>Windows Server 2012 R2 以降のバージョンの AD FS の場合:</b> <li> <a href="https://docs.microsoft.com/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap">AD FS と WAP での SSL 証明書の管理</a>に関するページを参照してください。 </li> | 
| プライマリ AD FS トークン暗号化解除証明書の有効期限が切れています | プライマリ AD FS トークン暗号化解除証明書の有効期限が切れています。 AD FS は、信頼された要求プロバイダーからのトークンの暗号化を解除できません。 AD FS は、暗号化された SSO クッキーの暗号化を解除できません。 エンドユーザーがリソースにアクセスするための認証は行われません。 | <p>証明書の自動ロールオーバーが有効になっている場合は、AD FS がトークン暗号化解除証明書を管理します。</p><p>証明書を手動で管理する場合は、次の手順に従います。<ol><li><b>新しいトークン暗号化解除証明書を取得します。</b><ul><li>拡張キー使用法 (EKU) に "キーの暗号化" が含まれていることを確認します。</li><li>サブジェクトまたはサブジェクトの別名 (SAN) には、何の制限はありません。</li><li>フェデレーション サーバーと要求プロバイダー パートナーは、トークン暗号化解除証明書を検証するときに、信頼されたルート証明機関にチェーンできる必要があります。</li></ul></li><li><b>要求プロバイダー パートナーが新しいトークン暗号化解除証明書を信頼する方法を決定します。</b><ul><li>証明書を更新した後、フェデレーション メタデータをプルするようにパートナーに依頼します。</li><li>新しい証明書の公開キー  (.cer ファイル) をパートナーと共有します。 要求プロバイダー パートナーの AD FS サーバーで、[管理ツール] メニューから AD FS 管理を起動します。 [信頼関係/証明書利用者信頼] で、作成された信頼を選択します。 [プロパティ/暗号化] で、[参照] をクリックします。新しいトークン暗号化解除証明書を選択し、[OK] をクリックします。</li></ul></li><li><b>各フェデレーション サーバーのローカル証明書ストアに証明書をインストールします。</b><ul><li>証明書インストール ファイルに、各サーバーの証明書の秘密キーがあることを確認します。</li></ul></li><li><b>フェデレーション サービス アカウントが、新しい証明書の秘密キーにアクセスできることを確認します。</b></li><li><b>AD FS に新しい証明書を追加します。</b><ul><li>[管理ツール] メニューから AD FS 管理を起動します。</li><li>[サービス] を展開し、[証明書] を選択します。</li><li>[操作] ウィンドウで、[トークン暗号化解除証明書の追加] をクリックします。</li><li>トークン暗号化解除で有効な証明書の一覧が表示されます。 新しい証明書が一覧に存在しない場合は、前に戻って、秘密キーが関連付けられているローカル コンピューターの個人用ストアに証明書が格納されていること、および拡張キー使用法としてキーの暗号化が証明書に含まれていることを確認します。</li><li>新しいトークン暗号化解除証明書を選択し、[OK] をクリックします。</li></ul></li><li><b>新しいトークン暗号化解除証明書をプライマリとして設定します。</b><ul><li>AD FS 管理で [証明書] ノードを選択すると、[トークン暗号化解除] の下に 2 つの証明書 (既存の証明書と新しい証明書) が表示されます。</li><li>新しいトークン暗号化解除証明書を右クリックし、[プライマリとして設定] を選択します。</li><li>古い証明書はロールオーバー用にセカンダリのままにします。 古い証明書は、ロールオーバーで不要になったことを確信したとき、または証明書の有効期限が切れたときに削除します。 </li></ul></li> | 

## <a name="alerts-for-active-directory-domain-services"></a>Azure Active Directory Domain Services のアラート

| アラート名 | 説明 | 修復 |
| --- | --- | ----- |
| LDAP ping を介してドメイン コントローラーに到達できません | LDAP ping を介してドメイン コントローラーに到達できません。 これは、ネットワークの問題またはマシンの問題が原因で発生する可能性があります。 その結果、LDAP ping は失敗します。 |  <li>アラートの一覧で関連するアラートを調べます。例: ドメイン コントローラーがアドバタイズされていません。 </li><li>影響を受けているドメイン コントローラーに十分なディスク領域があることを確認します。 領域が不足していると、DC は、自身を LDAP サーバーとしてアドバタイズすることを停止します。 </li><li> PDC を検索します。 <br> <i>netdom query fsmo</i> </br> を影響を受けているドメイン コントローラーで実行します。 <li> 物理ネットワークが正しく構成されている/接続されていることを確認します。 </li> |
| Active Directory のレプリケーション エラーが発生しました | このドメイン コントローラーでレプリケーションの問題が発生しています。レプリケーションの状態ダッシュボードで問題を確認できます。 レプリケーション エラーは、不適切な構成やその他の関連する問題が原因で発生する可能性があります。 プリケーション エラーを放置すると、データの不整合に至る可能性があります。 | 追加の詳細で、影響を受けているソースと送信先 DC の名前を確認します。 レプリケーションの状態ダッシュ ボードに移動し、影響を受けている DC 上のアクティブなエラーを探します。 エラーをクリックしてブレードを開くと、その特定のエラーを修復する方法の詳細が表示されます。| 
| ドメイン コントローラーが PDC を検出できません | このドメイン コントローラー経由で PDC に到達できません。 これは、ユーザー ログオンへの影響、グループ ポリシーの変更の未適用、およびシステム時間の同期エラーにつながります。 | <li>アラートの一覧で、PDC に影響する可能性がある関連するアラートを調べます。例: ドメイン コントローラーがアドバタイズされていません。 </li> <li>PDC を検索します。 <br> <i>netdom query fsmo</i> </br> を影響を受けているドメイン コントローラーで実行します。<li>ネットワークが正常に機能していることを確認します。 </li> |
| ドメイン コントローラーがグローバル カタログ サーバーを検出できません | このドメイン コントローラーからグローバル カタログ サーバーに到達できません。 その結果、このドメイン コントローラーを経由して行われる認証は失敗します。 | アラートの一覧を調べて、影響を受けているサーバーが GC である可能性がある "<b>ドメイン コントローラーがアドバタイズされていません</b>" アラートを探します。 アドバタイズ アラートがない場合は、GC の SRV レコードをチェックします。 次を実行することで、それらを確認できます。 <br> <i>nltest \/dnsgetdc: [フォレスト名] \/gc </i> </br> GC としてアドバタイズされている DC が一覧表示されます。 リストが空の場合は、DNS 構成を調べて、GC が SRV レコードを登録していることを確認します。 DC は DNS でそれらを検索できます。 <br />グローバル カタログをトラブルシューティングするには、「<a href="https://technet.microsoft.com/library/cc961811.aspx#ECAA">Advertising as a Global Catalog Server. </a>」(グローバル カタログ サーバーとしてのアドバタイズ) を参照してください。 | 
| ドメイン コントローラーがローカル SYSVOL 共有に到達できません | SYSVOL には、ドメインの DC 内で配布されるグループ ポリシー オブジェクトとスクリプトの重要な要素が含まれています。 DC が自身を DC としてアドバタイズしないため、グループ ポリシーは適用されなくなります。 | 「<a href="https://support.microsoft.com/kb/2958414">不足している SYSVOL および Netlogon 共有のトラブルシューティング方法</a>」を参照してください。 | 
| ドメイン コントローラーの時間が同期していません | このドメイン コントローラーの時間が、通常の時間のずれの範囲外にあります。 その結果、Kerberos 認証は失敗します。 | <li>Windows Time サービスを再起動します。 <br><i>net stop w32time</i> </br> と  <br><i>net start w32time</i></br> を影響を受けているドメイン コントローラーで実行します。</li><li>Time を再起動します。 <br><i>w32tm \/resync </i></br> を影響を受けているドメイン コントローラーで実行します。 | 
| ドメイン コントローラーがアドバタイズされていません | このドメイン コントローラーは、実行できる役割を正しくアドバタイズしていません。 これは、レプリケーションの問題、DNS の不適切な構成、重要なサービスの未実行、またはサーバーの不完全な初期化が原因で発生する可能性があります。  その結果、ドメイン コントローラー、ドメインのメンバー、およびその他のデバイスが、このドメイン コントローラーを見つけることができなくなります。 さらに、他のドメイン コントローラーがこのドメイン コントローラーからレプリケートできない場合があります。 | アラートの一覧で、他の関連するアラートを調べます。例 レプリケーションが壊れています。 ドメイン コントローラーの時間が同期していません。Netlogon サービスが実行されていません。 DFSR サービスと NTFRS サービス、またはそのいずれかが実行されていません。 関連する DNS 問題を識別してトラブルシューティングします。影響を受けているドメイン コントローラーにログオンします。 システム イベント ログを開きます。 イベント 5774、5775、または 5781 がある場合は、<a href="https://msdn.microsoft.com/library/bb727055.aspx#ECAA">ドメイン コントローラー ロケーター DNS レコードの登録エラー</a>に関する記事を参照してください。関連する Windows Time サービスの問題を識別してトラブルシューティングします。Windows Time サービスが実行されていることを確認します。<b>net start w32time</b>' を影響を受けているドメイン コントローラーで実行します。 Windows Time サービスを再起動します。'<b>net stop w32time</b>' と '<b>net start w32time</b>' を影響を受けているドメイン コントローラーで実行します。 | 
| GPSVC サービスが実行されていません | サービスが停止されているか無効な場合、管理者によって構成された設定は適用されず、グループ ポリシーによるアプリケーションとコンポーネントの管理は行われません。 サービスが無効になっている場合、グループ ポリシー コンポーネントに依存するすべてのコンポーネントまたはアプリケーションは機能しないことがあります。  | ラン <br><i>net start gpsvc</i></br> を影響を受けているドメイン コントローラーで実行します。 | 
| DFSR サービスと NTFRS サービス、またはそのいずれかが実行されていません | DFSR サービスと NTFRS サービスの両方が停止すると、ドメイン コントローラーは SYSVOL データをレプリケートできなくなります。 SYSVOL データの整合性が失われます。 | <li>DFSR を使用している場合:<ol type="1" > '<b>net start dfsr</b>' を影響を受けているドメイン コントローラーで実行します。 </li><li>NTFRS を使用している場合:<ol type="1" >'<b>net start ntfrs</b>' を影響を受けているドメイン コントローラーで実行します。 </li>| 
| Netlogon サービスが実行されていません | この DC では、ログオン要求、登録、認証、およびドメイン コントローラーの検索は利用できません。 | '<b>net start netlogon</b>' を影響を受けているドメイン コントローラーで実行します。 | 
| W32Time サービスが実行されていません | Windows タイム サービスが停止されている場合、日付と時刻の同期は使用できません。 このサービスが無効になっている場合、このサービスに明示的に依存するすべてのサービスの開始は失敗します。 | '<b>net start win32Time</b>' を影響を受けているドメイン コントローラーで実行します。 | 
| ADWS サービスが実行されていません | Active Directory Web Services サービスが停止されるか無効になると、Active Directory PowerShell などのクライアント アプリケーションは、このサーバー上でローカルに実行されているディレクトリ サービス インスタンスにアクセスすることも管理することもできなくなります。 | '<b>net start adws</b>' を影響を受けているドメイン コントローラーで実行します。 | 
| ルート PDC が NTP サーバーから同期していません | 外部または内部タイム ソースからの時間と同期するように PDC が構成されていない場合、PDC エミュレーターは内部クロックを使用し、それ自体がフォレストの信頼できるタイム ソースになります。 PDC 自体の時間が正確でないと、すべてのコンピューターの時間設定が不正確になります。 | 影響を受けているドメイン コントローラーで、コマンド プロンプトを開きます。 Time サービスを停止します。net stop w32time</li> <li>外部タイム ソースを構成します。 <br> <i>w32tm \/config \/manualpeerlist: time.windows.com \/syncfromflags:manual \/reliable:yes </i></br><br>注: 必要な外部タイム ソースのアドレスで time.windows.com を置き換えます。 Time サービスを開始します。 <br> <i>net start w32time</i></br> | 
| ドメイン コントローラーが隔離されています | このドメイン コントローラーは、他の機能するドメイン コントローラーのいずれにも接続されていません。 原因は、不適切な構成である可能性があります。 その結果、この DC は使用されず、レプリケートは実行されません。 | 入力方向および出力方向のレプリケーションを有効にします。'<b>repadmin/options ServerName-DISABLE_INBOUND_REPL</b>' を影響を受けているドメイン コントローラーで実行します。 '<b>repadmin /options ServerName -DISABLE_OUTBOUND_REPL</b>' を影響を受けているドメイン コントローラーで実行します。 別のドメイン コントローラーへの新しいレプリケーション接続を作成します。<ol type="1"><li>Active Directory サイトとサービスを開きます。[スタート] メニューの [管理ツール] をポイントし、[Active Directory サイトとサービス] をクリックします。 </li><li>コンソール ツリーで、[サイト]を 展開し、この DC が属するサイトを展開します。 </li><li>サーバー コンテナーを展開して、サーバーの一覧を表示します。 </li><li>この DC のサーバー オブジェクトを展開します。 </li><li>NTDS 設定オブジェクトを右クリックし、[新しい Active Directory ドメイン サービス接続...] をクリックします。 </li><li>一覧からサーバーを選択し、[OK] をクリックします。</li></ol><a href="https://support.microsoft.com/kb/230306 ">How to remove orphaned domains from Active Directory</a> (孤立したドメインを Active Directory から削除する方法) |
| 出力方向のレプリケーションが無効です | 出力方向のレプリケーションが無効になっている DC は、自身からの変更を配布できなくなります。 | 影響を受けているドメイン コントローラーで出力方向のレプリケーションを有効にするには、次の手順に従います。[スタート] ボタンをクリックし、[ファイル名を指定して実行] をクリックし、「cmd」と入力し、[OK] をクリックします。 次のテキストを入力し、ENTER キーを押します。<br><i>repadmin /options -DISABLE_OUTBOUND_REPL </i> | 
| 入力方向のレプリケーションが無効です | 入力方向のレプリケーションが無効になっている DC は、最新の情報を持たなくなります。 この状態では、ログオンに失敗する可能性があります。 | 影響を受けているドメイン コントローラーで入力方向のレプリケーションを有効にするには、次の手順に従います。[スタート] ボタンをクリックし、[ファイル名を指定して実行] をクリックし、「cmd」と入力し、[OK] をクリックします。 次のテキストを入力し、ENTER キーを押します。<br><i>repadmin /options -DISABLE_INBOUND_REPL</i> </br> | 
| LanmanServer サービスが実行されていません | このサービスが無効になっている場合、このサービスに明示的に依存するすべてのサービスの開始は失敗します。 | '<b>net start LanManServer</b>' を影響を受けているドメイン コントローラーで実行します。 |
| Kerberos キー配布センター サービスが実行されていません | KDC サービスが停止すると、Kerberos v5 認証プロトコルを使用してこの DC 経由で認証することができなくなります。 | '<b>net start kdc</b>' を影響を受けているドメイン コントローラーで実行します。 |
| DNS サービスが実行されていません | DNS サービスが停止すると、DNS を利用するためにこのサーバーを使用しているコンピューターとユーザーはリソースを検出できなくなります。 | '<b>net start dns</b>' を影響を受けているドメイン コントローラーで実行します。 |
| DC が USN をロールバックしました | USN のロールバックが発生した場合、これまでは USN によって認識されていた送信先ドメイン コントローラーによるオブジェクトと属性に対する変更の入力方向のレプリケートは実行されません。 これらの送信先ドメイン コントローラーは最新のものであると考えられているため、レプリケーション エラーがディレクトリ サービスのイベント ログに報告されることも、監視および診断ツールによって監視されることもありません。 USN のロールバックは、すべてのパーティション内のすべてのオブジェクトまたは属性のレプリケーションに影響を与える可能性があります。 最も頻繁に観察される副作用は、ロールバック ドメイン コントローラー上に作成されるユーザー アカウントとコンピューター アカウントが、1 つまたは複数のレプリケーション パートナー上に存在しなくなることです。 または、ロールバック ドメイン コントローラーから発信されたパスワードの更新が、レプリケーション パートナーでは存在しなくなります。 | USN ロールバックから回復する方法は 2 つあります。 <p>次の手順に従って、ドメインからドメイン コントローラーを削除します。 <ol type="1"><li>Active Directory をドメイン コントローラーから削除して、強制的にスタンドアロン サーバーにします。 詳細については、次の記事の番号をクリックして表示される Microsoft サポート技術情報の記事を参照してください。 <br><a href="https://support.microsoft.com/kb/332199">332199</a>: Domain controllers do not demote gracefully when you use the Active Directory Installation Wizard to force demotion in Windows Server 2003 and in Windows 2000 Server (Active Directory インストール ウィザードを使用して Windows 2000 Server と Windows Server 2003 を強制的に降格する場合、ドメイン コントローラーは正常に降格しません) </li> <li>降格されたサーバーをシャット ダウンします。</li> <li>正常なドメイン コントローラーで、降格されたドメイン コントローラーのメタデータをクリーンアップします。 詳細については、次の記事の番号をクリックして表示される Microsoft サポート技術情報の記事を参照してください。 <br><a href="https://support.microsoft.com/kb/216498">216498</a>: ドメイン コントローラーの降格に失敗した後、Active Directory のデータを削除する方法</li> <li>不適切に復元されたドメイン コントローラーが操作マスターの役割をホストする場合は、これらの役割を正常なドメイン コントローラーに移行します。 詳細については、次の記事の番号をクリックして表示される Microsoft サポート技術情報の記事を参照してください。 <br><a href="https://support.microsoft.com/kb/255504">255504</a>: Ntdsutil.exe を使用して別のドメイン コントローラーに FSMO の役割を移行または強制移行する</li> <li>降格されたサーバーを再起動します。</li> <li>必要がある場合は、スタンドアロン サーバーに Active Directory を再度インストールします。</li> <li>ドメイン コントローラーがグローバル カタログであった場合は、グローバル カタログになるようにドメイン コントローラーを構成します。 詳細については、次の記事の番号をクリックして表示される Microsoft サポート技術情報の記事を参照してください。 <br><a href="https://support.microsoft.com/kb/313994">313994</a>: Windows 2000 でグローバル カタログの作成または移動を行う方法</li> <li>ドメイン コントローラーが操作マスターの役割をホストしていた場合は、ドメイン コントローラーに操作マスターの役割を移行して戻します。 詳細については、次の記事の番号をクリックして表示される Microsoft サポート技術情報の記事を参照してください。 <br><a href="https://support.microsoft.com/kb/255504">255504</a>: Ntdsutil.exe を使用して別のドメイン コントローラーに FSMO の役割を移行または強制移行する 良好なバックアップのシステム状態を復元します。</li></ol></p> <p>このドメイン コントローラーの有効なシステム状態のバックアップが存在するかどうかを判断します。 ロールバックされるドメイン コントローラーが不適切に復元される前に有効なシステム状態のバックアップが作成され、そのバックアップにドメイン コントローラーで実行された最近の変更が含まれている場合は、最新のバックアップからシステムの状態を復元します。</p> <p>バックアップのソースとしてスナップショットを使用することもできます。 または、<a href="http://technet.microsoft.com/library/dd363545(WS.10).aspx">こちらの記事</a>の仮想ドメイン コントローラー VHD の前バージョンへのシステム状態データのバックアップなしでの復元に関するセクションの手順を使用して、データベース自身に新しい呼び出し ID を指定するようにデータベースを設定できます。</p></p> |









## <a name="next-steps"></a>次の手順
* [Azure AD Connect Health の FAQ](active-directory-aadconnect-health-faq.md)
