---
title: SaaS アプリケーションへの Azure Active Directory 自動ユーザー アカウント プロビジョニングについてのレポート | Microsoft Docs
description: 自動ユーザー アカウント プロビジョニング ジョブの状態を確認する方法と、個々のユーザーのプロビジョニングをトラブルシューティングする方法について説明します。
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: app-mgmt
ms.devlang: na
ms.topic: conceptual
ms.date: 07/30/2018
ms.author: barbkess
ms.reviewer: asmalser
ms.openlocfilehash: 3231792ed1cb7f80cd2a106faf3760c48dd13c19
ms.sourcegitcommit: 30c7f9994cf6fcdfb580616ea8d6d251364c0cd1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/18/2018
ms.locfileid: "42142753"
---
# <a name="tutorial-reporting-on-automatic-user-account-provisioning"></a>チュートリアル: 自動ユーザー アカウント プロビジョニングについてのレポート


Azure Active Directory には、エンド ツー エンドの ID ライフ サイクル管理のために、SaaS アプリとその他のシステムのユーザー アカウントのプロビジョニングとプロビジョニング解除の自動化を支援する、[ユーザー アカウント プロビジョニング サービス](active-directory-saas-app-provisioning.md)が含まれています。 Azure AD では、[Azure AD アプリケーション ギャラリー](https://azuremarketplace.microsoft.com/marketplace/apps/category/azure-active-directory-apps?page=1&subcategories=featured)の「おすすめ」セクションのすべてのアプリケーションとシステム用に、事前統合されたユーザー プロビジョニング コネクタがサポートされています。

この記事では、プロビジョニング ジョブのセットアップ後にそれらの状態を確認する方法と、個々のユーザーとグループのプロビジョニングのトラブルシューティングを行う方法について説明します。

## <a name="overview"></a>概要

プロビジョニング コネクタは、[Azure Portal](https://portal.azure.com) を使用してセットアップおよび構成します。サポートされているアプリケーションに[提供されているドキュメント](saas-apps/tutorial-list.md)に従ってください。 構成を完了し実行すると、以下の 2 つの方法のいずれかで、プロビジョニング ジョブをレポートできます。

* **Azure 管理ポータル** - この記事では、主に、[Azure Portal](https://portal.azure.com) からレポート情報を取得する方法について説明します。このポータルでは、プロビジョニングの概要レポートと、特定のアプリケーションの詳細なプロビジョニング監査ログの両方が提供されます。

* **監査 API** - Azure Active Directory には、プログラムで詳細なプロビジョニング監査ログを取得することができる監査 API も用意されています。 この API の使用を取り上げたドキュメントについては、[Azure Active Directory 監査 API リファレンス](active-directory-reporting-api-audit-reference.md)を参照してください。 この記事では、API を使用する方法については具体的に説明していませんが、監査ログに記録されるプロビジョニング イベントの種類については詳細に説明しています。

### <a name="definitions"></a>定義

この記事では、以下に定義されている用語を使用します。

* **ソース システム** - Azure AD プロビジョニング サービスの同期元である、ユーザーのリポジトリ。 Azure Active Directory は、事前統合されたほとんどのプロビジョニング コネクタのソース システムです。ただし、いくつかの例外があります (例: Workday Inbound Synchronization)。

* **ターゲット システム** - Azure AD プロビジョニング サービスの同期先である、ユーザーのリポジトリ。 これは、通常は SaaS アプリケーション (例: Salesforce、ServiceNow、Google Apps、Dropbox for Business) です。ただし、場合によっては、Active Directory などのオンプレミス システムにすることもできます (例: Workday Inbound Synchronization から Active Directory へ)。


## <a name="getting-provisioning-reports-from-the-azure-management-portal"></a>Azure 管理ポータルからプロビジョニング レポートを取得する

特定のアプリケーションに関するプロビジョニング レポート情報を取得するには、まず [Azure 管理ポータル](https://portal.azure.com)を起動し、プロビジョニングの構成対象のエンタープライズ アプリケーションに移動します。 たとえば、LinkedIn Elevate にユーザーをプロビジョニングする場合、アプリケーションの詳細へのナビゲーション パスは、次のようになります。

**[Azure Active Directory] > [エンタープライズ アプリケーション] > [すべてのアプリケーション] > [LinkedIn Elevate]**

ここから、プロビジョニング概要レポートとプロビジョニング監査ログの両方にアクセスできます。それらについて、以下で説明します。


## <a name="provisioning-summary-report"></a>プロビジョニング概要レポート

プロビジョニング概要レポートは、アプリケーションの **[プロビジョニング]** タブに表示されます。 **[設定]** の下の **[同期の詳細]** セクションにあり、以下の情報が表示されます。

* ソース システムとターゲット システムの間で同期され、現時点でプロビジョニングの対象となっているユーザーとグループの総数。

* 同期が最後に実行された時間。 同期は通常、[初期同期](active-directory-saas-app-provisioning.md#what-happens-during-provisioning)が完了した後、20 ～ 40 分間隔で行われます。

* [初期同期](active-directory-saas-app-provisioning.md#what-happens-during-provisioning)が完了したかどうか。

* プロビジョニング プロセスが検疫の対象となったかどうかと、検疫状態になった理由 (たとえば、無効な管理者資格情報のためにターゲット システムとの通信に失敗した)

プロビジョニング概要レポートは、プロビジョニング ジョブの操作の正常性をチェックするために、管理者が最初に確認するものです。

 ![概要レポート](./media/active-directory-saas-provisioning-reporting/summary_report.PNG)

## <a name="provisioning-audit-logs"></a>プロビジョニング監査ログ
プロビジョニング サービスによって実行されたすべてのアクティビティは、Azure AD 監査ログに記録されます。このログは、**[アカウント プロビジョニング]** カテゴリの下の **[監査ログ]** タブで表示することができます。 記録されるアクティビティ イベントの種類には、次のようなものがあります。

* **インポート イベント** - "インポート" イベントは、Azure AD プロビジョニング サービスが個々のユーザーまたはグループに関する情報をソース システムまたはターゲット システムから取得するたびに記録されます。 同期中、まずユーザーがソース システムから取得され、結果が "インポート" イベントとして記録されます。 次に、取得されたユーザーの照合 ID がターゲット システムに対して照会され、その ID が存在するかどうかが確認されます。その結果も、"インポート" イベントとして記録されます。 これらのイベントでは、イベントの時点で Azure AD プロビジョニング サービスによって参照された、マップされている全ユーザー属性とその値が記録されます。 

* **同期ルール イベント** - これらのイベントでは、ユーザー データがソース システムとターゲット システムからインポートされ、評価された後で、属性マッピング規則と構成済みの全スコープ フィルターの結果が報告されます。 たとえば、ソース システムのユーザーがプロビジョニングのスコープ内にあると見なされ、ターゲット システムには存在しないと見なされる場合、このイベントでは、ユーザーがターゲット システムにプロビジョニングされると記録されます。 

* **エクスポート イベント** - "エクスポート" イベントは、Azure AD プロビジョニング サービスがユーザー アカウントまたはグループ オブジェクトをターゲット システムに書き込むたびに記録されます。 これらのイベントでは、イベントの時点で Azure AD プロビジョニング サービスによって書き込まれたすべてのユーザー属性とその値が記録されます。 ユーザー アカウントまたはグループ オブジェクトをターゲット システムに書き込んでいるときにエラーが発生した場合は、ここに表示されます。

* **プロセス エスクロー イベント** - プロセス エスクローは、操作の試行中にプロビジョニング サービスでエラーが生じ、バックオフ間隔で操作の再試行が開始されたときに発生します。 "エスクロー" イベントは、プロビジョニング操作が再試行されるたびに記録されます。

個々のユーザーのプロビジョニング イベントを見ると、通常は次の順序でイベントが発生します。

1. インポート イベント: ユーザーがソース システムから取得されます。

2. インポート イベント: ターゲット システムが照会され、取得したユーザーの存在が確認されます。

3. 同期ルール イベント: ソース システムとターゲット システムから取得されたユーザー データが、構成済みの属性マッピング規則とスコープ フィルターに対して評価され、実行するアクションが判断されます。

4. イベントのエクスポート: 同期ルール イベントにより操作 (追加、更新、削除) を実行することが指示されている場合は、操作の結果がエクスポート イベントに記録されます。

![Azure AD のテスト ユーザーの作成](./media/active-directory-saas-provisioning-reporting/audit_logs.PNG)


### <a name="looking-up-provisioning-events-for-a-specific-user"></a>特定のユーザーのプロビジョニング イベントを検索する

プロビジョニング監査ログの最も一般的なユース ケースは、個々のユーザー アカウントのプロビジョニング状態を確認することです。 特定のユーザーの最新のプロビジョニング イベントを検索するには、次のように操作します。

1. **[監査ログ]** セクションに移動します。

2. **[カテゴリ]** メニューの **[アカウント プロビジョニング]** を選択します。

3. **[日付範囲]** メニューで、検索する日付範囲を選択します。

4. **[検索]** バーに、検索するユーザーのユーザー ID を入力します。 ID 値の形式は、属性マッピング構成でプライマリ照合 ID として選択したもの (userPrincipalName や従業員 ID 番号など) と一致する必要があります。 必要な ID 値は、[ターゲット] 列に表示されます。

5. 検索するには、Enter キーを押します。 最新のプロビジョニング イベントが最初に返されます。

6. イベントが返された場合は、アクティビティの種類と、それが成功したか失敗したかに注意してください。 結果が返されない場合は、ユーザーが存在しないか、完全同期が完了しておらずプロビジョニング プロセスによってまだ検出されていないことを意味します。

7. 個々のイベントをクリックすると、詳細が展開され、イベントの一部として取得、評価、または書き込まれたすべてのユーザー プロパティなどが表示されます。

監査ログを使用する方法の例については、次の動画を参照してください。 およそ 5 時 30分の時点で監査ログが表示されます。

> [!VIDEO https://www.youtube.com/embed/pKzyts6kfrw]

### <a name="tips-for-viewing-the-provisioning-audit-logs"></a>プロビジョニング監査ログを表示するためのヒント

Azure Portal で見やすく表示するには、**[列]** ボタンを選択し、以下の列を選択します。

* **[日付]** - イベントが発生した日付が表示されます。
* **[ターゲット]** - イベントの対象のアプリ名とユーザー ID が表示されます。
* **[アクティビティ]** - 前述のようなアクティビティの種類です。
* **[状態]** - イベントが成功したかどうかが示されます。
* **[状態の理由]** - プロビジョニング イベントで発生したことの概要です。


## <a name="troubleshooting"></a>トラブルシューティング

プロビジョニング概要レポートと監査ログは、管理者がユーザー アカウントのプロビジョニングに関するさまざまな問題をトラブルシューティングする際に主要な役割を果たします。

自動ユーザー プロビジョニングをトラブルシューティングする方法のシナリオ ベースのガイダンスについては、「[アプリケーションに対するユーザーの構成およびプロビジョニングに関する問題](active-directory-application-provisioning-content-map.md)」を参照してください。


## <a name="additional-resources"></a>その他のリソース

* [エンタープライズ アプリのユーザー アカウント プロビジョニングの管理](manage-apps/configure-automatic-user-provisioning-portal.md)
* [Azure Active Directory のアプリケーション アクセスとシングル サインオンとは](manage-apps/what-is-single-sign-on.md)
