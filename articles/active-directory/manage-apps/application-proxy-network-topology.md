---
title: Azure Active Directory アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項 | Microsoft Docs
description: Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項について説明しています。
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 07/28/2017
ms.author: barbkess
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 2321ccf115e3b517bdc593c0c428c61d5dd90968
ms.sourcegitcommit: f86e5d5b6cb5157f7bde6f4308a332bfff73ca0f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2018
ms.locfileid: "39367091"
---
# <a name="network-topology-considerations-when-using-azure-active-directory-application-proxy"></a>Azure Active Directory アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項

この記事では、アプリケーションをリモートで発行およびアクセスするために Azure Active Directory (Azure AD) アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項について説明しています。

## <a name="traffic-flow"></a>トラフィック フロー

アプリケーションが Azure AD アプリケーション プロキシを通じて発行される場合、ユーザーからアプリケーションへのトラフィックはすべて、次の 3 つの接続を経由して送信されます。

1. ユーザーから Azure AD アプリケーション プロキシ サービスのパブリック エンドポイントへの接続
2. アプリケーション プロキシ サービスからアプリケーション プロキシ コネクタへの接続
3. アプリケーション プロキシ コネクタから対象アプリケーションへの接続

![ユーザーから対象アプリケーションへのトラフィック フローを示す図](./media/application-proxy-network-topology/application-proxy-three-hops.png)

## <a name="tenant-location-and-application-proxy-service"></a>テナントの場所とアプリケーション プロキシ サービス

Azure AD テナントにサインアップするとき、指定した国によってテナントのリージョンが決まります。 アプリケーション プロキシを有効にすると、テナント用のアプリケーション プロキシ サービス インスタンスは、Azure AD テナントと同じリージョン、またはその最寄りのリージョン内で選択されるか作成されます。

たとえば、Azure AD テナントのリージョンが欧州連合 (EU) の場合、すべてのアプリケーション プロキシ コネクタは、EU 内の Azure データセンターにあるサービス インスタンスを使用します。 ユーザーが公開アプリケーションにアクセスする場合、トラフィックはこの場所のアプリケーション プロキシ サービス インスタンスを経由して送信されます。

## <a name="considerations-for-reducing-latency"></a>待機時間を削減するための考慮事項

プロキシ ソリューションでは、ネットワーク接続に必ず待ち時間が発生します。 リモート アクセス ソリューションとして選択したプロキシまたは VPN ソリューションに関係なく、ソリューションには、企業ネットワーク内部に接続できるようにする一連のサーバーが必ず含まれます。

多くの組織では、サーバーのエンドポイントが境界ネットワーク内に含まれています。 しかし、Azure AD では、コネクタが企業ネットワーク上に配置されていてもトラフィックはクラウド内のプロキシ サービスを経由して送信されます。 このため、境界ネットワークは必要ありません。

次のセクションで、待機時間をさらに削減するための推奨事項を示します。 

### <a name="connector-placement"></a>コネクタの配置

アプリケーション プロキシでは、テナントの場所に基づいてインスタンスの場所が自動的に選択されます。 ただし、コネクタのインストール場所は自分で決定できます。これにより、ネットワーク トラフィックの待機時間特性を定義できます。

アプリケーション プロキシ サービスを設定する場合は、次の質問について考えてください。

* アプリケーションの場所はどこか。
* アプリケーションにアクセスする大半のユーザーの場所はどこか。
* アプリケーション プロキシ インスタンスの場所はどこか。
* Azure データセンターへの専用のネットワーク接続 (Azure ExpressRoute や類似の VPN など) が既に設定されているかどうか。

コネクタは Azure とアプリケーションの両方と通信する必要があるため (トラフィック フロー図の手順 2 と 3)、コネクタの配置場所はこれら 2 つの接続の待機時間に影響します。 コネクタの配置を評価する際は、次の点に留意してください。

* シングル サインオンに Kerberos の制約付き委任 (KCD) を使用する場合、コネクタからデータセンターへの通信経路が必要になります。 さらに、コネクタ サーバーはドメインに参加している必要があります。  
* 使用するかどうかが不明な場合は、アプリケーションの近くにコネクタをインストールします。

### <a name="general-approach-to-minimize-latency"></a>待機時間を最小限に抑えるための一般的なアプローチ

各ネットワーク接続を最適化することによって、エンド ツー エンドのトラフィック待機時間を最小化することができます。 各接続は次の方法で最適化できます。

* ホップの両端間の距離を短縮します。
* 経由する適切なネットワークを選択します。 たとえば、パブリック インターネットではなく、プライベート ネットワークを経由した方が、専用リンクのため高速である可能性があります。

Azure と企業ネットワークの間に専用の VPN または ExpressRoute リンクがある場合は、これを利用することをお勧めします。

## <a name="focus-your-optimization-strategy"></a>最適化戦略に焦点を合わせる

ユーザーとアプリケーション プロキシ サービス間の接続を制御するために実行できることはほとんどありません。 ユーザーは、ホーム ネットワーク、コーヒー ショップ、または別の国からアプリをアクセスする可能性があります。 代わりに、アプリケーション プロキシ サービスからアプリケーション プロキシ コネクタへの接続とアプリケーション プロキシ コネクタからアプリへの接続を最適化できます。 環境内に次のパターンを組み込むことを検討してください。

### <a name="pattern-1-put-the-connector-close-to-the-application"></a>パターン 1: アプリケーションの近くへのコネクタの配置

顧客のネットワーク内の対象アプリケーションの近くにコネクタを配置します。 この構成では、コネクタとアプリケーションが閉じているため、トポロジ図の手順 3 が最小限に抑えられます。 

コネクタがドメイン コントローラーを見通す必要がある場合は、このパターンが得策です。 このパターンはほとんどのシナリオに適しているため、大半のユーザーが使用しています。 このパターンとパターン 2 を組み合わせて、サービスとコネクタ間のトラフィックを最適化することもできます。

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a>パターン 2: パブリック ピアリングを使用した ExpressRoute の活用

パブリック ピアリングを使用して ExpressRoute を設定済みの場合、アプリケーション プロキシとコネクタ間のトラフィック用により高速な ExpressRoute 接続を利用できます。 この場合でも、コネクタはネットワーク上のアプリケーションに近い場所に配置します。

### <a name="pattern-3-take-advantage-of-expressroute-with-private-peering"></a>パターン 3: プライベート ピアリングを使用した ExpressRoute の活用

Azure と企業ネットワークとの間に、プライベート ピアリングを使用して専用の VPN または ExpressRoute を設定済みの場合、別の選択肢があります。 この構成では、通常、Azure の仮想ネットワークは企業ネットワークの拡張機能と見なされます。 そのため、Azure データセンターにコネクタをインストールする一方で、コネクタからアプリへの接続について厳しい待ち時間の要件を満たすことができます。

専用接続を介して送信されるため、待機時間は損なわれません。 さらに、コネクタが Azure AD テナントに近い Azure データセンターへとインストールされるため、アプリケーション プロキシ サービスからコネクタへの接続待ち時間も改善されます。

![Azure データ センター内にインストールされたコネクタを示す図](./media/application-proxy-network-topology/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a>その他のアプローチ

この記事ではコネクタの配置を中心に取り上げていますが、アプリケーションの配置を変更して待ち時間特性を改善することもできます。

ホスト環境にネットワークを移動する組織が増えています。 これにより組織は、企業ネットワークの一部でもあり、ドメイン内のままであるホスト環境にアプリを配置できます。 この場合は、前のセクションで説明したパターンをアプリケーションの新しい場所に適用できます。 このオプションを検討する場合は、[Azure AD Domain Services](../../active-directory-domain-services/active-directory-ds-overview.md) に関するページをご覧ください。

さらに、別々の場所やネットワーク内にある対象アプリケーションに接続するコネクタを、[コネクタ グループ](application-proxy-connector-groups.md)を使用して整理することを検討してください。 

## <a name="common-use-cases"></a>一般的なユース ケース

このセクションでは、いくつかの一般的なシナリオについて説明します。 ここでは、Azure AD テナント (およびそれに伴うプロキシ サービス エンドポイント) が米国 (US) 内にあると仮定しています。 これらのユース ケースで説明されている考慮事項は、世界各地の他のリージョンにも当てはまります。

以下のシナリオでは、説明をわかりやすくするため、各接続に番号を付けて "ホップ" と呼びます。

- **ホップ 1**: ユーザーからアプリケーション プロキシ サービスへ
- **ホップ 2**: アプリケーション プロキシ サービスからアプリケーション プロキシ コネクタへ
- **ホップ 3**: アプリケーション プロキシ コネクタからターゲット アプリケーションへ 

### <a name="use-case-1"></a>ユース ケース 1

**シナリオ:** アプリは米国内の組織のネットワークにあり、ユーザーは同じリージョン内に存在している。 Azure データセンターと企業ネットワークの間に ExpressRoute または VPN は存在しません。

**推奨事項:** 前のセクションで説明したパターン 1 に従います。 待ち時間を改善するには、必要に応じて ExpressRoute の使用を検討してください。

これは、単純なパターンです。 アプリの近くにコネクタを配置することによって、ホップ 3 を最適化します。 コネクタは、KCD 操作を実行するために、通常、アプリとデータセンターとの通信経路にインストールされるため、これは自然な選択でもあります。

![ユーザー、プロキシ、コネクタ、アプリケーションがすべて米国内に存在することを示す図](./media/application-proxy-network-topology/application-proxy-pattern1.png)

### <a name="use-case-2"></a>ユース ケース 2

**シナリオ:** アプリは米国内の組織のネットワークにあり、ユーザーは世界中に分散している。 Azure データセンターと企業ネットワークの間に ExpressRoute または VPN は存在しません。

**推奨事項:** 前のセクションで説明したパターン 1 に従います。 

繰り返しますが、一般的なパターンはホップ 3 の最適化です。これにより、コネクタはアプリの近くに配置されます。 ホップ 3 は、すべて同じリージョン内にある場合、通常、コストは高くありません。 ただし、世界各地のユーザーが米国内のアプリケーション プロキシ インスタンスにアクセスするため、ユーザーの場所によってはホップ 1 のコストが高くなる可能性があります。 どのプロキシ ソリューションも、グローバルに分散しているユーザーに関して類似した特性を持つことは注目に値します。

![ユーザーが世界中に分散し、プロキシ、コネクタ、アプリケーションは米国内に存在することを示す図](./media/application-proxy-network-topology/application-proxy-pattern2.png)

### <a name="use-case-3"></a>ユース ケース 3

**シナリオ:** アプリは米国内の組織のネットワークにある。 パブリック ピアリングを使用した ExpressRoute が、Azure と企業ネットワークの間に存在します。

**推奨事項:**: 前のセクションで説明したパターン 1 とパターン 2 に従います。

最初に、コネクタを可能な限りアプリケーションの近くに配置します。 これで、ホップ 2 には ExpressRoute が自動的に使用されます。 

ExpressRoute リンクでパブリック ピアリングを使用している場合、プロキシとコネクタの間のトラフィックはそのリンク経由で送信されます。 ホップ 2 の待ち時間が最適化されます。

![プロキシとコネクタ間の ExpressRoute を示す図](./media/application-proxy-network-topology/application-proxy-pattern3.png)

### <a name="use-case-4"></a>ユース ケース 4

**シナリオ:** アプリは米国内の組織のネットワークにある。 プライベート ピアリングを使用した ExpressRoute が、Azure と企業ネットワークの間に存在します。

**推奨事項:**: 前のセクションで説明したパターン 3 に従います。

ExpressRoute プライベート ピアリング経由で企業ネットワークに接続されている Azure データセンターにコネクタを配置します。 

コネクタは、Azure データセンターに配置できます。 プライベート ネットワークを経由しても、コネクタからアプリケーションとデータセンターへの通信経路は保たれるため、ホップ 3 は最適化されたままになります。 加えて、ホップ 2 はさらに最適化されます。

![Azure データセンター内にコネクタがありコネクタとアプリケーション間に ExpressRoute があることを示す図](./media/application-proxy-network-topology/application-proxy-pattern4.png)

### <a name="use-case-5"></a>ユース ケース 5

**シナリオ:** アプリケーションは EU 内の組織のネットワークにあり、アプリケーション プロキシ インスタンスと大部分のユーザーは米国内に存在している。

**推奨事項:** コネクタをアプリケーションの近くに配置します。 米国のユーザーは、同じリージョンのアプリケーション プロキシ インスタンスにアクセスしているため、ホップ 1 のコストが高すぎるということはありません。 ホップ 3 は最適化されています。 ExpressRoute を使用して ホップ 2 を最適化することを検討してください。 

![ユーザーとプロキシが米国内に、コネクタとアプリケーションは EU 内に存在することを示す図](./media/application-proxy-network-topology/application-proxy-pattern5b.png)

このような状況では、もう 1 つのバリエーションを使用することも検討できます。 組織内のほとんどのユーザーが米国内に存在する場合、ネットワークが米国まで拡張される可能性があります。 コネクタを米国内に配置し、EU 内のアプリケーションへの専用の内部企業ネットワーク回線を使用します。 これにより、ホップ 2 と 3 が最適化されます。

![ユーザー、プロキシ、コネクタは米国内に、アプリケーションは EU 内に存在することを示す図](./media/application-proxy-network-topology/application-proxy-pattern5c.png)

## <a name="next-steps"></a>次の手順

- [アプリケーション プロキシを有効にする](application-proxy-enable.md)
- [シングル サインオンを有効にする](application-proxy-configure-single-sign-on-with-kcd.md)
- [条件付きアクセスを有効にする](application-proxy-integrate-with-sharepoint-server.md)
- [アプリケーション プロキシで発生した問題のトラブルシューティングを行う](application-proxy-troubleshoot.md)
