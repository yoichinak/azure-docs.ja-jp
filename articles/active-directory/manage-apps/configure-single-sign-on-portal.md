---
title: シングル サインオンの構成 - Azure Active Directory | Microsoft Docs
description: このチュートリアルでは、Azure portal を使って、Azure Active Directory (Azure AD) による SAML ベースのシングル サインオンをアプリケーションに構成します。
services: active-directory
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.topic: tutorial
ms.workload: identity
ms.date: 08/09/2018
ms.author: barbkess
ms.reviewer: arvinh,luleon
ms.openlocfilehash: b0180f162996c5fc4647071feaf02d42320b7c9a
ms.sourcegitcommit: 387d7edd387a478db181ca639db8a8e43d0d75f7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/10/2018
ms.locfileid: "40036382"
---
# <a name="tutorial-configure-saml-based-single-sign-on-for-an-application-with-azure-active-directory"></a>チュートリアル: Azure Active Directory による SAML ベースのシングル サインオンをアプリケーションに構成する

このチュートリアルでは、[Azure portal](https://portal.azure.com) を使って、Azure Active Directory (Azure AD) による SAML ベースのシングル サインオンをアプリケーションに構成します。 このチュートリアルは、構成対象の[アプリケーションに固有のチュートリアル](../saas-apps/tutorial-list.md)がない場合にご覧ください。 


このチュートリアルでは、Azure portal を使用して次の作業を行います。

> [!div class="checklist"]
> * SAML ベースのシングル サインオン モードを選択する
> * アプリケーションに固有のドメインと URL を構成する
> * ユーザー属性を構成する
> * SAML 署名証明書を作成する
> * アプリケーションにユーザーを割り当てる
> * SAML ベースのシングル サインオンに対応するようにアプリケーションを構成する
> * SAML 設定のテスト

## <a name="before-you-begin"></a>開始する前に

1. Azure AD テナントにまだアプリケーションを追加していない場合は、「[クイック スタート: Azure Active Directory テナントにアプリケーションを追加する](add-application-portal.md)」を参照してください。

2. 「[ドメインと URL の構成](#configure-domain-and-urls)」に記載されている情報をアプリケーションのベンダーに問い合わせます。

3. このチュートリアルの手順をテストするには、非運用環境を使用することをお勧めします。 Azure AD の非運用環境がない場合は、[1 か月の評価版を入手できます](https://azure.microsoft.com/pricing/free-trial/)。

4. Azure AD テナントの全体管理者、クラウド アプリケーション管理者、またはアプリケーション管理者として [Azure portal](https://portal.azure.com) にサインインします。

## <a name="select-a-single-sign-on-mode"></a>シングル サインオン モードを選択する

Azure AD テナントにアプリケーションを追加したら、アプリケーションにシングル サインオンを構成する準備は完了です。

シングル サインオンの設定を開くには、次の手順に従います。

1. [Azure portal](https://portal.azure.com) の左側のナビゲーション パネルで、**[Azure Active Directory]** をクリックします。 

2. **[Azure Active Directory]** ブレードで、**[エンタープライズ アプリケーション]** をクリックします。 **[すべてのアプリケーション]** ブレードが開き、Azure AD テナントのアプリケーションのランダム サンプルが表示されます。 

3. **[アプリケーションの種類]** メニューの **[すべてのアプリケーション]** を選択し、**[適用]** をクリックします。

4. シングル サインオンを構成するアプリケーションの名前を入力します。 独自のアプリケーションを選択するか、[アプリケーションの追加](add-application-portal.md)に関するクイック スタートで追加した GitHub-test アプリケーションを使用してください。

5. **[シングル サインオン]** をクリックします。 **[シングル サインオン モード]** に、既定のオプションとして **[SAML ベースのサインオン]** が表示されます。 

    ![構成オプション](media/configure-single-sign-on-portal/config-options.png)

6. ブレードの上部にある **[保存]** をクリックします。 

## <a name="configure-domain-and-urls"></a>ドメインと URL の構成

ドメインと URL を構成するには、次の手順に従います。

1. 次の設定についての正しい情報をアプリケーションのベンダーに問い合わせます。

    | 構成設定 | SP-Initiated | idP-Initiated | 説明 |
    |:--|:--|:--|:--|
    | [サインオン URL] | 必須 | 指定しない | この URL をユーザーが開くと、サービス プロバイダーは、ユーザーの認証とサインインを行う Azure AD にそのユーザーをリダイレクトします。 Azure AD はその URL を使用して Office 365 と Azure AD アクセス パネルからアプリケーションを起動します。 何も入力されていない場合、ユーザーが Office 365、Azure AD アクセス パネル、または Azure AD シングル サインオン URL からアプリケーションを起動したとき、Azure AD により idP-Initiated のシングル サインオンが実行されます。|
    | 識別子 (エンティティ ID) | 一部のアプリでは必須 | 一部のアプリでは必須 | シングル サインオンの構成対象となるアプリケーションを一意に識別します。 この ID は、SAML トークンの Audience パラメーターとして Azure AD からアプリケーションに返される値であり、アプリケーションではこの値を検証する必要があります。 また、この値はアプリケーションによって提供される SAML メタデータ内に Entity ID として表示されます。|
    | [応答 URL] | 省略可能 | 必須 | アプリケーションが SAML トークンを受け取ることになっている場所を指定します。 応答 URL は Assertion Consumer Service (ACS) URL とも呼ばれています。 |
    | リレー状態 | 省略可能 | 省略可能 | 認証が完了した後にユーザーをリダイレクトする場所をアプリケーションに指示します。 通常、値はアプリケーションで有効な URL です。ただし、一部のアプリケーションでは、このフィールドを異なる方法で使用します。 詳細については、アプリケーションのベンダーに問い合わせてください。

2. 情報を入力します。 すべての設定を表示するには、**[詳細な URL 設定の表示]** をクリックします。

    ![構成オプション](media/configure-single-sign-on-portal/config-urls.png)

3. ブレードの上部にある **[保存]** をクリックします。

4. このセクションには、**[SAML 設定のテスト]** ボタンがあります。 このテストは、後でこのチュートリアルの「[シングル サインオンのテスト](#test-single-sign-on)」セクションで実行します。

## <a name="configure-user-attributes"></a>ユーザー属性を構成する

Azure AD からアプリケーションに送信する情報は、ユーザー属性で制御でききます。 たとえば、ユーザーの名前やメール、従業員 ID を Azure AD からアプリケーションに送信することが考えられます。 ユーザーがサインインするたびに、そのユーザー属性を Azure AD が SAML トークンに含めてアプリケーションに送信します。 

シングル サインオンが適切に機能するうえで、これらの属性が必要な場合もあれば、省略可能な場合もあります。 詳細については、[ アプリケーションに固有のチュートリアル](../saas-apps/tutorial-list.md)を参照するか、アプリケーションのベンダーに問い合わせてください。

1. すべてのオプションを表示するために、**[その他のすべてのユーザー属性を表示および編集する]** をクリックします。

    ![ユーザー属性を構成する](media/configure-single-sign-on-portal/config-user-attributes.png)

2. **ユーザー識別子**を入力します。

    アプリケーション内の各ユーザーは、ユーザー識別子によって一意に識別されます。 たとえば、メール アドレスがユーザー名と一意識別子を兼ねている場合、この値を *user.mail* に設定します。

3. その他の SAML トークン属性を表示するには、**[その他のすべてのユーザー属性を表示および編集する]** をクリックします。

4. **[SAML トークン属性]** に属性を追加するには、**[属性の追加]** をクリックします。 **[名前]** を入力し、メニューから **[値]** を選択します。

5. **[Save]** をクリックします。 テーブルに新しい属性が表示されます。
 
## <a name="create-a-saml-signing-certificate"></a>SAML 署名証明書を作成する

Azure AD は、アプリケーションに送信する SAML トークンに対し、証明書を使って署名します。 

1. すべてのオプションを表示するために、**[Show advanced certificate signing options]\(証明書署名の詳細オプションを表示する\)** をクリックします。

    ![証明書の構成](media/configure-single-sign-on-portal/config-certificate.png)

2. 証明書を構成するには、**[新しい証明書を作成する]** をクリックします。

3. **[新しい証明書の作成]** ブレードで有効期限を設定し、**[保存]** をクリックします。

4. **[新しい証明書をアクティブにする]** をクリックします。

5. 詳細については、[詳細な証明書署名オプション](certificate-signing-options.md)に関するページを参照してください。

6. これまでに行った変更を維持するために、**[シングル サインオン]** ブレードの一番上にある **[保存]** を必ずクリックしてください。 

## <a name="assign-users-to-the-application"></a>アプリケーションにユーザーを割り当てる

アプリケーションを社内にロールアウトする前に、複数のユーザーまたはグループを対象にシングル サインオンをテストすることをお勧めします。

アプリケーションにユーザーまたはグループを割り当てるには、次の手順に従います。

1. ポータルでアプリケーションを開きます (まだ開いていない場合)。
2. 左側のアプリケーション ブレードで、**[ユーザーとグループ]** をクリックします。
3. **[ユーザーの追加]** をクリックします。
4. **[割り当ての追加]** ブレードで **[ユーザーとグループ]** をクリックします。
5. 特定のユーザーを検索するには、そのユーザー名を **[選択]** ボックスに入力し、ユーザーのプロフィール写真またはロゴの横にあるチェック ボックスをオンにして、**[選択]** をクリックします。 
6. 現在のユーザー名を見つけて選択します。 必要に応じて、さらに別のユーザーを選択することもできます。
7. **[割り当ての追加]** ブレードで、**[割り当て]** をクリックします。 完了すると、選択したユーザーが **[ユーザーとグループ]** の一覧に表示されます。

## <a name="configure-the-application-to-use-azure-ad"></a>Azure AD を使用するようにアプリケーションを構成する

あともう少しで終了です。  最後の手順として、Azure AD を SAML ID プロバイダーとして使用するための構成をアプリケーションに対して行う必要があります。 

1. 目的のアプリケーションの **[シングル サインオン]** ブレードを下へスクロールして一番下まで移動します。 

    ![アプリケーションの構成](media/configure-single-sign-on-portal/configure-app.png)

2. ポータルで **[アプリケーションの構成]** をクリックし、指示に従います。
3. シングル サインオンのテスト目的で使用するユーザー アカウントをアプリケーションに手動で作成します。 [前のセクション](#assign-users-to-the-application)でアプリケーションに割り当てたユーザー アカウントを作成します。   アプリケーションを社内にロールアウトする準備が整ったら、自動ユーザー プロビジョニングを使って、ユーザー アカウントをアプリケーションに自動で作成することをお勧めします。

## <a name="test-single-sign-on"></a>シングル サインオンのテスト

設定をテストする準備が整いました。  

1. アプリケーションのシングル サインオン設定を開きます。 
2. **[Configure domain and URLs]\(ドメインと URL の構成\)** セクションまでスクロールします。
2. **[SAML 設定のテスト]** をクリックします。 テストのオプションが表示されます。

    ![シングル サインオンのテストのオプション](media/configure-single-sign-on-portal/test-single-sign-on.png) 

3. **[現在のユーザーとしてサインイン]** をクリックします。 これにより、管理者である自分に関して、シングル サインオンが機能しているかどうかを確認できます。
4. エラーが発生した場合は、エラー メッセージが表示されます。 詳細をコピーして **[エラーの説明]** ボックスに貼り付けます。

    ![解決ガイダンスを入手する](media/configure-single-sign-on-portal/error-guidance.png)

5. **[解決ガイダンスを入手する]** をクリックします。 根本原因と解決ガイダンスが表示されます。  この例では、アプリケーションにユーザーが割り当てられていませんでした。

    ![エラーの修正](media/configure-single-sign-on-portal/fix-error.png)

6. 解決ガイダンスを読み、必要に応じて **[修正する]** をクリックします。

7. 成功するまでテストを再実行します。



## <a name="next-steps"></a>次の手順
このチュートリアルでは、Azure portal を使って、Azure AD によるシングル サインオンをアプリケーションに構成しました。 シングル サインオンの構成ページにアクセスし、シングル サインオンの設定を行いました。 構成の完了後、ユーザーをアプリケーションに割り当てて、SAML ベースのシングル サインオンを使うための構成をアプリケーションに対して行いました。 その作業がすべて完了した時点で、SAML のサインオンが正常に機能していることを確認しました。

以下のことを行いました。
> [!div class="checklist"]
> * シングル サインオン モードに SAML を選択しました
> * アプリケーションのベンダーに問い合わせてドメインと URL を構成しました
> * ユーザー属性を構成しました
> * SAML 署名証明書を作成しました
> * ユーザーまたはグループをアプリケーションに手動で割り当てました
> * シングル サインオンを使用するための構成をアプリケーションに対して行いました
> * SAML ベースのシングル サインオンをテストしました

社内の他のユーザーについてもアプリケーションをロールアウトする場合は、自動プロビジョニングの使用をお勧めします。

> [!div class="nextstepaction"]
>[自動プロビジョニングを使ってユーザーを割り当てる方法について](configure-automatic-user-provisioning-portal.md)


