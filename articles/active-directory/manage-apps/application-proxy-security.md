---
title: Azure AD アプリケーション プロキシのセキュリティに関する注意事項 | Microsoft Docs
description: Azure AD アプリケーション プロキシを使用する場合のセキュリティに関する注意事項を説明します
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 09/08/2017
ms.author: barbkess
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 985ea1f16cff010041d61d808280cb47f2b77aa9
ms.sourcegitcommit: 35ceadc616f09dd3c88377a7f6f4d068e23cceec
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/08/2018
ms.locfileid: "39618361"
---
# <a name="security-considerations-for-accessing-apps-remotely-with-azure-ad-application-proxy"></a>Azure AD アプリケーション プロキシを使用したアプリへのリモート アクセス時のセキュリティに関する注意事項

この記事では、Azure Active Directory アプリケーション プロキシを使用する際にユーザーとアプリケーションを安全に保つために動作するコンポーネントについて説明します。

次の図は、Azure AD によってお客様のオンプレミスのアプリケーションへの安全なリモート アクセスが実現されるしくみを示しています。

 ![Azure AD アプリケーション プロキシ経由のセキュリティで保護されたリモート アクセスの図](./media/application-proxy-security/secure-remote-access.png)

## <a name="security-benefits"></a>セキュリティ上の利点

Azure AD アプリケーション プロキシには、次のセキュリティ上の利点があります。

### <a name="authenticated-access"></a>認証済みのアクセス 

Azure Active Directory の事前認証を使用することを選択すれば、認証された接続のみがネットワークにアクセスできます。

Azure AD アプリケーション プロキシでは、すべての認証に Azure AD セキュリティ トークン サービス (STS) を使用しています。  事前認証はその性質上、多数の匿名の攻撃をブロックします。これは、バックエンド アプリケーションにアクセスできるのが認証された ID のみのためです。

事前認証方法としてパススルーを選択した場合、この利点を得ることはできません。 

### <a name="conditional-access"></a>条件付きアクセス

ネットワークへの接続が確立される前に、多数のポリシー制御を適用できます。

[条件付きアクセス](../conditional-access/overview.md)を使用すると、バックエンド アプリケーションにアクセスできるトラフィックの制限を定義できます。 場所、認証の強度、およびユーザーのリスク プロファイルに基づいてサインインを制限するポリシーを作成できます。

条件付きアクセスを使用して Multi-Factor Authentication のポリシーを構成することで、ユーザー認証に別のセキュリティ層を追加することもできます。 

### <a name="traffic-termination"></a>トラフィックの終了

すべてのトラフィックがクラウドで終了します。

Azure AD アプリケーション プロキシはリバース プロキシであるため、バックエンド アプリケーションへのトラフィックはすべて、このサービスで終了します。 バックエンド サーバーでのみ、セッションの再確立が可能です。つまり、HTTP トラフィックを送信するためにバックエンド サーバーが公開されることはありません。 この構成は、標的型攻撃に対する保護が強化されることを意味します。

### <a name="all-access-is-outbound"></a>すべてのアクセスが外向き 

企業ネットワークへの受信接続を開く必要がありません。

アプリケーション プロキシ コネクタは、Azure AD アプリケーション プロキシ サービスへの送信接続のみを使用します。つまり、受信接続用のファイアウォール ポートを開放する必要はありません。 従来のプロキシでは、境界ネットワーク ("*DMZ*"、"*非武装地帯*"、"*スクリーン サブネット*" とも呼ばれます) が必要であり、認証されていない接続へのアクセスをネットワーク境界で許可する必要がありました。 このシナリオでは、トラフィックの分析と環境の保護のために、Web アプリケーション ファイアウォール製品への投資が必要でした。 アプリケーション プロキシでは、すべての接続が送信用で、セキュリティで保護されたチャネルを介しているため、境界ネットワークは不要です。

コネクタの詳細については、「[Understand Azure AD Application Proxy connectors (Azure AD アプリケーション プロキシ コネクタについて)](application-proxy-connectors.md)」を参照してください。

### <a name="cloud-scale-analytics-and-machine-learning"></a>クラウド規模の分析と機械学習 

最先端のセキュリティ保護を得ることができます。

アプリケーション プロキシは Azure Active Directory の一部であるため、[Azure AD Identity Protection](../active-directory-identityprotection.md) と、Microsoft の Security Response Center やデジタル犯罪対策部門からのデータを活用できます。 これらの組織は ID が攻撃されたアカウントを被害の発生前に特定し、危険性の高いサインインが実行されないように保護します。どのサインインの試みが高リスクであるかを判断するために、さまざまな要素が考慮されます。 要素としては、感染したデバイスのフラグ、ネットワークの匿名化、特殊な場所や可能性の低い場所などが含まれます。

これらのレポートとイベントの多くは、お客様のセキュリティ情報およびイベント管理 (SIEM) システムとの統合を可能にする API を通じて既に使用可能です。

### <a name="remote-access-as-a-service"></a>サービスとしてのリモート アクセス

オンプレミス サーバーの保守やパッチの適用について心配する必要がありません。

パッチの適用されていないソフトウェアは、依然として多数の攻撃の的となっています。 Azure AD アプリケーション プロキシは Microsoft によるインターネット規模のサービスであるため、常に最新のセキュリティ パッチとアップグレードを取得できます。

Azure AD アプリケーション プロキシによって発行されたアプリケーションのセキュリティを強化するために、Web クローラー ロボットによるアプリケーションのインデックス作成およびアーカイブ操作はブロックされます。 Web クローラー ロボットが発行されたアプリのロボット設定を取得しようとするたびに、アプリケーション プロキシは、`User-agent: * Disallow: /` が含まれる robots.txt ファイルで応答します。

### <a name="ddos-prevention"></a>DDOS 防止

アプリケーション プロキシを使用して公開されたアプリケーションは、分散型サービス拒否 (DDOS) 攻撃から保護されます。

アプリケーション プロキシ サービスは、アプリケーションとネットワークに到達しようとするトラフィック量を監視します。 アプリケーションへのリモート アクセスを要求するデバイスの数が急増すると、Microsoft はネットワークへのアクセスを調整します。 

Microsoft は、個々のアプリケーションとサブスクリプション全体のトラフィック パターンを監視しています。 1 つのアプリケーションが通常より多い要求を受信すると、そのアプリケーションへのアクセス要求はしばらくの間拒否されます。 サブスクリプション全体で通常より多い要求を受け取った場合は、どのアプリへのアクセスの要求も拒否されます。 この予防措置により、リモート アクセス要求によってアプリケーション サーバーが過負荷になることがなくなり、オンプレミス ユーザーはアプリへのアクセスを維持できます。 

## <a name="under-the-hood"></a>コネクタの性能

Azure AD アプリケーション プロキシは、以下の 2 つで構成されています。

* クラウドベースのサービス: このサービスは Azure 内で実行され、外部のクライアント/ユーザーの接続はこの場所で行われます。
* [オンプレミスのコネクタ](application-proxy-connectors.md): オンプレミスのコンポーネント。コネクタは、Azure AD アプリケーション プロキシ サービスからの要求をリッスンし、内部アプリケーションへの接続を処理します。 

コネクタとアプリケーション プロキシ サービスの間でフローが確立されるのは以下の場合です。

* コネクタの最初の設定時。
* コネクタは、アプリケーション プロキシ サービスから構成情報を取得します。
* 公開されたアプリケーションにユーザーがアクセスする。

>[!NOTE]
>すべての通信は SSL 経由で発生し、常にコネクタで生成されて、アプリケーション プロキシ サービスに送られます。 このサービスは送信専用です。

コネクタはクライアント証明書を使用して、ほぼすべての呼び出しに対してアプリケーション プロキシ サービスを認証します。 このプロセスの唯一の例外は、クライアント証明書が確立される最初のセットアップ手順です。

### <a name="installing-the-connector"></a>コネクタのインストール

コネクタの初回セットアップ時に、次のフロー イベントが発生します。

1. サービスへのコネクタの登録は、コネクタのインストールの一環として発生します。 ユーザーは、Azure AD 管理者の資格情報の入力を求められます。 この認証から取得されたトークンが、Azure AD アプリケーション プロキシ サービスに提示されます。
2. アプリケーション プロキシ サービスがトークンを評価します。 ユーザーがテナントの会社管理者であるかどうかを確認します。 ユーザーが管理者でない場合、このプロセスは終了します。
3. コネクタは、クライアント証明書要求を生成し、トークンと共にアプリケーション プロキシ サービスに渡します。 次に、サービスがトークンを検証し、クライアント証明書要求に署名します。
4. コネクタはアプリケーション プロキシ サービスとのその後の通信の際に、このクライアント証明書を使用します。
5. コネクタはクライアント証明書を使用して、サービスからのシステム構成データの初回の収集を実行します。これで要求を受け入れる準備が完了します。

### <a name="updating-the-configuration-settings"></a>構成の設定の更新

アプリケーション プロキシ サービスが構成の設定を更新するたびに、次のフロー イベントが発生します。

1. コネクタはクライアント証明書を使用して、アプリケーション プロキシ サービス内の構成のエンドポイントに接続します。
2. クライアント証明書が検証されると、アプリケーション プロキシ サービスはコネクタに構成データ (そのコネクタが含まれている必要があるコネクタ グループなど) を返します。
3. 現在の証明書が 180 日を経過している場合は、コネクタが新しい証明書要求を生成します。このため、180 日ごとに効率よくクライアント証明書が更新されます。

### <a name="accessing-published-applications"></a>発行済みアプリケーションへのアクセス

ユーザーが公開されたアプリケーションにアクセスすると、アプリケーション プロキシ サービスとアプリケーション プロキシ コネクタの間で次のイベントが発生します。

1. [サービスは、アプリケーションのユーザーを認証します。](#the-service-checks-the-configuration-settings-for-the-app)
2. [サービスがコネクタのキューに要求を配置する](#The-service-places-a-request-in-the-connector-queue)
3. [コネクタがキューの要求を処理する](#the-connector-receives-the-request-from-the-queue)
4. [コネクタが応答のために待機する](#the-connector-waits-for-a-response)
5. [サービスがユーザーにデータをストリーミングする](#the-service-streams-data-to-the-user)

これらの各手順の詳細について、この後説明します。


#### <a name="1-the-service-authenticates-the-user-for-the-app"></a>1.サービスは、アプリケーションのユーザーを認証します。

事前認証方法としてパススルーを使用するようにアプリを構成した場合は、このセクションの手順はスキップされます。

Azure AD を使用して事前認証を使用するようにアプリを構成した場合、ユーザーは認証のために Azure AD STS にリダイレクトされ、次の手順が発生します。

1. アプリケーション プロキシが、特定のアプリケーションの条件付きアクセス ポリシーの要件を確認します。 この手順では、ユーザーがアプリケーションに割り当てられていることを確認します。 2 段階検証が必要な場合は、認証シーケンスでユーザーに第 2 認証方式が要求されます。

2. すべてのチェックに合格すると、Azure AD STS はアプリケーション向けに署名されたトークンを発行し、ユーザーをアプリケーション プロキシ サービスにリダイレクトします。

3. アプリケーション プロキシは、アプリケーションを修正するためのトークンが発行されたかどうかを確認します。 そのトークンが Azure AD によって署名されたものであるかどうか、まだ有効期間内であるかどうかなど、他の確認も行われます。

4. アプリケーション プロキシは、暗号化された認証 Cookie を設定して、アプリケーションへの認証が実行されたことを示します。 この Cookie には、Azure AD と他のデータ (認証の基になるユーザー名など) からのトークンを基にした有効期限のタイムスタンプが含まれています。 この Cookie は、アプリケーション プロキシ サービスのみで認識される秘密キーを使用して暗号化されます。

5. アプリケーション プロキシは、最初に要求された URL にユーザーをリダイレクトします。

事前認証の手順の一部が失敗した場合は、ユーザーの要求が拒否され、問題の原因を示すメッセージが表示されます。


#### <a name="2-the-service-places-a-request-in-the-connector-queue"></a>2.サービスがコネクタのキューに要求を配置する

コネクタは、アプリケーション プロキシ サービスへの送信接続を開いたままにします。 要求を受信すると、サービスは開いている接続のいずれかでキューに要求を配置し、コネクタが処理できるようにします。

この要求には、アプリケーションからのアイテム (要求ヘッダー、暗号化された Cookie のデータ、要求を作成したユーザー、要求 ID など) が含まれています。 要求と共に暗号化された cookie のデータが送信されますが、認証 cookie 自体は暗号化されていません。

#### <a name="3-the-connector-processes-the-request-from-the-queue"></a>手順 3.コネクタがキューの要求を処理する 

アプリケーション プロキシは、要求に基づいて次のいずれかのアクションを実行します。

* 要求が単純な操作の場合 (たとえば、本文にデータがない RESTful *GET* 要求) は、コネクタはターゲットの内部リソースへの接続を確立し、応答を待機します。

* 関連付けられたデータが本文に含まれている要求 (RESTful *POST* 操作など) の場合、コネクタはクライアント証明書を使用して、アプリケーション プロキシのインスタンスへの送信接続を確立します。 この接続は、データを要求し、内部リソースへの接続を開くために確立されます。 アプリケーション プロキシ サービスは、コネクタからの要求を受信すると、ユーザーからのコンテンツの受け入れを開始し、データをコネクタに転送します。 そしてコネクタが内部リソースにデータを転送します。

#### <a name="4-the-connector-waits-for-a-response"></a>4.コネクタが応答のために待機する

バックエンドへのすべてのコンテンツの要求および送信が完了すると、コネクタは応答を待機します。

コネクタは、応答を受け取ると、アプリケーション プロキシ サービスへの送信接続を確立して、ヘッダーの情報を返し、返されるデータのストリーミングを開始します。

#### <a name="5-the-service-streams-data-to-the-user"></a>5.サービスがユーザーにデータをストリーミングする 

アプリケーションの何らかの処理がここで発生する場合があります。 アプリケーションのヘッダーまたは URL を変換するようにアプリケーション プロキシを構成した場合、その処理は、この手順の中で必要に応じて実行されます。


## <a name="next-steps"></a>次の手順

[Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項](application-proxy-network-topology.md)

[Azure AD アプリケーション プロキシ コネクタについて](application-proxy-connectors.md)
