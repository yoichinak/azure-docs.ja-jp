---
title: Azure IoT Hub Device Provisioning サービスにプロビジョニングされたデバイスをプロビジョニング解除する方法 | Microsoft Docs
description: Azure IoT Hub Device Provisioning サービスにプロビジョニングされたデバイスをプロビジョニング解除する方法
author: wesmc7777
ms.author: wesmc
ms.date: 05/11/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: 3c6e2a9006d73d269422292dc959866d3f6d8a82
ms.sourcegitcommit: 9819e9782be4a943534829d5b77cf60dea4290a2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2018
ms.locfileid: "39522674"
---
# <a name="how-to-deprovision-devices-that-were-previously-auto-provisioned"></a>自動プロビジョニングされた以前のデバイスのプロビジョニングを解除する方法 

デバイス プロビジョニング サービスによってプロビジョニングされたデバイスをプロビジョニング解除する必要が生じる場合があります。 たとえば、デバイスが売却されたり、別の IoT Hub に移動されたり、紛失、盗難、その他の理由で侵害された場合などです。 

一般に、デバイスのプロビジョニング解除には 2 つの手順が含まれます。

1. 将来の自動プロビジョニングを防ぐために、プロビジョニング サービスからデバイスの登録を抹消します。 アクセスを一時的に取り消すのか、または永続的に取り消すのかに応じて、登録エントリを無効にするか、削除します。 X.509 の構成証明を使用するデバイスの場合は、既存の登録グループの階層内のエントリを無効または削除する必要があることがあります。  
 
   - デバイスの登録を抹消する方法については、次を参照してください。 [Azure IoT Hub Device Provisioning サービスからの登録を抹消する方法](how-to-revoke-device-access-portal.md)です。
   - いずれかのプロビジョニング サービス SDK を使用してプログラムでデバイスの登録を抹消する方法については、[サービス SDK を使用したデバイスの登録の管理](how-to-manage-enrollments-sdks.md)に関する記事をご覧ください。

2. 将来の通信とデータ転送を防ぐために、IoT Hub からデバイスの登録を解除します。 デバイスがプロビジョニングされた IoT Hub の ID レジストリで、もう一度一時的にデバイスのエントリを無効化するか、または永続的に削除します。 無効化についての詳細は[デバイスの無効化](/azure/iot-hub/iot-hub-devguide-identity-registry#disable-devices)を参照してください。 IoT Hub リソースについては、[Azure Portal](https://portal.azure.com)の「デバイスの管理/IoT デバイス」を参照してください。

デバイスをプロビジョニング解除するための実際の手順は、デバイスが使用している構成証明メカニズムと、プロビジョニング サービスで適用される登録エントリによって異なります。 次のセクションでは、登録と構成証明の種類に基づいて、プロセスの概要を説明します。

## <a name="individual-enrollments"></a>個別登録
TPM 構成証明またはリーフ証明書による X.509 構成証明を使用するデバイスは、個別登録エントリを使用してプロビジョニングされます。 

個別登録のあるデバイスのプロビジョニングを解除するには、次の手順を実行します。 

1. プロビジョニング サービスからデバイスの登録を抹消します。

   - TPM 構成証明を使用するデバイスの場合は、個別登録エントリを削除してプロビジョニング サービスへのデバイスのアクセスを永続的に取り消すか、エントリを無効にして一時的にアクセスを取り消します。 
   - X.509 構成証明を使用するデバイスの場合は、エントリを削除するか無効にすることができます。 ただし、X.509 を使用するデバイスの個別登録を削除した場合でも、そのデバイスの証明書チェーン内の署名証明書に対して有効な登録グループがあると、そのデバイスは再登録することができます。 このようなデバイスがある場合は、登録エントリを無効にするほうが安全であると考えられます。 登録エントリを無効にすれば、その署名証明書のいずれかに対して有効な登録グループが存在する場合でも、デバイスは再登録できなくなります。

2. デバイスがプロビジョニングされた IoT Hub の ID レジストリで、デバイスを無効化または削除します。 


## <a name="enrollment-groups"></a>登録グループ
X.509 構成証明では、登録グループを使用してデバイスをプロビジョニングすることもできます。 登録グループは署名証明書 (中間 CA 証明書またはルート CA 証明書) を使用して構成され、証明書チェーン内のその証明書を使用して、プロビジョニング サービスへのデバイスのアクセスを制御します。 プロビジョニング サービスの登録グループと X.509 証明書の詳細については、「[X.509 証明書](concepts-security.md#x509-certificates)」をご覧ください。 

登録グループを使用してプロビジョニングされているデバイスの一覧を表示するには、登録グループの詳細を表示します。 これは、各デバイスがどの IoT Hub に対してプロビジョニングされているかを把握するための簡単な方法です。 デバイスの一覧を表示するには、次のようにします。 

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
2. リソースの一覧で、目的のプロビジョニング サービスをクリックします。
3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Enrollment Groups]\(登録グループ\)** タブを選択します。
4. 登録グループをクリックして開きます。

   ![ポータルで登録グループ エントリを表示する](./media/how-to-unprovision-devices/view-enrollment-group.png)

登録グループに関しては、2 つのシナリオが考えられます。

- 登録グループを使用してプロビジョニングされているすべてのデバイスのプロビジョニングを解除するには、次の手順を実行します。
  1. 登録グループを無効にして、その署名証明書をブラックリストに追加します。 
  2. 登録グループのプロビジョニング済みデバイスの一覧を使用して、対応する IoT Hub の ID レジストリから各デバイスを無効化または削除します。 
  3. すべてのデバイスを対応する IoT Hub から無効化または削除した後で、必要に応じて登録グループを削除できます。 ただし、登録グループを削除した場合、1 つまたは複数のデバイスの証明書チェーンの上位に署名証明書に対して有効な登録グループがあると、そのデバイスの再登録が可能になります。 

- 登録グループから 1 つのデバイスだけをプロビジョニング解除するには、次の手順を実行します。
  1. リーフ (デバイス) 証明書に対して無効化された個別登録を作成します。 これにより、そのデバイスのプロビジョニング サービスへのアクセスが取り消されますが、チェーン内に登録グループの署名証明書を持つ他のデバイスは引き続きアクセスを許可されます。 デバイスに対して無効化された個別登録を削除しないでください。 削除した場合、登録グループを使用してそのデバイスを再登録することが可能になります。 
  2. その登録グループのプロビジョニング済みデバイスの一覧を使用して、デバイスがどの IoT Hub に対してプロビジョニングされているかを確認し、そのハブの ID レジストリからデバイスを無効化または削除します。 
  
  










