---
title: Site Recovery を使用して Azure にレプリケートされる Hyper-V VM のフェールオーバーとフェールバック | Microsoft Docs
description: Azure Site Recovery を使用して Hyper-V VM を Azure にフェールオーバーする方法と、オンプレミスにフェールバックする方法について説明します
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: article
ms.date: 07/06/2018
ms.author: raynew
ms.openlocfilehash: f758939964045ed373703a211d4cbef00f0e42e7
ms.sourcegitcommit: a06c4177068aafc8387ddcd54e3071099faf659d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/09/2018
ms.locfileid: "37919548"
---
# <a name="failover-and-failback-hyper-v-vms-replicated-to-azure"></a>Azure にレプリケートされる Hyper-V VM のフェールオーバーとフェールバック

このチュートリアルでは、Hyper-V VM と Azure にフェールオーバーする方法について説明します。 フェールオーバーした後、オンプレミス サイトが使用可能になったときにオンプレミス サイトにフェールバックします。 このチュートリアルで学習する内容は次のとおりです。

> [!div class="checklist"]
> * Hyper-V VM のプロパティで Azure の要件に準拠していることを確認する
> * Azure へのフェールオーバーを実行する
> * Azure からオンプレミスへのフェールバック
> * オンプレミス VM のレプリケートを反転して、Azure へのレプリケートを再開する

このチュートリアルはシリーズで 5 番目のチュートリアルです。 このチュートリアルでは、前のチュートリアルで以下のタスクが既に完了していることを前提としています。    

1. [Azure を準備する](tutorial-prepare-azure.md)
2. [オンプレミスの Hyper-V を準備する](tutorial-prepare-on-premises-hyper-v.md)
3. [Hyper-V VM](tutorial-hyper-v-to-azure.md) または [System Center VMM クラウドで管理される Hyper-V VM](tutorial-hyper-v-vmm-to-azure.md) のディザスター リカバリーをセットアップする
4. [ディザスター リカバリーのテストを実行する](tutorial-dr-drill-azure.md)

## <a name="prepare-for-failover-and-failback"></a>フェールオーバーとフェールバックを準備する

VM にスナップショットがないことと、フェールバック中にオンプレミスの VM をオフにすることを確認します。 これは、レプリケーション中のデータの整合性を確保するのに役立ちます。 フェールバック中にオンプレミスの VM を有効にしないでください。 

フェールオーバーとフェールバックには 3 つの段階があります。

1. **Azure にフェールオーバーする**: オンプレミス サイトの Hyper-V を Azure にフェールオーバーします。
2. **オンプレミスにフェールオーバーする**: オンプレミス サイトが使用可能な場合に、Azure VM をオンプレミス サイトにフェールオーバーします。 Azure からオンプレミスへのデータの同期が開始され、完了すると、オンプレミスの VM が起動します。  
3. **オンプレミス VM のレプリケートを反転する**: オンプレミスにフェールオーバーされたら、オンプレミスの VM のレプリケートを反転して、Azure へのレプリケートを開始します。

## <a name="verify-vm-properties"></a>VM のプロパティを確認する

フェールオーバー前に、VM のプロパティで、VM が [Azure の要件](hyper-v-azure-support-matrix.md#replicated-vms)を満たしていることを確認します。

**[保護されているアイテム]** で、**[レプリケートされたアイテム]** をクリックし、VM をクリックします。

2. **[レプリケートされたアイテム]** ウィンドウには、VM 情報、正常性状態、および最新の使用可能な復旧ポイントの概要が表示されます。 **[プロパティ]** をクリックすると、詳細が表示されます。

3. **[コンピューティングとネットワーク]** で、Azure 名、リソース グループ、ターゲット サイズ、[可用性セット](../virtual-machines/windows/tutorial-availability-sets.md)、および管理ディスクの設定を変更できます。

4. ネットワーク設定 (フェールオーバー後に Azure VM が配置されるネットワークやサブネット、割り当てられる IP アドレスなど) を表示および変更できます。

5. **[ディスク]** で、VM のオペレーティング システム ディスクとデータ ディスクに関する情報を確認できます。

## <a name="failover-to-azure"></a>Azure へのフェールオーバー

1. **[設定]** > **[レプリケートされたアイテム]** で、対象の VM、**[フェールオーバー]** の順にクリックします。
2. **[フェールオーバー]** で、**[最新]** 復旧ポイントを選択します。 
3. **[フェールオーバーを開始する前にマシンをシャットダウンします]** を選択します。 Site Recovery は、フェールオーバーを開始する前にソース VM をシャットダウンしようとします。 仮にシャットダウンが失敗したとしても、フェールオーバーは続行されます。 フェールオーバーの進行状況は **[ジョブ]** ページで確認できます。
4. フェールオーバーを確認したら、**[コミット]** をクリックします。 これにより、利用可能なすべての復旧ポイントが削除されます。

> [!WARNING]
> **進行中のフェールオーバーをキャンセルしないでください**。進行中のフェールオーバーをキャンセルすると、フェールオーバーは停止しますが、VM が再びレプリケートされることはありません。

## <a name="failback-azure-vm-to-on-premises-and-reverse-replicate-the-on-premises-vm"></a>Azure VM をオンプレミスにフェールバックし、オンプレミス の VM のレプリケートを反転する

フェールバック操作は基本的に Azure からオンプレミス サイトへのフェールオーバーです。レプリケートの反転では、オンプレミス サイトから Azure への VM のレプリケートを再開します。

1. **[設定]** > **[レプリケートされたアイテム]** で、[VM] > **[計画されたフェールオーバー]** をクリックします。
2. **[計画されたフェールオーバーの確認]** で、フェールオーバーの方向 (Azure から) を確認し、ソースとターゲットの場所を選択します。
3. **[フェールオーバーの前にデータを同期する (差分変更のみを同期する)]** を選択します。 このオプションでは VM をシャットダウンせずに同期するため、VM のダウンタイムが最小限に抑えられます。
4. フェールオーバーを開始します。 フェールオーバーの進行状況は、 **[ジョブ]** タブで確認できます。
5. 初回のデータ同期が完了し、Azure VM をシャットダウンする準備ができた時点で、**[ジョブ]** > 計画されたフェールオーバーのジョブ名 > **[フェールオーバーの完了]** をクリックします。 これにより Azure VM がシャットダウンされ、最新の変更がオンプレミスに転送され、オンプレミスの VM が起動します。
6. オンプレミスの VM にログオンして、それが期待どおりに使用できることを確認します。
7. オンプレミスの VM は、この時点では **[コミット保留中]** の状態です。 **[コミット]** をクリックします。 これにより、Azure VM とそのディスクが削除され、オンプレミスの VM でレプリケーションの反転が準備されます。
オンプレミスの VM の Azure へのレプリケーションを開始するには、**[レプリケーションの反転]** を有効にします。 これにより、Azure VM をシャットダウンした後に発生した差分変更のレプリケーションが開始されます。  
