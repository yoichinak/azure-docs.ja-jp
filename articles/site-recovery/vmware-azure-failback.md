---
title: Azure Site Recovery を使用して Azure から VMware にフェールバックする | Microsoft Docs
description: 仮想マシンを Azure にフェールオーバーした後に、フェールバックを開始して仮想マシンをオンプレミスに戻すことができます。 フェールバック方法の手順について説明します。
author: nsoneji
ms.service: site-recovery
ms.date: 07/06/2018
ms.topic: conceptual
ms.author: nisoneji
ms.openlocfilehash: 9d8398582766a27f1457e3a59bdde0c59298ed50
ms.sourcegitcommit: a06c4177068aafc8387ddcd54e3071099faf659d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/09/2018
ms.locfileid: "37919837"
---
# <a name="fail-back-from-azure-to-an-on-premises-site"></a>Azure からオンプレミス サイトへのフェールバック

この記事では、Azure Virtual Machines からオンプレミスの VMware 環境に仮想マシンをフェールバックする方法について説明します。 この記事の手順は、[Azure Site Recovery でのフェールオーバー](site-recovery-failover.md)に関するチュートリアルを使用して、VMware 仮想マシンまたは Windows/Linux 物理サーバーをオンプレミス サイトから Azure にフェールオーバーした後で、それらをフェールバックするために実行します。

## <a name="prerequisites"></a>前提条件
- [さまざまな種類のフェールバック](concepts-types-of-failback.md)とそれぞれの注意事項に関する詳細情報を既に読んだことを確認します。

> [!WARNING]
> 既に[移行が完了](migrate-overview.md#what-do-we-mean-by-migration)している場合、仮想マシンを別のリソース グループに移動した場合、または Azure 仮想マシンを削除した場合、その後フェールバックを実行することはできません。 仮想マシンの保護を無効にした場合は、フェールバックを実行できません。

> [!WARNING]
> Windows Server 2008 R2 SP1 の物理サーバーが保護されていて、Azure にフェールオーバーした場合、これをフェールバックすることはできません。

> [!NOTE]
> VMware 仮想マシンをフェールオーバー済みである場合、Hyper-V ホストにフェールバックすることはできません。


- 仮想マシンのレプリケート状態を確保したうえでオンプレミス サイトへのフェールバックを開始するために、再保護の操作を事前に行っておく必要があります。 詳細については、[Azure からオンプレミスへの再保護の方法](vmware-azure-reprotect.md)に関するページを参照してください。

- フェールバックを実行する前に、必ず vCenter を接続された状態にしてください。 接続されていない場合、ディスクの切断と仮想マシンへの再接続は失敗します。

- Azure へのフェールオーバー中はオンプレミス サイトにアクセスできないため、構成サーバーが利用できなくなったりシャットダウンされたりする場合があります。 再保護とフェールバック中には、オンプレミスの構成サーバーが実行中で、かつその接続状態が OK である必要があります。 

- フェールバック中、仮想マシンが構成サーバー データベースに存在している必要があります。存在していない場合、フェールバックは成功しません。 必ず、サーバーを定期的にバックアップするようスケジュールを設定します。 障害が発生した場合は、フェールバックが機能するように、元の IP アドレスでサーバーを復元する必要があります。

- マスター ターゲット サーバーには、再保護/フェールバックのトリガー前にスナップショットが一切存在していないことが必要です。

## <a name="overview-of-failback"></a>フェールバックの概要
Azure にフェールオーバーした後は、次の手順を実行して、オンプレミス サイトにフェールバックすることができます。

1. オンプレミス サイトの VMware 仮想マシンへのレプリケートを開始するために、Azure の仮想マシンを[再保護](vmware-azure-reprotect.md)します。 このプロセスでは、次の手順も実行する必要があります。

    * オンプレミスのマスター ターゲットを設定します。 Windows 仮想マシンには Windows マスター ターゲット、Linux 仮想マシンには [Linux マスター ターゲット](vmware-azure-install-linux-master-target.md)を使用します。
    * [プロセス サーバー](vmware-azure-set-up-process-server-azure.md)をセットアップする。
    * [再保護](vmware-azure-reprotect.md)を開始して、オンプレミスの仮想マシンをオフにし、Azure 仮想マシンのデータをオンプレミスのディスクと同期します。

2. Azure の仮想マシンからオンプレミス サイトへのレプリケーションが開始されたら、Azure からオンプレミス サイトへのフェールオーバーを開始します。

3. データがフェールバックされたら、オンプレミスの仮想マシンを再保護します。これにより、オンプレミスの仮想マシンの Azure へのレプリケートを開始できるようになります。

概要を簡単に把握するために、オンプレミス サイトへのフェールバック方法に関する次の動画をご覧ください。
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video5-Failback-from-Azure-to-On-premises/player]


## <a name="steps-to-fail-back"></a>フェールバックの手順

> [!IMPORTANT]
> フェールバックを開始する前に、仮想マシンの再保護が完了していることを確認します。 仮想マシンが保護された状態であり、正常性に**問題がない**ことが必須です。 仮想マシンを再保護するには、[再保護の方法](vmware-azure-reprotect.md)に関するページを参照してください。

1. レプリケートされた項目ページで、仮想マシンを選択します。 右クリックして **[計画されていないフェールオーバー]** を選択します。
2. **[フェールオーバーの確認]** で、フェールオーバーの方向 (Azure から) を確認します。 フェールオーバーに使用する最新の復旧ポイント (最新のアプリケーション整合性ポイント) を選択します。 アプリケーション整合性ポイントは最新の時点よりも過去になるため、一部のデータが失われます。
3. フェールオーバー中に、Site Recovery によって Azure の仮想マシンがシャットダウンされます。 フェールバックが期待どおりに完了したことを確認したら、Azure の仮想マシンがシャットダウンしたこと確認します。
4. フェールオーバーされた仮想マシンを Azure から削除するには、**コミット**する必要があります。 保護された項目を右クリックし、**[コミット]** を選択します。 ジョブが実行されて、Azure にフェールオーバーされた仮想マシンが削除されます。


## <a name="to-what-recovery-point-can-i-fail-back-the-virtual-machines"></a>仮想マシンをフェールバックできる復旧ポイント

仮想マシン/復旧計画をフェールバックする場合、2 つの選択肢があります。

- "最後に処理が行われた時点" を選択した場合、すべての仮想マシンが、候補として考えられる最新の時点までフェールオーバーされます。 復旧計画内にレプリケーション グループが存在する場合は、レプリケーション グループの個々の仮想マシンが、それぞれの最新の時点までフェールオーバーされます。

  仮想マシンをフェールバックするには、その仮想マシンに少なくとも 1 つの復旧ポイントが必要です。 復旧計画をフェールバックするには、復旧計画に含まれるすべての仮想マシンに復旧ポイントが少なくとも 1 つ存在する必要があります。

  > [!NOTE]
  > 最新の復旧ポイントは、クラッシュ整合性の復旧ポイントです。

- "アプリケーション整合性" の復旧ポイントを選択した場合は、1 回の仮想マシン フェールバックで、候補として考えられる最新のアプリケーション整合性復旧ポイントまで復元されます。 レプリケーション グループを含んだ復旧計画の場合、それぞれのレプリケーション グループが、その共通の復旧ポイントまで復元されます。
アプリケーション整合性の復旧ポイントは時間差を伴うことがあり、データの損失につながる場合があります。

## <a name="what-happens-to-vmware-tools-post-failback"></a>フェールバック後の VMware ツールの動作

Windows 仮想マシンの場合、フェールオーバー時に Site Recovery によって VMware ツールが無効になります。 Windows 仮想マシンのフェールバック時に、VMware ツールが再有効化されます。 


## <a name="reprotect-from-on-premises-to-azure"></a>オンプレミスから Azure への再保護
フェールバックが終了し、コミットを開始した後、Azure の復旧した仮想マシンは削除されます。 これで、仮想マシンはオンプレミス サイトに戻りましたが、保護はされません。 Azure へのレプリケートを再び開始するには、次を実行します。

1. **[コンテナー]** > **[設定]** > **[レプリケートされたアイテム]** の順に選択し、フェールバックした仮想マシンを選択し、**[再保護]** を選択します。
2. Azure にデータを送信する際に使用する必要があるプロセス サーバーの値を入力します。
3. **[OK]** を選択すると、再保護ジョブが開始されます。

> [!NOTE]
> オンプレミスの仮想マシンが起動した後、エージェントが構成サーバーに再度登録されるまでにしばらく時間がかかります (最大 15 分)。 この間は再保護が失敗し、エージェントがインストールされていないというエラー メッセージが返されます。 数分待ってから再保護操作をやり直してください。

## <a name="next-steps"></a>次の手順

再保護ジョブが完了すると、仮想マシンが Azure にレプリケートされるため、[フェールオーバー](site-recovery-failover.md)を実行し、仮想マシンを再度 Azure に移動することができます。


