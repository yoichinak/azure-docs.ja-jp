---
title: Azure Site Recovery を使用して、プライマリ Azure リージョンに戻すフェールオーバーされた Azure VM を再保護する | Microsoft Docs
description: Azure Site Recovery を使用して、プライマリ リージョンからフェールオーバーした後に、セカンダリ リージョン内の Azure VM を再保護する方法について説明します。
services: site-recovery
author: rajani-janaki-ram
manager: gauravd
ms.service: site-recovery
ms.topic: article
ms.date: 07/06/2018
ms.author: rajanaki
ms.openlocfilehash: 9759e209f15622d70aaa833a993234863ac1053c
ms.sourcegitcommit: a06c4177068aafc8387ddcd54e3071099faf659d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/09/2018
ms.locfileid: "37918868"
---
# <a name="reprotect-failed-over-azure-vms-to-the-primary-region"></a>プライマリ リージョンに対してフェールオーバーされた Azure VM を再保護する


[Azure Site Recovery](site-recovery-overview.md) を使用してリージョンから別のリージョンに Azure VM を[フェールオーバー](site-recovery-failover.md)すると、VM は保護されていない状態でセカンダリ リージョンで起動されます。 VM をプライマリ リージョンにフェールバックする場合、次の操作を行う必要があります。

- プライマリ リージョンへのレプリケートを開始できるように、セカンダリ リージョンの VM を再保護します。 
- 再保護が完了して、VM がレプリケートされると、セカンダリからプライマリ リージョンにフェールオーバーすることができます。

> [!WARNING]
> プライマリからセカンダリ リージョンにマシンを[移行](migrate-overview.md#what-do-we-mean-by-migration)すると、VM を別のリソース グループに移動した場合、または Azure VM を削除した場合は、VM を再保護したり、フェールバックしたりすることはできません。


## <a name="prerequisites"></a>前提条件
1. VM のプライマリからセカンダリ リージョンへのフェールオーバーは、コミットされている必要があります。
2. プライマリ ターゲット サイトが使用可能で、そのリージョンでリソースにアクセスしたり、リソースを作成したりできる必要があります。

## <a name="reprotect-a-vm"></a>VM の再保護

1. **[コンテナー]**  >  **[レプリケートされたアイテム]** で、フェールオーバーされた VM を右クリックし、**[再保護]** を選択します。 再保護の方向には、セカンダリからプライマリへの方向が示されています。 

  ![再保護](./media/site-recovery-how-to-reprotect-azure-to-azure/reprotect.png)

2. リソース グループ、ネットワーク、ストレージ、および可用性セットを確認します。 次に、 **[OK]** をクリックします 新規としてマークされているリソースがある場合は、再保護プロセスの一環として作成されます。
3. 再保護のジョブにより、最新のデータでターゲット サイトがシード処理されます。 処理が完了したら、差分レプリケーションが行われます。 その後、プライマリ サイトへのフェールバックを行うことができます。 カスタマイズ オプションを使用して、再保護中に使用するストレージ アカウントまたはネットワークを選択できます。

  ![カスタマイズ オプション](./media/site-recovery-how-to-reprotect-azure-to-azure/customize.png)

### <a name="customize-reprotect-settings"></a>再保護設定のカスタマイズ

再保護中にカスタマイズできるのは、ターゲット VM の次のプロパティです。

![[カスタマイズ]](./media/site-recovery-how-to-reprotect-azure-to-azure/customizeblade.png)

|プロパティ |メモ  |
|---------|---------|
|ターゲット リソース グループ     | VM が作成されるターゲット リソース グループを変更します。 再保護の一環として、ターゲット VM が削除されます。 フェールオーバー後に VM を作成する新しいリソース グループを選ぶことができます。        |
|ターゲット仮想ネットワーク     | 再保護ジョブの間に、ターゲット ネットワークを変更することはできません。 ネットワークを変更するには、ネットワーク マッピングを再実行します。         |
|ターゲット ストレージ (セカンダリ VM では、管理ディスクが使用されません)     | フェールオーバー後に、VM で使用するストレージ アカウントを変更できます。         |
|レプリカ管理ディスク (セカンダリ VM では、管理ディスクが使用されます)    | Site Recovery によりプライマリ リージョンにレプリカ管理ディスクが作成され、セカンダリ VM の管理ディスクがミラーリングされます。         | 
|キャッシュ ストレージ     | レプリケーション時に使用されるキャッシュ ストレージ アカウントを指定できます。 既定では、存在しない場合は、新しいキャッシュ ストレージ アカウントが作成されます。         |
|可用性セット     |セカンダリ リージョンの VM が可用性セットの一部である場合は、プライマリ リージョンのターゲット VM に対して可用性セットを選ぶことができます。 既定では、Site Recovery によって、プライマリ リージョンの既存の可用性セットが検索され、使用されます。 カスタマイズするときに、新しい可用性セットを指定できます。         |


### <a name="what-happens-during-reprotection"></a>再保護中の動作

既定では、次のように動作します。

1. キャッシュ ストレージ アカウントが、プライマリ リージョンに作成されます。
2. ターゲット ストレージ アカウント (プライマリ リージョンの元のストレージ アカウント) が存在しない場合は、新しいアカウントが作成されます。 割り当てられたストレージ アカウント名は、"asr" のサフィックスが付けられた、セカンダリ VM によって使用されるストレージ アカウントの名前です。
3. VM で管理ディスクが使用されている場合、レプリカ管理ディスクがプライマリ リージョンで作成され、セカンダリ VM のディスクから複製されたデータが保管されます。 
4. ターゲットの可用性セットが存在しない場合は、必要に応じて、新しい可用性セットが再保護ジョブの一環として作成されます。 再保護設定をカスタマイズした場合は、選択したセットが使用されます。

再保護ジョブをトリガーして、ターゲット VM が存在する場合は、次のように動作します。

1. 必要なコンポーネントが、再保護の一環として作成されます。 既に存在している場合は、再利用されます。
2. ターゲット側の VM が実行されている場合は、オフにされます。
3. ターゲット側の VM のディスクが、Site Recovery によってシード BLOB としてコンテナーにコピーされます。
4. その後、ターゲット側の VM が削除されます。
5. シード BLOB は、現在のソース側 (セカンダリ) の VM によって、レプリケーション時に使用されます。 これにより、差分のみがレプリケートされます。
6. ソース ディスクとシード BLOB の間の主な変更が同期されます。 この処理には、完了までに時間がかかる場合があります。
7. 再保護ジョブが完了した後、再保護ポリシーに従って、差分レプリケーションが始まり、復旧ポイントが作成されます。
8. 再保護ジョブが成功したら、VM は保護された状態になります。

## <a name="next-steps"></a>次の手順

VM が保護されたら、フェールオーバーを開始できます。 フェールオーバーでは、セカンダリ リージョンの VM をシャットダウンし、少しのダウンタイムと共に、プライマリ リージョンに VM を作成して起動します。 プライマリ サイトへの完全なフェールオーバーを開始するのではなく、適宜、時間を選択し、テスト フェールオーバーを実行することをお勧めします。 フェールオーバーの詳細については、[こちら](site-recovery-failover.md)を参照してください。

