---
title: Azure Media Services を使用してマルチビットレートのストリームを作成するライブ ストリーミング | Microsoft Docs
description: このトピックでは、オンプレミスのエンコーダーからシングル ビットレートのライブ ストリームを受信した後、Media Services を使用してアダプティブ ビットレート ストリームへのライブ エンコードを実行するチャネルの設定方法について説明します。 次にストリームは、1 つ以上のストリーミング エンドポイントを介して、HLS、スムーズ ストリーミング、MPEG DASH のいずれかを使用してクライアントの再生アプリケーションに送信できます。
services: media-services
documentationcenter: ''
author: anilmur
manager: cfowler
editor: ''
ms.assetid: 30ce6556-b0ff-46d8-a15d-5f10e4c360e2
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/02/2018
ms.author: juliako;anilmur
ms.openlocfilehash: f4b57241085381f4b975c07038b41133b8a4319b
ms.sourcegitcommit: e0834ad0bad38f4fb007053a472bde918d69f6cb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2018
ms.locfileid: "37436193"
---
# <a name="live-streaming-using-azure-media-services-to-create-multi-bitrate-streams"></a>Azure Media Services を使用して Live Encoding の実行が有効なチャネルを操作する

> [!NOTE]
> 2018 年 5 月 12日以降は、ライブ チャネルで RTP/MPEG-2 トランスポート ストリーム取り込みプロトコルがサポートされなくなります。 RTP/MPEG-2 から RTMP またはフラグメント化 MP4 (Smooth Streaming) 取り込みプロトコルに移行してください。

## <a name="overview"></a>概要
Azure Media Services (AMS) では、 **チャネル** はライブ ストリーミング コンテンツを処理するパイプラインを表します。 **チャネル** は、次の 2 つの方法のいずれかでライブ入力ストリームを受信します。

* オンプレミスのライブ エンコーダーは、RTMP またはスムーズ ストリーミング (Fragmented MP4) のいずれかの形式で、シングル ビットレート ストリームを Media Services によるライブ エンコードが有効なチャネルに送信します。 次に、受信したシングル ビットレート ストリームのマルチ ビットレート (アダプティブ) ビデオ ストリームへのライブ エンコードがチャネルで実行されます。 Media Services は、要求に応じて、ストリームを顧客に配信します。
* オンプレミスのライブ エンコーダーは、マルチビットレート **RTMP** または**スムーズ ストリーミング** (Fragmented MP4) を、AMS によるライブ エンコードの実行が無効なチャネルに送信します。 取り込んだストリームは、追加の処理なしで **チャネル**を通過します。 この方式は、 **パススルー**と呼ばれます。 マルチビットレートの Smooth Streaming を出力するライブ エンコーダーとして、MediaExcel、Ateme、Imagine Communications、Envivio、Cisco、Elemental を使用できます。 Adobe Flash Media Live Encoder (FMLE)、Telestream Wirecast、Haivision、Teradek、Tricaster エンコーダーは、RTMP を出力するライブ エンコーダーです。  ライブ エンコーダーは、ライブ エンコードが有効になっていないチャネルにシングル ビットレート ストリームも送信できますが、これはお勧めしません。 Media Services は、要求に応じて、ストリームを顧客に配信します。
  
  > [!NOTE]
  > パススルー方式を使用することが、ライブ ストリーミングを行う最も経済的な方法です。
  > 
  > 

Media Services 2.10 リリース以降、チャネルを作成するときに、チャネルで入力ストリームを受信する方法、およびチャネルでストリームのライブ エンコードを実行するかどうかを指定できます。 2 つのオプションがあります。

* **なし** – オンプレミスのライブ エンコーダーを使用してマルチビットレート ストリーム (パススルー ストリーム) を出力する場合には、この値を指定します。 この場合は、受信ストリームはエンコードなしで出力に渡されます。 これは、2.10 リリースより前のチャネル動作です。  この種類のチャネル動作の詳細については、「[オンプレミスのエンコーダーからマルチビットレートのライブ ストリームを受信するチャネルを操作する](media-services-live-streaming-with-onprem-encoders.md)」をご覧ください。
* **Standard** – Media Services を使用して、シングル ビットレートのライブ ストリームをマルチ ビットレート ストリームにエンコードする場合に、この値を選択します。 ライブ エンコードは課金に影響することと、ライブ エンコード チャネルを "実行中" 状態のままにしておくと請求料金が課されることに注意してください。  余分な時間料金を課されないようにするために、ライブ ストリーミング イベントが完了したら、チャネルの実行をすぐに停止することをお勧めします。

> [!NOTE]
> このトピックでは、ライブ エンコードの実行が有効なチャネル (エンコードの種類が**標準** のチャネル) の属性について説明します。 ライブ エンコードの実行が無効なチャネルの操作については、「[オンプレミスのエンコーダーからマルチビットレートのライブ ストリームを受信するチャネルを操作する](media-services-live-streaming-with-onprem-encoders.md)」をご覧ください。
> 
> 必ず「 [考慮事項](media-services-manage-live-encoder-enabled-channels.md#Considerations) 」セクションを確認してください。
> 
> 

## <a name="billing-implications"></a>課金への影響
ライブ エンコード チャネルでは、API を通じて状態が "実行中" に遷移するとすぐに、課金が開始されます。   Azure Portal や Azure Media Services Explorer ツール (http://aka.ms/amse) でも状態を表示できます。

次の表は、API と Azure Portal でチャネルの状態がどのように課金の状態に対応しているかを示しています。 API とポータルのユーザー エクスペリエンスとでは状態が少し異なります。 チャネルが API を通じて "実行中" 状態になるか、Azure ポータルで "準備完了" または "ストリーミング" 状態になるとすぐに、課金がアクティブになります。
チャネルへの課金を停止するには、API を通じて、または Azure Portal で、チャネルを停止する必要があります。
ライブ エンコード チャネルが終了したら、自分でチャネルを停止する必要があります。  エンコード チャネルの停止に失敗すると、課金が継続されます。

### <a id="states"></a>チャネルの状態と、どのように課金モードにマッピングされているか
現在のチャネルの状態。 指定できる値は、次のとおりです。

* **停止済み**。 これは、チャネル作成後の初期状態です (ポータルで自動開始が選択されなかった場合)。この状態では、課金は行われません。 この状態で、チャネルのプロパティを更新できますが、ストリーミングは許可されていません。
* **開始中**。 チャネルを開始しています。 この状態では、課金は行われません。 この状態の場合、更新やストリーミングはできません。 エラーが発生した場合は、チャネルは Stopped 状態に戻ります。
* **実行中**。 チャネルは、ライブ ストリームを処理できます。 課金が始まります。 課金されないようにするには、チャネルを停止する必要があります。 
* **停止中**。 チャネルを停止しています。 この遷移状態では、課金は行われません。 この状態の場合、更新やストリーミングはできません。
* **削除中**。 チャネルが削除されました。 この遷移状態では、課金は行われません。 この状態の場合、更新やストリーミングはできません。

次の表は、チャネルの状態と課金モードとの対応を示しています。 

| チャネルの状態 | ポータル UI インジケーター | 課金対象 |
| --- | --- | --- |
| 開始中 |開始中 |いいえ (遷移状態) |
| 実行中 |準備完了 (実行中プログラムなし)<br/>or<br/>ストリーミング (実行中プログラムが最低 1 つ存在) |はい |
| 停止中 |停止中 |いいえ (遷移状態) |
| 停止済み |停止済み |いいえ  |

### <a name="automatic-shut-off-for-unused-channels"></a>使用されていないチャネルの自動停止
2016 年 1 月 25 日以降、Live Encoding が有効になっているチャネルが長期間使用されていない場合、そのチャネルを自動的に停止する Media Services の更新プログラムがロールアウトされます。 これは、アクティブなプログラムがなく、長期間にわたって入力/投稿フィードを受け取っていないチャネルに適用されます。

未使用期間のしきい値は 12 時間とされていますが、この値は変更されることがあります。

## <a name="live-encoding-workflow"></a>Live Encoding のワークフロー
次のダイアグラムは、チャネルが RTMP またはスムーズ ストリーミングでシングル ビットレートストリームを受信し、そのストリームをマルチ ビットレート ストリームにエンコードするライブ ストリーミング ワークフローを示しています。 

![ライブ ワークフロー][live-overview]

## <a id="scenario"></a>一般的なライブ ストリーミング シナリオ
以下に、一般的なライブ ストリーミング アプリケーションを作成する場合に関係する標準的な手順を示します。

> [!NOTE]
> 現在、ライブ イベントの最大推奨時間は 8 時間です。 チャネルを長時間実行する必要がある場合は、amslived@microsoft.com にお問い合わせください。 ライブ エンコードは課金に影響するため、ライブ エンコード チャネルを "実行中" 状態のままにしておくと時間料金が発生します。  余分な時間料金を課されないようにするために、ライブ ストリーミング イベントが完了したら、チャネルの実行をすぐに停止することをお勧めします。 
> 
> 

1. ビデオ カメラをコンピューターに接続します。 オンプレミスのライブ エンコーダーを起動して構成します。このエンコーダーは**シングル** ビットレート ストリームを RTMP またはスムーズ ストリーミングで出力できます。 
   
    この手順は、チャネルを作成した後でも実行できます。
2. チャネルを作成し、起動します。 
3. チャネルの取り込み URL を取得します。 
   
    取り込み URL は、ライブ エンコーダーがチャネルにストリームを送信する際に使用されます。
4. チャネルのプレビュー URL を取得します。 
   
    この URL を使用して、チャネルがライブ ストリームを正常に受信できることを確認します。
5. プログラムを作成します。 
   
    Azure Portal を使用する場合、プログラムを作成すると資産も作成されます。 
   
    .NET SDK または REST を使用する場合は、プログラムを作成するときに資産を作成し、その資産を使用するように指定する必要があります。 
6. プログラムに関連付けられた資産を発行します。   
   
    >[!NOTE]
    >AMS アカウントの作成時に、**既定**のストリーミング エンドポイントが自分のアカウントに追加され、**停止**状態になっています。 コンテンツのストリーミング元のストリーミング エンドポイントは、**実行中**状態である必要があります。 
    
7. ストリーミングとアーカイブの開始を準備するときにプログラムを開始します。
8. 必要に応じて、ライブ エンコーダーは、広告の開始を信号通知できます。 広告が出力ストリームに挿入されます。
9. イベントのストリーミングとアーカイブを停止するときにプログラムを停止します。
10. プログラムを削除し、資産を削除 (オプション) します。   

> [!NOTE]
> Live Encoding チャネルを停止し忘れないようにすることが、非常に重要です。 ライブ エンコードは時間単位の課金に影響することと、ライブ エンコード チャネルを "実行中" 状態のままにしておくと請求料金が課されることに注意してください。  余分な時間料金を課されないようにするために、ライブ ストリーミング イベントが完了したら、チャネルの実行をすぐに停止することをお勧めします。 
> 
> 

## <a id="channel"></a>チャネル入力 (取り込み) の構成
### <a id="Ingest_Protocols"></a>取り込みストリーミング プロトコル
**[Encoder Type (エンコーダーの種類)]** が **[Standard]** に設定されている場合の有効なオプションは次のとおりです。

* シングル ビットレート **RTMP**
* シングル ビットレート **Fragmented MP4** (スムーズ ストリーミング)

#### <a id="single_bitrate_RTMP"></a>シングル ビットレート RTMP
考慮事項:

* 受信ストリームには、マルチ ビットレート ビデオを含めることはできません。
* ビデオ ストリームの平均ビットレートは 15 Mbps 以下にしてください。
* オーディオ ストリームの平均ビットレートは 1 Mbps 以下にしてください。
* 次のコーデックがサポートされています。
* MPEG-4 AVC / H.264 ビデオ
* Baseline、Main、High Profile (8-bit 4:2:0)
* High 10 Profile (10-bit 4:2:0)
* High 422 Profile (10-bit 4:2:2)
* MPEG-2 AAC-LC オーディオ
* Mono、Stereo、Surround (5.1, 7.1)
* 44.1 kHz sampling rate
* MPEG-2 style ADTS packaging
* 推奨されるエンコーダーは、次のとおりです。
* Telestream Wirecast
* Flash Media Live Encoder

#### <a name="single-bitrate-fragmented-mp4-smooth-streaming"></a>シングル ビットレート Fragmented MP4 (スムーズ ストリーミング)
一般的なユース ケース:

Elemental Technologies、Ericsson、Ateme、Envivio などのベンダーのオンプレミス ライブ エンコーダーを使用して、オープン インターネットを介した入力ストリームを近くの Azure データセンターに送信します。

考慮事項:

[シングル ビットレート RTMP](media-services-manage-live-encoder-enabled-channels.md#single_bitrate_RTMP)と同じです。

#### <a name="other-considerations"></a>その他の考慮事項
* チャネルやチャネルに関連付けられたプログラムの実行中は、入力プロトコルを変更できません。 別のプロトコルが必要な場合は、入力プロトコルごとに別のチャネルを作成します。
* 受信ビデオ ストリームの最大解像度は1920x1080 で、インターレースされている場合には最大で 60 フィールド/秒、プログレッシブの場合には最大で 30 フレーム/秒です。

### <a name="ingest-urls-endpoints"></a>取り込み URL (エンドポイント)
チャネルは、ライブ エンコーダーで指定した入力エンドポイント (取り込み URL) を提供するため、エンコーダーはご使用のチャネルにストリームをプッシュできます。

チャネルを作成すると、取り込み URL を取得できます。 これらの URL を取得するために、チャネルが **実行中** 状態である必要はありません。 データをチャネルにプッシュする準備ができたら、チャネルを **実行中** 状態にする必要があります。 チャネルがデータの取り込みを開始すると、プレビュー URL 経由でストリームをプレビューできます。

Fragmented MP4 (スムーズ ストリーミング) のライブ ストリームを、SSL 接続で取り込むこともできます。 SSL 経由で取り込むには、取り込み URL を HTTPS に更新する必要があります。 なお、現在のところ、AMS ではカスタム ドメインを使用した SSL はサポートされていません。  

### <a name="allowed-ip-addresses"></a>許可された IP アドレス
このチャネルにビデオを発行できる IP アドレスを定義できます。 許可される IP アドレスは、1 つの IP アドレス (例: '10.0.0.1')、IP アドレスと CIDR サブネット マスクを使用した IP 範囲 (例: '10.0.0.1/22')、IP アドレスとピリオドで区切られた 10 進数のサブネット マスクを使用した IP 範囲 (例: '10.0.0.1(255.255.252.0)') のいずれかの形で指定できます。

IP アドレスが指定されておらず、規則の定義もない場合は、どの IP アドレスも許可されません。 すべての IP アドレスを許可するには、規則を作成し、0.0.0.0/0 に設定します。

## <a name="channel-preview"></a>チャネルのプレビュー
### <a name="preview-urls"></a>プレビュー URL
ストリームをさらに処理して配信する前にプレビューできるプレビュー エンドポイント (プレビュー URL) がチャネルから提供されます。

プレビュー URL は、チャネルの作成時に取得できます。 URL を取得するために、チャネルが **実行中** 状態である必要はありません。

チャネルがデータの取り込みを開始した後、ストリームをプレビューできます。

> [!NOTE]
> 現在、プレビュー ストリームを配信できるのは指定された入力タイプにかかわらず、Fragmented MP4 (スムーズ ストリーミング) 形式のみです。  Azure Portal でホストされているプレーヤーを使用してストリームを表示できます。
> 
> 

### <a name="allowed-ip-addresses"></a>許可された IP アドレス
プレビューのエンドポイントへの接続を許可する IP アドレスを定義できます。 IP アドレスを指定しない場合、すべての IP アドレスが許可されます。 許可される IP アドレスは、1 つの IP アドレス (例: '10.0.0.1')、IP アドレスと CIDR サブネット マスクを使用した IP 範囲 (例: '10.0.0.1/22')、IP アドレスとピリオドで区切られた 10 進数のサブネット マスクを使用した IP 範囲 (例: '10.0.0.1(255.255.252.0)') のいずれかの形で指定できます。

## <a name="live-encoding-settings"></a>Live Encoding の設定
このセクションでは、チャネルの **[Encoding Type (エンコードの種類)]** が **[Standard]** に設定されているときに、チャネル内のライブ エンコーダーの設定を調整する方法について説明します。

> [!NOTE]
> 投稿フィードには、音声トラックを 1 つだけ含めることができます。現在のところ、複数の音声トラックを取り込むことはできません。 [オンプレミス ライブ エンコード](media-services-live-streaming-with-onprem-encoders.md)でライブ エンコードするとき、複数の音声トラックを含む投稿フィードをスムーズ ストリーミングで送信できます。
> 
> 

### <a name="ad-marker-source"></a>Ad マーカー ソース
Ad マーカーの信号ソースを指定できます。 既定値は **Api** で、この場合にはチャネル内のライブ エンコーダーが**広告マーカー API** を非同期的にリッスンすることを示します。

### <a name="cea-708-closed-captions"></a>CEA 708 クローズ キャプション
受信ビデオに埋め込まれている CEA 708 キャプション データをすべて無視するようにライブ エンコーダーに指示するオプション フラグです。 このフラグが false (既定値) に設定されている場合、エンコーダーは CEA 708 データを検出し、そのデータを出力ビデオ ストリームに再び挿入します。

#### <a name="index"></a>Index
シングル プログラム トランスポート ストリーム (SPTS) で送信することをお勧めします。 入力ストリームに複数のプログラムが含まれている場合、チャネル内のライブ エンコーダーは、入力でプログラム マップ テーブル (PMT) を解析し、ストリーム種類名が MPEG-2 AAC ADTS、AC-3 System-A、AC-3 System-B、MPEG-2 プライベート PES、MPEG-1 オーディオ、MPEG-2 オーディオの入力を特定し、PMT で指定された順序に配置します。 次に 0 から始まるインデックスを使用して、その配置内の n 番目のエントリを選択します。

#### <a name="language"></a>言語
ISO 639-2 に準拠している、オーディオ ストリームの言語識別子 (例: ENG)。 存在しない場合の既定値は UND (未定義) です。

### <a id="preset"></a>システム プリセット
このチャネル内のライブ エンコーダーが使用するプリセットを指定します。 現在、唯一の許容されている値は **Default720p** (既定値) です。

カスタム プリセットが必要な場合は、amslived@microsoft.com にお問い合わせください。

**Default720p** は次の 7 つのレイヤーにビデオをエンコードします。

#### <a name="output-video-stream"></a>出力ビデオ ストリーム
| ビットレート | 幅 | 高さ | 最大 FPS | プロファイル | 出力ストリーム名 |
| --- | --- | --- | --- | --- | --- |
| 3500 |1280 |720 |30 |高 |Video_1280x720_3500kbps |
| 2200 |960 |540 |30 |メイン |Video_960x540_2200kbps |
| 1350 |704 |396 |30 |メイン |Video_704x396_1350kbps |
| 850 |512 |288 |30 |メイン |Video_512x288_850kbps |
| 550 |384 |216 |30 |メイン |Video_384x216_550kbps |
| 350 |340 |192 |30 |ベースライン |Video_340x192_350kbps |
| 200 |340 |192 |30 |ベースライン |Video_340x192_200kbps |

#### <a name="output-audio-stream"></a>出力オーディオ ストリーム
オーディオは、ステレオの 64 kbps で AAC-LC に、サンプリング レート 44.1 kHz でエンコードされます。

## <a name="signaling-advertisements"></a>広告の信号通知
Live Encoding が有効なチャネルがある場合、パイプライン内のコンポーネントでビデオを処理し、操作することができます。 チャネルに対して、スレートまたは広告 (あるいはその両方) を発信アダプティブ ビットレート ストリームに挿入するように信号を発信できます。 スレートは静止画像で、(コマーシャルの時間など) 特定のケースで入力ライブ フィードに被せるために使用できます。 広告信号は、発信ストリームに埋め込む同期信号で、ビデオ プレイヤーに対して特別なアクションを実行するよう命令します。たとえば、適切な時間に広告に切り替えるなどのアクションです。 このために使用する SCTE-35 信号メカニズムの概要については、こちらの[ブログ](https://codesequoia.wordpress.com/2014/02/24/understanding-scte-35/)をご覧ください。 ライブ イベントに実装できる一般的なシナリオを以下に示します。

1. イベント開始前に、イベント前イメージを視聴者が取得するようにします。
2. イベント終了後に、イベント後イメージを視聴者が取得するようにします。
3. (スタジアムの電源障害など) イベント中に問題が生じる場合に、エラー イベント イメージを視聴者が取得するようにします。
4. コマーシャルによる中断期間に、ライブ イベントを非表示にする広告中断イメージを送信します。

広告信号を発信する際に設定可能なプロパティを以下に記します。 

### <a name="duration"></a>時間
コマーシャルで中断する時間 (秒) です。 コマーシャルを開始するには、この値を 0 以外の正の値にします。 コマーシャルで中断している場合に、現在のコマーシャルによる中断期間と一致する CueId を指定して時間を 0 に設定すると、対象のコマーシャル期間がキャンセルされます。

### <a name="cueid"></a>CueId
ダウンストリームのアプリケーションが適切なアクションを実行するために使用する、コマーシャルによる中断期間の一意の ID。 正の整数にする必要があります。 この値をランダムな正の整数に設定したり、アップストリームを使用して CueID を追跡したりできます。 API を介して送信する前に、ID を正の整数に必ず正規化してください。

### <a name="show-slate"></a>スレートの表示
省略可能。 コマーシャルによる中断期間に [既定のスレート](media-services-manage-live-encoder-enabled-channels.md#default_slate) イメージに切り替えて受信ビデオ フィードを非表示にするようにライブ エンコーダーに信号通知します。 スレートの際には、オーディオもミュートされます。 既定値は **false**です。 

使用されるイメージは、チャネル作成時に既定のスレート資産 ID プロパティで指定したイメージです。 スレートは、ディスプレイのイメージ サイズに合わせて拡大縮小されます。 

## <a name="insert-slate--images"></a>スレート イメージの挿入
チャネル内のライブ エンコーダーは、スレート イメージに切り替えるように信号通知できます。 使用中のスレートを終了するように信号通知することもできます。 

ライブ エンコーダーを、スレート イメージに切り替えて、広告による中断期間など特定の状況で受信ビデオ信号を非表示にするよう構成できます。 そうしたスレートが構成されていない場合、広告による中断期間中に入力ビデオはマスクされません。

### <a name="duration"></a>時間
スレートの時間 (秒) です。 スレートを開始するには、この値を 0 以外の正の値にします。 使用中のスレートがある場合、時間が 0 に設定されると、現在使用中のスレートが終了します。

### <a name="insert-slate-on-ad-marker"></a>Ad マーカーへのスレートの挿入
この設定を true にすると、広告による中断期間中にライブ エンコーダーがスレート イメージを挿入するように構成されます。 既定値は true です。 

### <a id="default_slate"></a>既定のスレート アセット ID

省略可能。 スレート イメージが含まれる Media Services 資産の資産 ID を指定します。 既定値は Null です。 


>[!NOTE] 
>チャネルを作成する前に、次の制約があるスレート画像を専用資産としてアップロードする必要があります (他のファイルはこの資産に含めないでください)。 このイメージは、ライブ エンコーダーが広告中断のためにスレートを挿入する場合、またはスレートを挿入するように明示的に信号通知された場合にのみ使用されます。 また、特定のエラー条件 (入力信号が見つからないなど) の発生中にライブ エンコーダーをスレート モードに切り替えることもできます。 現時点では、ライブ エンコーダーが '入力信号が見つからない' などの状態になったときにカスタム イメージを使用するオプションはありません。 [こちら](https://feedback.azure.com/forums/169396-azure-media-services/suggestions/10190457-define-custom-slate-image-on-a-live-encoder-channel)でこの機能に投票することができます。


* 最大解像度 1920x1080。
* 最大サイズ 3 MB。
* ファイル名の拡張子は *.jpg である必要があります。
* イメージを資産の唯一の AssetFile として資産にアップロードし、この AssetFile をプライマリ ファイルとしてマークする必要があります。 この資産を暗号化ストレージにすることはできません。

既定の **[スレートの資産 ID]** が指定されていない場合、**[広告マーカーへのスレートの挿入]** が **true** に設定されていると、入力ビデオ ストリームを非表示にするために既定の Azure Media Services イメージが使用されます。 スレートの際には、オーディオもミュートされます。 

## <a name="channels-programs"></a>チャネルのプログラム
チャネルは、ライブ ストリームのセグメントの発行と保存を管理できるプログラムに関連付けられています。 プログラムはチャネルによって管理されます。 チャネルとプログラムの関係は、従来のメディアとよく似ています。チャネルが絶えずコンテンツのストリームを配信するのに対し、プログラムは、そのチャネル上で決まった時間に生じるイベントです。

プログラムの **アーカイブ ウィンドウ** の長さを設定することで、録画されたコンテンツの保持時間を指定できます。 この値は、最小 5 分から最大 25 時間までの範囲で設定できます。 クライアントが現在のライブ位置からさかのぼって検索できる最長時間も、Archive Window (アーカイブ ウィンドウ)の長さによって決まります。 プログラムの放送は、指定された期間継続しますが、ArchiveWindowLength を過ぎたコンテンツは絶えず破棄されていきます。 さらに、このプロパティの値によって、クライアント マニフェストが肥大した場合の最大サイズも決まります。

各プログラムは、ストリーミングされたコンテンツを格納する資産に関連付けられます。 資産は Azure Storage アカウント内のブロック BLOB コンテナーにマップされ、資産内のファイルは BLOB としてそのコンテナーに格納されます。 プログラムを発行して顧客がストリームを表示できるようにするには、関連付けられた資産の OnDemand ロケーターを作成する必要があります。 このロケーターを作成すると、ストリーミング URL を構築してクライアントに提供できます。

チャネルは、最大 3 つの同時実行プログラムをサポートするため、同じ受信ストリームのアーカイブを複数作成できます。 これにより、1 つのイベントのさまざまな部分を必要に応じて発行したりアーカイブしたりできます。 たとえば、ビジネス要件によって 1 つのプログラムの 6 時間分をアーカイブする一方、最後の 10 分間のみをブロードキャストする場合があります。 これを実現するには、2 つの同時実行プログラムを作成する必要があります。 1 つのプログラムは 6 時間分のイベントをアーカイブするように設定しますが、プログラムは発行されません。 もう 1 つのプログラムは 10 分間のアーカイブを行うように設定します。このプログラムは発行されます。

新しいイベントには既存のプログラムを再使用できません。 代わりに、「ライブ ストリーミング アプリケーションのプログラミング」セクションにあるように、各イベントで新しいプログラムを作成し、起動します。

ストリーミングとアーカイブの開始を準備するときにプログラムを開始します。 イベントのストリーミングとアーカイブを停止するときにプログラムを停止します。 

アーカイブ済みコンテンツを削除するには、プログラムを停止して削除し、次に関連付けられた資産を削除します。 プログラムが資産を使用している場合は資産を削除できません。まずプログラムを削除する必要があります。 

プログラムを停止して削除した後も、資産を削除していなければアーカイブ済みコンテンツをオンデマンドでのビデオとしてストリームできます。

アーカイブ済みコンテンツを保持したいが、ストリーミングには使用したくない場合は、ストリーミング ロケーターを削除します。

## <a name="getting-a-thumbnail-preview-of-a-live-feed"></a>ライブ フィードの縮小表示プレビューを取得する
Live Encoding が有効な場合は、ライブ フィードがチャネルに到達するとそのプレビューを取得できます。 これは、ライブ フィードがチャネルに実際に到達しているかどうかを確認するための重要なツールとなります。 

## <a id="states"></a>チャネルの状態と課金モードとの対応
現在のチャネルの状態。 指定できる値は、次のとおりです。

* **停止済み**。 これは、チャネル作成後の初期状態です。 この状態で、チャネルのプロパティを更新できますが、ストリーミングは許可されていません。
* **開始中**。 チャネルを開始しています。 この状態の場合、更新やストリーミングはできません。 エラーが発生した場合は、チャネルは Stopped 状態に戻ります。
* **実行中**。 チャネルは、ライブ ストリームを処理できます。
* **停止中**。 チャネルを停止しています。 この状態の場合、更新やストリーミングはできません。
* **削除中**。 チャネルが削除されました。 この状態の場合、更新やストリーミングはできません。

次の表は、チャネルの状態と課金モードとの対応を示しています。 

| チャネルの状態 | ポータル UI インジケーター | 課金対象 |
| --- | --- | --- |
| 開始中 |開始中 |いいえ (遷移状態) |
| 実行中 |準備完了 (実行中プログラムなし)<br/>または<br/>ストリーミング (実行中プログラムが最低 1 つ存在) |はい |
| 停止中 |停止中 |いいえ (遷移状態) |
| 停止済み |停止済み |いいえ  |

> [!NOTE]
> 現時点では、チャネルの開始の平均は約 2 分ですが、20 分以上かかる場合もあります。 チャネルのリセットには、最大で 5 分かかります。
> 
> 

## <a id="Considerations"></a>考慮事項
* **標準** エンコーディング タイプのチャネルで入力ソース/投稿フィードが失われるとき、ソース ビデオ/オーディオをエラー スレートと無音で置換し、補います。 入力/投稿フィードが再開するまで、チャネルはスレートの送信を続けます。 ライブ チャネルを 2 時間以上このような状態にしないことをお勧めします。 2 時間を超えると、入力再接続時のチャネルの動作が保証されず、リセット コマンドに対する応答の動作も保証されません。 チャネルを停止し、削除し、新しいものを作成する必要があります。
* チャネルやチャネルに関連付けられたプログラムの実行中は、入力プロトコルを変更できません。 別のプロトコルが必要な場合は、入力プロトコルごとに別のチャネルを作成します。
* ライブ エンコーダーを再構成する際は、毎回チャネルで **Reset** メソッドを呼び出します。 チャネルをリセットする前に、プログラムを停止する必要があります。 チャネルをリセットしたら、プログラムを再起動します。
* チャネルを停止できるのは実行中の状態で、チャネルのすべてのプログラムが停止しているときのみです。
* 既定では、Media Services アカウントに追加できるチャネル数は 5 つのみです。 これは、すべての新しいアカウントに関するソフト クォータです。 詳しくは、「 [クォータと制限](media-services-quotas-and-limitations.md)」をご覧ください。
* チャネルやチャネルに関連付けられたプログラムの実行中は、入力プロトコルを変更できません。 別のプロトコルが必要な場合は、入力プロトコルごとに別のチャネルを作成します。
* チャネルが **実行中** 状態のときにのみ課金されます。 詳しくは、 [こちら](media-services-manage-live-encoder-enabled-channels.md#states) のセクションを参照してください。
* 現在、ライブ イベントの最大推奨時間は 8 時間です。 チャネルを長時間実行する必要がある場合は、amslived@microsoft.com にお問い合わせください。
* コンテンツのストリーミング元のストリーミング エンドポイントが**実行中**状態であることを確認してください。
* エンコードのプリセットでは、「最大フレーム レート」 30 fps の概念が使用されます。 したがって、入力が 60fps/59.94i の場合、入力フレームは 30/29.97 fps にドロップ/インターレース解除されます。 入力が 50fps/50i の場合は、入力フレームは 25 fps にドロップ/インターレース解除されます。 入力が 25 fps の場合は、出力は 25 fps のままです。
* 終了したら、忘れずにチャネルを停止してください。 そうしないと、課金が続行されます。

## <a name="known-issues"></a>既知の問題
* チャネルの起動時間は、改善されて平均 2 分になりましたが、要求が多いときには、まだ 20 分以上かかる場合もあります。
* スレート イメージは、 [こちら](media-services-manage-live-encoder-enabled-channels.md#default_slate)で説明した制限に準拠する必要があります。 1920 x 1080 を超える既定のスレートでチャネルを作成しようとすると、要求は最終的にエラーになります。
* 繰り返しますが、ストリーミングを終えたら、忘れずにチャネルを停止してください。 そうしないと、課金が続行されます。

## <a name="next-step"></a>次のステップ
Media Services のラーニング パスを確認します。

[!INCLUDE [media-services-learning-paths-include](../../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a>フィードバックの提供
[!INCLUDE [media-services-user-voice-include](../../../includes/media-services-user-voice-include.md)]

## <a name="related-topics"></a>関連トピック
[Azure Media Services を使用してライブ ストリーミング イベントを配信する](media-services-overview.md)

[ポータルでシングル ビットレートからアダプティブ ビットレート ストリームへのライブ エンコードを実行するチャネルを作成する](media-services-portal-creating-live-encoder-enabled-channel.md)

[.NET SDK でシングル ビットレートからアダプティブ ビットレート ストリームへのライブ エンコードを実行するチャネルを作成する](media-services-dotnet-creating-live-encoder-enabled-channel.md)

[REST API でチャネルを管理する](https://docs.microsoft.com/rest/api/media/operations/channel)
 
[Media Services の概念](media-services-concepts.md)

[Azure Media Services の Fragmented MP4 ライブ インジェスト仕様](media-services-fmp4-live-ingest-overview.md)

[live-overview]: ./media/media-services-manage-live-encoder-enabled-channels/media-services-live-streaming-new.png

