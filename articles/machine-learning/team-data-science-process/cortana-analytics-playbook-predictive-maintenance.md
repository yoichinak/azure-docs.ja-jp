---
title: 予測メンテナンス ソリューションのための Azure AI ガイド | Microsoft Docs
description: 複数の垂直的業界向けのメンテナンス ソリューションを実現するデータ サイエンスについて包括的に説明します。
services: machine-learning
author: fboylu
manager: cgronlun
editor: ''
ms.assetid: 2e8b66db-91eb-432b-b305-6abccca25620
ms.service: machine-learning
ms.component: team-data-science-process
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/11/2018
ms.author: fboylu
ms.openlocfilehash: 816ba560ccb9b06414dff8ffaea054e88d216b10
ms.sourcegitcommit: f606248b31182cc559b21e79778c9397127e54df
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/12/2018
ms.locfileid: "38972385"
---
# <a name="azure-ai-guide-for-predictive-maintenance-solutions"></a>予測メンテナンス ソリューションのための Azure AI ガイド

## <a name="summary"></a>まとめ

予測メンテナンス (**PdM**) は、人気の高い予測分析の応用技術です。さまざまな業界のビジネスにおいて、資産の高使用率や運用コストの節約を実現するのに役立ちます。 このガイドでは、[Microsoft Azure AI プラットフォーム](https://azure.microsoft.com/overview/ai-platform)のテクノロジを使用して PdM ソリューションの開発と展開を成功させるための、ビジネス上のガイドラインと分析ガイドライン、およびベスト プラクティスがまとめられています。

最初に、業界特有のビジネス シナリオと、これらのシナリオを PdM に当てはめるプロセスについて紹介します。 PdM ソリューションを構築するためのデータ要件とモデリング手法についても説明します。 このガイドのメイン コンテンツはデータ サイエンスのプロセスです。これには、データの準備、特徴エンジニアリング、モデルの作成、モデルの運用化などの手順が含まれます。 これらの重要な概念を補完するために、このガイドでは PdM アプリケーションの開発を加速させる一連のソリューション テンプレートを列挙しています。 また、データ サイエンスの背後にある AI 技術について、実務者がより深く学習するのに役立つトレーニング用リソースも示されています。 

### <a name="data-science-guide-overview-and-target-audience"></a>データ サイエンス ガイドの概要と対象読者
このガイドの前半では、典型的なビジネス上の問題と、その対処として PdM を実装することの利点について説明し、一般的なユース ケースをいくつか紹介します。 この内容は管理職意思決定者 (BDM) にとって有益です。 後半では、PdM の背後にあるデータ サイエンスについて説明し、PdM ソリューションのリストを示します。これらは、このガイド内で説明した原則によって構築されたものです。 また、ラーニング パスやトレーニング資料のヒントも示しています。 この内容は技術的意思決定者 (TDM) にとって有益です。

| どこから始めるか | 対象者 |
|:---------------|:---------------|
| [予測メンテナンスのためのビジネス ケース](#Business-case-for-predictive-maintenance) |ダウンタイムと運用コストの削減や、機器の使用率の向上を目指している管理職意思決定者 (BDM) |
| [予測メンテナンスのためのデータ サイエンス](#Data-Science-for-predictive-maintenance) |予測メンテナンスに必要な固有のデータ処理や AI 技術を理解するために、PdM テクノロジを評価している技術的意思決定者 (TDM) |
| [予測メンテナンスのためのソリューション テンプレート](#Solution-templates-for-predictive-maintenance)|デモや概念実証のすばやい立ち上げを目指している、ソフトウェア設計担当者または AI 開発者 |
| [予測メンテナンスのためのトレーニング リソース](#Training-resources-for-predictive-maintenance) | 上記の対象者すべて、または、データ サイエンス、ツール、および手法の背後にある基本概念について関心のある学習者

### <a name="prerequisite-knowledge"></a>前提条件となる知識
BDM 用のコンテンツでは、読者がデータ サイエンスの予備知識を持っていないことを想定しています。 TDM 用のコンテンツでは、統計学やデータ サイエンスの基本的な知識があると役立ちます。 Azure のデータ サービスと AI サービス、Python、R、XML、および JSON の知識が推奨されます。 AI の手法は Python と R のパッケージで実装されます。 ソリューション テンプレートは、Azure サービス、開発ツール、SDK を使用して実装されます。

## <a name="business-case-for-predictive-maintenance"></a>予測メンテナンスのためのビジネス ケース

ビジネスにおいては、クリティカルな機器に対する設備投資の利益を実現するために、それらを最大の効率と使用率で実行させる必要があります。 航空機エンジン、タービン、エレベーター、工業用冷却装置などの数百万ドルの投資から、コピー機、コーヒー メーカー、冷水器などの日常的な機器まで、さまざまな資産を考えることができます。
- 通常、ほとんどの企業では、部品が故障したら交換するという "_是正メンテナンス_" が採用されています。 是正メンテナンスでは、部品は必ず最後まで使用されます (したがってコンポーネントの寿命に無駄が生じません)。ただし、ダウンタイムや人件費、(勤務時間外や不都合な場所での) 予期しないメンテナンスの発生によって、ビジネスに損失が発生します。
- 次のレベルとして、企業は "_予防保全_" を実践します。これは、部品の耐用年数を定めて、故障する前にメンテナンスまたは交換を行う方法です。 予防保全では、予期しない故障や致命的な故障を回避できます。 ただし、スケジュールされたダウンタイム、寿命をフルで使い切らないことによるコンポーネント使用率の低さ、および人件費のコストは、高くついたままです。
- "_予測メンテナンス_" の目的は、コンポーネントの "_ジャスト イン タイム_" な交換を可能にすることで、是正メンテナンスと予防保全の間のバランスを最適化することです。 この方法では、障害が近づいた場合にのみこれらのコンポーネントを交換します。 (予防保全と比べて) コンポーネントの寿命が延び、(是正メンテナンスと比べて) 予期しないメンテナンスと作業のコストが減少します。これにより、企業はコストの節約と競争優位性を獲得できます。

## <a name="business-problems-in-pdm"></a>PdM でのビジネスの問題
企業は、予期しない障害や、複雑なシステムにおける問題の根本原因の洞察不足に起因する、高い運用リスクに直面しています。 主要なビジネス上の課題の一部を次に示します。

- 機器の異常や、システムのパフォーマンスまたは機能の異常を検出する。
- 近い将来に資産に障害が発生する可能性を予測する。
- 資産の残存耐用年数を見積もる。
- 資産の障害の主な原因を特定する。
- 資産に対して、どのようなメンテナンス操作が、いつまでに必要か特定する。

PdM が掲げる一般的な目標は次のとおりです。

- ミッション クリティカルな機器の運用リスクを軽減する。
- 障害を事前に予測することで、資産の投資収益率を向上させる。
- Just-In-Time な保守操作を可能にすることで、保守のコストを制御する。
- 顧客離れを減少させ、ブランド イメージを改善し、売り上げの低下を防ぐ。
- 再発注点を予測して在庫レベルを減らすことで、在庫コストを削減する。
- さまざまなメンテナンスの問題に関連するパターンを発見する。
- 資産状態の正常性スコアなどの KPI (主要業績評価指標) を提供する。
- 資産の残存する寿命を見積もる。
- 適切なタイミングでメンテナンス作業を推奨する。
- 部品交換の発注日を見積もることで、Just In Time なインベントリを可能にする。

これらの目標が開始点となる対象者は、次のとおりです。

- 特定の予測問題の分析と解決に取り組む "_データ サイエンティスト_"。
- エンド ツー エンド ソリューションの作成に取り組む "_クラウドの設計者や開発者_"。

## <a name="qualifying-problems-for-predictive-maintenance"></a>予測メンテナンスに適した問題
すべてのユース ケースまたはビジネス上の問題を PdM によって効果的に解決できるわけではないことに注意してください。 問題を選択する際には、3 つの重要な適格条件を考慮する必要があります。

- 問題が本質的に予測可能であることが必要です。つまり、予測するターゲットや結果が存在する必要があります。 また、問題を検出した場合に、障害を回避するための対策の流れが、明確に決まっている必要があります。
- 問題には、"_良い結果と悪い結果の両方_" を含む、機器の操作履歴の記録が含まれている必要があります。 悪い結果を軽減するための一連の対策も、これらの記録の一部として含まれている必要があります。 エラー レポート、パフォーマンスの低下のメンテナンス ログ、修復、および交換のログも重要です。 さらに、それらを改善するために取り組んだ修復、および交換の記録も役立ちます。
- 記録された履歴は、ユース ケースをサポートするのに "_十分な_" 品質の "_関連_" データ内に反映されている必要があります。 データの関連性と充足性について詳しくは、[予測メンテナンスのためのデータ要件](#Data-requirements-for-predictive-maintenance)に関する記事をご覧ください。
- 最後に、その問題を明確に理解しているドメインの専門家が企業にいる必要があります。 専門家は、内部の処理や実務に通じており、アナリストがデータを理解し解釈するための助けになることができる必要があります。 また、問題の正しいデータを収集するために、必要に応じて既存のビジネス プロセスに必要な変更を加えることができる必要があります。

## <a name="sample-pdm-use-cases"></a>サンプル PdM ユース ケース
このセクションでは、航空宇宙業界、公共事業、輸送など、いくつかの業界における PdM のユース ケース集を示します。 各セクションはビジネス上の問題から始まります。続いて PdM の利点、問題を取り巻く関連データ、最後に PdM ソリューションの利点について説明します。

| ビジネス上の問題 | PdM で得られる利点 |
|:-----------------|-------------------|
|**航空**      |                   |
|機械的な問題による "_フライトの遅延と欠航_"。 すぐに修復できない障害が発生すると、フライトが欠航され、スケジュールと運用に混乱が生じる可能性があります。 |PdM ソリューションでは、機械的な問題によって航空機が遅延または欠航する確率を予測できます。|
|_航空機エンジン部品の故障_: 航空機エンジンの部品交換は、航空業界で最も一般的なメンテナンス タスクの 1 つです。 メンテナンス ソリューションでは、在庫部品の可用性、輸送、計画について、慎重に管理する必要があります。|コンポーネントの信頼性に関する情報を収集できることは、投資コストの大幅な削減につながります。|
|**ファイナンス** |                         |
|"_ATM の故障_" は銀行業界内でよく発生する問題です。 ここでの問題は、キャッシュ ディスペンサー内の紙詰まりや部品の故障などによって、ATM の現金引き出しトランザクションが中断される確率を予測することです。 トランザクションの障害を事前に予測することで、障害が発生しないように事前に ATM を補修できます。| トランザクションの途中で機械が故障してしまうよりも、予測に基づいて適宜サービスを拒否するように ATM をプログラムする方が望ましい動作です。|
|**エネルギー** |                          |
|_風力タービンの故障_: 風力タービンは、環境に配慮した国にとって主力となるエネルギー源であり、高い資本コストを伴います。 風力タービンの主要なコンポーネントは、発電機です。 発電機が故障するとタービンは効果を失います。 また、その修理は非常に高くつきます。|MTTF (平均故障時間) などの KPI を予測することは、エネルギー企業がタービンの故障を回避し、ダウンタイムを最小限に抑えるのに役立ちます。 故障の確率を示すことによって、技術者はもうすぐ故障しそうなタービンを監視し、時間ベースのメンテナンス体制を敷くことができます。 予測モデルによって、故障のさまざまな要因に対する洞察が得られます。これは、技術者が問題の根本原因をより深く理解するのに役立ちます。|
|_サーキット ブレーカーの故障_: 家庭や企業への電力供給においては、エネルギーの配給を途切れさせないために、電気系統を常に動作させている必要があります。 過負荷が発生した場合や悪天候の際に、サーキット ブレーカーによって電気系統へのダメージを制限または回避できます。 ここでのビジネス上の問題は、サーキット ブレーカーの故障を予測することです。| PdM ソリューションにより、サーキット ブレーカーなどの機器の修理費用を削減し、その寿命を延ばすことができます。 また、予期しない故障やサービスの中断を減らすことによって、電力ネットワークの品質を高めることができます。|
|**輸送と物流** |    |
|_エレベーターのドアの故障_: 大規模なエレベーター会社は、世界中で稼働している何百万基ものエレベーターに複合的なサービスを提供しています。 顧客の主な懸念事項は、エレベーターの安全性、信頼性、稼働時間です。 エレベーター会社は、これらを含むさまざまな属性をセンサーによって追跡し、是正メンテナンスや予防保全に役立てます。 顧客が遭遇する最も顕著な問題は、エレベーターのドアの故障です。 この事例におけるビジネス上の問題は、ドアが故障する潜在的な原因を予測する、知識ベースの予測型アプリケーションを備えることです。| エレベーターは、20 ～ 30 年間の稼働を見込める設備投資です。 したがって、各販売における競争が激化する可能性があり、サービスやサポートに対する期待も高くなります。 エレベーター会社は、予測メンテナンスを使用することにより、製品とサービスの提供において競合他社よりも優位に立つことができます。|
|_車輪の故障_: 電車の脱線の半数が車輪の故障によるもので、鉄道産業全体に数十億の損失が生じます。 また、車輪の故障は鉄道を老朽化させ、鉄道の機能不全の原因になることも少なくありません。 鉄道の故障は、脱線などの致命的な事故に繋がります。 このような事故を避けるために、鉄道会社は車輪のパフォーマンスを監視し、予防的にそれらを交換します。 ここでのビジネス上の問題は、車輪の故障の予測です。| 車輪の予測メンテナンスは、Just-In-Time の車輪の交換に役立ちます。 |
|_地下鉄電車のドアの故障_: 地下鉄運営の遅延の主な理由は、車両のドアの故障です。 ここでのビジネス上の問題は、電車のドアの故障を予測することです。|ドア故障の早期認識 (ドア故障までの日数の予測) によって、電車のドア機能スケジュールを最適化できます。|

次のセクションでは、上記で説明した PdM のメリットを享受する方法を詳しく説明します。

## <a name="data-science-for-predictive-maintenance"></a>予測メンテナンスのためのデータ サイエンス

このセクションでは、PdM のデータ サイエンスの原則と実践の一般的なガイドラインを示します。 これにより、TDM、ソリューション アーキテクト、開発者は、PdM 向けのエンド ツー エンドの AI アプリケーションを構築するための前提条件とプロセスを理解できます。 このセクションは、「[予測メンテナンスのためのソリューション テンプレート](#Solution-templates-for-predictive-maintenance)」に記載されたデモと概念実証のテンプレート共に読み進められます。 これらの原則とベスト プラクティスを使用して、Azure に PdM ソリューションを実装できます。

> [!NOTE]
> このガイドは、データ サイエンスについて学ぶためのものではありません。 役立つソースについては、以降の「[予測メンテナンスのためのトレーニング リソース](#Training-resources-for-predictive-maintenance)」のセクションをご覧ください。 ガイドに記載された[ソリューション テンプレート](#Solution-templates-for-predictive-maintenance)では、特定の PdM の問題に対する一部の AI 手法を紹介しています。

## <a name="data-requirements-for-predictive-maintenance"></a>予測メンテナンスのためのデータ要件

ラーニングの成功は、(a) 学習内容の質、(b) 学習者の能力に依存します。 予測モデルは履歴データからパターンを学習し、これらの観察されたパターンに基づいて特定の確率によって将来の結果を予測します。 モデルの予測正確度は、トレーニングとテスト データの関連性、充足性、および質に依存します。 このモデルを使用して "スコア付け" された新しいデータには、トレーニング/テスト データと同じ特徴とスキーマが必要です。 新しいデータの機能特性 (型、密度、分布など) は、トレーニングとテスト データ セットの特性と一致する必要があります。 このセクションでは、このようなデータ要件に重点を置いています。

### <a name="relevant-data"></a>関連データ

最初に、データには "_問題との関連性_" が必要です。 前で説明した "_車輪の故障_" ユース ケースでは、トレーニング データには車輪操作に関連する特徴を含める必要があります。 問題が "_牽引システム_" の故障を予測することであった場合、トレーニング データは牽引システムのさまざまなコンポーネントすべてを含む必要があります。 最初のケースの対象は特定のコンポーネントで、2 番目のケースの対象はより大規模なサブシステムの故障です。 一般的な推奨事項として、より大きなサブシステムではなく特定のコンポーネントに関する予測システムを設計します。より大きなサブシステムのデータはより分散しているためです。 ドメイン専門家の手を借りて (「[予測メンテナンスに適した問題](#Qualifying-problems-for-predictive-maintenance)」を参照)、分析用の最も関連性の高いデータのサブセットを選択する必要があります。 関連するデータ ソースについて詳しくは、「[予測メンテナンスのデータの準備](#Data-preparation-for-predictive-maintenance)」をご覧ください。

### <a name="sufficient-data"></a>十分なデータ
故障の履歴データに関する一般的な質問として、(1) "モデルのトレーニングに必要なエラー イベントの数はどのくらいか"、 (2) "十分と考えられるレコードの数はどのくらいか" というものがあります。明確な回答はありませんが、原則があります。 (1) については、故障イベントの数が多ければ多いほど、モデルが向上します。 (2) については、故障イベントの正確な数は、解決される問題のデータとコンテキストに依存します。 その一方で、マシンの故障頻度が高く、企業でそれを交換した場合、故障インスタンスは減ります。 ここでも、ドメインの専門家からガイダンスが重要になります。 ただし、"_頻度の低いイベント_" に対処するための方法があります。 詳しくは、「[偏ったデータの処理](#Handling-imbalanced-data)」を参照してください。

### <a name="quality-data"></a>高品質なデータ
データの品質は重要です。各予測属性の値は、ターゲット変数の値と組み合わせて "_正確_" である必要があります。 データの品質は統計とデータ管理におけるよく研究された分野であるため、このガイドでは説明しません。

> [!NOTE]
> 高品質なデータを提供するいくつかのリソースや企業向け製品があります。 参考資料のサンプルを以下に紹介します。
> - Dasu, T, Johnson, T., Exploratory Data Mining and Data Cleaning, Wiley, 2003.
> - [Exploratory Data Analysis, Wikipedia](https://en.wikipedia.org/wiki/Exploratory_data_analysis)
> - [Hellerstein, J, Quantitative Data Cleaning for Large Databases](http://db.cs.berkeley.edu/jmh/papers/cleaning-unece.pdf)
> - [de Jonge, E, van der loo, M, Introduction to Data Cleaning with R](https://cran.r-project.org/doc/contrib/de_Jonge+van_der_Loo-Introduction_to_data_cleaning_with_R.pdf)

## <a name="data-preparation-for-predictive-maintenance"></a>予測メンテナンスのためのデータの準備

### <a name="data-sources"></a>データ ソース

予測メンテナンス用の関連データ ソースには次のようなものがありますが、これらに限定されるものではありません。
- 障害の履歴
- メンテナンス/修理履歴
- マシンの運転状況
- 機器のメタデータ

#### <a name="failure-history"></a>障害の履歴
故障イベントは、PdM アプリケーションでは稀です。 ただし、予測モデルを構築するときに、アルゴリズムはコンポーネントの通常の運用パターンと、その故障パターンについて学習する必要があります。 したがって、トレーニング データには、両方のカテゴリからの十分な数の例が必要です。 メンテナンス レコードと部品の交換履歴は、故障イベントを見つけるのに最適なソースです。 一部のドメイン専門家の知識を借りて、トレーニング データの異常を故障として定義することもできます。

#### <a name="maintenancerepair-history"></a>メンテナンス/修理履歴
資産のメンテナンス履歴には、交換されたコンポーネント、実施された修理アクティビティに関する詳細が含まれています。これらのイベントは、パフォーマンス低下のパターンを記録します。 トレーニング データにこの重要な情報がない場合は、モデルの結果が不適切になる可能性があります。 故障履歴は、メンテナンス履歴内にも特別なエラー コードまたは部品の発注日として確認できます。 ドメイン専門家によって、故障パターンに影響するその他のデータ ソースが調査され提供される必要があります。

#### <a name="machine-operating-conditions"></a>マシンの運転状況
運転中の機器のセンサー ベース (またはその他の) ストリーミング データは、重要なデータ ソースです。 PdM の重要な想定は、マシンの正常性状態が定常運転中に徐々に低下するというものです。 データには時間とともに変化する特徴が含まれることが想定され、これにより、この老朽化パターンや、劣化につながる異常を把握できます。 アルゴリズムはデータの一時的な側面を使用して、時間の経過に伴う故障パターンと故障ではないパターンを学習します。 これらのデータ ポイントに基づいて、アルゴリズムは、マシンが故障するまであとどれくらいの時間単位、稼働を続けられるかを予測することを学習します。

#### <a name="static-feature-data"></a>静的な特徴のデータ
静的な特徴は、機器に関するメタデータです。 たとえば、機器の製造元、モデル、製造日、サービスの開始日、システムの場所、技術仕様などがあります。

[サンプル PdM ユース ケース](#Sample-PdM-use-cases)の関連データの例を以下に示します。

| ユース ケース | 関連データの例 |
|:---------|---------------------------|
|_フライトの遅延と欠航_ | 飛行区間とページ ログの形式の飛行経路情報。 飛行区間データには、発着の日付、時刻、空港、乗り継ぎなど、経路の詳細が含まれています。ページ ログには、グランド メンテナンス担当者が記録した一連の故障コードやメンテナンス コードがあります。|
|_航空機エンジン部品の故障_ | 航空機のセンサーによって収集されたデータでは、さまざまな部分の状態に関する情報が提供されます。 メンテナンス レコードを使用して、コンポーネントの故障や交換がいつ発生したかを特定できます。|
|_ATM の故障_ | 各トランザクション (現金/小切手の預金) や現金支払いのセンサーの読み取り値。 現金、厚さ、現金到着までの距離間の差の計測値に関する情報。エラー コード、修理情報、現金自動支払機が最後に補充された時刻を提供するメンテナンス レコード。|
|_風力タービンの故障_ | センサーは、温度、風向き、生成されたエネルギー、発電機の速度など、タービンの状態を監視します。データは、さまざまな地域に置かれた風力発電所の複数の風力タービンから収集されます。 通常、各タービンでは、複数のセンサーによって一定の時間間隔で継電測定値が読み取られます。|
|_ブレーカーの故障_ | 是正・予防措置や組織的な対策を含むメンテナンス ログ。 ブレーカーに送信される自動および手動コマンド (開く操作、閉じる操作など) を含むオペレーショナル データ。 デバイスのメタデータ (製造日、場所、モデルなど)。ブレーカーの仕様 (電圧レベル、位置情報、環境条件など)。|
|_エレベーターのドアの故障_| エレベーターのメタデータ (エレベーターの種類、製造日、メンテナンスの頻度、ビルの種類など)。 運用情報 (ドア サイクル数、ドアが閉まっている平均時間など)。 原因が記載された故障履歴。|
|_車輪の故障_ | 車輪のアクセル、ブレーキ インスタンス、運転距離、速さなどを測定するセンサー データ。車輪に関する静的な情報 (製造元、製造日など)。 注文日や量を追跡する部品注文データベースから推論される故障データ。|
|_地下鉄電車のドア故障_ | ドアの開閉時刻、その他のオペレーショナル データ (電車のドアの現在の状態など)。 静的なデータには、資産 ID、条件値の列などが含まれます。|

### <a name="data-types"></a>データの種類
上記のようなデータ ソースでは、PdM ドメインに 2 つの主要なデータ タイプがあることがわかります。

- _テンポラル データ_: 記録時にタイムスタンプが付される操作テレメトリ、マシンの状態、整備の種類、優先順位コード。 故障、メンテナンス/修復、使用履歴にも、各イベントに関連付けられたタイムスタンプが含まれます。
- _静的なデータ_: 一般的に、マシンの特徴とオペレーターの特徴はマシンの技術仕様またはオペレーターの属性を説明するため、これらのデータは静的です。 これらの特徴が時間の経過と共に代わる場合、これらに関連付けられたタイムスタンプが必要です。

予測変数とターゲット変数は、使用するアルゴリズムに応じて、[数値、カテゴリ、およびその他のデータ型](https://www.statsdirect.com/help/basics/measurement_scales.htm)に前処理/変換されている必要があります。

### <a name="data-preprocessing"></a>データの前処理
_特徴エンジニア リング_の前提条件として、さまざまなストリームからデータを準備して、スキームを構成します。これによって、特徴の構築が容易になります。 レコードのテーブルとして最初にデータを視覚化します。 テーブル内の各行はトレーニング インスタンスを表し、列は "_予測値_" の特徴 (独立した属性または変数とも呼ばれます) を表します。 最後の列が "_ターゲット_" (従属変数) になるようにデータを整理します。 各トレーニング インスタンスについて、この列の値として "_ラベル_" を割り当てます。

テンポラル データについて、センサー データの期間を時間単位に分割します。 各レコードは、資産の特定の時間単位に属している必要があり、"_個別の情報を提供する必要があります_"。 時間単位は、秒、分、時間、日、月などの倍数でビジネス ニーズに基づいて定義されます。 時間単位は、"_データ収集の頻度と同じである必要はありません_"。 頻度が高い場合は、異なる時間単位間で著しい差が見られない場合があります。 たとえば、大気温度を 10 秒ごとに収集したとします。 トレーニング データにその同じ時間間隔を使用しても、例の数が増えるだけで、何の追加情報も得られません。 この場合、適切な方法として、10 分間、またはビジネス上の正当な利用に基づいて 1 時間 のデータの平均値をとります。

静的データの場合
- _メンテナンス レコード_: 生のメンテナンス データには、資産 ID とタイムスタンプのほか、特定の時間に実行されたメンテナンス アクティビティに関する情報が含まれます。 メンテナンス アクティビティを "_カテゴリ_" 列に変換します。ここでは、各カテゴリの記述子が一意に特定のメンテナンス アクションにマップされます。 メンテナンス レコードのスキーマは、資産 ID、時刻、およびメンテナンス操作を含みます。

- _故障レコード_: 故障やエラーの原因を、特定のビジネス条件によって定義された特定のエラー コードまたはエラー イベントとして記録することができます。 機器に複数のエラー コードがある場合、ドメイン専門家は、ターゲット変数に関連するものを識別できる必要があります。 残りのエラー コードまたは条件を使用して、これらのエラーと関連付けられた "_予測値_" の特徴を構築します。 故障レコードのスキーマには、資産 ID、時刻、故障、または該当する場合は故障の理由を含みます。

- _マシンとオペレーターのメタデータ_: マシンとオペレーターのデータを 1 つのスキーマにマージして、資産を (各属性と共に) そのオペレーターと関連付けます。 マシン状態のスキーマには、資産 ID、資産の特徴、オペレーター ID、オペレーターの特徴が含まれます。

その他のデータの前処理手順には、"_不足した値の処理_" と属性値の "_正規化_" が含まれます。 このガイドでは詳しく説明していません。一部の役立つリファレンスについては、次のセクションを参照してください。

上記の前処理したデータ ソースを準備したら、特徴エンジニアリング前の最後の変換として、資産 ID とタイムスタンプに基づいて上記のテーブルを結合します。 結果のテーブルには、マシンの通常稼働時の故障列に null 値が含まれます。 これらの null 値は、通常運用のインジケーターによって補完できます。 この故障列を使用して、"_予測モデルのラベル_" を作成します。 詳しくは、「[予測メンテナンスのためのモデリング手法](#Modeling-techniques-for-predictive-maintenance)」のセクションを参照してください。

## <a name="feature-engineering"></a>特徴エンジニアリング
特徴エンジニアリングは、データのモデリングの前に行う最初の手順です。 データ サイエンス プロセスにおけるその役割については、[ここを参照](https://docs.microsoft.com/azure/machine-learning/team-data-science-process/create-features)してください。 "_特徴_" とは、モデルの予測属性 (温度、圧力、振動など)。 PdM の場合、特徴エンジニアリングには、非常に長い期間にわたって収集された履歴データのマシンの正常性の要約が含まれます。 その意味では、これは、リモート監視、異常検出、障害検出などとは異なります。 

### <a name="time-windows"></a>時間枠
リモート監視は、"_特定時点_" に発生したイベントのレポートを伴います。 異常検出モデルは、データの入力ストリームを評価 (スコア付け) して、特定時点の異常をフラグします。 エラー検出は、エラーを特定の時点に発生した特定の種類に分類します。 これに対し、PdM には、"_過去の期間_" にわたるマシンの動作を表す特徴に基づいた、"_将来の期間_" における故障の予測が含まれます。 PdM の場合、各特定の時点の特徴データは、予測についてノイズが多すぎます。 このため、時間枠でのデータ ポイントを集計することによって、各特徴のデータを "_スムージング_" する必要があります。

### <a name="lag-features"></a>ラグ特徴
モデルがどのくらい先まで予測する必要があるかは、ビジネス要件によって決まります。 同様に、この期間により、これらの予測を行うために "モデルはどのくらい過去をさかのぼる必要があるか" を定義できます。 この "さかのぼる" 期間は "_ラグ_" と呼ばれ、このラグ期間にエンジニアリングされる特徴は "_ラグ特徴_" と呼ばれます。 このセクションでは、タイムスタンプ付きデータ ソースから構築できるラグ特徴と、静的なデータ ソースからの特徴の作成について説明します。 通常、ラグ特徴は本来 "_数値_" です。

> [!IMPORTANT]
> ウィンドウ サイズが試験によって決定され、ドメイン専門家の力を借りて結果を導き出します。 ラグ特徴、その集計、およびウィンドウのタイプの選択と定義においても、同じ注意事項が当てはまります。

#### <a name="rolling-aggregates"></a>ローリング集計
資産の各レコードについて、サイズ "W" のローリング ウィンドウが時間単位の数として選択され、集計が計算されます。 次に、そのレコードの "_日付以前_" の W 期間を使用して、ラグ特徴が計算されます。 図 1 の青い線は、各時間単位の資産の記録されたセンサーの値を示します。 これらは、サイズ W=3 のウィンドウの特徴値のローリング平均値を表します。 ローリング平均は、t<sub>1</sub> (オレンジ) から t<sub>2</sub> (緑) の範囲のすべてのタイムスタンプ付きレコートについて計算されます。 通常、W の値は、データの特性に応じて分または時間です。 ただし、一部の問題では、大きな W (12 か月など) を選択すると、記録時までに資産の履歴全体が提供されます。

![図 1:  ローリング集計の特徴](./media/cortana-analytics-playbook-predictive-maintenance/rolling-aggregate-features.png) 図 1. ローリング集計の特徴

時間枠でのローリング集計の例として、数量、平均、CUMESUM (累積合計)、最小/最大値などがあります。 また、分散、標準偏差、および N 標準偏差を超える外れ値の数が一般的に使用されます。 このガイドの[ユース ケース](#Sample-PdM-use-cases)に適用できる集計の例を以下に示します。 
- _フライト遅延_: 前日/前の週のエラー コードの数。
- _航空機エンジン部品の故障_: ローリング平均、標準偏差、過去の日、週の合計など。このメトリックは、ビジネス ドメインの専門家と共に決定してください。
- _ATM の故障_: ローリング平均、標準偏差、3 つの標準偏差値外の外れ値、上下の CUMESUM など。
- _地下鉄電車のドア故障_: 過去の日、週、2 週間などのイベントの数。
- _ブレーカーの故障_: 過去の週、年、3 年間などに発生した故障の数。

PdM のもう 1 つの便利な手法は、データ内の異常を検出するアルゴリズムを使用して、傾向の変更、スパイクやレベルの変更をキャプチャすることです。

#### <a name="tumbling-aggregates"></a>タンブリング集計
資産の各ラベル付き資産について、サイズ _W-<sub>k</sub>_ のウィンドウが定義されます。ここで、_k_ はサイズ _W_ のウィンドウの数です。次に、レコードのタイムスタンプ前の期間について、集計が _k_ _タンブリング ウィンドウ_ _W-k、W-<sub>(k-1)</sub>、…、W-<sub>2</sub>、W-<sub>1</sub>_ で作成されます。 _k_ を小さい数値にして短期の効果を取得したり、大きな数値にして長期の老朽化パターンを取得したりできます。 (図 2 を参照)

![図 2:  タンブリング集計の特徴](./media/cortana-analytics-playbook-predictive-maintenance/tumbling-aggregate-features.png) 図 2. タンブリング集計の特徴

たとえば、風力タービン ユース ケースのラグ特徴は、W=1 と k=3 を使用して作成できます。 これらは、上下の外れ値を使用した過去 3 か月ごとのラグを示します。

### <a name="static-features"></a>静的な特徴

静的な特徴の例として、機器の技術仕様 (製造日、モデル番号、場所など) があります。 これらは、モデリングの "_カテゴリ_" 変数として処理されます。 ブレーカーのユース ケースの一部の例として、電圧、電流、電力容量、トランスフォーマー タイプ、電源などがあります。 車輪の故障の場合、車輪の種類 (合金、鋼鉄など) が挙げられます。

これまでに説明したデータの準備作業によって、データは以下に示すように整理されています。 トレーニング、テスト、および検証データには、この論理スキーマ (この例では、日単位) が含まれています。

| 資産 ID | Time | <Feature Columns> | ラベル |
| ---- | ---- | --- | --- |
| A123 |Day 1 | . . . | . |
| A123 |Day 2 | . . . | . |
| ...  |...   | . . . | . |
| B234 |Day 1 | . . . | . |
| B234 |Day 2 | . . . | . |
| ...  |...   | . . . | . |

特徴エンジニア リングの最後の手順は、ターゲット変数の "**ラベル付け**" です。 このプロセスは、モデリング手法に依存します。 さらに、モデリング手法はビジネス上の問題と、使用可能なデータの特性に依存します。 ラベル付けについては次のセクションで説明します。

> [!IMPORTANT]
> データの準備と特徴エンジニアリングは、PdM ソリューションを成功させるために、モデリング手法と同じくらい重要です。 ドメイン専門家と実務者は、短い期間では、モデルの適切な特徴とデータを取得することはできません。 特徴エンジニアリングに関する多くの書籍の一部の例を紹介します。
> - Pyle, D. Data Preparation for Data Mining (The Morgan Kaufmann Series in Data Management Systems), 1999
> - Zheng, A., Casari, A. Feature Engineering for Machine Learning: Principles and Techniques for Data Scientists, O'Reilly, 2018.
> - Dong, G. Liu, H.(Editors), Feature Engineering for Machine Learning and Data Analytics (Chapman & Hall/CRC Data Mining and Knowledge Discovery Series), CRC Press, 2018.

## <a name="modeling-techniques-for-predictive-maintenance"></a>予測メンテナンスのためのモデリング手法

このセクションでは、PdM の問題の主なモデリング手法と、その特定のラベル構築方法について説明します。 さまざまな業界全体にわたって単一のモデリング手法を使用できることに注意してください。 モデリング手法は、手持ちのデータのコンテキストではなく、データ サイエンスの問題と組み合わされます。

> [!IMPORTANT]
> 故障の事例とラベル付け方法のラベルの選択は、  
> ドメインの専門家と相談して決定する必要があります。

### <a name="binary-classification"></a>二項分類
二項分類を使用して、_機器の一部が将来的に故障する可能性を予測_します。これを、"_将来の水平期間 X_" と呼びます。X は、ドメインの専門家と相談して、ビジネス上の問題と手持ちのデータによって決定されます。 次に例をいくつか示します。
- _最小リード タイム_。コンポーネントを交換し、メンテナンス リソースをデプロイし、メンテナンスを実行して、この期間に発生する可能性のある問題を回避するために必要です。
- _イベントの最小数_。問題が発生する前に発生する可能性のあるイベントの数。

この手法では、2 種類のトレーニング例が特定されます。 肯定的な例。ラベル = 1 で、"_障害を示します_"。 否定的な例。ラベル = 0 で、通常の運用を示します。 ターゲット変数 (ラベル値) は、"_カテゴリ_" です。 モデルは新しい各例を、次の X 期間に故障する可能性がある例または通常の運用例として特定する必要があります。

#### <a name="label-construction-for-binary-classification"></a>二項分類のラベル構築
ここでの質問は、"資産が次の X 期間に故障する確率はどのくらいか?" です。 この質問に回答するために、資産の故障前の X レコードを "故障する可能性のあるもの" (ラベル = 1) としてラベル付けし、その他のすべてのレコードを "正常" (ラベル = 0) としてラベル付けします。 (図 3 を参照)

![図 3:  二項分類のラベル付け](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-binary-classification.png) 図 3: 二項分類のラベル付け

一部の事例のラベル付け方法の例を以下に示します。
- _フライト遅延_: 今後 24 時間以内に遅延を予測する、1 日として X を選択できます。 故障前の 24 時間以内に予定されたすべてのフライトを 1 としてラベル付けします。
- _ATM 現金自動支払の故障_: 目標として、今後 1 時間以内のトランザクションの故障の確率を特定します。 この場合、故障前の直近の過去 1 時間に発生したすべてのトランザクションを 1 としてラベル付けします。 次に発行される N 枚の現金全体での障害の確率を予測するには、故障前の N 枚の現金内で発行されたすべての現金を 1 としてラベル付けします。
- _ブレーカーの故障_: 目標として、次のブレーカー コマンドが失敗する可能性を予測します。 ここでは、将来的なコマンドの 1 つとして X を選択しました。
- _電車のドアの故障_: X は 2 日間として選択できます。
- _風力タービンの故障_: X は 2 か月として選択できます。

### <a name="regression-for-predictive-maintenance"></a>予測メンテナンスのための回帰
回帰モデルを使用して、"_資産の残存耐用年数 (RUL) を計算します_"。 RUL の定義は、次の故障が発生するまでに資産が稼働する時間です。 各トレーニング例は、資産の期間 _nY_ (_n_ は倍数) に属するレコードです。 このモデルでは、新しい例ごとの RUL を、"_連続する数_" として計算する必要があります。 この数は、故障するまでに残された期間を示します。

#### <a name="label-construction-for-regression"></a>回帰のラベル構築
ここでは、機器の残存耐用年数 (RUL) はどれくらいかが問題になります。 故障前の各レコードに対して、ラベルを次の故障までに残っている期間の数値として計算します。 この方法では、ラベルは連続変数です。 (図 4 を参照)

![図 4:  回帰のラベル付け](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-regression.png) 図 4:  回帰のラベル付け

回帰では、障害点を参照してラベル付けを行います。 故障前に資産が稼働していた期間がわからなければ、計算は不可能です。 したがって、二項分類とは対照的に、故障のデータがない資産はモデリングに使用できません。 この問題には、[生存率分析](https://en.wikipedia.org/wiki/Survival_analysis)と呼ばれる別の統計手法で対処します。 ただし、時間とともに頻繁に変化するデータを扱う PdM ユース ケースに対してこの手法を応用すると、潜在的な複雑さが発生する可能性があります。 生存率分析について詳しくは、[この資料](https://www.cscu.cornell.edu/news/statnews/stnews78.pdf)をご覧ください。

### <a name="multi-class-classification-for-predictive-maintenance"></a>予測メンテナンスの多クラス分類
多クラス分類の手法は、PdM ソリューションにおいて 2 つのシナリオで使用されます。
- "_2 つの将来的な結果_" を予測する: 1 つ目の結果は、資産の "_故障する期間_" です。 資産は、複数ある可能な期間のいずれかに割り当てられます。 2 つ目の結果は、"_複数の根本原因のいずれか_" によって将来の期間に故障が発生する可能性です。 この予測を使用して、メンテナンス スタッフは故障の兆候を監視し、メンテナンス スケジュールを計画することができます。
- 特定の故障の "_最も可能性の高い根本原因_" を予測する。 この結果によって、故障を修理するために行うべき一連のメンテナンス操作が示されます。 ランク付けされた根本原因と推奨された修理操作によって、技術者は故障時の修復作業に優先順位を付けることができます。

#### <a name="label-construction-for-multi-class-classification"></a>多クラス分類のラベル構築
ここでは、_n_ を期間の数として、次の _nZ_ の期間内に資産が故障する確率はどれくらいかが問題になります。 この問題を解決するには、時間のバケット (3Z、2Z、Z) を使用して、資産の故障前の nZ 個のレコードをラベル付けします。 その他のレコードはすべて "正常" (ラベル = 0) としてラベル付けします。 この方法では、ターゲット変数は "_カテゴリ_" の値です。 (図 5 を参照)

![図 5:  多クラス分類のラベル付けによる故障の予測](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-failure-time-prediction.png) 図 5:  多クラス分類のラベル付けによる故障の予測

ここでは、根本原因/問題 _P<sub>i</sub>_ によって次の X 期間内に資産が故障する確率は、どれくらいかが問題となります。 _i_ は可能な根本原因の数です。 この問題を解決するには、資産の故障前の X 個のレコードを、"根本原因 _P<sub>i</sub>_ によってまもなく故障する" (ラベル = _P<sub>i</sub>_) としてラベル付けします。 その他のレコードはすべて "正常である" (ラベル = 0) としてラベル付けします。 この方法でも、ラベルはカテゴリ変数です (図 6 を参照)。

![図 6:  多クラス分類のラベル付けによる根本原因の予測](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-root-cause-prediction.png) 図 6:  多クラス分類のラベル付けによる根本原因の予測

このモデルは、各 _P<sub>i</sub>_ によって故障する確率と、故障しない確率を割り当てます。 これらの確率を magnitude により並べ替えて、今後最も発生する可能性のある問題を予測できます。

ここでは、故障時にどのようなメンテナンス操作を行うべきかが問題となります。 この問題を解決するために、ラベル付けにおいて "_将来の水平期間を選択する必要はありません_"。なぜなら、このモデルは将来的な故障を予測しないからです。 予測するのは、"_既に故障が発生した場合_" における最も可能性の高い根本原因です。

## <a name="training-validation-and-testing-methods-for-predictive-maintenance"></a>予測メンテナンスのためのトレーニング、検証、およびテスト方法
[Team Data Science Process](https://docs.microsoft.com/azure/machine-learning/team-data-science-process/overview) によって、モデルのトレーニング - テスト - 検証サイクルが全体的にカバーされます。 このセクションでは、PdM に固有の側面について説明します。

### <a name="cross-validation"></a>クロス検証
[クロス検証](https://en.wikipedia.org/wiki/Cross-validation_(statistics))の目的は、トレーニング フェーズでモデルを "テスト" するためにデータ セットを定義することです。 このデータ セットは、"_検証セット_" と呼ばれます。 この手法を使用すると、"_オーバーフィット_" のような問題を制限し、モデルが独立したデータ セットに対してどのように汎用化されるかを把握することができます。 つまりこれは、現実の問題から取得することができる、未知のデータ セットです。 PdM のトレーニングとテストのルーチンは、未知の将来的データをより深く一般化するために、時間によって変化するさまざまな側面を考慮する必要があります。

多くの機械学習アルゴリズムは、モデルのパフォーマンスを大幅に変える可能性がある多数のハイパーパラメーターに依存しています。 これらのハイパーパラメーターの最適値は、モデルのトレーニング時に自動的に計算されません。 これらは、データ サイエンティストが指定する必要があります。 ハイパーパラメーターの適切な値を検索するいくつかの方法があります。

最も一般的な方法の 1 つは、例をランダムに _k_ 個のフォールドに分割する "_k フォールド クロス検証_" です。 ハイパーパラメーター値のセットごとに、学習アルゴリズムを _k_ 回実行します。 各イテレーションにおいて、現在のフォールドの例を検証セットとして使用し、残りの例をトレーニング セットとして使用します。 トレーニング例を使用してアルゴリズムをトレーニングし、検証例を使用してパフォーマンス メトリックを計算します。 このループの最後に、_k_ 個のパフォーマンス メトリックの平均を計算します。 ハイパーパラメーター値のセットごとに、その平均パフォーマンスが最適になるような値を選択します。 実際には、多くの場合、ハイパーパラメーターの選択は実験的なタスクになります。

PdM 問題では、データはいくつかのデータ ソースからのイベントの時系列として記録されます。 これらのレコードは、ラベル付けの時間に従って並べ替えることができます。 そのため、データ セットをトレーニング セットと検証セットに "_ランダムに_" 分割すると、"_トレーニング例の一部が検証例の一部よりも後に出現する場合があります_"。 ハイパーパラメーター値の将来のパフォーマンスは、モデルをトレーニングする "_前に_" 到着したデータに基づいて見積もられます。 これらの予測は、特に時系列が固定的ではなく時間とともに変化する場合には、過度に楽観的になる場合があります。 結果として、選択されたハイパーパラメーターの値は準最適となる可能性があります。

推奨される方法は、"_時間に依存した_" 方法によって例をトレーニング セットと検証セットに分割することです。つまり、すべての検証例がすべてのトレーニング例よりも後に出現するようにします。 ハイパーパラメーター値のセットごとに、トレーニング データ セットを使用してアルゴリズムをトレーニングします。 同じ検証セットを使用してモデルのパフォーマンスを測定します。 最適なパフォーマンスを示すハイパーパラメーター値を選択します。 トレーニング/検証の分割によって選択したハイパーパラメーター値を使用したほうが、クロス検証によってランダムに選択した値を使用するよりも、将来のモデルのパフォーマンスが向上します。

最適なハイパーパラメーター値を使用して、トレーニング データ全体に渡って学習アルゴリズムをトレーニングすることによって、最終的なモデルを生成できます。

### <a name="testing-for-model-performance"></a>モデルのパフォーマンスのテスト
モデルを構築したら、新しいデータ上での将来のパフォーマンスを見積もる必要があります。 見積もりとして適切なものは、検証セットで計算されたハイパーパラメーター値のパフォーマンス メトリックか、クロス検証から計算された平均パフォーマンス メトリックです。 これらの見積もりは、過度に楽観的になることがよくあります。 多くの場合、企業は、モデルのテスト方法に関する何らかの追加ガイドラインを持っています。

PdM に対して推奨される方法は、"_時間に依存した_" 方法によって、例をトレーニング セット、検証セット、テスト データ セットに分割することです。 すべてのテスト例は、すべてのトレーニング例および検証例よりも後に出現する必要があります。 分割したら、モデルを生成し、前述のようにそのパフォーマンスを測定します。

時系列のデータが固定的で予測が簡単な場合は、ランダムな方法と時間に依存した方法のどちらを使用しても、生成される将来のパフォーマンスの見積もりは同様です。 ただし、時系列のデータが固定的ではない場合や、予測が困難な場合は、時間に依存した方法のほうがより現実的な将来のパフォーマンスの見積もりを生成します。

### <a name="time-dependent-split"></a>時間に依存した分割
このセクションでは、時間に依存した分割を実装するためのベスト プラクティスについて説明します。 以下では、トレーニング セットとテスト セット間での時間に依存した双方向の分割を説明します。

さまざまなセンサーから収集した測定値のような、タイムスタンプ付きのイベントのストリームを想定します。 複数のイベントを含む期間全体で、トレーニング例とテスト例の特徴およびラベルを定義します。 たとえば、二項分類の場合、過去のイベントに基づいて特徴を作成し、将来の "X" 期間内のイベントに基づいてラベルを作成します ([特徴エンジニアリング](#Feature-engineering)および[モデリング手法](#Modeling-techniques-applied-to-PdM-use-cases)のセクションを参照)。 このため、例の期間のラベル付けは、その特徴の期間より後にきます。

時間に依存した分割では、モデルをトレーニングする "_トレーニング分割時間 T<sub>c</sub>_" を選択します。これには、T<sub>c</sub> までの履歴データを使用して調整したハイパーパラメーターを使用します。 T<sub>c</sub> を超えた将来のラベルがトレーニング データに混入するのを回避するには、トレーニング例をラベル付けする最新の時間を、T<sub>c</sub> よりも X 単位分前にします。 図 7 に示す例では、各四角形が、前述の方法で特徴とラベルを計算したデータ セット内のレコードを表しています。 この図では、X=2、W=3 の場合にトレーニング セットとテスト セットに入るレコードを示しています。

![図 7:  二項分類の時間に依存した分割](./media/cortana-analytics-playbook-predictive-maintenance/time-dependent-split-for-binary-classification.png) 図 7:  二項分類の時間に依存した分割

緑の四角形は、トレーニングに使用できる期間に属するレコードを表します。 各トレーニング例は、特徴の生成のために過去の期間を 3 つ考慮し、ラベル付けのために T<sub>c</sub> より前の将来の期間を 2 つ考慮することで生成されています。 将来の期間 2 つのうちいずれかの部分が T<sub>c</sub> を超える場合は、その例をトレーニング データ セットから除外します。T<sub>c</sub> 以降では表示が保証されないためです。

この制約に従い、黒い四角形は、トレーニング データ セットで使用できない、最後のラベル付けされたデータ セットのレコードを示します。 これらのレコードは、T<sub>c</sub> 以前のものであるため、テスト データでも使用できません。 さらに、ラベル付け期間が部分的にトレーニング期間に依存しています。これは理想的ではありません。 トレーニング データとテスト データは、ラベル情報の漏えいを回避するために、異なるラベル付け期間を持つ必要があります。

これまでに説明した手法では、タイムスタンプが T<sub>c</sub> に近いトレーニング例とテスト例との間で、重複が生じる可能性があります。 より完全な分離を実現するためのソリューションは、T<sub>c</sub> から W 期間の間にある例をテスト セットから除外することです。 ただし、このようなアグレッシブな分割は、十分なデータの可用性を必要とします。

RUL を予測するために使用される回帰モデルは、漏えいの問題の影響をより厳しく受けます。 ランダム分割の方法は、極端な過剰適合につながります。 回帰の問題では、故障が T<sub>c</sub> 以前である資産に属しているレコードが、トレーニング セットに入るように分割する必要があります。 故障が分割時間よりも後である資産のレコードは、テスト セットに入ります。

トレーニングとテストのためのデータ分割の、もう 1 つのベスト プラクティスは、資産 ID による分割を使用することです。 トレーニング セットで使用される資産が、いずれもモデル パフォーマンスのテストでは使用されないように分割する必要があります。 この方法を使用すると、新しい資産に対してモデルがより現実的な結果をもたらす可能性が高まります。

### <a name="handling-imbalanced-data"></a>偏ったデータの処理
分類の問題では、1 つのクラスの例が他のクラスよりも多い場合、そのデータ セットは "_不均衡である_" と言われます。 さまざまなクラス間の区別を可能にするために、トレーニング データの各クラスに十分な代表が存在することが理想的です。 1 つのクラスがデータの 10% 未満である場合、データは不均衡であるとみなされます。 代表が不足しているクラスは、"_少数派クラス_" と呼ばれます。

PdM 問題の多くがこのような不均衡データ セットに直面します。ここでは、1 つのクラスの代表が、他の 1 つまたは複数のクラスよりも大幅に不足しています。 状況によっては、少数派クラスがデータ ポイント全体のわずか 0.001% しか構成していない場合もあります。 クラスの不均衡は PdM に特有の問題ではありません。 故障や異常が稀にしか発生しない他の領域でも、同様の問題が生じます。たとえば、不正行為の検出やネットワークの侵入などです。 このような障害は、少数派クラスの例となります。

データにクラスの不均衡があると、標準的な学習アルゴリズムのほとんどがパフォーマンスに悪影響を受けます。このようなアルゴリズムは全体的なエラー率の最小化を目指すためです。 99% の負の例と 1% の正の例を持つデータ セットでは、すべてのインスタンスを負としてラベル付けすることで、99% の正確度を持つモデルとして示すことができます。 ただし、モデルはすべての正の例を誤って分類するため、正確度が高い場合でも、アルゴリズムが有用であるとは言えません。 したがって、"_エラー率の全体的な正確度_" などの従来の評価メトリックは、不均衡な学習では十分ではありません。 不均衡なデータ セットに直面した場合は、その他のメトリックがモデル評価に使用されます。
- Precision
- 再現率
- F1 スコア
- コスト調整済み ROC (受信者操作特性)

これらのメトリックについて詳しくは、[モデルの評価](#Model-evaluation)に関する記事をご覧ください。

ただし、クラスの不均衡の問題に対処するいくつかの方法があります。 2 つの主要な方法は、"_サンプリング手法_" と "_費用重視型学習_" です。

#### <a name="sampling-methods"></a>サンプリング メソッド
不均衡な学習では、トレーニング データセットを均衡なデータ セットに変更するため、サンプリング メソッドが使用されます。 サンプリング メソッドはテスト セットには適用されません。 いくつかのサンプリング手法がありますが、最も簡単な手法は、"_ランダムなオーバーサンプリング_" および "_アンダーサンプリング_" です。

"_ランダムなオーバーサンプリング_" では、少数派クラスからランダムなサンプルを選択し、これらの例をレプリケートして、トレーニング データ セットに追加します。 これにより、少数派クラスの例の数が増加し、最終的に各クラスの例の数が均衡になります。 オーバーサンプリングの欠点は、特定の例の複数のインスタンスにより、分類器が詳細になりすぎて、過剰適合につながる場合があることです。 このモデルは高いトレーニング正確度を示すことが可能ですが、未知のテスト データに対するパフォーマンスは準最適になる場合があります。

反対に、"_ランダムなアンダーサンプリング_" では多数派クラスからランダム サンプルを選択し、それらの例をトレーニング データ セットから削除します。 ただし、多数派クラスから例を削除すると、多数派クラスに関連した重要な概念が分類子で不足する可能性があります。 少数派クラスがオーバーサンプリングされ、同時に多数派クラスがアンダーサンプリングされる "_ハイブリッド サンプリング_" は、もう 1 つの有効な手法です。

高度なサンプリング手法はたくさんあります。 どの手法を選択するかは、データのプロパティと、データ サイエンティストによる反復実験の結果に依存します。

#### <a name="cost-sensitive-learning"></a>費用重視型学習
PdM では、通常の例よりも、少数派クラスを構成する故障のほうにより多くの関心があります。 したがって、故障に対するアルゴリズムのパフォーマンスに主な焦点が置かれます。 正のクラスを誤って負のクラスと予測した場合のコストは、逆の場合よりも高くつきます。 通常、このような状況は、非等分散ロス、または、異なるクラスの要素を誤って分類することの非対称コストと呼ばれます。 理想的な分類器は、多数派クラスの正確度について妥協することなく、少数派クラスでの高い予測正確度を実現する必要があります。

このバランスを実現するための方法は複数あります。 非等分散ロスの問題を軽減するために、少数派クラスの誤分類に高いコストを割り当て、全体的なコストの最小化を試みます。 "_SVM (サポート ベクター マシン)_" のようなアルゴリズムは、本質的にこの方法を採用しています。ここでは、正の例と負の例のコストを、トレーニング中に指定することができます。 同様に、"_ブースト デシジョン ツリー_" などのブースティング方法は、通常、不均衡データで優れたパフォーマンスを示します。

## <a name="model-evaluation"></a>モデルの評価
ビジネスに対する誤ったアラームのコストが高い PdM シナリオでは、誤った分類は重大な問題となります。 たとえば、エンジン故障の誤った予測に基づいて航空機の離陸の中止を決定した場合、スケジュールや旅行計画が破壊される可能性があります。 組み立てラインからマシンをオフラインにした場合、利益の損失が発生する可能性があります。 したがって、新しいテスト データに対する適切なパフォーマンス メトリックを使用してモデルを評価することが非常に重要です。

以下では、PdM モデルを評価するために使用される典型的なパフォーマンス メトリックについて説明します。

- [正確度](https://en.wikipedia.org/wiki/Accuracy_and_precision)は、分類器のパフォーマンスを記述するために使用される最も一般的なメトリックです。 ただし、正確度はデータ分布の影響を受けやすく、不均衡データ セットを含むシナリオでは効果のない尺度です。 そのため、別のメトリックが代わりに使用されます。 モデルの正確度の計算と理解のためには、[混同行列](https://en.wikipedia.org/wiki/Confusion_matrix)のようなツールが使用されます。
- PdM モデルの[精度](https://en.wikipedia.org/wiki/Precision_and_recall)は、誤ったアラームの比率に関連します。 通常、モデルの精度が低いと、誤ったアラームの比率が高くなります。
- [再現率](https://en.wikipedia.org/wiki/Precision_and_recall)は、モデルによって正しく特定された、テスト セット内の故障の数を示します。 高い再現率は、モデルが真の故障の把握に成功していることを意味します。
- [F1 スコア](https://en.wikipedia.org/wiki/F1_score)は、精度と再現度の調和平均です。その値は 0 (最低) から 1 (最高) まで変化します。

二項分類に関しては、
- [受信者操作特性 (ROC)](https://en.wikipedia.org/wiki/Receiver_operating_characteristic) もよく使用されるメトリックです。 ROC 曲線では、モデルのパフォーマンスは ROC 上の 1 つの固定された動作点に基づいて解釈されます。
- ただし、PdM 問題については、"_十分位数テーブル_" および "_リフト チャート_" のほうが有益です。 これらは正のクラス (故障) にのみ焦点を当て、ROC 曲線よりも詳細なアルゴリズムのパフォーマンスのイメージを提供します。
  - "_十分位数テーブル_" は、故障確率によって降順に並べられたテスト例を使用して作成されます。 順序付けされたサンプルは、十分位数 (最も高い確率を持つ 10% のサンプル、20%、30%、...) でグループ化されます。 十分位数ごとの (真陽性率)/(ランダム ベースライン) の割合は、各十分位数でのアルゴリズムのパフォーマンスを見積もるのに役立ちます。 ランダム ベースラインは、0.1、0.2、... という値を取ります。
  - [リフト チャート](http://www2.cs.uregina.ca/~dbd/cs831/notes/lift_chart/lift_chart.html)では、十分位数の真陽性率対ランダムな真陽性率のペアをすべての十分位数についてプロットします。 通常、最初の十分位数が結果の焦点となります。最大の増加を示すためです。 PdM に対して使用する場合は、最初の十分位数を "リスク時の" 代表とみなすこともできます。

## <a name="model-operationalization-for-predictive-maintenance"></a>予測メンテナンスのモデルの運用化

データ サイエンスがもたらす利点は、トレーニングされたモデルが運用化される場合にのみ実現されます。 つまり、新しい、未知のデータに基づく予測を行うために、モデルをビジネス システムに配置する必要があります。  新しいデータは、トレーニングされたモデルの "_モデル シグネチャ_" に、2 つの点で正確に準拠する必要があります。
- 新しいデータのすべての論理インスタンス (たとえば、テーブルの行) 内に、すべての特徴が存在する必要があります。
- トレーニング データと厳密に同じ方法で、新しいデータが事前処理され、各特徴がエンジニアリングされる必要があります。

このプロセスは、アカデミックな資料や業界の資料ではさまざまな呼ばれ方をしています。 ただし、以下の表現はすべて同じことを意味しています。
- モデルを使用して "_新しいデータをスコア付けする_"
- 新しいデータに "_モデルを適用する_"
- モデルを "_運用化する_"
- モデルを "_デプロイする_"
- 新しいデータに対して "_モデルを実行する_"

前述のように、PdM のモデルの運用化は、その仲間と異なっています。 通常、異常検出や障害検出に関連するシナリオでは、"_オンライン スコアリング_" (または "_リアルタイム スコアリング_") を実装します。 ここでは、モデルは受信した各レコードを "_スコア付け_" し、予測を返します。 異常検出では、予測は異常が発生したという兆候です (例: 1 クラス SVM)。 障害検出では、予測は障害の種類やクラスとなります。

これに対し、PdM は "_バッチ スコアリング_" を含みます。 モデル シグネチャに準拠するために、新しいデータの特徴はトレーニング データと同じ方法でエンジニアリングされる必要があります。 新しいデータに典型的な大規模データ セットでは、特徴は時間枠で集計され、バッチでスコア付けされます。 通常、バッチ スコアリングは、[Spark](http://spark.apache.org/) や [Azure Batch](https://docs.microsoft.com/azure/batch/batch-api-basics) のような分散システムで実行されます。 準最適な代替手段が 2 つ存在します。
- ストリーミング データ エンジンは、メモリ内で時間枠での集計をサポートします。 したがって、オンライン スコアリングをサポートするとも言えます。 ただし、これらのシステムが適しているのは、狭い時間枠での高密度のデータ、または広い時間枠でのまばらな要素です。 広い時間枠での高密度のデータに対しては、PdM のシナリオで見られるように、適切にスケーリングが行われない可能性があります。
- バッチ スコアリングを利用できない場合のソリューションは、オンライン スコアリングを調整して、小さなバッチ内の新しいデータを一度に処理することです。

## <a name="solution-templates-for-predictive-maintenance"></a>予測メンテナンスのためのソリューション テンプレート

このガイドの最後のセクションでは、PdM のソリューション テンプレート、チュートリアル、および Azure で実装された実験の一覧を示します。 これらの PdM アプリケーションは、場合によっては数分で Azure サブスクリプションにデプロイできます。 これらは、概念実証のデモ、代替手段を実験するためのサンドボックス、または実稼働の実装のためのアクセラレータとして使用できます。 これらのテンプレートは、[Azure AI Gallery](http://gallery.azure.ai) または [Azure GitHub](https://github.com/Azure) に配置されます。 これらのさまざまなサンプルは、時間とともにこのソリューション テンプレートにまとめられます。

| # | タイトル | 説明 |
|--:|:------|-------------|
| 1 | [Azure 予測メンテナンスの機械学習サンプル](https://github.com/Azure/MachineLearningSamples-PredictiveMaintenance) |次の N 期間における障害を予測する PdM のサンプルです。 このサンプルは Azure ML の Workbench プロジェクトとして記述されており、PdM の初心者に最適です。 関連する[追加ドキュメント](https://docs.microsoft.com/azure/machine-learning/desktop-workbench/scenario-predictive-maintenance)をご覧ください。|
| 2 | [Azure 予測メンテナンス ソリューション テンプレート](https://github.com/Azure/AI-PredictiveMaintenance) | IoT リモート監視における、ML モデリングと、予測メンテナンス シナリオを支援できる完全な Azure インフラストラクチャを示すオープンソースのソリューション テンプレート。 |
| 3 | [予測メンテナンスのためのディープ ラーニング](https://github.com/Azure/MachineLearningSamples-DeepLearningforPredictiveMaintenance) | 予測メンテナンスのために LSTM (Long Short-Term Memory) ネットワーク (再帰型ニューラル ネットワークの 1 クラス) を使用したデモ ソリューションを含む Azure Notebook です。[このサンプルに関するブログ記事](https://azure.microsoft.com/blog/deep-learning-for-predictive-maintenance)をご覧ください。|
| 4 | [R での予測メンテナンスのモデリング ガイド](https://gallery.azure.ai/Notebook/Predictive-Maintenance-Modelling-Guide-R-Notebook-1) | R のスクリプトを使用した PdM のモデリング ガイドです。|
| 5 | [航空宇宙業界向けの Azure 予測メンテナンス](https://gallery.azure.ai/Solution/Predictive-Maintenance-for-Aerospace-1) | 航空機メンテナンスのための、Azure ML v1.0 に基づいた最初の PdM ソリューション テンプレートの 1 つです。 本ガイドの起源はこのプロジェクトでした。 |
| 6 | [IoT Edge 用 Azure AI ツールキット](https://github.com/Azure/ai-toolkit-iot-edge) | TensorFlow を使用した IoT edge での AI です。Azure IoT Edge と互換性のある Docker コンテナーでのディープ ラーニング モデルをまとめたツールキットが含まれます。これらのモデルは REST API として公開されます。
| 7 | [Azure IoT 予測メンテナンス](https://github.com/Azure/azure-iot-predictive-maintenance) | Azure IoT Suite PCS - 構成済みソリューションです。 IoT Suite を使用した航空機メンテナンスの PdM テンプレートです。 同じプロジェクトに関連する[別のドキュメント](https://docs.microsoft.com/azure/iot-suite/iot-suite-predictive-overview)と[チュートリアル](https://docs.microsoft.com/azure/iot-suite/iot-suite-predictive-walkthrough)をご覧ください。 |
| 8 | [SQL Server R Services を使用した予測メンテナンス テンプレート](https://gallery.azure.ai/Tutorial/Predictive-Maintenance-Template-with-SQL-Server-R-Services-1) | R Services に基づいた、残存耐用年数に関するシナリオのデモです。 |
| 9 | [予測メンテナンスのモデリング ガイド](https://gallery.azure.ai/Collection/Predictive-Maintenance-Modelling-Guide-1) | R を使用して特徴エンジニアリングを行う航空機メンテナンスのデータ セットです。[実験](https://gallery.azure.ai/Experiment/Predictive-Maintenance-Modelling-Guide-Experiment-1)、[データ セット](https://gallery.azure.ai/Experiment/Predictive-Maintenance-Modelling-Guide-Data-Sets-1)、[Azure notebook](https://gallery.azure.ai/Notebook/Predictive-Maintenance-Modelling-Guide-R-Notebook-1)、AzureML v1.0 での[実験](https://gallery.azure.ai/Experiment/Predictive-Maintenance-Step-1-of-3-data-preparation-and-feature-engineering-2)を含みます。|

## <a name="training-resources-for-predictive-maintenance"></a>予測メンテナンスのためのトレーニング リソース

[予測メンテナンスのための Azure AI ラーニング パス](https://github.com/Azure/AI-PredictiveMaintenance/blob/master/docs/azure-ai-learning-path-for-predictive-maintenance.md)では、アルゴリズムの背後にある概念や数学、および PdM 問題で使用される手法をより深く理解するための、トレーニング資料が提供されます。 

Microsoft Azure では、一般的な AI の概念や実践に関するコンテンツとトレーニングを、無料で提供しています。

| トレーニング用のリソース  | 可用性 |
|:-------------------|--------------|
| [Azure の AI 開発者](http://azure.microsoft.com/training/learning-paths/azure-ai-developer) | パブリック |
| [Microsoft AI スクール](http://aischool.microsoft.com/learning-paths) | パブリック |
| [GitHub からの Azure AI ラーニング](https://github.com/Azure/connectthedots/blob/master/readme.md) | パブリック |
| [LinkedIn Learning](http://www.linkedin.com/learning) | パブリック |
| [Microsoft AI YouTube ウェビナー](https://www.youtube.com/watch?v=NvrH7_KKzoM&t=4s) | パブリック |
| [Microsoft AI Show](http://channel9.msdn.com/Shows/AI-Show) | パブリック |
| [LearnAI@MS](http://learnanalytics.microsoft.com) | Microsoft パートナー用 |
| [Microsoft Partner Network](http://learningportal.microsoft.com) | Microsoft パートナー用 |

さらに、MIT などの教育機関やその他の教育的企業によって、AI に関する無料の MOOCS (Massive Open Online Courses) がオンラインで提供されています。
