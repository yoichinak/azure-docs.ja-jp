---
title: Azure Active Directory B2C のトークン、セッション、シングル サインオンの構成 | Microsoft Docs
description: Azure Active Directory B2C でのトークン、セッション、シングル サインオンの構成。
services: active-directory-b2c
author: davidmu1
manager: mtillman
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 08/16/2017
ms.author: davidmu
ms.component: B2C
ms.openlocfilehash: 35210a8e93b8437ea4d8c3b5f002c81c549d3afe
ms.sourcegitcommit: 86cb3855e1368e5a74f21fdd71684c78a1f907ac
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2018
ms.locfileid: "37444832"
---
# <a name="azure-active-directory-b2c-token-session-and-single-sign-on-configuration"></a>Azure Active Directory B2C: トークン、セッション、シングル サインオンの構成

この機能を使用すると、 [個別のポリシーに基づいて](active-directory-b2c-reference-policies.md)、以下の対象をきめ細かく制御することができます。

1. Azure Active Directory (Azure AD) B2C が出力するセキュリティ トークンの有効期間。
2. Azure AD B2C によって管理される Web アプリケーションのセッションの有効期間。
3. Azure AD B2C が出力するセキュリティ トークンの重要な要求の形式。
4. B2C テナントに含まれる複数のアプリケーションとポリシーの間でのシングル サインオン (SSO) の動作。

組み込みポリシーでは、この機能を次のように Azure AD B2C ディレクトリで使用できます。

1. この手順に従って、Azure Portal で [B2C 機能メニューに移動](active-directory-b2c-app-registration.md#navigate-to-b2c-settings) します。
2. **[Sign-up or sign-in policies (サインアップまたはサインイン ポリシー)]** をクリックします。 *注: この機能は \*\*[サインアップまたはサインイン ポリシー]\*\* に限らず、あらゆるポリシー タイプで使用できます*。
3. ポリシーをクリックして開きます。 たとえば、**[B2C_1_SiUpIn]** をクリックします。
4. メニューの上部にある **[編集]** をクリックします。
5. **[トークン、セッション、シングル サインオンの構成]** をクリックします。
6. 必要な変更を施します。 後のセクションに、利用できるプロパティの説明があります。
7. Click **OK**.
8. メニューの上部で **[保存]** をクリックします。

## <a name="token-lifetimes-configuration"></a>トークンの有効期間の構成

Azure AD B2C は保護されたリソースへの安全なアクセスを実現する [OAuth 2.0 認証プロトコル](active-directory-b2c-reference-protocols.md) をサポートしています。 このサポートを実施するために、Azure AD B2C は各種の [セキュリティ トークン](active-directory-b2c-reference-tokens.md)を発行します。 Azure AD B2C は以下のプロパティを使用して、セキュリティ トークンの有効期間を管理することができます。

* **[Access & ID token lifetimes (minutes) (アクセス & ID トークンの有効期間 (分))]**: 保護されたリソースへのアクセスに使用する OAuth 2.0 ベアラー トークンの有効期間。
  * 既定値 = 60 分。
  * 最小値 (この値を含む) = 5 分。
  * 最大値 (この値を含む) = 1,440 分。
* **[Refresh token lifetime (days) (更新トークン有効期間 (日))]**: 更新トークンで新しいアクセスや ID トークン (および使用するアプリケーションで `offline_access` スコープが与えられている場合は、新しい更新トークン) を取得できる最長期間。
  * 既定値 = 14 日。
  * 最小値 (この値を含む) = 1 日。
  * 最大値 (この値を含む) = 90 日。
* **[Refresh token sliding window lifetime (days) (更新トークン スライディング ウィンドウの有効期間 (日))]**: この期間の経過後は、アプリケーションが取得した最新の更新トークンの有効期間にかかわらず、強制的にユーザーを再認証します。 スイッチが **[制限あり]** の場合にのみ、この設定が可能です。 **[Refresh token lifetime (days) (更新トークン有効期間 (日))]** の値以上であることが必要です。 スイッチが **[制限なし]** の場合は、特定の値を設定できません。
  * 既定値 = 90 日。
  * 最小値 (この値を含む) = 1 日。
  * 最大値 (この値を含む) = 365 日。

次の 2 つのユース ケースは、これらのプロパティを使用して実現できます。

* ユーザーがモバイル アプリケーションでアクティブな状態を継続している限り、そのアプリケーションへのサインインを無制限に持続することができます。 そのためには、サインイン ポリシーで **[Refresh token sliding window lifetime (days) (更新トークン スライディング ウィンドウの有効期間 (日))]** スイッチを **[Unbounded (制限なし)]** に設定します。
* 適切なアクセス トークン有効期間を設定して、業界のセキュリティ要件やコンプライアンス要件を満たすことができます。

    > [!NOTE]
    > これらの設定は、パスワード リセット ポリシーでは使用できません。
    > 
    > 

## <a name="token-compatibility-settings"></a>トークンの互換性の設定

Azure AD B2C が出力するセキュリティ トークンの重要な要求のフォーマットに変更を加えました。 この変更は、当社の標準プロトコル サポートの向上、またサードパーティの ID ライブラリとの相互運用性の向上を目的としています。 ただし、既存のアプリの中断を回避するために、お客様が必要に応じてオプトインできるようにする次のプロパティを作成しました。

* **発行者 (iss) 要求**: トークンを発行した Azure AD B2C テナントを特定します。
  * `https://login.microsoftonline.com/{B2C tenant GUID}/v2.0/`: これが既定値です。
  * `https://login.microsoftonline.com/tfp/{B2C tenant GUID}/{Policy ID}/v2.0/`: この値には、B2C テナントと、トークン要求で使用されるポリシーの両方の ID が含まれています。 アプリまたはライブラリで Azure AD B2C を [OpenID Connect Discovery 1.0 仕様](http://openid.net/specs/openid-connect-discovery-1_0.html)に準拠させる必要がある場合は、この値を使用します。
* **サブジェクト (sub) 要求**: エンティティ、つまり、トークンが情報をアサートするユーザーを特定します。
  * **ObjectID**: これが既定値です。 ディレクトリ内のユーザーのオブジェクト ID を、トークンの `sub` 要求に設定します。
  * **サポートされていません**: これは、下位互換の場合にのみ用意されており、可能であればすぐに **ObjectID** に切り替えることをお勧めします。
* **ポリシー ID を表す要求**: トークン要求で使用されるポリシー ID を設定する要求の種類を特定します。
  * **tfp**: これが既定値です。
  * **acr**: これは、下位互換の場合にのみ用意されており、可能であればすぐに `tfp` に切り替えることをお勧めします。

## <a name="session-behavior"></a>セッションの動作

Azure AD B2C がサポートしている [OpenID Connect 認証プロトコル](active-directory-b2c-reference-oidc.md) を使用して、Web アプリケーションへの安全なサインインを実現できます。 次のプロパティを使用して、Web アプリケーション セッションを管理できます。

* **[Web app session lifetime (minutes) (Web アプリ セッション有効期間 (分))]**: ユーザーのブラウザーに保存した Azure AD B2C のセッション Cookie が正常に認証される有効期間。
  * 既定値 = 1,440 分。
  * 最小値 (この値を含む) = 15 分。
  * 最大値 (この値を含む) = 1,440 分。
* **[Web app session timeout (Web アプリ セッションのタイムアウト)]**: このスイッチを **[絶対]** に設定すると、**[Web app session lifetime (minutes) (Web アプリ セッション有効期間 (分))]** で指定した期間の経過後に、強制的にユーザーを再認証します。 このスイッチを **[ローリング]** (既定値) に設定すると、ユーザーが Web アプリケーションでアクティブな状態を継続している限り、そのユーザーのサインインは継続されます。

次の 2 つのユース ケースは、これらのプロパティを使用して実現できます。

* 適切な Web アプリケーション セッション有効期間を設定して、業界のセキュリティ要件やコンプライアンス要件を満たすことができます。
* ユーザーが Web アプリケーションの高セキュリティ部分を操作しているときに、設定期間が過ぎると、強制的に再認証を実施できます。 

    > [!NOTE]
    > これらの設定は、パスワード リセット ポリシーでは使用できません。
    > 
    > 

## <a name="single-sign-on-sso-configuration"></a>シングル サインオン (SSO) の構成
B2C テナントで複数のアプリケーションやポリシーを運用している場合は、 **シングル サインオン構成** プロパティを使用して、アプリケーションやポリシー間でのユーザーの操作を管理できます。 以下のいずれかのプロパティを設定することができます。

* **[テナント]**: これは既定の設定です。 この設定を使用すると、B2C テナント内の複数のアプリケーションとポリシーで同じユーザー セッションを共有できます。 たとえば、ユーザーが Contoso Shopping というアプリケーションにサインインすると、そのユーザーは別のアプリケーション Contoso Pharmacy にもシームレスにアクセスできます。
* **[アプリケーション]**: この設定を行うと、ユーザー セッションは、特定のアプリケーション専用として、他のアプリケーションから独立して維持されます。 たとえば、ユーザーが既に Contoso Shopping にサインインしている場合でも、同じ B2C テナントの別のアプリケーションである Contoso Pharmacy に (同じ資格情報で) サインインするように指定できます。 
* **[ポリシー]**: この設定を行うと、ユーザー セッションは、アプリケーションにかかわらず、特定のポリシー専用として維持されます。 たとえば、ユーザーがサインインを済ませ、Multi-Factor Authentication (MFA) ステップを完了すると、ポリシーに関連付けられたセッションが期限切れになるまで、ユーザーは複数のアプリケーションの高セキュリティ部分にアクセスできます。
* **[無効]**: この設定は、ポリシーの実行時に毎回、ユーザーの完全な手続きを必要とします。 これにより、たとえば (共有デスクトップのシナリオで)、1 人のユーザーがアプリケーションへのサインインを終始継続していても、複数のユーザーがそのアプリケーションにサインインすることができます。

    > [!NOTE]
    > これらの設定は、パスワード リセット ポリシーでは使用できません。
    > 
    > 

