---
title: 機械学習 - Azure Cognitive Services | Microsoft Docs
description: コンテキストに応じた意思決定を行うことができるクラウドベースの API である、Azure Custom Decision Service での機械学習に関するチュートリアル。
services: cognitive-services
author: slivkins
manager: slivkins
ms.service: cognitive-services
ms.topic: article
ms.date: 05/08/2018
ms.author: slivkins;marcozo;alekh
ms.openlocfilehash: 50814d67ee39c6657954610358462d877843416e
ms.sourcegitcommit: 95d9a6acf29405a533db943b1688612980374272
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/23/2018
ms.locfileid: "35377024"
---
# <a name="machine-learning"></a>機械学習

このチュートリアルでは、Custom Decision Service の高度な機械学習機能について説明します。 このチュートリアルは、[特性付け](#featurization-concepts-and-implementation)および[特性仕様](#feature-specification-format-and-apis)という 2 つの部分で構成されています。 機械学習では、特性付けはデータを "特性" として表すことを指します。 特性仕様では、特性を指定するための JSON 形式と補助的な API について説明します。

既定では、Custom Decision Service での機械学習はお客様に対して透過的になります。 特性は自動的にコンテンツから抽出され、標準的な強化学習アルゴリズムが使用されます。 特性抽出では、[Entity Linking](../entitylinking/home.md)、[Text Analytics](../text-analytics/overview.md)、[Emotion](../emotion/home.md)、[Computer Vision](../computer-vision/home.md) など、他のいくつかの Azure Cognitive Services を活用します。 このチュートリアルは、既定の機能が使用される場合にのみ、スキップできます。

## <a name="featurization-concepts-and-implementation"></a>特性付け: 概念と実装

Custom Decision Service では、1 つずつ決定していきます。 決定ごとに、いくつかの代替候補 (アクションともいう) から選択します。 アプリケーションに応じて、決定の際に 1 つのアクション、またはアクションの (短い) ランク付けされたリストを選択できます。

たとえば、Web サイトのフロント ページでの記事の選択をパーソナライズできます。 ここでは、アクションは記事に対応しており、各決定は特定のユーザーに表示される記事となります。

各アクションは、プロパティのベクターで表され、以後、*特性*と呼びます。 自動的に抽出される特性に加え、新しい特性を指定することができます。 一部の特性をログに記録するよう Custom Decision Service に指示することもできますが、機械学習では無視します。

### <a name="native-vs-internal-features"></a>ネイティブ特性と内部特性

数値、文字列、配列など、アプリケーションに最も自然な形式で特性を指定することができます。 これらの特性は "ネイティブ特性" と呼ばれます。 Custom Decision Service では、各ネイティブ特性を 1 つ以上の数値特性 ("内部特性" という) に変換します。

内部特性への変換は次のとおりです。

- 数値特性は変わりません。
- 数値配列では、配列の要素ごとに 1 つずつ、いくつかの数値特性に変換します。
- 文字列値特性 `"Name":"Value"` は、既定で、名前が `"NameValue"` で値が 1 の特性に変換されます。
- 必要に応じて、文字列を [bag-of-words](https://en.wikipedia.org/wiki/Bag-of-words_model) として表すことができます。 その後、文字列内の単語ごとに内部特性が作成され、その値はこの単語の出現回数となります。
- 0 値の内部特性は省略されます。

### <a name="shared-vs-action-dependent-features"></a>共有特性とアクション依存特性

一部の特性は決定全体を指しており、すべてのアクションに対して同じものです。 これを*共有特性*と呼びます。 その他の特性は特定のアクションに固有のものです。 これを*アクション依存特性* (ADF) と呼びます。

実行例では、共有特性で世界のユーザーや状況について記述することができます。 たとえば、ユーザーの位置情報、年齢、性別、現在発生している主なイベントなどの特性です。 アクション依存特性では、この記事で説明されているトピックなど、特定の記事のプロパティを記述することができます。

### <a name="interacting-features"></a>特性の相互作用

多くの場合、特性は "相互に作用" しています。つまり、1 つの特性の影響は別の特性に依存しています。 たとえば、特性 X が、ユーザーがスポーツに関心があるかどうかであるとします。 特性 Y は、特定の記事がスポーツに関するものであるかどうかです。 したがって、特性 Y の影響は特性 X に大きく依存しています。

特性 X と Y の間の相互作用を説明するために、値が X\*Y の*二次* 特性を作成します  (X と Y を "交差させる" ともいう)。交差する特性のペアを選択することができます。

> [!TIP]
> 共有特性は、ランクに影響するように、アクション依存特性と交差する必要があります。 アクション依存特性は、パーソナル化のために、共有特性と交差する必要があります。

つまり、どの ADF とも交差しない共有特性は同じように各アクションに影響します。 どの共有特性とも交差しない ADF は、各決定にも影響します。 このような種類の特性では、報酬推定値の差異が減る可能性があります。

### <a name="implementation-via-namespaces"></a>実装と名前空間

ポータルで "VW コマンド ライン" を使用して、交差特性 (および他の特性付けの概念) を実装することができます。 構文は [Vowpal Wabbit](http://hunch.net/~vw/) コマンド ラインに基づきます。

実装の中心となるのは、*名前空間* (特性の名前付きサブセット) の概念です。 各特性は 1 つの名前空間にのみ属しています。 特性値が Custom Decision Service に提供されている場合は、名前空間を明示的に指定できます。 これは、VW コマンド ラインで特性を参照する唯一の方法です。

名前空間は "共有" か "アクション依存" のいずれかになります。つまり、共有特性のみで構成されているか、同じアクションのアクション依存特性のみで構成されています。

> [!TIP]
> 明示的に指定された名前空間で特性をラップすることをお勧めします。 関連する特性は同じ名前空間にグループ化します。

名前空間が指定されていない場合、特性は自動的に既定の名前空間に割り当てられます。

> [!IMPORTANT]
> 特性と名前空間はアクション間で一貫している必要はありません。 つまり、名前空間にはアクションに応じて別の特性を含めることができます。 さらに、特定の名前空間を一部のアクションにのみ定義することができます。

同じ文字列値のネイティブ特性からの複数の内部特性は、同じ名前空間にグループ化されます。 異なる名前空間にある 2 つのネイティブ特性は、名前が同じでも、別のものとして扱われます。

> [!IMPORTANT]
> 長い説明的な名前空間 ID が一般的ですが、VW コマンド ラインでは、ID が同じ文字で始まる名前空間は区別されません。 以下では、名前空間 ID は、`x` や `y` などの 1 文字です。

実装の詳細は次のとおりです。

- 名前空間の `x` と `y` を交差させるには、`-q xy` または `--quadratic xy` を記述します。 これで、`x` の各特性は、`y` の各特性と交差します。 `-q x:` を使用して、`x` を各名前空間と交差させ、`-q ::` を使用して、名前空間のすべてのペアを交差させます。

- 名前空間 `x` のすべての特性を無視するには、`--ignore x` を記述します。

これらのコマンドは、名前空間が定義されるたびに、各アクションに個別に適用されます。

### <a name="estimated-average-as-a-feature"></a>特性としての推定平均

思考実験として、特定のアクションがすべての決定に対して選択された場合の平均報酬について考えてみます。 このような平均報酬は、このアクションの "全体的な質" を測る基準として使用できます。 一部の決定で代わりに他のアクションがいつ選択されたかは、正確にはわかりません。 ただし、強化学習手法を使用して推定することができます。 この推定値の質は、通常、時間の経過と共に向上します。

この "推定平均報酬" を特定のアクションの特性として含めるように選択できます。 その後、Custom Decision Service では、新しいデータが到着したときにこの推定値が自動的に更新されます。 この特性は、このアクションの*限界特性* と呼ばれます。 この限界特性は、機械学習と監査で使用できます。

限界特性を追加するには、VW コマンド ラインに `--marginal <namespace>` を記述します。 JSON で次のように `<namespace>` を定義します。

```json
{<namespace>: {"mf_name":1 "action_id":1}
```

特定のアクションの他のアクション依存特性と共に、この名前空間を挿入します。 すべての決定に対して同じ `mf_name` と `action_id` を使用して、決定ごとにこの定義を指定します。

限界特性は、`<namespace>` と共に各アクションに対して追加されます。 `action_id` は、アクションを一意に識別する特性名にすることができます。 特性名は `mf_name` に設定されます。 つまり、`mf_name` が異なる限界特性は別の特性として扱われ、各 `mf_name` について、別の重みが学習されます。

既定の使用法では、`mf_name` はすべてのアクションに対して同じになります。 その後、すべての限界特性について、1 つの重みが学習されます。

値は同じでも特性名が異なる、同じアクションに対して、複数の限界特性を指定することもできます。

```json
{<namespace>: {"mf_name1":1 "action_id":1 "mf_name2":1 "action_id":1}}
```

### <a name="1-hot-encoding"></a>1 ホット エンコード

各ビットが使用可能な値の範囲に対応する場合は、ビット ベクターとして一部の特性を表すように選択できます。 特性がこの範囲内にある場合にのみ、このビットが 1 に設定されます。 したがって、1 つの "ホット" ビットが 1 に設定され、その他は 0 に設定されます。 この表現は、一般的に *1 ホット エンコード* として知られています。

1 ホット エンコードは、本質的に意味のある数値表現がない、"地理的領域" などのカテゴリ特性では一般的です。 報酬への影響が非線形になる可能性がある数値特性の場合にもお勧めします。 たとえば、特定の記事が特定の年齢グループに関係しており、それより高いまたは低い年齢の人には関係ない場合があります。

文字列値特性は、既定では 1 ホット エンコードされます。つまり、指定可能な値ごとに別の内部特性が作成されます。 数値特性やカスタマイズされた範囲に対する自動 1 ホット エンコードは、現在、提供されていません。

> [!TIP]
> 機械学習アルゴリズムでは、特定の内部特性の指定可能なすべての値が (共通の "重み" を使用して) 一様に扱われます。 1 ホット エンコードでは、値の範囲ごとに別の "重み" を使用できます。 範囲を小さくすると、十分なデータが収集された後によりよい報酬が得られます。ただし、より良い報酬を得るために変換する必要があるデータ量が増える可能性があります。

## <a name="feature-specification-format-and-apis"></a>特性仕様: 形式と API

いくつかの補助的な API を使用して、特性を指定することができます。 すべての API で共通の JSON 形式が使用されます。 API と形式を概念レベルで以下に示します。 仕様は Swagger スキーマで補完されます。

特性仕様の基本的な JSON テンプレートは次のとおりです。

```json
{
"<name>":<value>, "<name>":<value>, ... ,
"namespace1": {"<name>":<value>, ... },
"namespace2": {"<name>":<value>, ... },
...
}
```

ここでは、`<name>` と `<value>` はそれぞれ特性名と特性値を意味します。 `<value>` は文字列、整数、浮動小数点、ブール値、配列にすることができます。 名前空間にラップされていない特性は、自動的に既定の名前空間に割り当てられます。

bag-of-words として文字列を表すには、`"<name>":<value>` ではなく、特別な構文の `"_text":"string"` を使用します。 実際には、文字列内の単語ごとに別の内部特性が作成されます。 その値はこの単語の出現回数となります。

`<name>` が "_" で始まる (しかし `"_text"` ではない) 場合、特性は無視されます。

> [!TIP]
> 場合によっては、複数の JSON ソースから特性をマージします。 便宜上、次のように表すことができます。
>
> ```json
> {
> "source1":<features>,
> "source2":<features>,
> ...
> }
> ```

ここでは、`<features>` は、前に定義した基本的な特性仕様を指します。 深いレベルの "入れ子" も使用できます。 Custom Decision Service では、`<features>` として解釈できる "最も深い" JSON オブジェクトが自動的に検出されます。

#### <a name="feature-set-api"></a>Feature Set API

Feature Set API では、前述の JSON 形式で特性のリストが返されます。 いくつかの Feature Set API エンドポイントを使用することができます。 各エンドポイントは、特性セット ID と URL で識別されます。 特性セット ID と URL 間のマッピングは、ポータルで設定されます。

JSON の適切な場所に対応する特性セット ID を挿入して、Feature Set API を呼び出します。 アクション依存特性の場合、呼び出しはアクション ID で自動的にパラメーター化されます。同じアクションに対して、複数の特性セット ID を指定することができます。

#### <a name="action-set-api-json-version"></a>Action Set API (JSON バージョン)

Action Set API は、アクションと特性が JSON で指定されるバージョンです。 特性は明示的に、また Feature Set API を使用して指定することができます。 共有特性は、すべてのアクションに対して 1 回指定できます。

#### <a name="ranking-api-http-post-call"></a>Ranking API (HTTP POST 呼び出し)

Ranking API は、HTTP POST 呼び出しを使用するバージョンです。 この呼び出しの本文では、フレキシブルな JSON 構文を使用して、アクションと特性を指定します。

アクションは明示的に、またアクション セット ID を使用して指定することができます。 アクション セット ID が検出されるたびに、対応する Action Set API エンドポイントの呼び出しが実行されます。

Action Set API については、特性を明示的に、また Feature Set API を使用して指定することができます。 共有特性は、すべてのアクションに対して 1 回指定できます。