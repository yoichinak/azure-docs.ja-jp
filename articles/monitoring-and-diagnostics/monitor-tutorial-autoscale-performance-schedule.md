---
title: パフォーマンス データまたはスケジュールに基づいて Azure リソースを自動スケールする
description: メトリック データとスケジュールを使用して App Service プランの自動スケール設定を作成します。
author: anirudhcavale
services: azure-monitor
ms.service: azure-monitor
ms.topic: tutorial
ms.date: 12/11/2017
ms.author: ancav
ms.custom: mvc
ms.component: autoscale
ms.openlocfilehash: b63e1fa316e9ebeaa564731b8bb0bc3ed5ba9036
ms.sourcegitcommit: 1b8665f1fff36a13af0cbc4c399c16f62e9884f3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "35264063"
---
# <a name="create-an-autoscale-setting-for--azure-resources-based-on-performance-data-or-a-schedule"></a>パフォーマンス データまたはスケジュールに基づいて自動スケール設定を作成する

自動スケール設定を行うと、事前設定した条件に基づいてサービスのインスタンスを追加または削除することができます。 これらの設定は、ポータルで作成できます。 この方法では、ブラウザーベースのユーザー インターフェイスで、自動スケール設定を作成および構成できます。 

このチュートリアルでは、次のことについて説明します。 
> [!div class="checklist"]
> * Web アプリおよび App Service プランを作成する
> * Web アプリが受信する要求の数に基づくスケールインおよびスケールアウトの自動スケール ルールを構成する
> * スケールアウト アクションをトリガーして、インスタンス数の増加を監視する
> * スケールイン アクションをトリガーして、インスタンス数の減少を監視する
> * リソースをクリーンアップする

Azure サブスクリプションをお持ちでない場合は、開始する前に[無料](https://azure.microsoft.com/free/)アカウントを作成してください。

## <a name="log-in-to-the-azure-portal"></a>Azure Portal にログインする

[Azure Portal](https://portal.azure.com/) にログインします。

## <a name="create-a-web-app-and-app-service-plan"></a>Web アプリおよび App Service プランを作成する
1. 左側のナビゲーション ウィンドウの **[リソースの作成]** オプションをクリックします。
2. *[Web アプリ]* 項目を検索して選択し、**[作成]** をクリックします。
3. *MyTestScaleWebApp* のようなアプリ名を選択します。 新しいリソース グループ 'myResourceGroup' を作成し、選択したリソース グループに配置します。

数分以内に、リソースがプロビジョニングされます。 このチュートリアルの残りの部分では、この Web アプリとそれに対応する App Service プランを使用します。

   ![ポータルで新しい App Service を作成する](./media/monitor-tutorial-autoscale-performance-schedule/Web-App-Create.png)

## <a name="navigate-to-autoscale-settings"></a>自動スケール設定に移動する
1. 左側のナビゲーション ウィンドウで **[監視]** オプションを選択します。 ページを読み込んだ後、**[自動スケール]** タブを選択します。
2. 自動スケールをサポートする、サブスクリプション内のリソースのリストが、ここに表示されます。 チュートリアルの前半で作成した App Service プランを特定し、クリックします。

    ![自動スケール設定に移動する](./media/monitor-tutorial-autoscale-performance-schedule/monitor-blade-autoscale.png)

3. 自動スケール設定で、**[自動スケールの有効化]** をクリックします。

以下のいくつかの手順を行うと、自動スケール設定の画面を次の画像のように設定できます。

   ![自動スケール設定を保存する](./media/monitor-tutorial-autoscale-performance-schedule/Autoscale-Setting-Save.png)

 ## <a name="configure-default-profile"></a>既定のプロファイルを構成する
1. 自動スケール設定に**名前**を指定します。
2. 既定のプロファイルで **[スケール モード]** が [特定のインスタンス数にスケーリングする] に設定されていることを確認します。
3. インスタンス数を **1** に設定します。 このように設定すると、他のプロファイルがアクティブでない場合、または有効でない場合、既定のプロファイルのインスタンス数が 1 に戻ります。

  ![自動スケール設定に移動する](./media/monitor-tutorial-autoscale-performance-schedule/autoscale-setting-profile.png)


## <a name="create-recurrance-profile"></a>定期プロファイルを作成する

1. 既定のプロファイルの下の、**[Add a scale condition]\(スケール条件の追加\)** リンクをクリックします。

2. このプロファイルの**名前**を編集して、"月曜日から金曜日までのプロファイル" にします。

3. **[スケール モード]** が [メトリックに基づいてスケーリングする] になっていることを確認します。

4. **インスタンスの制限**で、**最小**を 1、**最大** を 2、**既定** を 1 に設定します。 この設定を行うと、このプロファイルでは、インスタンス数が 1 を下回るまたは 2 を超えるサービス プランの自動スケールは行われなくなります。 プロファイルに、決定に必要なデータが不足している場合、既定のインスタンス数 (この場合は 1) を使用します。

5. **[スケジュール]** で、[特定の日数を繰り返す] を選択します。

6. 月曜日から金曜日の 09:00 PST から 18:00 PST まで繰り返すように、プロファイルを設定します。 この設定を行うと、このプロファイルは、月曜日から金曜日の午前 9 時から午後 6 時まで有効になり適用されます。 それ以外の時間は、[既定] プロファイルが自動スケール設定で使用されます。

## <a name="create-a-scale-out-rule"></a>スケール アウト ルールを作成する

1. [月曜日から金曜日までのプロファイル] を表示します。

2. **[Add a rule]\(ルールの追加\)** リンクをクリックします。

3. **メトリック ソース**を [その他のリソース] に設定します。 **リソースの種類**を [App Services]、**リソース**を、このチュートリアルの前半で作成した Web アプリに設定します。

4. **[時間の集計]** を [合計]、**[メトリック名]** を [要求]、**[時間グレインの統計]** を [合計] に設定します。

5. **演算子**を [より大きい]、**しきい値**を 10、**期間**を 5 分に設定します。

6. **[操作]** は [カウントを増やす量]、**[インスタンス数]** は 1、**[クール ダウン]** は 5 分を選択します。

7. **[追加]** をクリックします。

このルールでは、Web アプリが 5 分以内に 10 を超える要求を受信した場合に、負荷を管理するために 1 つのインスタンスが App Service プランに追加されます。

   ![スケール アウト ルールを作成する](./media/monitor-tutorial-autoscale-performance-schedule/Scale-Out-Rule.png)

## <a name="create-a-scale-in-rule"></a>スケール イン ルールを作成する
必ずスケール アウト ルールに対応するスケール イン ルールを設定することをお勧めします。 両方のルールを設定すると、リソースのオーバー プロビジョニングを防ぐことができます。 オーバー プロビジョニングとは、現在の読み込みの処理に必要な数より多くのインスタンスが実行されることを意味します。 

1. [月曜日から金曜日までのプロファイル] を表示します。

2. **[Add a rule]\(ルールの追加\)** リンクをクリックします。

3. **メトリック ソース**を [その他のリソース] に設定します。 **リソースの種類**を [App Services]、**リソース**を、このチュートリアルの前半で作成した Web アプリに設定します。

4. **[時間の集計]** を [合計]、**[メトリック名]** を [要求]、**[時間グレインの統計]** を [平均] に設定します。

5. **演算子**を [未満]、**しきい値**を 5、**期間**を 5 分に設定します。

6. **[操作]** は [カウントを減らす量]、**[インスタンス数]** は 1、**[クール ダウン]** は 5 分を選択します。

7. **[追加]** をクリックします。

    ![スケール イン ルールを作成する](./media/monitor-tutorial-autoscale-performance-schedule/Scale-In-Rule.png)

8. 自動スケール設定を**保存**します。

    ![自動スケール設定を保存する](./media/monitor-tutorial-autoscale-performance-schedule/Autoscale-Setting-Save.png)

## <a name="trigger-scale-out-action"></a>スケール アウト アクションをトリガーする
上記で作成した自動スケール設定でスケール アウト条件をトリガーするには、Web アプリに 5 分以内に 10 件を超える要求が必要となります。

1. ブラウザー ウィンドウを開き、このチュートリアルの前半で作成した Web アプリに移動します。 Azure Portal で Web アプリの URL を見つけるには、Web アプリのリソースに移動し、[概要] タブの **[参照]** ボタンをクリックします。

2. 立て続けにページを 11 回以上再読み込みします。

3. 左側のナビゲーション ウィンドウで **[監視]** オプションを選択します。 ページを読み込んだ後、**[自動スケール]** タブを選択します。

4. リストから、このチュートリアルで使用する App Service プランを選択します。

5. 自動スケール設定で、**[実行履歴]** タブをクリックします。

6. 時間の経過に伴った App Service プランのインスタンス数を反映したグラフが表示されます。

7. 数分後に、インスタンス数が 1 から 2 に増加します。

8. グラフの下には、この自動スケール設定によって行われた各スケール アクションのアクティビティ ログ エントリが表示されます。

## <a name="trigger-scale-in-action"></a>スケール イン アクションをトリガーする
自動スケール設定のスケール イン条件は、Web アプリへの要求が 10 分間で 5 件未満の場合にトリガーされます。 

1. Web アプリに要求が送信されていないことを確認します。

2. Azure Portal を読み込みます。

3. 左側のナビゲーション ウィンドウで **[監視]** オプションを選択します。 ページを読み込んだ後、**[自動スケール]** タブを選択します。

4. リストから、このチュートリアルで使用する App Service プランを選択します。

5. 自動スケール設定で、**[実行履歴]** タブをクリックします。

6. 時間の経過に伴った App Service プランのインスタンス数を反映したグラフが表示されます。

7. 数分後に、インスタンス数が 2 から 1 に減少します。 このプロセスには、少なくとも 100 分はかかります。  

8. グラフの下には、この自動スケール設定によって行われた各スケール アクションのアクティビティ ログ エントリが表示されます。

    ![スケール イン アクションを表示する](./media/monitor-tutorial-autoscale-performance-schedule/Scale-In-Chart.png)

## <a name="clean-up-resources"></a>リソースのクリーンアップ

1. Azure Portal の左側のメニューにある **[すべてのリソース]** をクリックし、このチュートリアルで作成した Web アプリを選択します。

2. リソース ページで **[削除]** をクリックします。削除することを確認するためにテキスト ボックスに「**yes**」と入力してから、**[削除]** をクリックします。

3. App Service プランのリソースを選択し、**[削除]** をクリックします。

4. 削除することを確認するためにテキスト ボックスに「**yes**」と入力してから、**[削除]** をクリックします。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、次のことを行いました。  
> [!div class="checklist"]
> * Web アプリおよび App Service プランを作成する
> * Web アプリが受信する要求の数に基づくスケールインおよびスケールアウトの自動スケール ルールを構成する
> * スケールアウト アクションをトリガーして、インスタンス数の増加を監視する
> * スケールイン アクションをトリガーして、インスタンス数の減少を監視する
> * リソースをクリーンアップする


自動スケール設定の詳細については、[自動スケールの概要](monitoring-overview-autoscale.md)に関する記事をご覧ください。

> [!div class="nextstepaction"]
> [監視データをアーカイブする](monitor-tutorial-archive-monitoring-data.md)
