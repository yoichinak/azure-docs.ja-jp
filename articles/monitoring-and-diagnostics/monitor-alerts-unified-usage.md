---
title: Azure Monitor を使用してアラートを作成、表示、管理する
description: 新しい Azure アラートの統合されたエクスペリエンスを使用して、1 か所でメトリックとログ アラート ルールを作成、表示、管理します。
author: msvijayn
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 02/05/2018
ms.author: vinagara
ms.component: alerts
ms.openlocfilehash: 77aa6805094d44d16eea9ac671316c9702423e6c
ms.sourcegitcommit: 1d850f6cae47261eacdb7604a9f17edc6626ae4b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/02/2018
ms.locfileid: "39433404"
---
# <a name="create-view-and-manage-alerts-using-azure-monitor"></a>Azure Monitor を使用してアラートを作成、表示、管理する  

## <a name="overview"></a>概要
この記事では、Azure Portal 内の新しいアラート インターフェイスを使ってアラートを設定する方法を説明します。 アラート ルールの定義は、次の 3 つの部分に分かれています。
- [対象]: 監視される特定の Azure リソース
- [条件]: Signal で確認された場合にアクションをトリガーする特定の条件またはロジック
- [アクション]: 電子メール、SMS、Webhook などの通知の受信者に送信される特定の呼び出し。

また、Azure アラートには、お使いのすべてのアラート ルールを表示する統合されたビューと、それらを 1 か所で管理する、未解決アラートの表示機能などの機能があります。 機能について詳しくは、[Azure アラートの概要](monitoring-overview-unified-alerts.md)に関するページをご覧ください。

アラートでは、**ログ アラート**という用語を使ってアラートを説明します。このアラートでは、[Log Analytics](../log-analytics/log-analytics-tutorial-viewdata.md) または [Application Insights](../application-insights/app-insights-analytics.md) に基づいて、シグナルがカスタム クエリとなります。 [新しいメトリック アラート機能](monitoring-near-real-time-metric-alerts.md)では、特定の Azure リソースの[多次元メトリック](monitoring-metric-charts.md)について警告する機能が提供されます。 そのようなリソースのアラートでは、ディメンションに対して追加のフィルターを使って、**多次元メトリック アラート**を作成できます。


> [!NOTE]
> Azure アラートには、Azure でアラートを作成するための、新しいエクスペリエンスや改良されたエクスペリエンスが用意されています。 既存の[アラート (クラシック)](monitoring-overview-alerts.md) エクスペリエンスは引き続き使用できます
>

以下の詳細は、Azure アラートを使用するためのステップ バイ ステップ ガイドです。

## <a name="create-an-alert-rule-with-the-azure-portal"></a>Azure Portal でアラート ルールを作成する
1. [ポータル](https://portal.azure.com/)で **[モニター]** を選び、[モニター] セクションで **[アラート]** を選びます。  
    ![監視](./media/monitor-alerts-unified/AlertsPreviewMenu.png)

1. **[新しいアラート ルール]** を選択して、Azure 内で新しいアラートを作成します。
    ![アラートの追加](./media/monitor-alerts-unified/AlertsPreviewOption.png)

1. [アラートの作成] セクションが表示されます。*[アラートの条件を定義します]*、*[アラートの詳細を定義します]*、*[アクション グループを定義します]* の 3 つのセクションで構成されています。

    ![ルールを作成する](./media/monitor-alerts-unified/AlertsPreviewAdd.png)

1.  **[リソースの選択]** のリンクを使用してターゲットを指定し、リソースを選択することで、アラートの条件を定義します。 *サブスクリプション、*リソースの種類を選択し、最後に必要な "*リソース*" を選択して、フィルターを適用します。

    >[!NOTE]

    > 続行する前に、選択したリソースに使用可能なシグナルを確認します。

    ![リソースの選択](./media/monitor-alerts-unified/Alert-SelectResource.png)

 ユーザー インターフェイスでは、1 か所からさまざまな種類のアラートを作成することができます。 必要なアラートの種類に基づいて、次の手順を選びます。

    - **メトリック アラート**の場合は、手順 5 から 7 に従い、そのあと手順 11 に進む
    - **ログ アラート**の場合は、手順 8 以降に進む

    > [!NOTE]

    > アクティビティ ログ アラートもサポートされていますが、まだプレビューです。 [詳細情報](monitoring-activity-log-alerts-new-experience.md)。

1. "*メトリック アラート*": **[リソースの種類]** がシグナルの種類と共に **[メトリック]** として選択されていることを確認し、適切な**リソース**を選択したら、"*[完了]*" をクリックして [アラートの作成] に戻ります。 次に **[条件の追加]** を使用して、シグナル オプションの一覧にある特定のシグナル、それらの監視サービス、先ほど選択したリソースで使用可能な種類を選択します。

    ![リソースの選択](./media/monitor-alerts-unified/AlertsPreviewResourceSelection.png)

    > [!NOTE]

    >  すべての[ほぼリアルタイムのアラート](monitoring-near-real-time-metric-alerts.md)対応リソースは、モニター サービスが **[プラットフォーム]**、シグナルの種類が **[メトリック]** として一覧表示されます

1. *メトリック アラート*: シグナルを選択すると、アラート設定のロジックを宣言できます。 参考として、直近の 6 時間から最後の週までさまざまな時間枠を **[履歴の表示]** を使用して微調整するオプションとともに、シグナルの履歴データが表示されます。 所定の視覚エフェクトを使用して、表示される [条件]、[集計]、[しきい値] のオプションから**アラート ロジック**を選択できます。 ロジックのプレビューから分かるように、シグナルの履歴とともに条件が視覚エフェクトで表示され、アラートがトリガーされた時間を示します。 最後に、**[期間]** オプションから選択して Alert が指定条件を探す期間を指定し、**[頻度]** を選択して Alert が実行される頻度を指定します。

    ![メトリックのシグナル ロジックの構成](./media/monitor-alerts-unified/AlertsPreviewCriteria.png)

1. *メトリック アラート*: シグナルがメトリックの場合、この Azure リソースの複数のデータ ポイントまたはデータ ディメンションを使用して、アラート ウィンドウをフィルタリングできます。 

    a. 異なる期間を視覚化するには、**[履歴の表示]** ドロップダウンから期間を選びます。 サポートされるメトリックのディメンションを選んで、タイム シリーズでフィルター処理できます。ディメンションの選択は任意であり、最大 5 つのディメンションを使うことができます。 

    b. 表示される *[条件]*、*集計、*[しきい値]* のオプションから**アラート ロジック**を選択できます。 ロジックのプレビューが提供するように、シグナルの履歴とともに条件が視覚エフェクトで表示され、アラートがトリガーされた過去の時間を示します。 

    c. 期間を指定するには、**[期間]** を選択し、**[頻度]** でアラートの実行頻度を指定します。

    ![多次元メトリックのシグナル ロジックの構成](./media/monitor-alerts-unified/AlertsPreviewCriteriaMultiDim.png)

1. "*ログ アラート*": **[リソースの種類]** が *Log Analytics* または *Application Insights* のような分析ソースであり、シグナルの種類が **[ログ]** であることを確認し、適切な**リソース**を選択したら、"*[完了]*" をクリックします。 次に **[条件の追加]** をクリックして、そのリソースで使用できるシグナル オプションの一覧を表示し、シグナル一覧から、*Log Analytics* または *Application Insights* などの選択したログ監視サービスの **[Custom log search]\(カスタム ログ検索\)** オプションを選択します。

   ![リソースの選択 - カスタム ログ検索](./media/monitor-alerts-unified/AlertsPreviewResourceSelectionLog.png)

   > [!NOTE]

   > アラート リストは上の図に示すように、分析クエリをシグナルの種類 - **[Log (Saved Query)]\(ログ (保存されたクエリ)\)** としてインポートできます。 したがって、ユーザーは Analytics でクエリを完成させ、将来使用するためにクエリをアラートに保存することができます。保存クエリの使用について詳しくは、[ログ分析でのログ検索の使用](../log-analytics/log-analytics-log-searches.md)または [Application Insights 分析 での共有クエリ](../log-analytics/log-analytics-overview.md)に関する記事を参照してください。 

1.  *[ログ アラート]*: 選択すると、アラート設定のクエリを **[検索クエリ]** フィールドで宣言できます。クエリ構文が正しくない場合は、フィールドに赤文字でエラーが表示されます。 クエリ構文が正しい場合は、直近の 6 時間から最後の週までさまざまな時間枠を微調整するオプションとともに、宣言されたクエリの履歴データが参考としてグラフで表示されます。

 ![アラート ルールの構成](./media/monitor-alerts-unified/AlertsPreviewAlertLog.png)

 > [!NOTE]

    > 履歴データの視覚エフェクトは、時間に関する詳細がクエリ結果にある場合のみ表示されます。 ご利用のクエリが集計されたデータまたは特定の列の値になった場合は、単一のプロットとして同じものが表示されます。

    >  Application Insights を使用するメトリック測定タイプのログ アラートでは、以下に示すように、**[集計]** オプションを使用して、データをグループ化する特定の変数を指定できます。

    ![[集計] オプション](./media/monitor-alerts-unified/aggregate-on.png)

1.  *[ログ アラート]*: 所定の視覚エフェクトを使用して、表示される [条件]、[集計]、[しきい値] のオプションから**アラート ロジック**を選択できます。 最後に、そのロジック内で **[期間]** オプションを使用して、指定した条件を評価する期間を指定します。 また、**[頻度]** を選択して Alert を実行する頻度を指定します。
**ログ アラート**の場合、アラートは次のものに基づきます。
   - *[レコード数]*: クエリによって返されるレコード数が、指定した値より大きいまたは小さい場合に、アラートが作成されます。
   - *[メトリック測定]*: 結果内の各*集計値*が指定したしきい値を超え、選択した値で*グループ化*される場合に、アラートが作成されます。 アラートが作成されるための違反数は、選択した期間のしきい値を超えた回数です。 結果セット全体での違反の任意の組み合わせについて違反総数を指定するか、または、違反が連続したサンプルで発生しなければならない必要な連続する違反を指定できます。 [ログ アラートとその種類](monitor-alerts-unified-log.md)の詳細をご覧ください。

    > [!TIP]
    > 現在、アラートでは、ログ検索アラートは数分でカスタムの *[期間]* と *[頻度]* の値を取得できます。 値は 5 分から 1440 分 (つまり 24 時間) までになります。 そのため、たとえばアラートの期間を 3 時間にする場合は、使用前に 180 分に変換します

1. 2 番目の手順として、**[アラート ルール名]** フィールドでご利用のアラートの名前を定義し、そのアラートと指定したオプションからの **[重大度]** の値の詳細を説明する **[説明]** を定義します。 これらの詳細は、Azure Monitor が送信するすべてのアラート メール、通知、またはプッシュ内で再利用されます。 また、ユーザーは **[ルールの作成時に有効にする]** オプションを適切に切り替えることで、作成に関するアラート ルールをすぐにアクティブにすることも選択できます。

    **ログ アラート**の場合のみ、Alert の詳細でいくつかの他の機能を使用できます。

    - **[アラートを表示しない]**: アラート ルールの抑制を有効にすると、新しいアラートを作成した後、定義された期間中、ルールのアクションが無効になります。 ルールは引き続き実行され、条件が満たされればアラート レコードが作成されます。 これにより、同じアクションを繰り返し実行することなく、問題を修正できます。

        ![ログ アラートのアラートを表示しない](./media/monitor-alerts-unified/AlertsPreviewSuppress.png)

        > [!TIP]
        > アラート抑制の値をアラートの頻度より大きくし、通知がオーバーラップすることなく停止されるようにします

1. 3 番目および最後の手順として、アラートの条件が満たされた場合に、どの**アクション グループ**でそのアラート ルールをトリガーする必要があるかを指定します。 アラートのある既存のアクション グループはすべて選択できます。新しいアクション グループを作成することもできます。 選択したアクション グループによって、アラートがトリガーされた場合に、Azure はメールを送信したり、SMS を送信したり、Webhook を呼び出したり、Azure Runbook を使用して復旧したり、ご利用の ITSM ツールにプッシュしたりします。 [アクション グループ](monitoring-action-groups.md)の詳細をご覧ください。

    **ログ アラート**の場合、既定のアクションをオーバーライドするためにいくつかの他の機能を使用できます。

    - **電子メール通知**: 前述のアクション グループに 1 つ以上の電子メール アクションが存在する場合、アクションのグループ経由で送信された電子メール内の "*電子メールの件名*" をオーバーライドします。 メールの本文は変更できず、このフィールドは電子メール アドレス用では**ありません**。
    - **カスタム JSON ペイロードを含める**: 前述のアクション グループに 1 つ以上の webhook アクションが存在する場合、アクション グループによって使用される webhook JSON をオーバーライドします。 ユーザーは、関連付けられているアクション グループで構成されているすべての webhook に使用する JSON の形式を指定できます。webhook 形式について詳しくは、「[ログ アラート ルールの webhook アクション](monitor-alerts-unified-log-webhook.md)」をご覧ください。 webhook オプションは、**テスト**目的のみを意味するラベルが付けられたサンプル JSON とこのオプションを使用して、形式および宛先による処理を確認するために用意されています。

        ![ログ アラートのアクションのオーバーライド](./media/monitor-alerts-unified/AlertsPreviewOverrideLog.png)

        > [!NOTE]
        > **[webhook のテスト]** オプションが機能するには、エンドポイントが[クロス オリジン リソース共有 (CORS)](https://www.w3.org/TR/cors/) をサポートし、ユーザーが CORS プロキシを使用して「Access-Control-Allow-Origin ヘッダーがない」問題を迂回できる必要があります。

1. すべてのフィールドが有効で緑色のチェックマークがついている場合、**[アラート ルールの作成]** をクリックすることができ、アラートが Azure Monitor - アラートで作成されます。 アラート ダッシュボードですべてのアラートを表示できます。

    ![ルールの作成](./media/monitor-alerts-unified/AlertsPreviewCreate.png)

    数分後にアラートがアクティブになり、前述のようにトリガーされます。

## <a name="view-your-alerts-in-azure-portal"></a>アラートを Azure Portal で表示する

1. [ポータル](https://portal.azure.com/)で **[モニター]** を選び、[モニター] セクションで **[アラート]** を選びます。  

1. **アラート ダッシュボード**が表示されます。ここではすべての Azure アラートが 1 つの![アラート ダッシュボード](./media/monitoring-alerts-unified-usage/alerts-preview-overview.png)にまとめられて表示されます
1. 上部の左から右にかけて、ダッシュボードでは次のものが一目で確認できます (クリックすれば詳細な一覧が表示されます)。
    - *[発生したアラートの数]*: 現在ロジックの条件を満たしており、発生状態にあるアラートの数です
    - *[アラート ルールの合計]*: 作成されたアラート ルールの数、およびサブテキスト内で現在有効になっている数です 
    

        > [!NOTE]
        > アプリケーションの分析情報とログ分析に関するログ アラートなど、すべての発生済みアラートの詳細とダッシュボードの一貫性を確保するには、[拡張統合アラート (プレビュー)](monitoring-overview-unified-alerts.md#enhanced-unified-alerts-public-preview) を使用する必要があります
  
  
1. 発生したすべてのアラートを記載した一覧が表示されます。ユーザーがクリックすると詳細が表示されます
1. 特定のアラートを探すのに役立つように、特定のサブスクリプション、*リソース グループ、および/または リソース*をフィルタリングするための、上部にあるドロップダウン オプションを使用できます。 未解決のアラートについては、*[アラートのフィルター]* オプションを使用して、*名前、アラートの条件、リソース グループ、ターゲット リソース*などの指定のキーワードで一致するアラートを探すことができます

## <a name="managing-your-alerts-in-azure-portal"></a>アラートを Azure Portal で管理する
1. [ポータル](https://portal.azure.com/)で **[モニター]** を選び、[モニター] セクションで **[アラート]** を選びます。  
1. 上部のバーにある **[ルールの管理]** を選択して、ルールを管理するセクションに移動します。ここでは、作成されたすべてのアラート ルール (無効にされたアラートも含む) が一覧表示されます。
1. 特定のアラート ルールを探すため、上部にあるドロップダウン フィルターを使用して、特定の*サブスクリプション、リソース グループ、および/または リソース*のアラート ルールを絞り込むことができます。 または、*[アラートのフィルター]* のアラート ルール一覧の上にある検索ウィンドウを使用して、*アラート名、条件、ターゲット リソース*に一致するキーワードを入力して、一致したルールのみを表示できます。
   ![アラート管理ルール](./media/monitoring-alerts-unified-usage/alerts-preview-rules.png)
1. 特定のアラート ルールを表示したり変更したりするには、クリックできるリンクとして表示されているアラートの名前をクリックします。
1. 定義されたアラートは、1) アラートの条件、2) アラートの詳細、3) アクション グループという 3 つの段階構造で表示されます。 **[対象の条件]** をクリックすると、アラート ロジックを変更できます。または、ごみ箱アイコンで既存のロジックを削除したあとに、新しい条件を追加できます。 同様に、[アラートの詳細] セクションで、**[説明]** と **[重大度]** を変更できます。 アクション グループは変更できます。または、**[新しいアクション グループ]** をクリックして新しいアクション グループを作成してアラートにリンクできます。

   ![アラート ルールの変更](./media/monitor-alerts-unified/AlertsPreviewEdit.png)

1. 上部のパネルを使用して、次のようなアラートの変更を反映できます。**[保存]** で、アラートに加えられた変更をコミットします。**[破棄]** で、アラートの変更をコミットせずに戻ります。**[無効]** で、アクションをもう実行しない、またはトリガーしないアラートを非アクティブ化します。 最後に、**[削除]** で、アラート ルール全体を Azure から完全に削除します。

## <a name="next-steps"></a>次の手順

- [ほぼリアルタイムのメトリック アラート](monitoring-near-real-time-metric-alerts.md)について詳しく学習します。
- [メトリック収集の概要](insights-how-to-customize-monitoring.md) 情報を入手して、サービスの可用性と応答性を確認します。
- [Azure アラートのログ アラート](monitor-alerts-unified-log.md)について学習します。
- [アラート (プレビュー) エクスペリエンスのアクティビティ ログ アラートについて確認する](monitoring-activity-log-alerts-new-experience.md)
